<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' plausible.io 'sha256-W1GNp3+VWjJioYCdm8AYiKdLkMCj2IaEzYszX8JFTh4='">
    <meta name="description" content="The financial transactions database to power the next 30 years of Online Transaction Processing.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@TigerBeetleDB">
    <meta name="twitter:author" content="@TigerBeetleDB">
    <meta name="twitter:description" content="The financial transactions database to power the next 30 years of Online Transaction Processing.">
    <meta name="twitter:title" content="TigerBeetle">
    <meta name="twitter:image" content="https://docs.tigerbeetle.com/img/preview.webp">
    <meta property="og:type" content="website">
    <meta property="og:title" content="TigerBeetle">
    <meta property="og:image" content="https://docs.tigerbeetle.com/img/preview.webp">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="TigerBeetle Team">
    <title id="title">TigerBeetle</title>
    <link rel="icon" href="/img/favicon.png">
    <link rel="canonical" href="/single-page/">
    <link rel="stylesheet" type="text/css" href="/style/style.css">
    <link rel="stylesheet" type="text/css" href="/style/highlight.css">
    <script defer data-domain="docs.tigerbeetle.com" src="https://plausible.io/js/script.js"></script>
  </head>
  <body>
    <a class="expand-button" title="Show menu (press M to toggle)">
      <div>
        <svg width="28" height="24" viewBox="0 0 28 24" aria-label="TigerBeetle logo">
          <use href="#svg-tigerbeetle-logo"></use>
        </svg>
        <svg class="tick" width="16" height="16" fill="none">
          <path d="M7 5L10 8L7 11" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
        </svg>
      </div>
    </a>
    <nav class="left-pane">
      <div class="top-wrapper">
        <div class="top">
          <header>
            <div class="logo">
              <a href="https://tigerbeetle.com" aria-label="TigerBeetle website">
                <svg width="127" height="24" viewBox="0 0 127 24" aria-label="TigerBeetle logo">
                  <use href="#svg-tigerbeetle-logo"></use>
                </svg>
              </a>
            </div>
            <div class="line"></div>
            <a href="/">Docs</a>
            <div class="spacer"></div>
            <a class="menu-button">
              <svg class="icon-burger" width="24" height="24">
                <path d="M2.5 5.5 21.5 5.5M2.5 12 21.5 12M2.5 18.5 21.5 18.5" stroke-width="1.5" stroke-linecap="round" stroke="currentColor" />
              </svg>
              <svg class="icon-x" width="24" height="24" fill="none">
                <path d="M6 6 18 18M6 18 18 6" stroke-width="1.5" stroke-linecap="round" stroke="currentColor" />
              </svg>
            </a>
            <a class="collapse-button" title="Hide menu (press M to toggle)">
              <svg width="16" height="16" fill="none">
                <path d="M7 5L4 8L7 11M12 5L9 8L12 11" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
              </svg>
            </a>
          </header>
          
        </div>
      </div>
      
      <nav class="side">
        <ol>
<li class="item"><a href="#start">Start</a></li>
<li>
<details><summary class="item"><a href="#concepts">Concepts</a></summary>
<ol>
<li class="item"><a href="#concepts-oltp">OLTP</a></li>
<li class="item"><a href="#concepts-debit-credit">Debit-Credit</a></li>
<li class="item"><a href="#concepts-performance">Performance</a></li>
<li class="item"><a href="#concepts-safety">Safety</a></li>
</ol>
</details></li>
<li>
<details><summary class="item"><a href="#coding">Coding</a></summary>
<ol>
<li class="item"><a href="#coding-system-architecture">System Architecture</a></li>
<li class="item"><a href="#coding-data-modeling">Data Modeling</a></li>
<li class="item"><a href="#coding-financial-accounting">Financial Accounting</a></li>
<li class="item"><a href="#coding-requests">Requests</a></li>
<li class="item"><a href="#coding-reliable-transaction-submission">Reliable Transaction Submission</a></li>
<li class="item"><a href="#coding-two-phase-transfers">Two-Phase Transfers</a></li>
<li class="item"><a href="#coding-linked-events">Linked Events</a></li>
<li class="item"><a href="#coding-time">Time</a></li>
<li>
<details><summary class="item"><a href="#coding-recipes">Recipes</a></summary>
<ol>
<li class="item"><a href="#coding-recipes-currency-exchange">Currency Exchange</a></li>
<li class="item"><a href="#coding-recipes-multi-debit-credit-transfers">Multi-Debit, Multi-Credit Transfers</a></li>
<li class="item"><a href="#coding-recipes-close-account">Closing Accounts</a></li>
<li class="item"><a href="#coding-recipes-balance-conditional-transfers">Balance-Conditional Transfers</a></li>
<li class="item"><a href="#coding-recipes-balance-invariant-transfers">Balance-Invariant Transfers</a></li>
<li class="item"><a href="#coding-recipes-balance-bounds">Balance Bounds</a></li>
<li class="item"><a href="#coding-recipes-correcting-transfers">Correcting Transfers</a></li>
<li class="item"><a href="#coding-recipes-rate-limiting">Rate Limiting</a></li>
</ol>
</details></li>
<li>
<details><summary class="item"><a href="#coding-clients">Clients</a></summary>
<ol>
<li class="item"><a href="#coding-clients-dotnet">.Net</a></li>
<li class="item"><a href="#coding-clients-go">Go</a></li>
<li class="item"><a href="#coding-clients-java">Java</a></li>
<li class="item"><a href="#coding-clients-node">Node</a></li>
<li class="item"><a href="#coding-clients-python">Python</a></li>
</ol>
</details></li>
</ol>
</details></li>
<li>
<details><summary class="item"><a href="#operating">Operating</a></summary>
<ol>
<li class="item"><a href="#operating-installing">Installing</a></li>
<li class="item"><a href="#operating-hardware">Hardware</a></li>
<li class="item"><a href="#operating-cluster">Cluster</a></li>
<li>
<details><summary class="item"><a href="#operating-deploying">Deploying</a></summary>
<ol>
<li class="item"><a href="#operating-deploying-systemd">systemd</a></li>
<li class="item"><a href="#operating-deploying-docker">Docker</a></li>
<li class="item"><a href="#operating-deploying-managed-service">Managed</a></li>
</ol>
</details></li>
<li class="item"><a href="#operating-upgrading">Upgrading</a></li>
</ol>
</details></li>
<li>
<details><summary class="item"><a href="#reference">Reference</a></summary>
<ol>
<li class="item"><a href="#reference-sessions">Client Sessions</a></li>
<li class="item"><a href="#reference-account">Account</a></li>
<li class="item"><a href="#reference-transfer">Transfer</a></li>
<li class="item"><a href="#reference-account-balance">AccountBalance</a></li>
<li class="item"><a href="#reference-account-filter">AccountFilter</a></li>
<li class="item"><a href="#reference-query-filter">QueryFilter</a></li>
<li>
<details><summary class="item"><a href="#reference-requests">Requests</a></summary>
<ol>
<li class="item"><a href="#reference-requests-create_accounts">create_accounts</a></li>
<li class="item"><a href="#reference-requests-create_transfers">create_transfers</a></li>
<li class="item"><a href="#reference-requests-lookup_accounts">lookup_accounts</a></li>
<li class="item"><a href="#reference-requests-lookup_transfers">lookup_transfers</a></li>
<li class="item"><a href="#reference-requests-get_account_transfers">get_account_transfers</a></li>
<li class="item"><a href="#reference-requests-get_account_balances">get_account_balances</a></li>
<li class="item"><a href="#reference-requests-query_accounts">query_accounts</a></li>
<li class="item"><a href="#reference-requests-query_transfers">query_transfers</a></li>
</ol>
</details></li>
</ol>
</details></li>
</ol>

      </nav>
    </nav>
    <div class="resizer"></div>
    <main>
      <article>
        <aside id="note-nested-css">Note: this site uses nested CSS selectors. Please upgrade your browser or use the reader mode.</aside>
        <a id="github-link" href="https://github.com/tigerbeetle/tigerbeetle">
          GitHub
          <svg width="16" height="16">
            <path d="M5.75 4.75H11.25M11.25 4.75V10.25M11.25 4.75L4.75 11.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
          </svg>
        </a>
        <div class="content">
          <h1 id=""><a href="#"
class="anchor">TigerBeetle</a></h1>
<p>This is the documentation for TigerBeetle: the financial transactions
database designed for mission critical safety and performance to power
the next 30 years of <a href="#concepts-oltp">OLTP</a>.</p>
<p>This is how the entire documentation is organized:</p>
<ul>
<li><a href="#start">Start</a> gets you up and running with a
cluster.</li>
<li><a href="#concepts">Concepts</a> explains why TigerBeetle
exists.</li>
<li><a href="#coding">Coding</a> shows how to integrate TigerBeetle
into your application.</li>
<li><a href="#operating">Operating</a> covers deployment and operating
a TigerBeetle cluster.</li>
<li><a href="#reference">Reference</a> is a companion to <a
href="#coding">Coding</a> which meticulously documents every
detail.</li>
</ul>
<p>Note that this documentation is aimed at the users of TigerBeetle. If
you want to understand how it works under the hood, check out the <a
href="https://github.com/tigerbeetle/tigerbeetle/tree/main/docs/internals">internals
docs</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="start"><a href="#start" class="anchor">Start</a></h1>
<p>TigerBeetle is a reliable, fast, and highly available database for
financial accounting. It tracks financial transactions or anything else
that can be expressed as double-entry bookkeeping, providing three
orders of magnitude more performance and guaranteeing durability even in
the face of network, machine, and storage faults. You will learn more
about why this is an important and hard problem to solve in the <a
href="#concepts">Concepts</a> section, but let‚Äôs make some real
transactions first!</p>
<h2 id="start-install"><a href="#start-install" class="anchor">Install</a></h2>
<p>TigerBeetle is a single, small, statically linked binary.</p>
<p>You can download a pre-built Linux binary from
<code>tigerbeetle.com</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>curl -Lo tigerbeetle.zip https://linux.tigerbeetle.com &amp;&amp; unzip tigerbeetle.zip &amp;&amp; ./tigerbeetle version</code></pre>
</div>
<p>MacOS and Windows versions are also available:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code># macOS
curl -Lo tigerbeetle.zip https://mac.tigerbeetle.com &amp;&amp; unzip tigerbeetle.zip &amp;&amp; ./tigerbeetle version</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code># Windows
powershell -command &quot;curl.exe -Lo tigerbeetle.zip https://windows.tigerbeetle.com; Expand-Archive tigerbeetle.zip .; .\tigerbeetle version&quot;</code></pre>
</div>
<p>Building from source is possible and easy, but is not recommended for
most users. Refer to the <a
href="https://github.com/tigerbeetle/tigerbeetle/tree/main/docs/internals">internals
documentation</a> for compilation instructions.</p>
<h2 id="start-run-a-cluster"><a href="#start-run-a-cluster" class="anchor">Run a
Cluster</a></h2>
<p>Typically, TigerBeetle is deployed as a cluster of 6 replicas, which
is described in the <a href="#operating">Operating</a> section. But
it is also possible to run a single-replica cluster, which of course
doesn‚Äôt provide high-availability, but is convenient for
experimentation. That‚Äôs what we‚Äôll do here.</p>
<p>First, format a data file:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>./tigerbeetle format --cluster=0 --replica=0 --replica-count=1 --development ./0_0.tigerbeetle</code></pre>
</div>
<p>A TigerBeetle replica stores everything in a single file
(<code>./0_0.tigerbeetle</code> in this case). The
<code>--cluster</code>, <code>--replica</code>, and
<code>--replica-count</code> arguments set the topology of the cluster
(a single replica for this tutorial).</p>
<p>Now, start a replica:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>./tigerbeetle start --addresses=3000 --development ./0_0.tigerbeetle</code></pre>
</div>
<p>It will listen on port 3000 for connections from clients. There‚Äôs
intensionally no way to gracefully shut down a replica, you can
<code>^C</code> it freely, and the data will be safe as long as the
underlying storage functions correctly. Note that with a real cluster of
6 replicas, the data is safe even if the storage misbehaves.</p>
<h2 id="start-connecting-to-a-cluster"><a href="#start-connecting-to-a-cluster"
class="anchor">Connecting to a Cluster</a></h2>
<p>Now that the cluster is running, we can connect to it using a client.
TigerBeetle already has clients for several popular programming
languages, including Go, NodeJS, Java, and Python, and more are coming;
see the <a href="#coding">Coding</a> section for details. For this
tutorial, we‚Äôll keep it simple and connect to the cluster using the
built-in CLI client. In a separate terminal, start a REPL with</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>$ ./tigerbeetle repl --cluster=0 --addresses=3000</code></pre>
</div>
<p>The <code>--addresses</code> argument is the port the server is
listening on. The <code>--cluster</code> argument is required to
double-check that the client connects to the correct cluster. While not
strictly necessary, it helps prevent operator errors.</p>
<h2 id="start-issuing-transactions"><a href="#start-issuing-transactions"
class="anchor">Issuing Transactions</a></h2>
<p>TigerBeetle comes with a pre-defined database schema ‚Äî double-entry
bookkeeping. The <a href="#concepts">Concept</a> section explains why
this particular schema, and the <a href="#reference">Reference</a>
documents all the bells and whistles, but, for the purposes of this
tutorial, it is enough to understand that there are accounts holding
<code>credits</code> and <code>debits</code> balances, and that each
transfer moves value between two accounts by incrementing
<code>credits</code> on one side and <code>debits</code> on the
other.</p>
<p>In the REPL, let‚Äôs create two empty accounts:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>&gt; create_accounts id=1 code=10 ledger=700, id=2 code=10 ledger=700;
&gt; lookup_accounts id=1, id=2;</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user_data&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ledger&quot;</span><span class="fu">:</span> <span class="st">&quot;700&quot;</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="st">&quot;10&quot;</span><span class="fu">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;flags&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;2&quot;</span><span class="fu">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user_data&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ledger&quot;</span><span class="fu">:</span> <span class="st">&quot;700&quot;</span><span class="fu">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="st">&quot;10&quot;</span><span class="fu">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;flags&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>Now, create our first transfer and inspect the state of accounts
afterwards:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>&gt; create_transfers id=1 debit_account_id=1 credit_account_id=2 amount=10 ledger=700 code=10;
&gt; lookup_accounts id=1, id=2;</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;1&quot;</span><span class="fu">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user_data&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ledger&quot;</span><span class="fu">:</span> <span class="st">&quot;700&quot;</span><span class="fu">,</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="st">&quot;10&quot;</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;flags&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;10&quot;</span><span class="fu">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="st">&quot;2&quot;</span><span class="fu">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user_data&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;ledger&quot;</span><span class="fu">:</span> <span class="st">&quot;700&quot;</span><span class="fu">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;code&quot;</span><span class="fu">:</span> <span class="st">&quot;10&quot;</span><span class="fu">,</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;flags&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;debits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_pending&quot;</span><span class="fu">:</span> <span class="st">&quot;0&quot;</span><span class="fu">,</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;credits_posted&quot;</span><span class="fu">:</span> <span class="st">&quot;10&quot;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>Note how the transfer amount is added both to the credits and to the
debits. That the sum of debits and credits stays equal no matter what is
a powerful invariant of the double-entry bookkeeping system.</p>
<h2 id="start-conclusion"><a href="#start-conclusion"
class="anchor">Conclusion</a></h2>
<p>This is the end of the quick start! You now know how to format a data
file, run a single-replica TigerBeetle cluster, and run transactions
through it. Here‚Äôs where to go from here:</p>
<ul>
<li><a href="#concepts">Concepts</a> explains the ‚Äúwhy?‚Äù of
TigerBeetle, read this to decide if you need to use TigerBeetle.</li>
<li><a href="#coding">Coding</a> gives guidance on developing
applications which store accounting data in a TigerBeetle cluster.</li>
<li><a href="#operating">Operating</a> explains how to deploy a
TigerBeetle cluster in a highly-available manner, with replication
enabled.</li>
<li><a href="#reference">Reference</a> meticulously documents every
single available feature and flag of the underlying data model.</li>
</ul>
<h2 id="start-community"><a href="#start-community"
class="anchor">Community</a></h2>
<p>If you want to keep up to speed with recent TigerBeetle developments,
here are some things to follow:</p>
<ul>
<li><a
href="https://mailchi.mp/8e9fa0f36056/subscribe-to-tigerbeetle">Monthly
Newsletter</a> covers everything of importance that happened with
TigerBeetle. It is a changelog director‚Äôs cut!</li>
<li><a href="https://slack.tigerbeetle.com/join">Slack</a> is the place
to hang out with users and developers of TigerBeetle. We try to answer
every question.</li>
<li><a href="https://www.youtube.com/@tigerbeetledb">YouTube</a> channel
has most of the talks about TigerBeetle, as well as talks from the
Systems Distributed conference. We also stream on <a
href="https://www.twitch.tv/tigerbeetle">Twitch</a>, with recordings
duplicated to YouTube.</li>
<li><a href="https://twitter.com/TigerBeetleDB">ùïè</a> is good for
smaller updates, and word-of-mouth historical trivia you won‚Äôt learn
elsewhere!</li>
<li><a href="https://github.com/tigerbeetle/tigerbeetle">GitHub</a> ‚Äî if
you want to keep closer to the source!</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/start.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="concepts"><a href="#concepts" class="anchor">Concepts</a></h1>
<p>This section is for anyone evaluating TigerBeetle, eager to learn
about it, or curious. It focuses on the big picture and problems that
TigerBeetle solves. As well as why it looks nothing like a typical SQL
database from the outside <em>and</em> from the inside.</p>
<ul>
<li><a href="#concepts-oltp">OLTP</a> defines the domain of TigerBeetle ‚Äî system
of record for business transactions.</li>
<li><a href="#concepts-debit-credit">Debit-Credit</a> argues that double-entry
bookkeeping is the right schema for this domain.</li>
<li><a href="#concepts-performance">Performance</a> explains how TigerBeetle
achieves state-of-the-art performance.</li>
<li><a href="#concepts-safety">Safety</a> shows that safety and performance are
not at odds with each other.</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/concepts/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="concepts-oltp"><a
href="#concepts-oltp" class="anchor">Online
Transaction Processing (OLTP)</a></h1>
<p>Online Transaction Processing (OLTP) is about <strong>recording
business transactions in real-time</strong>. This could be payments,
sales, car sharing rides, game scores, or API usage.</p>
<h2 id="concepts-oltp-the-world-is-becoming-more-transactional"><a
href="#concepts-oltp-the-world-is-becoming-more-transactional" class="anchor">The
World is Becoming More Transactional</a></h2>
<p>Historically, general purpose databases like PostgreSQL, MySQL, and
SQLite handled OLTP. We refer to these as Online General Purpose (OLGP)
databases.</p>
<p>OLTP workloads have increased by 3-4 orders of magnitude in the last
10 years alone. For example:</p>
<ul>
<li>The <a
href="https://en.wikipedia.org/wiki/Unified_Payments_Interface">UPI</a>
real-time payments switch in India processed 10 billion payments in the
year 2019. In January 2025 alone, it processed <a
href="https://www.npci.org.in/what-we-do/upi/product-statistics">16.9
billion payments.</a></li>
<li>Cleaner energy and smart metering means energy is being traded by
the kilowatt-hour. Customer billing is every 15 or 30 minutes rather
than at the end of the month.</li>
<li>Serverless APIs charge for usage by the second or per-request,
rather than per month. (Today, serverless billing at scale is often
implemented using <a
href="https://en.wikipedia.org/wiki/MapReduce">MapReduce</a>. This makes
it difficult or impossible to offer customers real-time spending
caps.)</li>
</ul>
<p>OLGP databases already struggle to keep up.</p>
<p><strong>But TigerBeetle is built to handle the scale of OLTP
workloads today and for the decades to come.</strong> It works well
alongside OLGP databases, which holds infrequently updated data.
TigerBeetle can race ahead, giving your system unparalleled latency and
throughput.</p>
<h2 id="concepts-oltp-write-heavy-workloads"><a href="#concepts-oltp-write-heavy-workloads"
class="anchor">Write-Heavy Workloads</a></h2>
<p>A distinguishing characteristic of OLTP is its focus on
<em>recording</em> business transactions. In contrast, OLGP databases
are often designed for read-heavy or balanced workloads.</p>
<p>TigerBeetle is optimized from the ground up for write-heavy
workloads. This means it can handle the increasing scale of OLTP, unlike
an OLGP database.</p>
<h2 id="concepts-oltp-high-contention-on-hot-accounts"><a
href="#concepts-oltp-high-contention-on-hot-accounts" class="anchor">High Contention
on Hot Accounts</a></h2>
<p>Business transactions always involve more than one account. One
account gets paid but then there are fees, taxes, revenue splits, and
other costs to account for.</p>
<p>OLTP systems often have accounts involved in a high percentage of all
transactions. This is especially true for accounts that represent the
business income or expenses. Locks can be used to ensure that updates to
these ‚Äòhot accounts‚Äô are consistent. But the resulting contention can
bring the system‚Äôs performance to a crawl.</p>
<p>TigerBeetle provides strong consistency guarantees without row locks.
This sidesteps the issue of contention on hot accounts. Due to
TigerBeetle‚Äôs use of the system cache, transactions processing speed
even <em>increases</em>.</p>
<h2 id="concepts-oltp-business-transactions-dont-shard-well"><a
href="#concepts-oltp-business-transactions-dont-shard-well" class="anchor">Business
Transactions Don‚Äôt Shard Well</a></h2>
<p>One of the most common ways to scale systems is to horizontally scale
or shard them. This means different servers process different sets of
transactions. Unfortunately, business transactions don‚Äôt shard well.
Horizontal scaling is a poor fit for OLTP:</p>
<ul>
<li>Most accounts cannot be neatly partitioned between shards.</li>
<li>Transactions between accounts on different shards become more
complex and slow.</li>
<li>Row locks on hot accounts worsen when the transactions must execute
across shards.</li>
</ul>
<p>Another approach to scaling OLTP systems is to use MapReduce for
billing. But this makes it hard to provide real-time balance reporting
or spending limits. It also creates a poor user experience that‚Äôs hard
to fix post system design.</p>
<p>TigerBeetle uses a <a
href="#concepts-performance-single-threaded-by-design">single-core design</a>
and unique performance optimizations to deliver high throughput. And
this without the downsides of horizontal scaling.</p>
<h2 id="concepts-oltp-bottleneck-for-your-system"><a
href="#concepts-oltp-bottleneck-for-your-system" class="anchor">Bottleneck for Your
System</a></h2>
<p>You can only do as much business as your database supports. You need
a core OLTP database capable of handling your transactions on your
busiest days. And for decades to come.</p>
<p>TigerBeetle is designed to handle <strong>1 million transactions per
second</strong>, to remove the risk of your business outgrowing your
database.</p>
<h2 id="concepts-oltp-next-up-debit--credit-is-the-schema-for-oltp"><a
href="#concepts-oltp-next-up-debit--credit-is-the-schema-for-oltp" class="anchor">Next
Up: Debit / Credit is the Schema for OLTP</a></h2>
<p>The world is becoming more transactional. OLTP workloads are
increasing and we need a database designed from the ground up. What is
the perfect schema and language for this database? <a
href="#concepts-debit-credit">Debit / Credit</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/concepts/oltp.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="concepts-debit-credit"><a
href="#concepts-debit-credit" class="anchor">Debit / Credit:
The Schema for OLTP</a></h1>
<p>As discussed in the previous section, OLTP is all about processing
business transactions. We saw that the nuances of OLTP workloads make
them tricky to handle at scale.</p>
<p>Now, we‚Äôll turn to the data model and see how the specifics of
business transactions actually lend themselves to an incredibly simple
schema ‚Äì and one that‚Äôs been in use for centuries!</p>
<h2 id="concepts-debit-credit-the-who-what-when-where-why-and-how-much-of-oltp"><a
href="#concepts-debit-credit-the-who-what-when-where-why-and-how-much-of-oltp"
class="anchor">The ‚ÄúWho, What, When, Where, Why, and How Much‚Äù of
OLTP</a></h2>
<p>OLTP and business transactions tend to record the same types of
information:</p>
<ul>
<li><strong>Who</strong>: which accounts are transacting?</li>
<li><strong>What</strong>: what type of asset or value is moving?</li>
<li><strong>When</strong>: when was the transaction initiated or when
was it finalized?</li>
<li><strong>Where</strong>: where in the world did the transaction take
place?</li>
<li><strong>Why</strong>: what type of transaction is this or why is it
happening?</li>
<li><strong>How Much</strong>: what quantity of the asset or items was
moved?</li>
</ul>
<h2 id="concepts-debit-credit-the-language-of-business-for-centuries"><a
href="#concepts-debit-credit-the-language-of-business-for-centuries" class="anchor">The
Language of Business for Centuries</a></h2>
<p>Debit / credit, or double-entry bookkeeping, has been the lingua
franca of business and accounting since at least the 13th century.</p>
<p>The key insight underpinning debit / credit systems is that every
transfer records a movement of value from one or more accounts to one or
more accounts. Money never appears from nowhere or disappears. This
simple principle helps ensure that all of a business‚Äôs money is
accounted for.</p>
<p>Debit / credit perfectly captures the who, what, when, where, why,
and how much of OLTP while ensuring financial consistency.</p>
<p>(For a deeper dive on debits and credits, see our primer on <a
href="#coding-financial-accounting">Financial Accounting</a>.)</p>
<h2 id="concepts-debit-credit-sql-vs-debit--credit"><a href="#concepts-debit-credit-sql-vs-debit--credit"
class="anchor">SQL vs Debit / Credit</a></h2>
<p>While SQL is a great query language for getting data out of a
database, OLTP is primarily about getting data in to the database and
this is where SQL falls short.</p>
<p><strong>Often, a single business transaction requires multiple SQL
queries (on the order of 10 SQL queries per transaction)</strong> and
potentially even multiple round-trips from the application to the
database.</p>
<p>By designing a database specifically for the schema and needs of
OLTP, we can ensure our accounting logic is enforced correctly while
massively increasing performance.</p>
<h2 id="concepts-debit-credit-tigerbeetle-enforces-debit--credit-in-the-database"><a
href="#concepts-debit-credit-tigerbeetle-enforces-debit--credit-in-the-database"
class="anchor">TigerBeetle Enforces Debit / Credit in the
Database</a></h2>
<p>The schema of OLTP is built in to TigerBeetle‚Äôs data model, and is
ready for you to use:</p>
<ul>
<li><strong>Who</strong>: the <a
href="#reference-transfer-debit_account_id"><code>debit_account_id</code></a>
and <a
href="#reference-transfer-credit_account_id"><code>credit_account_id</code></a>
indicate which accounts are transacting.</li>
<li><strong>What</strong>: each asset or type of value in TigerBeetle is
tracked on a separate <a
href="#coding-data-modeling-ledgers">ledger</a>. The <a
href="#reference-transfer-ledger"><code>ledger</code></a> field
indicates what is being transferred.</li>
<li><strong>When</strong>: each transfer has a unique <a
href="#reference-transfer-timestamp"><code>timestamp</code></a> for
when it is processed by the cluster, but you can add another timestamp
representing when the transaction happened in the real world in the <a
href="#reference-transfer-user_data_64"><code>user_data_64</code></a>
field.</li>
<li><strong>Where</strong>: the <a
href="#reference-transfer-user_data_32"><code>user_data_32</code></a>
can be used to store the locale where the transfer occurred.</li>
<li><strong>Why</strong>: the <a
href="#reference-transfer-code"><code>code</code></a> field stores
the reason a transfer occurred and should map to an enum or table of all
the possible business events.</li>
<li><strong>How Much</strong>: the <a
href="#reference-transfer-amount"><code>amount</code></a> indicates
how much of the asset or item is being transferred.</li>
</ul>
<p>TigerBeetle also supports <a
href="#coding-two-phase-transfers">two-phase transfers</a> out of
the box, and can express complex atomic chains of transfers using <a
href="#coding-linked-events">linked events</a>. These powerful
built-in primitives allow for a large vocabulary of <a
href="#coding-recipes">patterns and recipes</a> for <a
href="#coding-data-modeling">data modeling</a>.</p>
<p>Crucially, accounting invariants such as balance limits are enforced
within the database, avoiding round-trips between your database and
application logic.</p>
<h2 id="concepts-debit-credit-immutability-is-essential"><a href="#concepts-debit-credit-immutability-is-essential"
class="anchor">Immutability is Essential</a></h2>
<p>Another critical element of debit / credit systems is immutability:
once transfers are recorded, they cannot be erased. Reversals are
implemented with separate transfers to provide a full and auditable log
of business events.</p>
<p>Accidentally dropping rows or tables is bad in any database, but it
is unacceptable when it comes to accounting. Legal compliance and good
business practices require that all funds be fully accounted for, and
all history be maintained.</p>
<p>Transfers in TigerBeetle are always immutable, providing you with
peace of mind out of the box. There is no possibility of a malformed
query unintentionally deleting data.</p>
<h2 id="concepts-debit-credit-dont-roll-your-own-ledger"><a href="#concepts-debit-credit-dont-roll-your-own-ledger"
class="anchor">Don‚Äôt Roll Your Own Ledger</a></h2>
<p>Many companies start out building their own system for recording
business transactions. Then, once their business scales, they realize
they need a proper ledger and end up coming back to debits and
credits.</p>
<p>A number of prime examples of this are:</p>
<ul>
<li><strong>Uber</strong>: In 2018, Uber started a 2-year, 40-engineer
effort to migrate their collection and disbursement payment platform to
one based on the principles of double-entry accounting and debits and
credits.<a href="#concepts-debit-credit-fn1" class="footnote-ref" id="concepts-debit-credit-fnref1"
role="doc-noteref"><sup>1</sup></a></li>
<li><strong>Airbnb</strong>: From 2012 to 2016, Airbnb used a
MySQL-based data pipeline to record all of its transactions in an
immutable store suitable for reporting. The pipeline became too complex,
hard to scale, and slow. They ended up building a new financial
reporting system based on double-entry accounting.<a href="#concepts-debit-credit-fn2"
class="footnote-ref" id="concepts-debit-credit-fnref2"
role="doc-noteref"><sup>2</sup></a></li>
<li><strong>Stripe</strong>: While we don‚Äôt know when this system
initially went into service, Stripe relies on an internal system based
on double-entry accounting and an immutable log of events to record all
of the payments they process.<a href="#concepts-debit-credit-fn3" class="footnote-ref"
id="concepts-debit-credit-fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ul>
<aside id="concepts-debit-credit-footnotes" class="footnotes footnotes-end-of-section"
role="doc-footnote">
<hr />
<ol>
<li id="concepts-debit-credit-fn1"><p>Singla, A., &amp; Wu, S. (2020, October 2).
<em>Revolutionizing Money Movements at Scale with Strong Data
Consistency</em>. Uber Blog. [<a
href="https://www.uber.com/blog/money-scale-strong-data](https://www.uber.com/blog/money-scale-strong-data)">https://www.uber.com/blog/money-scale-strong-data](https://www.uber.com/blog/money-scale-strong-data)</a>.<a
href="#concepts-debit-credit-fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="concepts-debit-credit-fn2"><p>Liang, A. (2017, March 16). <em>Tracking the Money ‚Äî
Scaling Financial Reporting at Airbnb</em>. The Airbnb Tech Blog. [<a
href="https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040](https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040)">https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040](https://medium.com/airbnb-engineering/tracking-the-money-scaling-financial-reporting-at-airbnb-6d742b80f040)</a>.<a
href="#concepts-debit-credit-fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="concepts-debit-credit-fn3"><p>Ganelin, I. (2024, February 16). <em>Ledger: Stripe‚Äôs
system for tracking and validating money movement</em>. Stripe Blog. [<a
href="https://stripe.com/blog/ledger-stripe-system-for-tracking-and-validating-money-movement](https://stripe.com/blog/ledger-stripe-system-for-tracking-and-validating-money-movement)">https://stripe.com/blog/ledger-stripe-system-for-tracking-and-validating-money-movement](https://stripe.com/blog/ledger-stripe-system-for-tracking-and-validating-money-movement)</a>.<a
href="#concepts-debit-credit-fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</aside>
<h2 id="concepts-debit-credit-standardized-simple-and-scalable"><a
href="#concepts-debit-credit-standardized-simple-and-scalable" class="anchor">Standardized,
Simple, and Scalable</a></h2>
<p>From one perspective, debit / credit may seem like a limited data
model. However, it is incredibly flexible and scalable. Any business
event can be recorded as debits and credits ‚Äì indeed, accountants have
been doing precisely this for centuries!</p>
<p>Instead of modeling business transactions as a set of ad-hoc tables
and relationships, debits and credits provide a simple and standardized
schema that can be used across all product lines, now and into the
future. This avoids the need to add columns, tables, and complex
relations between them as new features are added ‚Äì and avoids complex
schema migrations.</p>
<p>Debit / credit has been the foundation of business for hundreds of
years, and now you can leverage TigerBeetle‚Äôs high-performance
implementation of it built for OLTP in the 21st century.</p>
<h2 id="concepts-debit-credit-next-performance"><a href="#concepts-debit-credit-next-performance"
class="anchor">Next: Performance</a></h2>
<p>So far, we‚Äôve seen why we need a new database designed for OLTP and
how debit / credit provides the perfect data model for it. Next, we can
look at the <a href="#concepts-performance">performance</a> of a database,
designed for OLTP.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/concepts/debit-credit.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="concepts-performance"><a href="#concepts-performance"
class="anchor">Performance</a></h1>
<p>How, exactly, is TigerBeetle so fast?</p>
<h2 id="concepts-performance-its-all-about-the-interface"><a
href="#concepts-performance-its-all-about-the-interface" class="anchor">It‚Äôs All About The
Interface</a></h2>
<p>The key is that TigerBeetle designed specifically for <a
href="#concepts-oltp">OLTP</a> workloads, as opposed to OLGP. The prevailing
paradigm for OLGP is interactive transactions, where business-logic
lives in the application, and the job of the database is to send the
data to the application, holding the locks while the data is being
processed. This works for mixed read-write workload with low contention,
but fails for highly-contended OLTP workloads ‚Äî locks over the network
are very expensive!</p>
<p>With TigerBeetle, <strong>all the logic lives inside the
database</strong>, obviating the need for locking. Not only is this very
fast, it is also more convenient ‚Äî the application can speak <a
href="#concepts-debit-credit">Debit/Credit</a> directly, it doesn‚Äôt need to
translate the language of business to SQL.</p>
<h2 id="concepts-performance-batching-batching-batching"><a
href="#concepts-performance-batching-batching-batching" class="anchor">Batching, Batching,
Batching</a></h2>
<p>On a busy day in a busy city, taking subway is faster than using a
car. On empty streets, a personal sports car gives you the best latency,
but, when the load and contention increases, due to <a
href="https://en.wikipedia.org/wiki/Little%27s_law"><strong>Little‚Äôs
law</strong></a>, both latency and throughput become abysmal.</p>
<p>TigerBeetle works like a high-speed train ‚Äî its interface always
deals with <em>batches</em> of transactions, 8k apiece. Although
TigerBeetle is a replicated database using a consensus algorithm, the
cost of replications is paid only once per batch, which means that
TigerBeetle runs not much slower than an in-memory hash map, all the
while providing extreme durability and availability.</p>
<p>What‚Äôs more, under light load the batches automatically become
smaller, trading unnecessary throughput for better latency.</p>
<h2 id="concepts-performance-extreme-engineering"><a href="#concepts-performance-extreme-engineering"
class="anchor">Extreme Engineering</a></h2>
<p>Debit/Credit fixes inefficiency in the interface, pervasive batching
amortizes costs, but, to really hit performance targets, solid
engineering is required at every level of the stack.</p>
<p>TigerBeetle is built fully from scratch, without using any
dependencies, to make sure that all the layers are co-designed for the
purposes of OLTP.</p>
<p>TigerBeetle is written in Zig ‚Äî a systems programming language which
doesn‚Äôt use garbage collection and is designed for writing fast
code.</p>
<p>Every data structure is hand-crafted with the CPU in mind: a transfer
object is 128 bytes in size, cache-line aligned. Executing a batch of
transfers is just one tight CPU loop!</p>
<p>TigerBeetle allocates all the memory statically: it never runs out of
memory, it never stalls due to a GC pause or mutex contention, and it
never fragments the memory.</p>
<p>TigerBeetle is designed for io_uring ‚Äî a new Linux kernel interface
for zero syscall networking and storage I/O.</p>
<p>These and other performance rules are captured in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/TIGER_STYLE.md">TIGER_STYLE.md</a>
‚Äî the secret recipe that keeps TigerBeetle fast and safe.</p>
<h2 id="concepts-performance-single-threaded-by-design"><a href="#concepts-performance-single-threaded-by-design"
class="anchor">Single Threaded By Design</a></h2>
<p>TigerBeetle uses a single core by design and uses a single leader
node to process events. Adding more nodes can therefore increase
reliability but not throughput.</p>
<p>For a high-performance database, this may seem like an unusual
choice. However, sharding in financial databases is notoriously
difficult and contention issues often negate the would-be benefits.
Specifically, a small number of hot accounts are often involved in a
large proportion of the transactions so the shards responsible for those
accounts become bottlenecks.</p>
<p>For more details on when single-threaded implementations of
algorithms outperform multi-threaded implementations, see <a
href="https://www.usenix.org/system/files/conference/hotos15/hotos15-paper-mcsherry.pdf">‚ÄúScalability!
But at what COST?</a>.</p>
<h2 id="concepts-performance-performance--flexibility"><a href="#concepts-performance-performance--flexibility"
class="anchor">Performance = Flexibility</a></h2>
<p>Is it <em>really</em> necessary to go to such great lengths in the
name of performance? It of course depends on a particular use-case, but
it‚Äôs worth keeping in mind that higher performance can unlock new
use-cases. An OLGP database might be enough to do nightly settlement,
but with OLTP real-time settlement is a no-brainer. If a transaction
system just hits its throughput target, that means that every unexpected
delay or an ops accident lead to missed transactions. If a system
operates at one tenth of capacity, this gives a lot of headroom for
operators to deal with the unexpected.</p>
<p>Finally, it is always helpful to think about the future. The future
is hard to predict (even the <em>present</em> is hard to wrap your head
around!), but the <em>option</em> to handle significantly more load on a
short notice greatly expands your options.</p>
<h2 id="concepts-performance-next-safety"><a href="#concepts-performance-next-safety" class="anchor">Next:
Safety</a></h2>
<p>Performance can get you very far very fast, but it is useless if the
result is wrong. Business transaction processing also requires
<strong>strong safety guarantees</strong>, to ensure that data cannot be
lost, and <strong>high availability</strong> to ensure that money is not
lost due to database downtime. Let‚Äôs look at how TigerBeetle ensures <a
href="#concepts-safety">safety</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/concepts/performance.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="concepts-safety"><a href="#concepts-safety" class="anchor">Safety</a></h1>
<p>The purpose of a database is to store data: if the database accepted
new data, it should be able to retrieve it later. Surprisingly, many
databases don‚Äôt provide guaranteed durability ‚Äî usually the data is
there, but, under certain edge case conditions, it can get lost!</p>
<p>As the purpose of TigerBeetle is to be the system of record for
business transaction, associated with real-world value transfers, it is
paramount that the data stored in TigerBeetle is safe.</p>
<h2 id="concepts-safety-strict-serializability"><a href="#concepts-safety-strict-serializability"
class="anchor">Strict Serializability</a></h2>
<p>The easiest way to lose data is by using the database incorrectly, by
misconfiguring (or just misunderstanding) its isolation level. For this
reason, TigerBeetle intentionally supports only the strictest possible
isolation level ‚Äî <strong>strict serializability</strong>. All transfers
are executed one-by-one, on a single core.</p>
<p>Furthermore, TigerBeetle‚Äôs state machine is designed according to the
<a
href="#coding-reliable-transaction-submission"><strong>end-to-end
idempotency principle</strong></a> ‚Äî each transfer has a unique
client-generated <code>u128</code> id, and each transfer is processed at
most once, even in the presence of intermediate retry loops.</p>
<h2 id="concepts-safety-high-availability"><a href="#concepts-safety-high-availability"
class="anchor">High Availability</a></h2>
<p>Some databases rely on a single central server, which puts the data
at risk as any single server might fail catastrophically (e.g. due to a
fire in the data center). Primary/backup systems with ad-hoc failover
can lose data due to split-brain.</p>
<p>To avoid these pitfalls, TigerBeetle implements pioneering <a
href="https://pmg.csail.mit.edu/papers/vr-revisited.pdf">Viewstamped
Replication</a> and consensus algorithm, that guarantees correct,
automatic failover. It‚Äôs worth emphasizing that consensus proper needs
only be engaged during actual failover. During the normal operation, the
cost of consensus is just the cost of replication, which is further
minimized because of <a
href="#concepts-performance-batching-batching-batching">batching</a>, tail
latency tolerance, and pipelining.</p>
<p>TigerBeetle does not depend on synchronized system clocks, does not
use leader leases, and <strong>performs leader-based
timestamping</strong> so that your application can deal only with safe
relative quantities of time with respect to transfer timeouts. To ensure
that the leader‚Äôs clock is within safe bounds of ‚Äútrue time‚Äù,
TigerBeetle combines all the clocks in the cluster to create a
fault-tolerant clock that we call <a
href="https://tigerbeetle.com/blog/three-clocks-are-better-than-one/">‚Äúcluster
time‚Äù</a>.</p>
<p>For highest availability, TigerBeetle should be deployed as a cluster
of six replicas across three different cloud providers (two replicas per
provider). Because TigerBeetle uses <a
href="https://arxiv.org/pdf/1608.06696v1">Heidi Howard‚Äôs flexible
quorums</a>, this deployment is guaranteed to tolerate a complete outage
of any cloud provider and will likely survive even if one extra replica
fails.</p>
<h2 id="concepts-safety-storage-fault-tolerance"><a href="#concepts-safety-storage-fault-tolerance"
class="anchor">Storage Fault Tolerance</a></h2>
<p>Traditionally, databases assume that disks do not fail, or at least
fail politely with a clear error code. This is usually a reasonable
assumption, but edge cases matter.</p>
<p>HDD and SSD hardware can fail. Disks can silently return corrupt data
( <a href="https://www.usenix.org/system/files/fast20-maneas.pdf">0.031%
of SSD disks per year</a>, <a
href="https://www.usenix.org/legacy/events/fast08/tech/full_papers/bairavasundaram/bairavasundaram.pdf">1.4%
of Enterprise HDD disks per year</a>), misdirect IO ( <a
href="https://www.usenix.org/system/files/fast20-maneas.pdf">0.023% of
SSD disks per year</a>, <a
href="https://www.usenix.org/legacy/events/fast08/tech/full_papers/bairavasundaram/bairavasundaram.pdf">0.466%
of Nearline HDD disks per year</a>), or just suddenly become extremely
slow, without returning an error code (the so called <a
href="https://www.microsoft.com/en-us/research/wp-content/uploads/2017/06/paper-1.pdf">gray
failure</a>).</p>
<p>On top of hardware, software might be buggy or just tricky to use
correctly. Handling fsync failures correctly is <a
href="https://www.usenix.org/system/files/atc20-rebello.pdf">particularly
hard</a>.</p>
<p><strong>TigerBeetle assumes that its disk <em>will</em> fail</strong>
and takes advantage of replication to proactively repair replica‚Äôs local
disks.</p>
<ul>
<li>All data in TigerBeetle is immutable, checksummed, and <a
href="https://csrc.nist.gov/glossary/term/hash_chain">hash-chained</a>,
providing a strong guarantee that no corruption or tampering happened.
In case of a latent sector error, the error is detected and repaired
without any operator involvement.</li>
<li>Most consensus implementations lose data or become unavailable if
the write ahead log gets corrupted. TigerBeetle uses <a
href="https://www.youtube.com/watch?v=fDY6Wi0GcPs">Protocol Aware
Recovery</a> to remain available unless the data gets corrupted on every
single replica.</li>
<li>To minimize impact of software bugs, TigerBeetle puts as little
software as possible between itself and the disk ‚Äî TigerBeetle manages
its own page cache, writes data to disk with O_DIRECT and can work with
a block device directly, no file system is necessary.</li>
<li>TigerBeetle also tolerates gray failure ‚Äî if a disk on a replica
becomes very slow, the cluster fall backs on other replicas for
durability.</li>
</ul>
<h2 id="concepts-safety-software-reliability"><a href="#concepts-safety-software-reliability"
class="anchor">Software Reliability</a></h2>
<p>Even the advanced algorithm with a formally proved correctness
theorem is useless if the implementation is buggy. TigerBeetle uses the
oldest and the newest software engineering practices to ensure
correctness.</p>
<p>TigerBeetle is written in <a href="https://ziglang.org">Zig</a> ‚Äî a
modern systems programming language that removes many instances of
undefined behavior, provides spatial memory safety and encourages
simple, straightforward code.</p>
<p>TigerBeetle adheres to a strict code style, <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/TIGER_STYLE.md">TIGER_STYLE</a>,
inspired by <a href="https://spinroot.com/gerard/pdf/P10.pdf">NASA‚Äôs
power of ten</a>. For example, TigerBeetle uses static memory
allocation, which designs away memory fragmentation, out-of-memory
errors and use-after-frees.</p>
<p>TigerBeetle is tested in the VOPR ‚Äî a simulated environment where an
entire cluster, running real code, is subjected to all kinds of network,
storage and process faults, at 1000x speed. This simulation can find
both logical errors in the algorithms and coding bugs in the source.
This simulator is running 24/7 on 1024 cores, fuzzing the latest version
of the database.</p>
<p>It also <strong>runs in your browser</strong>: <a
href="https://sim.tigerbeetle.com">https://sim.tigerbeetle.com</a>!</p>
<h2 id="concepts-safety-human-fallibility"><a href="#concepts-safety-human-fallibility"
class="anchor">Human Fallibility</a></h2>
<p>While, with a lot of care, software can be perfected to become
virtually bug-free, humans will always make mistakes. TigerBeetle takes
this into account and tries to protect from operator errors:</p>
<ul>
<li>The surface area is intentionally minimized, with little
configurability.</li>
<li>In particular, there‚Äôs only one isolation level ‚Äî strict
serializability.</li>
<li>Upgrades are automatic and atomic, guaranteeing that each transfer
is applied by only a single version of code.</li>
<li>TigerBeetle always runs with online verification on, to detect any
discrepancies in the data.</li>
</ul>
<h2 id="concepts-safety-is-tigerbeetle-acid-compliant"><a
href="#concepts-safety-is-tigerbeetle-acid-compliant" class="anchor">Is TigerBeetle
ACID-compliant?</a></h2>
<p>Yes. Let‚Äôs discuss each part:</p>
<h3 id="concepts-safety-atomicity"><a href="#concepts-safety-atomicity"
class="anchor">Atomicity</a></h3>
<p>As part of replication, each operation is durably stored in at least
a quorum of replicas‚Äô Write-Ahead Logs (WAL) before the primary will
acknowledge the operation as committed. WAL entries are executed through
the state machine business logic and the resulting state changes are
stored in TigerBeetle‚Äôs LSM-Forest local storage engine.</p>
<p>The WAL is what allows TigerBeetle to achieve atomicity and
durability since the WAL is the source of truth. If TigerBeetle crashes,
the WAL is replayed at startup from the last checkpoint on disk.</p>
<p>However, financial atomicity goes further than this: events and
transfers can be <a href="#coding-linked-events">linked</a> when
created so they all succeed or fail together.</p>
<h3 id="concepts-safety-consistency"><a href="#concepts-safety-consistency"
class="anchor">Consistency</a></h3>
<p>TigerBeetle guarantees strict serializability. And at the cluster
level, stale reads are not possible since all operations (not only
writes, but also reads) go through the global consensus protocol.</p>
<p>However, financial consistency requires more than this. TigerBeetle
exposes a double-entry accounting API to guarantee that money cannot be
created or destroyed, but only transferred from one account to another.
And transfer history is immutable.</p>
<h3 id="concepts-safety-isolation"><a href="#concepts-safety-isolation"
class="anchor">Isolation</a></h3>
<p>All client requests (and all events within a client request batch)
are executed with the highest level of isolation, serially through the
state machine, one after another, before the next operation begins.
Counterintuitively, the use of batching and serial execution means that
TigerBeetle can also provide this level of isolation optimally, without
the cost of locks for all the individual events within a batch.</p>
<h3 id="concepts-safety-durability"><a href="#concepts-safety-durability"
class="anchor">Durability</a></h3>
<p>Up until 2018, traditional DBMS durability has focused on the Crash
Consistency Model, however, Fsyncgate and <a
href="https://www.usenix.org/conference/fast18/presentation/alagappan">Protocol
Aware Recovery</a> have shown that this model can lead to real data loss
for users in the wild. TigerBeetle therefore adopts an explicit storage
fault model, which we then verify and test with incredible levels of
corruption, something which few distributed systems historically were
designed to handle. Our emphasis on protecting Durability is what sets
TigerBeetle apart, not only as a ledger but as a DBMS.</p>
<p>However, absolute durability is impossible, because all hardware can
ultimately fail. Data we write today might not be available tomorrow.
TigerBeetle embraces limited disk reliability and maximizes data
durability in spite of imperfect disks. We actively work against such
entropy by taking advantage of cluster-wide storage. A record would need
to get corrupted on all replicas in a cluster to get lost, and even in
that case the system would safely halt.</p>
<h2 id="concepts-safety-io_uring-security"><a href="#concepts-safety-io_uring-security"
class="anchor"><code>io_uring</code> Security</a></h2>
<p><code>io_uring</code> is a relatively new part of the Linux kernel
(support for it was added in version 5.1, which was released in May
2019). Since then, many kernel exploits have been found related to
<code>io_uring</code> and in 2023 <a
href="https://security.googleblog.com/2023/06/learnings-from-kctf-vrps-42-linux.html">Google
announced</a> that they were disabling it in ChromeOS, for Android apps,
and on Google production servers.</p>
<p>Google‚Äôs post is primarily about how they secure operating systems
and web servers that handle hostile user content. In the Google blog
post, they specifically note:</p>
<blockquote>
<p>we currently consider it safe only for use by trusted components</p>
</blockquote>
<p>As a financial system of record, TigerBeetle is a trusted component
and it should be running in a trusted environment.</p>
<p>Furthermore, TigerBeetle only uses 128-byte <a
href="#reference-account"><code>Account</code>s</a> and <a
href="#reference-transfer"><code>Transfer</code>s</a> with pure
integer fields. TigerBeetle has no (de)serialization and does not take
user-generated strings, which significantly constrains the attack
surface.</p>
<p>We are confident that <code>io_uring</code> is the safest (and most
performant) way for TigerBeetle to handle async I/O. It is significantly
easier for the kernel to implement this correctly than for us to include
a userspace multithreaded thread pool (for example, as libuv does).</p>
<h2 id="concepts-safety-next-coding"><a href="#concepts-safety-next-coding" class="anchor">Next:
Coding</a></h2>
<p>This concludes the discussion of the concepts behind TigerBeetle ‚Äî an
<a href="#concepts-oltp">OLTP</a> database for recording business transactions
in real time, using a <a href="#concepts-debit-credit">double-entry
bookkeeping</a> schema, which <a href="#concepts-performance">is orders of
magnitude faster</a> and <a href="#concepts-safety">keeps the data safe</a>
even when the underling hardware inevitably fails.</p>
<p>We will now learn <a href="#coding">how to build applications
on top of TigerBeetle</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/concepts/safety.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding"><a href="#coding" class="anchor">Coding</a></h1>
<p>This section is aimed at programmers building applications on top of
TigerBeetle. It is organized as a series of loosely connected guides
which can be read in any order.</p>
<ul>
<li><a href="#coding-system-architecture">System Architecture</a> paints the
big picture.</li>
<li><a href="#coding-data-modeling">Data Modeling</a> shows how to map
business-level entities to the primitives provided by TigerBeetle.</li>
<li><a href="#coding-financial-accounting">Financial Accounting</a>, a deep
dive into double-entry bookkeeping.</li>
<li><a href="#coding-requests">Requests</a> outlines the database
interface.</li>
<li><a href="#coding-reliable-transaction-submission">Reliable Transaction
Submission</a> explains the end-to-end principle and how it helps to
avoid double spending.</li>
<li><a href="#coding-two-phase-transfers">Two-Phase Transfers</a> introduces
pending transfers, one of the most powerful primitives built into
TigerBeetle.</li>
<li><a href="#coding-linked-events">Linked Events</a> shows how several
transfers can be chained together into a larger transaction, which
success or fails atomically.</li>
<li><a href="#coding-time">Time</a> lists the guarantees provided by the
TigerBeetle cluster clock.</li>
<li><a href="#coding-recipes">Recipes</a> is a library of ready-made
solutions for common business requirements such as a currency
exchange.</li>
<li><a href="#coding-clients">Clients</a> shows how to use TigerBeetle from
the comfort of .Net, Go, Java, Node.js, or Python.</li>
</ul>
<p>Subscribe to the <a
href="https://github.com/tigerbeetle/tigerbeetle/issues/2231">tracking
issue #2231</a> to receive notifications about breaking changes!</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-system-architecture"><a
href="#coding-system-architecture"
class="anchor">TigerBeetle in Your System Architecture</a></h1>
<p>TigerBeetle is an Online Transaction Processing (OLTP) database built
for safety and performance. It is not a general purpose database like
PostgreSQL or MySQL. Instead, TigerBeetle works alongside your general
purpose database, which we refer to as an Online General Purpose (OLGP)
database.</p>
<p>TigerBeetle should be used in the data plane, or hot path of
transaction processing, while your general purpose database is used in
the control plane and may be used for storing information or metadata
that is updated less frequently.</p>
<p><img
src="https://github.com/user-attachments/assets/679ec8be-640d-4c7e-b082-076557baeac7"
alt="TigerBeetle in Your System Architecture" /></p>
<h2 id="coding-system-architecture-division-of-responsibilities"><a
href="#coding-system-architecture-division-of-responsibilities" class="anchor">Division of
Responsibilities</a></h2>
<p><strong>App or Website</strong></p>
<ul>
<li>Initiate transactions</li>
<li><a
href="#coding-reliable-transaction-submission-the-app-or-browser-should-generate-the-id">Generate
Transfer and Account IDs</a></li>
</ul>
<p><strong>Stateless API Service</strong></p>
<ul>
<li>Handle authentication and authorization</li>
<li>Create account records in both the general purpose database and
TigerBeetle when users sign up</li>
<li><a href="#coding-system-architecture-ledger-account-and-transfer-types">Cache ledger
metadata</a></li>
<li><a href="#coding-requests-batching-events">Batch transfers</a></li>
<li>Apply exchange rates for <a
href="#coding-recipes-currency-exchange">currency exchange</a>
transactions</li>
</ul>
<p><strong>General Purpose (OLGP) Database</strong></p>
<ul>
<li>Store metadata about ledgers and accounts (such as string names or
descriptions)</li>
<li>Store mappings between <a
href="#coding-system-architecture-ledger-account-and-transfer-types">integer type identifiers</a>
used in TigerBeetle and string representations used by the app and
API</li>
</ul>
<p><strong>TigerBeetle (OLTP) Database</strong></p>
<ul>
<li>Record transfers between accounts</li>
<li>Track balances for accounts</li>
<li>Enforce balance limits</li>
<li>Enforce financial consistency through double-entry bookkeeping</li>
<li>Enforce strict serializability of events</li>
<li>Optionally store pointers to records or entities in the general
purpose database in the <a
href="#coding-data-modeling-user_data"><code>user_data</code></a> fields</li>
</ul>
<h2 id="coding-system-architecture-ledger-account-and-transfer-types"><a
href="#coding-system-architecture-ledger-account-and-transfer-types" class="anchor">Ledger,
Account, and Transfer Types</a></h2>
<p>For performance reasons, TigerBeetle stores the ledger, account, and
transfer types as simple integers. Most likely, you will want these
integers to map to enums of type names or strings, along with other
associated metadata.</p>
<p>The mapping from the string representation of these types to the
integers used within TigerBeetle may be hard-coded into your application
logic or stored in a general purpose (OLGP) database and cached by your
application. (These mappings should be immutable and append-only, so
there is no concern about cache invalidation.)</p>
<p>‚ö†Ô∏è Importantly, <strong>initiating a transfer should not require
fetching metadata from the general purpose database</strong>. If it
does, that database will become the bottleneck and will negate the
performance gains from using TigerBeetle.</p>
<p>Specifically, the types of information that fit into this category
include:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Hard-coded in app or cached</th>
<th>In TigerBeetle</th>
</tr>
</thead>
<tbody>
<tr>
<td>Currency or asset code‚Äôs string representation (for example,
‚ÄúUSD‚Äù)</td>
<td><a href="#coding-data-modeling-asset-scale"><code>ledger</code></a> and
<a href="#coding-data-modeling-asset-scale">asset scale</a></td>
</tr>
<tr>
<td>Account type‚Äôs string representation (for example, ‚Äúcash‚Äù)</td>
<td><a href="#coding-data-modeling-code"><code>code</code></a></td>
</tr>
<tr>
<td>Transfer type‚Äôs string representation (for example, ‚Äúrefund‚Äù)</td>
<td><a href="#coding-data-modeling-code"><code>code</code></a></td>
</tr>
</tbody>
</table>
</div>
<h2 id="coding-system-architecture-authentication"><a href="#coding-system-architecture-authentication"
class="anchor">Authentication</a></h2>
<p>TigerBeetle does not support authentication. You should never allow
untrusted users or services to interact with it directly.</p>
<p>Also, untrusted processes must not be able to access or modify
TigerBeetle‚Äôs on-disk data file.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/system-architecture.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-data-modeling"><a href="#coding-data-modeling" class="anchor">Data
Modeling</a></h1>
<p>This section describes various aspects of the TigerBeetle data model
and provides some suggestions for how you can map your application‚Äôs
requirements onto the data model.</p>
<h2 id="coding-data-modeling-accounts-transfers-and-ledgers"><a
href="#coding-data-modeling-accounts-transfers-and-ledgers" class="anchor">Accounts,
Transfers, and Ledgers</a></h2>
<p>The TigerBeetle data model consists of <a
href="#reference-account"><code>Account</code>s</a>, <a
href="#reference-transfer"><code>Transfer</code>s</a>, and
ledgers.</p>
<h3 id="coding-data-modeling-ledgers"><a href="#coding-data-modeling-ledgers" class="anchor">Ledgers</a></h3>
<p>Ledgers partition accounts into groups that may represent a currency
or asset type or any other logical grouping. Only accounts on the same
ledger can transact directly, but you can use atomically linked
transfers to implement <a href="#coding-recipes-currency-exchange">currency
exchange</a>.</p>
<p>Ledgers are only stored in TigerBeetle as a numeric identifier on the
<a href="#reference-account-ledger">account</a> and <a
href="#reference-transfer">transfer</a> data structures. You may
want to store additional metadata about each ledger in a control plane
<a href="#coding-system-architecture">database</a>.</p>
<p>You can also use different ledgers to further partition accounts,
beyond asset type. For example, if you have a multi-tenant setup where
you are tracking balances for your customers‚Äô end-users, you might have
a ledger for each of your customers. If customers have end-user accounts
in multiple currencies, each of your customers would have multiple
ledgers.</p>
<h2 id="coding-data-modeling-debits-vs-credits"><a href="#coding-data-modeling-debits-vs-credits"
class="anchor">Debits vs Credits</a></h2>
<p>TigerBeetle tracks each account‚Äôs cumulative posted debits and
cumulative posted credits. In double-entry accounting, an account
balance is the difference between the two ‚Äî computed as either
<code>debits - credits</code> or <code>credits - debits</code>,
depending on the type of account. It is up to the application to compute
the balance from the cumulative debits/credits.</p>
<p>From the database‚Äôs perspective the distinction is arbitrary, but
accounting conventions recommend using a certain balance type for
certain types of accounts.</p>
<p>If you are new to thinking in terms of debits and credits, read the
<a href="#coding-financial-accounting">deep dive on financial accounting</a>
to get a better understanding of double-entry bookkeeping and the
different types of accounts.</p>
<h3 id="coding-data-modeling-debit-balances"><a href="#coding-data-modeling-debit-balances" class="anchor">Debit
Balances</a></h3>
<p><code>balance = debits - credits</code></p>
<p>By convention, debit balances are used to represent:</p>
<ul>
<li>Operator‚Äôs Assets</li>
<li>Operator‚Äôs Expenses</li>
</ul>
<p>To enforce a positive (non-negative) debit balance, use <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>.</p>
<p>To keep an account‚Äôs balance between an upper and lower bound, see
the <a href="#coding-recipes-balance-bounds">Balance Bounds recipe</a>.</p>
<h3 id="coding-data-modeling-credit-balances"><a href="#coding-data-modeling-credit-balances"
class="anchor">Credit Balances</a></h3>
<p><code>balance = credits - debits</code></p>
<p>By convention, credit balances are used to represent:</p>
<ul>
<li>Operator‚Äôs Liabilities</li>
<li>Equity in the Operator‚Äôs Business</li>
<li>Operator‚Äôs Income</li>
</ul>
<p>To enforce a positive (non-negative) credit balance, use <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>.
For example, a customer account that is represented as an Operator‚Äôs
Liability would use this flag to ensure that the balance cannot go
negative.</p>
<p>To keep an account‚Äôs balance between an upper and lower bound, see
the <a href="#coding-recipes-balance-bounds">Balance Bounds recipe</a>.</p>
<h3 id="coding-data-modeling-compound-transfers"><a href="#coding-data-modeling-compound-transfers"
class="anchor">Compound Transfers</a></h3>
<p><code>Transfer</code>s in TigerBeetle debit a single account and
credit a single account. You can read more about implementing compound
transfers in <a
href="#coding-recipes-multi-debit-credit-transfers">Multi-Debit, Multi-Credit
Transfers</a>.</p>
<h2 id="coding-data-modeling-fractional-amounts-and-asset-scale"><a
href="#coding-data-modeling-fractional-amounts-and-asset-scale" class="anchor">Fractional
Amounts and Asset Scale</a></h2>
<p>To maximize precision and efficiency, <a
href="#reference-account"><code>Account</code></a> debits/credits
and <a href="#reference-transfer"><code>Transfer</code></a> amounts
are unsigned 128-bit integers. However, currencies are often denominated
in fractional amounts.</p>
<p>To represent a fractional amount in TigerBeetle, <strong>map the
smallest useful unit of the fractional currency to 1</strong>. Consider
all amounts in TigerBeetle as a multiple of that unit.</p>
<p>Applications may rescale the integer amounts as necessary when
rendering or interfacing with other systems. But when working with
fractional amounts, calculations should be performed on the integers to
avoid loss of precision due to floating-point approximations.</p>
<h3 id="coding-data-modeling-asset-scale"><a href="#coding-data-modeling-asset-scale" class="anchor">Asset
Scale</a></h3>
<p>When the multiplier is a power of 10 (e.g. <code>10 ^ n</code>), then
the exponent <code>n</code> is referred to as an <em>asset scale</em>.
For example, representing USD in cents uses an asset scale of
<code>2</code>.</p>
<h4 id="coding-data-modeling-examples"><a href="#coding-data-modeling-examples" class="anchor">Examples</a></h4>
<ul>
<li>In USD, <code>$1</code> = <code>100</code> cents. So for example,
<ul>
<li>The fractional amount <code>$0.45</code> is represented as the
integer <code>45</code>.</li>
<li>The fractional amount <code>$123.00</code> is represented as the
integer <code>12300</code>.</li>
<li>The fractional amount <code>$123.45</code> is represented as the
integer <code>12345</code>.</li>
</ul></li>
</ul>
<h3 id="coding-data-modeling-oversized-amounts"><a href="#coding-data-modeling-oversized-amounts"
class="anchor">Oversized Amounts</a></h3>
<p>The other direction works as well. If the smallest useful unit of a
currency is <code>10,000,000</code> units, then it can be scaled down to
the integer <code>1</code>.</p>
<p>The 128-bit representation defines the precision, but not the
scale.</p>
<h3 id="coding-data-modeling-warning-asset-scales-cannot-be-easily-changed"><a
href="#coding-data-modeling-warning-asset-scales-cannot-be-easily-changed" class="anchor">‚ö†Ô∏è
Asset Scales Cannot Be Easily Changed</a></h3>
<p>When setting your asset scales, we recommend thinking about whether
your application may <em>ever</em> require a larger asset scale. If so,
we would recommend using that larger scale from the start.</p>
<p>For example, it might seem natural to use an asset scale of 2 for
many currencies. However, it may be wise to use a higher scale in case
you ever need to represent smaller fractions of that asset.</p>
<p>Accounts and transfers are immutable once created. In order to change
the asset scale of a ledger, you would need to use a different
<code>ledger</code> number and duplicate all the accounts on that ledger
over to the new one.</p>
<h2 id="coding-data-modeling-user_data"><a href="#coding-data-modeling-user_data"
class="anchor"><code>user_data</code></a></h2>
<p><code>user_data_128</code>, <code>user_data_64</code> and
<code>user_data_32</code> are the most flexible fields in the schema
(for both <a href="#reference-account">accounts</a> and <a
href="#reference-transfer">transfers</a>). Each
<code>user_data</code> field‚Äôs contents are arbitrary, interpreted only
by the application.</p>
<p>Each <code>user_data</code> field is indexed for efficient point and
range queries.</p>
<p>While the usage of each field is entirely up to you, one way of
thinking about each of the fields is:</p>
<ul>
<li><code>user_data_128</code> - this might store the ‚Äúwho‚Äù and/or
‚Äúwhat‚Äù of a transfer. For example, it could be a pointer to a business
entity stored within the <a
href="https://en.wikipedia.org/wiki/Control_plane">control plane</a>
database.</li>
<li><code>user_data_64</code> - this might store a second timestamp for
‚Äúwhen‚Äù the transaction originated in the real world, rather than when
the transfer was <a
href="#coding-time-why-tigerbeetle-manages-timestamps">timestamped by
TigerBeetle</a>. This can be used if you need to model <a
href="https://en.wikipedia.org/wiki/Bitemporal_modeling">bitemporality</a>.
Alternatively, if you do not need this to be used for a timestamp, you
could use this field in place of the <code>user_data_128</code> to store
the ‚Äúwho‚Äù/‚Äúwhat‚Äù.</li>
<li><code>user_data_32</code> - this might store the ‚Äúwhere‚Äù of a
transfer. For example, it could store the jurisdiction where the
transaction originated in the real world. In certain cases, such as for
cross-border remittances, it might not be enough to have the UTC
timestamp and you may want to know the transfer‚Äôs locale.</li>
</ul>
<p>(Note that the <a href="#coding-data-modeling-code"><code>code</code></a> can be used to
encode the ‚Äúwhy‚Äù of a transfer.)</p>
<p>Any of the <code>user_data</code> fields can be used as a group
identifier for objects that will be queried together. For example, for
multiple transfers used for <a
href="#coding-recipes-currency-exchange">currency exchange</a>.</p>
<h2 id="coding-data-modeling-id"><a href="#coding-data-modeling-id" class="anchor"><code>id</code></a></h2>
<p>The <code>id</code> field uniquely identifies each <a
href="#reference-account-id"><code>Account</code></a> and <a
href="#reference-transfer-id"><code>Transfer</code></a> within the
cluster.</p>
<p>The primary purpose of an <code>id</code> is to serve as an
‚Äúidempotency key‚Äù ‚Äî to avoid executing an event twice. For example, if a
client creates a transfer but the server‚Äôs reply is lost, the client (or
application) will retry ‚Äî the database must not transfer the money
twice.</p>
<p>Note that <code>id</code>s are unique per cluster ‚Äì not per ledger.
You should attach a separate identifier in the <a
href="#coding-data-modeling-user_data"><code>user_data</code></a> field if you want to store
a connection between multiple <code>Account</code>s or multiple
<code>Transfer</code>s that are related to one another. For example,
different currency <code>Account</code>s belonging to the same user or
multiple <code>Transfer</code>s that are part of a <a
href="#coding-recipes-currency-exchange">currency exchange</a>.</p>
<p><a href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">TigerBeetle
Time-Based Identifiers</a> are recommended for most applications.</p>
<p>When selecting an <code>id</code> scheme:</p>
<ul>
<li>Idempotency is particularly important (and difficult) in the context
of <a href="#coding-reliable-transaction-submission">application crash
recovery</a>.</li>
<li>Be careful to <a
href="https://en.wikipedia.org/wiki/Birthday_problem">avoid
<code>id</code> collisions</a>.</li>
<li>An account and a transfer may share the same <code>id</code> (they
belong to different ‚Äúnamespaces‚Äù), but this is not recommended because
other systems (that you may later connect to TigerBeetle) may use a
single ‚Äúnamespace‚Äù for all objects.</li>
<li>Avoid requiring a central oracle to generate each unique
<code>id</code> (e.g. an auto-increment field in SQL). A central oracle
may become a performance bottleneck when creating
accounts/transfers.</li>
<li>Sequences of identifiers with long runs of strictly increasing (or
strictly decreasing) values are amenable to optimization, leading to
higher database throughput.</li>
<li>Random identifiers are not recommended ‚Äì they can‚Äôt take advantage
of all of the LSM optimizations. (Random identifiers have ~10% lower
throughput than strictly-increasing ULIDs).</li>
</ul>
<h3 id="coding-data-modeling-tigerbeetle-time-based-identifiers-recommended"><a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended"
class="anchor">TigerBeetle Time-Based Identifiers (Recommended)</a></h3>
<p>TigerBeetle recommends using a specific ID scheme for most
applications. It is time-based and lexicographically sortable. The
scheme is inspired by ULIDs and UUIDv7s but is better able to take
advantage of LSM optimizations, which leads to higher database
throughput.</p>
<p>TigerBeetle clients include an <code>id()</code> function to generate
IDs using the recommended scheme.</p>
<p>TigerBeetle IDs consist of:</p>
<ul>
<li>48 bits of (millisecond) timestamp (high-order bits)</li>
<li>80 bits of randomness (low-order bits)</li>
</ul>
<p>When creating multiple objects during the same millisecond, we
increment the random bytes rather than generating new random bytes.
Furthermore, it is important that IDs are stored in little-endian with
the random bytes as the lower-order bits and the timestamp as the
higher-order bits. These details ensure that a sequence of objects have
strictly increasing IDs according to the server, which improves database
optimization.</p>
<p>Similar to ULIDs and UUIDv7s, these IDs have the following
benefits:</p>
<ul>
<li>they have an insignificant risk of collision.</li>
<li>they do not require a central oracle to generate.</li>
</ul>
<h3 id="coding-data-modeling-reuse-foreign-identifier"><a href="#coding-data-modeling-reuse-foreign-identifier"
class="anchor">Reuse Foreign Identifier</a></h3>
<p>This technique is most appropriate when integrating TigerBeetle with
an existing application where TigerBeetle accounts or transfers map
one-to-one with an entity in the foreign database.</p>
<p>Set <code>id</code> to a ‚Äúforeign key‚Äù ‚Äî that is, reuse an identifier
of a corresponding object from another database. For example, if every
user (within the application‚Äôs database) has a single account, then the
identifier within the foreign database can be used as the
<code>Account.id</code> within TigerBeetle.</p>
<p>To reuse the foreign identifier, it must conform to TigerBeetle‚Äôs
<code>id</code> <a
href="#reference-account-id">constraints</a>.</p>
<h2 id="coding-data-modeling-code"><a href="#coding-data-modeling-code" class="anchor"><code>code</code></a></h2>
<p>The <code>code</code> identifier represents the ‚Äúwhy‚Äù for an Account
or Transfer.</p>
<p>On an <a
href="#reference-account-code"><code>Account</code></a>, the
<code>code</code> indicates the account type, such as assets,
liabilities, equity, income, or expenses, and subcategories within those
classification.</p>
<p>On a <a
href="#reference-transfer-code"><code>Transfer</code></a>, the
<code>code</code> indicates why a given transfer is happening, such as a
purchase, refund, currency exchange, etc.</p>
<p>When you start building out your application on top of TigerBeetle,
you may find it helpful to list out all of the known types of accounts
and movements of funds and mapping each of these to <code>code</code>
numbers or ranges.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/data-modeling.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-financial-accounting"><a href="#coding-financial-accounting"
class="anchor">Financial Accounting</a></h1>
<p>For developers with non-financial backgrounds, TigerBeetle‚Äôs use of
accounting concepts like debits and credits may be one of the trickier
parts to understand. However, these concepts have been the language of
business for hundreds of years, so we promise it‚Äôs worth it!</p>
<p>This page goes a bit deeper into debits and credits, double-entry
bookkeeping, and how to think about your accounts as part of a type
system.</p>
<h2 id="coding-financial-accounting-building-intuition-with-two-simple-examples"><a
href="#coding-financial-accounting-building-intuition-with-two-simple-examples"
class="anchor">Building Intuition with Two Simple Examples</a></h2>
<p>If you have an outstanding loan and owe a bank $100, is your balance
<span class="math inline">100<em>o</em><em>r</em>‚àí</span>100?
Conversely, if you have $200 in your bank account, is the balance <span
class="math inline">200<em>o</em><em>r</em>‚àí</span>200?</p>
<p>Thinking about these two examples, we can start to build an intuition
that the <strong>positive or negative sign of the balance depends on
whose perspective we‚Äôre looking from</strong>. That $100 you owe the
bank represents a ‚Äúbad‚Äù thing for you, but a ‚Äúgood‚Äù thing for the bank.
We might think about that same debt differently if we‚Äôre doing your
accounting or the bank‚Äôs.</p>
<p>These examples also hint at the <strong>different types of
accounts</strong>. We probably want to think about a debt as having the
opposite ‚Äúsign‚Äù as the funds in your bank account. At the same time, the
types of these accounts look different depending on whether you are
considering them from the perspective of you or the bank.</p>
<p>Now, back to our original questions: is the loan balance <span
class="math inline">100<em>o</em><em>r</em>‚àí</span>100 and is the bank
account balance <span
class="math inline">200<em>o</em><em>r</em>‚àí</span>200? On some level,
this feels a bit arbitrary.</p>
<p>Wouldn‚Äôt it be nice if there were some <strong>commonly agreed-upon
standards</strong> so we wouldn‚Äôt have to make such an arbitrary
decision? Yes! This is exactly what debits and credits and the financial
accounting type system provide.</p>
<h2 id="coding-financial-accounting-types-of-accounts"><a href="#coding-financial-accounting-types-of-accounts"
class="anchor">Types of Accounts</a></h2>
<p>In financial accounting, there are 5 main types of accounts:</p>
<ul>
<li><strong>Asset</strong> - what you own, which could produce income or
which you could sell.</li>
<li><strong>Liability</strong> - what you owe to other people.</li>
<li><strong>Equity</strong> - value of the business owned by the owners
or shareholders, or ‚Äúthe residual interest in the assets of the entity
after deducting all its liabilities.‚Äù<a href="#coding-financial-accounting-fn1" class="footnote-ref"
id="coding-financial-accounting-fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li><strong>Income</strong> - money or things of value you receive for
selling products or services, or ‚Äúincreases in assets, or decreases in
liabilities, that result in increases in equity, other than those
relating to contributions from holders of equity claims.‚Äù<a href="#coding-financial-accounting-fn2"
class="footnote-ref" id="coding-financial-accounting-fnref2"
role="doc-noteref"><sup>2</sup></a></li>
<li><strong>Expense</strong> - money you spend to pay for products or
services, or ‚Äúdecreases in assets, or increases in liabilities, that
result in decreases in equity, other than those relating to
distributions to holders of equity claims.‚Äù<a href="#coding-financial-accounting-fn3"
class="footnote-ref" id="coding-financial-accounting-fnref3"
role="doc-noteref"><sup>3</sup></a></li>
</ul>
<p>As mentioned above, the type of account depends on whose perspective
you are doing the accounting from. In those examples, the loan you have
from the bank is liability for you, because you owe the amount to the
bank. However, that same loan is an asset from the bank‚Äôs perspective.
In contrast, the money in your bank account is an asset for you but it
is a liability for the bank.</p>
<p>Each of these major categories are further subdivided into more
specific types of accounts. For example, in your personal accounting you
would separately track the cash in your physical wallet from the funds
in your checking account, even though both of those are assets. The bank
would split out mortgages from car loans, even though both of those are
also assets for the bank.</p>
<aside id="coding-financial-accounting-footnotes" class="footnotes footnotes-end-of-section"
role="doc-footnote">
<hr />
<ol>
<li id="coding-financial-accounting-fn1"><p>IFRS. <em>Conceptual Framework for Financial
Reporting</em>. IFRS Foundation, 2018. <a
href="https://www.ifrs.org/content/dam/ifrs/publications/pdf-standards/english/2021/issued/part-a/conceptual-framework-for-financial-reporting.pdf">https://www.ifrs.org/content/dam/ifrs/publications/pdf-standards/english/2021/issued/part-a/conceptual-framework-for-financial-reporting.pdf</a><a
href="#coding-financial-accounting-fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="coding-financial-accounting-fn2"><p>IFRS. <em>Conceptual Framework for Financial
Reporting</em>. IFRS Foundation, 2018. <a
href="https://www.ifrs.org/content/dam/ifrs/publications/pdf-standards/english/2021/issued/part-a/conceptual-framework-for-financial-reporting.pdf">https://www.ifrs.org/content/dam/ifrs/publications/pdf-standards/english/2021/issued/part-a/conceptual-framework-for-financial-reporting.pdf</a><a
href="#coding-financial-accounting-fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="coding-financial-accounting-fn3"><p>IFRS. <em>Conceptual Framework for Financial
Reporting</em>. IFRS Foundation, 2018. <a
href="https://www.ifrs.org/content/dam/ifrs/publications/pdf-standards/english/2021/issued/part-a/conceptual-framework-for-financial-reporting.pdf">https://www.ifrs.org/content/dam/ifrs/publications/pdf-standards/english/2021/issued/part-a/conceptual-framework-for-financial-reporting.pdf</a><a
href="#coding-financial-accounting-fnref3" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</aside>
<h2 id="coding-financial-accounting-double-entry-bookkeeping"><a href="#coding-financial-accounting-double-entry-bookkeeping"
class="anchor">Double-Entry Bookkeeping</a></h2>
<p>Categorizing accounts into different types is useful for
organizational purposes, but it also provides a key error-correcting
mechanism.</p>
<p>Every record in our accounting is not only recorded in one place, but
in two. This is double-entry bookkeeping. Why would we do that?</p>
<p>Let‚Äôs think about the bank loan in our example above. When you took
out the loan, two things actually happened at the same time. On the one
hand, you now owe the bank $100. At the same time, the bank gave you
$100. These are the two entries that comprise the loan transaction.</p>
<p>From your perspective, your liability to the bank increased by $100
while your assets also increased by $100. From the bank‚Äôs perspective,
their assets (the loan to you) increased by $100 while their liabilities
(the money in your bank account) also increased by $100.</p>
<p>Double-entry bookkeeping ensures that funds are always accounted for.
Money never just appears. <strong>Funds always go from somewhere to
somewhere.</strong></p>
<h2 id="coding-financial-accounting-keeping-accounts-in-balance"><a
href="#coding-financial-accounting-keeping-accounts-in-balance" class="anchor">Keeping Accounts in
Balance</a></h2>
<p>Now we understand that there are different types of accounts and
every transaction will be recorded in two (or more) accounts ‚Äì but which
accounts?</p>
<p>The <a
href="https://en.wikipedia.org/wiki/Accounting_equation">Fundamental
Accounting Equation</a> stipulates that:</p>
<p><strong>Assets - Liabilities = Equity</strong></p>
<p>Using our loan example, it‚Äôs no accident that the loan increases
assets and liabilities at the same time. Assets and liabilities are on
the opposite sides of the equation, and both sides must be exactly
equal. Loans increase assets and liabilities equally.</p>
<p>Here are some other types of transactions that would affect assets,
liabilities, and equity, while maintaining this balance:</p>
<ul>
<li>If you withdraw $100 in cash from your bank account, your total
assets stay the same. Your bank account balance (an asset) would
decrease while your physical cash (another asset) would increase.</li>
<li>From the perspective of the bank, you withdrawing $100 in cash
decreases their assets in the form of the cash they give you, while also
decreasing their liabilities because your bank balance decreases as
well.</li>
<li>If a shareholder invests $1000 in the bank, that increases both the
bank‚Äôs assets and equity.</li>
</ul>
<p>Assets, liabilities, and equity represent a point in time. The other
two main categories, income and expenses, represent flows of money in
and out.</p>
<p>Income and expenses impact the position of the business over time.
The expanded accounting equation can be written as:</p>
<p><strong>Assets - Liabilities = Equity + Income ‚àí
Expenses</strong></p>
<p>You don‚Äôt need to memorize these equations (unless you‚Äôre training as
an accountant!). However, it is useful to understand that those main
account types lie on different sides of this equation.</p>
<h2 id="coding-financial-accounting-debits-and-credits-vs-signed-integers"><a
href="#coding-financial-accounting-debits-and-credits-vs-signed-integers" class="anchor">Debits and
Credits vs Signed Integers</a></h2>
<p>Instead of using a positive or negative integer to track a balance,
TigerBeetle and double-entry bookkeeping systems use <strong>debits and
credits</strong>.</p>
<p>The two entries that give ‚Äúdouble-entry bookkeeping‚Äù its name are the
debit and the credit: every transaction has at least one debit and at
least one credit. (Note that for efficiency‚Äôs sake, TigerBeetle
<code>Transfer</code>s consist of exactly one debit and one credit.
These can be composed into more complex <a
href="#coding-recipes-multi-debit-credit-transfers">multi-debit, multi-credit
transfers</a>.) Which entry is the debit and which is the credit? The
answer is easy once you understand that <strong>accounting is a type
system</strong>. An account increases with a debit or credit according
to its type.</p>
<p>When our example loan increases the assets and liabilities, we need
to assign each of these entries to either be a debit or a credit. At
some level, this is completely arbitrary. For clarity, accountants have
used the same standards for hundreds of years:</p>
<h3 id="coding-financial-accounting-how-debits-and-credits-increase-or-decrease-account-balances"><a
href="#coding-financial-accounting-how-debits-and-credits-increase-or-decrease-account-balances"
class="anchor">How Debits and Credits Increase or Decrease Account
Balances</a></h3>
<ul>
<li><strong>Assets and expenses are increased with debits, decreased
with credits</strong></li>
<li><strong>Liabilities, equity, and income are increased with credits,
decreased with debits</strong></li>
</ul>
<p>Or, in a table form:</p>
<div class="table">
<table>
<thead>
<tr>
<th></th>
<th>Debit</th>
<th>Credit</th>
</tr>
</thead>
<tbody>
<tr>
<td>Asset</td>
<td>+</td>
<td>-</td>
</tr>
<tr>
<td>Liability</td>
<td>-</td>
<td>+</td>
</tr>
<tr>
<td>Equity</td>
<td>-</td>
<td>+</td>
</tr>
<tr>
<td>Income</td>
<td>-</td>
<td>+</td>
</tr>
<tr>
<td>Expense</td>
<td>+</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
<p>From the perspective of our example bank:</p>
<ul>
<li>You taking out a loan debits (increases) their loan assets and
credits (increases) their bank account balance liabilities.</li>
<li>You paying off the loan debits (decreases) their bank account
balance liabilities and credits (decreases) their loan assets.</li>
<li>You depositing cash debits (increases) their cash assets and credits
(increases) their bank account balance liabilities.</li>
<li>You withdrawing cash debits (decreases) their bank account balance
liabilities and credits (decreases) their cash assets.</li>
</ul>
<p>Note that accounting conventions also always write the debits first,
to represent the funds flowing <em>from</em> the debited account
<em>to</em> the credited account.</p>
<p>If this seems arbitrary and confusing, we understand! It‚Äôs a
convention, just like how most programmers need to learn zero-based
array indexing and then at some point it becomes second nature.</p>
<h3 id="coding-financial-accounting-account-types-and-the-normal-balance"><a
href="#coding-financial-accounting-account-types-and-the-normal-balance" class="anchor">Account
Types and the ‚ÄúNormal Balance‚Äù</a></h3>
<p>Some other accounting systems have the concept of a ‚Äúnormal balance‚Äù,
which would indicate whether a given account‚Äôs balance is increased by
debits or credits.</p>
<p>When designing for TigerBeetle, we recommend thinking about account
types instead of ‚Äúnormal balances‚Äù. This is because the type of balance
follows from the type of account, but the type of balance doesn‚Äôt tell
you the type of account. For example, an account might have a normal
balance on the debit side but that doesn‚Äôt tell you whether it is an
asset or expense.</p>
<h2 id="coding-financial-accounting-takeaways"><a href="#coding-financial-accounting-takeaways"
class="anchor">Takeaways</a></h2>
<ul>
<li>Accounts are categorized into types. The 5 main types are asset,
liability, equity, income, and expense.</li>
<li>Depending on the type of account, an increase is recorded as either
a debit or a credit.</li>
<li>All transfers consist of two entries, a debit and a credit.
Double-entry bookkeeping ensures that all funds come from somewhere and
go somewhere.</li>
</ul>
<p>When you get started using TigerBeetle, we would recommend writing a
list of all the types of accounts in your system that you can think of.
Then, think about whether, from the perspective of your business, each
account represents an asset, liability, equity, income, or expense. That
determines whether the given type of account is increased with a debit
or a credit.</p>
<h2 id="coding-financial-accounting-want-more-help-understanding-debits-and-credits"><a
href="#coding-financial-accounting-want-more-help-understanding-debits-and-credits"
class="anchor">Want More Help Understanding Debits and Credits?</a></h2>
<h3 id="coding-financial-accounting-ask-the-community"><a href="#coding-financial-accounting-ask-the-community"
class="anchor">Ask the Community</a></h3>
<p>Have questions about debits and credits, TigerBeetle‚Äôs data model,
how to design your application on top of it, or anything else?</p>
<p>Come join our <a href="https://slack.tigerbeetle.com/join">Community
Slack</a> and ask any and all questions you might have!</p>
<h3 id="coding-financial-accounting-dedicated-consultation"><a href="#coding-financial-accounting-dedicated-consultation"
class="anchor">Dedicated Consultation</a></h3>
<p>Would you like the TigerBeetle team to help you design your chart of
accounts and leverage the power of TigerBeetle in your architecture?</p>
<p>Let us help you get it right. Contact our CEO, Joran Dirk Greef, at
<a href="mailto:joran@tigerbeetle.com">joran@tigerbeetle.com</a> to set
up a call.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/financial-accounting.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-requests"><a href="#coding-requests" class="anchor">Requests</a></h1>
<p>A <em>request</em> queries or updates the database state.</p>
<p>A request consists of one or more <em>events</em> of the same type
sent to the cluster in a single message. For example, a single request
can create multiple transfers but it cannot create both accounts and
transfers.</p>
<p>The cluster commits an entire request at once. Events are applied in
series, such that successive events observe the effects of previous ones
and event timestamps are <a
href="#coding-time-timestamps-are-totally-ordered">totally ordered</a>.</p>
<p>Each request receives one <em>reply</em> message from the cluster.
The reply contains one <em>result</em> for each event in the
request.</p>
<h2 id="coding-requests-request-types"><a href="#coding-requests-request-types" class="anchor">Request
Types</a></h2>
<ul>
<li><a
href="#reference-requests-create_accounts"><code>create_accounts</code></a>:
create <a href="#reference-account"><code>Account</code>s</a></li>
<li><a
href="#reference-requests-create_transfers"><code>create_transfers</code></a>:
create <a
href="#reference-transfer"><code>Transfer</code>s</a></li>
<li><a
href="#reference-requests-lookup_accounts"><code>lookup_accounts</code></a>:
fetch <code>Account</code>s by <code>id</code></li>
<li><a
href="#reference-requests-lookup_transfers"><code>lookup_transfers</code></a>:
fetch <code>Transfer</code>s by <code>id</code></li>
<li><a
href="#reference-requests-get_account_transfers"><code>get_account_transfers</code></a>:
fetch <code>Transfer</code>s by <code>debit_account_id</code> or
<code>credit_account_id</code></li>
<li><a
href="#reference-requests-get_account_balances"><code>get_account_balances</code></a>:
fetch the historical account balance by the <code>Account</code>‚Äôs
<code>id</code>.</li>
<li><a
href="#reference-requests-query_accounts"><code>query_accounts</code></a>:
query <code>Account</code>s</li>
<li><a
href="#reference-requests-query_transfers"><code>query_transfers</code></a>:
query <code>Transfer</code>s</li>
</ul>
<p><em>More request types, including more powerful queries, are coming
soon!</em></p>
<h2 id="coding-requests-events-and-results"><a href="#coding-requests-events-and-results"
class="anchor">Events and Results</a></h2>
<p>Each request has a corresponding <em>event</em> and <em>result</em>
type:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Request Type</th>
<th>Event</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create_accounts</code></td>
<td><a
href="#reference-requests-create_accounts-event"><code>Account</code></a></td>
<td><a
href="#reference-requests-create_accounts-result"><code>CreateAccountResult</code></a></td>
</tr>
<tr>
<td><code>create_transfers</code></td>
<td><a
href="#reference-requests-create_transfers-event"><code>Transfer</code></a></td>
<td><a
href="#reference-requests-create_transfers-result"><code>CreateTransferResult</code></a></td>
</tr>
<tr>
<td><code>lookup_accounts</code></td>
<td><a
href="#reference-requests-lookup_accounts-event"><code>Account.id</code></a></td>
<td><a
href="#reference-requests-lookup_accounts-result"><code>Account</code></a>
or nothing</td>
</tr>
<tr>
<td><code>lookup_transfers</code></td>
<td><a
href="#reference-requests-lookup_transfers-event"><code>Transfer.id</code></a></td>
<td><a
href="#reference-requests-lookup_transfers-result"><code>Transfer</code></a>
or nothing</td>
</tr>
<tr>
<td><code>get_account_transfers</code></td>
<td><a
href="#reference-account-filter"><code>AccountFilter</code></a></td>
<td><a
href="#reference-requests-get_account_transfers-result"><code>Transfer</code></a>
or nothing</td>
</tr>
<tr>
<td><code>get_account_balances</code></td>
<td><a
href="#reference-account-filter"><code>AccountFilter</code></a></td>
<td><a
href="#reference-requests-get_account_balances-result"><code>AccountBalance</code></a>
or nothing</td>
</tr>
<tr>
<td><code>query_accounts</code></td>
<td><a
href="#reference-query-filter"><code>QueryFilter</code></a></td>
<td><a
href="#reference-requests-lookup_accounts-result"><code>Account</code></a>
or nothing</td>
</tr>
<tr>
<td><code>query_transfers</code></td>
<td><a
href="#reference-query-filter"><code>QueryFilter</code></a></td>
<td><a
href="#reference-requests-lookup_transfers-result"><code>Transfer</code></a>
or nothing</td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-requests-idempotency"><a href="#coding-requests-idempotency"
class="anchor">Idempotency</a></h3>
<p>Events that create objects are idempotent. The first event to create
an object with a given <code>id</code> will receive the <code>ok</code>
result. Subsequent events that attempt to create the same object will
receive the <code>exists</code> result.</p>
<h2 id="coding-requests-batching-events"><a href="#coding-requests-batching-events"
class="anchor">Batching Events</a></h2>
<p>To achieve high throughput, TigerBeetle amortizes the overhead of
consensus and I/O by batching many events in each request.</p>
<p>In the default configuration, the maximum batch sizes for each
request type are:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Request Type</th>
<th style="text-align: right;">Request Batch Size (Events)</th>
<th style="text-align: right;">Reply Batch Size (Results)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lookup_accounts</code></td>
<td style="text-align: right;">8190</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>lookup_transfers</code></td>
<td style="text-align: right;">8190</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>create_accounts</code></td>
<td style="text-align: right;">8190</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>create_transfers</code></td>
<td style="text-align: right;">8190</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>get_account_transfers</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>get_account_balances</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>query_accounts</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8190</td>
</tr>
<tr>
<td><code>query_transfers</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8190</td>
</tr>
</tbody>
</table>
</div>
<p>TigerBeetle clients automatically batch events. Therefore, it is
recommended to share the client instances between multiple threads or
tasks to have events batched transparently.</p>
<ul>
<li><a href="#coding-clients-node-batching">Node</a></li>
<li><a href="#coding-clients-go-batching">Go</a></li>
<li><a href="#coding-clients-java-batching">Java</a></li>
<li><a href="#coding-clients-dotnet-batching">.NET</a></li>
<li><a href="#coding-clients-python-batching">Python</a></li>
</ul>
<h2 id="coding-requests-guarantees"><a href="#coding-requests-guarantees"
class="anchor">Guarantees</a></h2>
<ul>
<li>A request executes within the cluster at most once.</li>
<li>Requests do not <a href="#reference-sessions-retries">time
out</a>. Clients will continuously retry requests until they receive a
reply from the cluster. This is because in the case of a network
partition, a lack of response from the cluster could either indicate
that the request was dropped before it was processed or that the reply
was dropped after the request was processed. Note that individual <a
href="#coding-two-phase-transfers">pending transfers</a> within a request may
have <a href="#reference-transfer-timeout">timeouts</a>.</li>
<li>Requests retried by their original client session receive identical
replies.</li>
<li>Requests retried by a different client (same request body, different
session) may receive different replies.</li>
<li>Events within a request are executed in sequence. The effects of a
given event are observable when the next event within that request is
applied.</li>
<li>Events within a request do not interleave with events from other
requests.</li>
<li>All events within a request batch are committed, or none are. Note
that this does not mean that all of the events in a batch will succeed,
or that all will fail. Events succeed or fail independently unless they
are explicitly <a href="#coding-linked-events">linked</a></li>
<li>Once committed, an event will always be committed ‚Äî the cluster‚Äôs
state never backtracks.</li>
<li>Within a cluster, object <a
href="#coding-time-timestamps-are-totally-ordered">timestamps are unique and
strictly increasing</a>. No two objects within the same cluster will
have the same timestamp. Furthermore, the order of the timestamps
indicates the order in which the objects were committed.</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/requests.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-reliable-transaction-submission"><a
href="#coding-reliable-transaction-submission" class="anchor">Reliable
Transaction Submission</a></h1>
<p>When making payments or recording transfers, it is important to
ensure that they are recorded once and only once ‚Äì even if some parts of
the system fail during the transaction.</p>
<p>There are some subtle gotchas to avoid, so this page describes how to
submit events ‚Äì and especially transfers ‚Äì reliably.</p>
<h2 id="coding-reliable-transaction-submission-the-app-or-browser-should-generate-the-id"><a
href="#coding-reliable-transaction-submission-the-app-or-browser-should-generate-the-id" class="anchor">The App
or Browser Should Generate the ID</a></h2>
<p><a href="#reference-transfer-id"><code>Transfer</code>s</a> and
<a href="#reference-account-id"><code>Account</code>s</a> carry an
<code>id</code> field that is used as an idempotency key to ensure the
same object is not created twice.</p>
<p><strong>The client software, such as your app or web page, that the
user interacts with should generate the <code>id</code> (not your API).
This <code>id</code> should be persisted locally before submission, and
the same <code>id</code> should be used for subsequent
retries.</strong></p>
<ol type="1">
<li>User initiates a transfer.</li>
<li>Client software (app, web page, etc) <a
href="#coding-data-modeling-id">generates the transfer
<code>id</code></a>.</li>
<li>Client software <strong>persists the <code>id</code> in the app or
browser local storage.</strong></li>
<li>Client software submits the transfer to your <a
href="#coding-system-architecture">API service</a>.</li>
<li>API service includes the transfer in a <a
href="#reference-requests">request</a>.</li>
<li>TigerBeetle creates the transfer with the given <code>id</code> once
and only once.</li>
<li>TigerBeetle responds to the API service.</li>
<li>The API service responds to the client software.</li>
</ol>
<h3 id="coding-reliable-transaction-submission-handling-network-failures"><a href="#coding-reliable-transaction-submission-handling-network-failures"
class="anchor">Handling Network Failures</a></h3>
<p>The method described above handles various potential network
failures. The request may be lost before it reaches the API service or
before it reaches TigerBeetle. Or, the response may be lost on the way
back from TigerBeetle.</p>
<p>Generating the <code>id</code> on the client side ensures that
transfers can be safely retried. The app must use the same
<code>id</code> each time the transfer is resent.</p>
<p>If the transfer was already created before and then retried,
TigerBeetle will return the <a
href="#reference-requests-create_transfers-exists"><code>exists</code></a>
response code. If the transfer had not already been created, it will be
created and return the <a
href="#reference-requests-create_transfers-ok"><code>ok</code></a>.</p>
<h3 id="coding-reliable-transaction-submission-handling-client-software-restarts"><a
href="#coding-reliable-transaction-submission-handling-client-software-restarts" class="anchor">Handling Client
Software Restarts</a></h3>
<p>The method described above also handles potential restarts of the app
or browser while the request is in flight.</p>
<p>It is important to <strong>persist the <code>id</code> to local
storage on the client‚Äôs device before submitting the transfer</strong>.
When the app or web page reloads, it should resubmit the transfer using
the same <code>id</code>.</p>
<p>This ensures that the operation can be safely retried even if the
client app or browser restarts before receiving the response to the
operation. Similar to the case of a network failure, TigerBeetle will
respond with the <a
href="#reference-requests-create_transfers-ok"><code>ok</code></a>
if a transfer is newly created and <a
href="#reference-requests-create_transfers-exists"><code>exists</code></a>
if an object with the same <code>id</code> was already created.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/reliable-transaction-submission.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-two-phase-transfers"><a href="#coding-two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h1>
<p>A two-phase transfer moves funds in stages:</p>
<ol type="1">
<li>Reserve funds (<a
href="#coding-two-phase-transfers-reserve-funds-pending-transfer">pending</a>)</li>
<li>Resolve funds (<a href="#coding-two-phase-transfers-post-pending-transfer">post</a>, <a
href="#coding-two-phase-transfers-void-pending-transfer">void</a>, or <a
href="#coding-two-phase-transfers-expire-pending-transfer">expire</a>)</li>
</ol>
<p>The name ‚Äútwo-phase transfer‚Äù is a reference to the <a
href="https://en.wikipedia.org/wiki/Two-phase_commit_protocol">two-phase
commit protocol for distributed transactions</a>.</p>
<h2 id="coding-two-phase-transfers-reserve-funds-pending-transfer"><a
href="#coding-two-phase-transfers-reserve-funds-pending-transfer" class="anchor">Reserve Funds
(Pending Transfer)</a></h2>
<p>A pending transfer, denoted by <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a>,
reserves its <code>amount</code> in the debit/credit accounts‚Äô <a
href="#reference-account-debits_pending"><code>debits_pending</code></a>/<a
href="#reference-account-credits_pending"><code>credits_pending</code></a>
fields, respectively. Pending transfers leave the
<code>debits_posted</code>/<code>credits_posted</code> unmodified.</p>
<h2 id="coding-two-phase-transfers-resolve-funds"><a href="#coding-two-phase-transfers-resolve-funds" class="anchor">Resolve
Funds</a></h2>
<p>Pending transfers can be posted, voided, or they may time out.</p>
<h3 id="coding-two-phase-transfers-post-pending-transfer"><a href="#coding-two-phase-transfers-post-pending-transfer"
class="anchor">Post-Pending Transfer</a></h3>
<p>A post-pending transfer, denoted by <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>,
causes a pending transfer to ‚Äúpost‚Äù, transferring some or all of the
pending transfer‚Äôs reserved amount to its destination.</p>
<ul>
<li>If the posted <a
href="#reference-transfer-amount"><code>amount</code></a> is less
than the pending transfer‚Äôs amount, then only this amount is posted, and
the remainder is restored to its original accounts.</li>
<li>If the posted <a
href="#reference-transfer-amount"><code>amount</code></a> is equal
to the pending transfer‚Äôs amount or equal to <code>AMOUNT_MAX</code>
(<code>2^128 - 1</code>), the full pending transfer‚Äôs amount is
posted.</li>
<li>If the posted <a
href="#reference-transfer-amount"><code>amount</code></a> is
greater than the pending transfer‚Äôs amount (but less than
<code>AMOUNT_MAX</code>), <a
href="#reference-requests-create_transfers-exceeds_pending_transfer_amount"><code>exceeds_pending_transfer_amount</code></a>
is returned.</li>
</ul>
<details>
<summary>Client &lt; 0.16.0</summary>

<ul>
<li>If the posted <a
href="#reference-transfer-amount"><code>amount</code></a> is 0, the
full pending transfer‚Äôs amount is posted.</li>
<li>If the posted <a
href="#reference-transfer-amount"><code>amount</code></a> is
nonzero, then only this amount is posted, and the remainder is restored
to its original accounts. It must be less than or equal to the pending
transfer‚Äôs amount.</li>
</ul>
</details>

<p>Additionally, when <code>flags.post_pending_transfer</code> is
set:</p>
<ul>
<li><a
href="#reference-transfer-pending_id"><code>pending_id</code></a>
must reference a <a href="#coding-two-phase-transfers-reserve-funds-pending-transfer">pending
transfer</a>.</li>
<li><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>
must not be set.</li>
</ul>
<p>The following fields may either be zero or they must match the value
of the pending transfer‚Äôs field:</p>
<ul>
<li><a
href="#reference-transfer-debit_account_id"><code>debit_account_id</code></a></li>
<li><a
href="#reference-transfer-credit_account_id"><code>credit_account_id</code></a></li>
<li><a
href="#reference-transfer-ledger"><code>ledger</code></a></li>
<li><a href="#reference-transfer-code"><code>code</code></a></li>
</ul>
<h3 id="coding-two-phase-transfers-void-pending-transfer"><a href="#coding-two-phase-transfers-void-pending-transfer"
class="anchor">Void-Pending Transfer</a></h3>
<p>A void-pending transfer, denoted by <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>,
restores the pending amount its original accounts. Additionally, when
this field is set:</p>
<ul>
<li><a
href="#reference-transfer-pending_id"><code>pending_id</code></a>
must reference a <a href="#coding-two-phase-transfers-reserve-funds-pending-transfer">pending
transfer</a>.</li>
<li><a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>
must not be set.</li>
</ul>
<p>The following fields may either be zero or they must match the value
of the pending transfer‚Äôs field:</p>
<ul>
<li><a
href="#reference-transfer-debit_account_id"><code>debit_account_id</code></a></li>
<li><a
href="#reference-transfer-credit_account_id"><code>credit_account_id</code></a></li>
<li><a
href="#reference-transfer-ledger"><code>ledger</code></a></li>
<li><a href="#reference-transfer-code"><code>code</code></a></li>
</ul>
<h3 id="coding-two-phase-transfers-expire-pending-transfer"><a href="#coding-two-phase-transfers-expire-pending-transfer"
class="anchor">Expire Pending Transfer</a></h3>
<p>A pending transfer may optionally be created with a <a
href="#reference-transfer-timeout">timeout</a>. If the timeout
interval passes before the transfer is either posted or voided, the
transfer expires and the full amount is returned to the original
account.</p>
<p>Note that <code>timeout</code>s are given as intervals, specified in
seconds, rather than as absolute timestamps. For more details on why,
read the page about <a href="#coding-time">Time in TigerBeetle</a>.</p>
<h3 id="coding-two-phase-transfers-errors"><a href="#coding-two-phase-transfers-errors" class="anchor">Errors</a></h3>
<p>A pending transfer can only be posted or voided once. It cannot be
posted twice or voided then posted, etc.</p>
<p>Attempting to resolve a pending transfer more than once will return
the applicable error result:</p>
<ul>
<li><a
href="#reference-requests-create_transfers-pending_transfer_already_posted"><code>pending_transfer_already_posted</code></a></li>
<li><a
href="#reference-requests-create_transfers-pending_transfer_already_voided"><code>pending_transfer_already_voided</code></a></li>
<li><a
href="#reference-requests-create_transfers-pending_transfer_expired"><code>pending_transfer_expired</code></a></li>
</ul>
<h2 id="coding-two-phase-transfers-interaction-with-account-invariants"><a
href="#coding-two-phase-transfers-interaction-with-account-invariants" class="anchor">Interaction
with Account Invariants</a></h2>
<p>The pending transfer‚Äôs amount is reserved in a way that the second
step in a two-phase transfer will never cause the accounts‚Äô configured
balance invariants (<a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>credits_must_not_exceed_debits</code></a>
or <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a>)
to be broken, whether the second step is a post or void.</p>
<h3 id="coding-two-phase-transfers-pessimistic-pending-transfers"><a
href="#coding-two-phase-transfers-pessimistic-pending-transfers" class="anchor">Pessimistic Pending
Transfers</a></h3>
<p>If an account with <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a>
has <code>credits_posted = 100</code> and
<code>debits_posted = 70</code> and a pending transfer is started
causing the account to have <code>debits_pending = 50</code>, the
<em>pending</em> transfer will fail. It will not wait to get to
<em>posted</em> status to fail.</p>
<h2 id="coding-two-phase-transfers-all-transfers-are-immutable"><a
href="#coding-two-phase-transfers-all-transfers-are-immutable" class="anchor">All Transfers Are
Immutable</a></h2>
<p>To reiterate, completing a two-phase transfer (by either marking it
void or posted) does not involve modifying the pending transfer. Instead
you create a new transfer.</p>
<p>The first transfer that is marked pending will always have its
pending flag set.</p>
<p>The second transfer will have a <a
href="#reference-transfer-flagspost_pending_transfer"><code>post_pending_transfer</code></a>
or <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a>
flag set and a <a
href="#reference-transfer-pending_id"><code>pending_id</code></a>
field set to the <a
href="#reference-transfer-id"><code>id</code></a> of the first
transfer. The <a href="#reference-transfer-id"><code>id</code></a>
of the second transfer will be unique, not the same <a
href="#reference-transfer-id"><code>id</code></a> as the initial
pending transfer.</p>
<h2 id="coding-two-phase-transfers-examples"><a href="#coding-two-phase-transfers-examples" class="anchor">Examples</a></h2>
<p>The following examples show the state of two accounts in three
steps:</p>
<ol type="1">
<li>Initially, before any transfers</li>
<li>After a pending transfer</li>
<li>And after the pending transfer is posted or voided</li>
</ol>
<h3 id="coding-two-phase-transfers-post-full-pending-amount"><a href="#coding-two-phase-transfers-post-full-pending-amount"
class="anchor">Post Full Pending Amount</a></h3>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Account <code>A</code></th>
<th style="text-align: right;"></th>
<th style="text-align: right;">Account <code>B</code></th>
<th style="text-align: right;"></th>
<th style="text-align: left;">Transfers</th>
<th style="text-align: left;"></th>
<th style="text-align: right;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><strong>debits</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"><strong>credits</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;"><strong>pending</strong></td>
<td style="text-align: right;"><strong>posted</strong></td>
<td style="text-align: right;"><strong>pending</strong></td>
<td style="text-align: right;"><strong>posted</strong></td>
<td style="text-align: left;"><strong>debit_account_id</strong></td>
<td style="text-align: left;"><strong>credit_account_id</strong></td>
<td style="text-align: right;"><strong>amount</strong></td>
<td style="text-align: left;"><strong>flags</strong></td>
</tr>
<tr>
<td style="text-align: right;"><code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;"><code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr>
<td style="text-align: right;">123 + <code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;">123 + <code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: right;">123</td>
<td style="text-align: left;"><code>pending</code></td>
</tr>
<tr>
<td style="text-align: right;"><code>w</code></td>
<td style="text-align: right;">123 + <code>x</code></td>
<td style="text-align: right;"><code>y</code></td>
<td style="text-align: right;">123 + <code>z</code></td>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: right;">123</td>
<td style="text-align: left;"><code>post_pending_transfer</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-two-phase-transfers-post-partial-pending-amount"><a
href="#coding-two-phase-transfers-post-partial-pending-amount" class="anchor">Post Partial Pending
Amount</a></h3>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Account <code>A</code></th>
<th style="text-align: right;"></th>
<th style="text-align: right;">Account <code>B</code></th>
<th style="text-align: right;"></th>
<th style="text-align: left;">Transfers</th>
<th style="text-align: left;"></th>
<th style="text-align: right;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><strong>debits</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"><strong>credits</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;"><strong>pending</strong></td>
<td style="text-align: right;"><strong>posted</strong></td>
<td style="text-align: right;"><strong>pending</strong></td>
<td style="text-align: right;"><strong>posted</strong></td>
<td style="text-align: left;"><strong>debit_account_id</strong></td>
<td style="text-align: left;"><strong>credit_account_id</strong></td>
<td style="text-align: right;"><strong>amount</strong></td>
<td style="text-align: left;"><strong>flags</strong></td>
</tr>
<tr>
<td style="text-align: right;"><code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;"><code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr>
<td style="text-align: right;">123 + <code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;">123 + <code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: right;">123</td>
<td style="text-align: left;"><code>pending</code></td>
</tr>
<tr>
<td style="text-align: right;"><code>w</code></td>
<td style="text-align: right;">100 + <code>x</code></td>
<td style="text-align: right;"><code>y</code></td>
<td style="text-align: right;">100 + <code>z</code></td>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"><code>post_pending_transfer</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-two-phase-transfers-void-pending-transfer-1"><a href="#coding-two-phase-transfers-void-pending-transfer-1"
class="anchor">Void Pending Transfer</a></h3>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Account <code>A</code></th>
<th style="text-align: right;"></th>
<th style="text-align: right;">Account <code>B</code></th>
<th style="text-align: right;"></th>
<th style="text-align: left;">Transfers</th>
<th style="text-align: left;"></th>
<th style="text-align: right;"></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><strong>debits</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"><strong>credits</strong></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: right;"><strong>pending</strong></td>
<td style="text-align: right;"><strong>posted</strong></td>
<td style="text-align: right;"><strong>pending</strong></td>
<td style="text-align: right;"><strong>posted</strong></td>
<td style="text-align: left;"><strong>debit_account_id</strong></td>
<td style="text-align: left;"><strong>credit_account_id</strong></td>
<td style="text-align: right;"><strong>amount</strong></td>
<td style="text-align: left;"><strong>flags</strong></td>
</tr>
<tr>
<td style="text-align: right;"><code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;"><code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr>
<td style="text-align: right;">123 + <code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;">123 + <code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: right;">123</td>
<td style="text-align: left;"><code>pending</code></td>
</tr>
<tr>
<td style="text-align: right;"><code>w</code></td>
<td style="text-align: right;"><code>x</code></td>
<td style="text-align: right;"><code>y</code></td>
<td style="text-align: right;"><code>z</code></td>
<td style="text-align: left;"><code>A</code></td>
<td style="text-align: left;"><code>B</code></td>
<td style="text-align: right;">123</td>
<td style="text-align: left;"><code>void_pending_transfer</code></td>
</tr>
</tbody>
</table>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/two-phase-transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-linked-events"><a href="#coding-linked-events" class="anchor">Linked
Events</a></h1>
<p>Events within a request <a
href="#reference-requests-create_transfers-result">succeed or
fail</a> independently unless they are explicitly linked using
<code>flags.linked</code> (<a
href="#reference-account-flagslinked"><code>Account.flags.linked</code></a>
or <a
href="#reference-transfer-flagslinked"><code>Transfer.flags.linked</code></a>).</p>
<p>When the <code>linked</code> flag is specified, it links the outcome
of a Transfer or Account creation with the outcome of the next one in
the request. These chains of events will all succeed or fail
together.</p>
<p><strong>The last event in a chain is denoted by the first Transfer or
Account without this flag.</strong></p>
<p>The last Transfer or Account in a request may never have the
<code>flags.linked</code> set, as it would leave a chain open-ended.
Attempting to do so will result in the <a
href="#reference-requests-create_transfers-linked_event_chain_open"><code>linked_event_chain_open</code></a>
error.</p>
<p>Multiple chains of events may coexist within a request to succeed or
fail independently.</p>
<p>Events within a chain are executed in order, or are rolled back on
error, so that the effect of each event in the chain is visible to the
next. Each chain is either visible or invisible as a unit to subsequent
transfers after the chain. The event that was the first to fail within a
chain will have a unique error result. Other events in the chain will
have their error result set to <a
href="#reference-requests-create_transfers-linked_event_failed"><code>linked_event_failed</code></a>.</p>
<h3 id="coding-linked-events-linked-transfers-example"><a href="#coding-linked-events-linked-transfers-example"
class="anchor">Linked Transfers Example</a></h3>
<p>Consider this set of Transfers as part of a request:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th>Index in Request</th>
<th>flags.linked</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>A</code></td>
<td><code>0</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>B</code></td>
<td><code>1</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>C</code></td>
<td><code>2</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>D</code></td>
<td><code>3</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>E</code></td>
<td><code>4</code></td>
<td><code>false</code></td>
</tr>
</tbody>
</table>
</div>
<p>If any of transfers <code>B</code>, <code>C</code>, or <code>D</code>
fail (for example, due to <a
href="#reference-requests-create_transfers-exceeds_credits"><code>exceeds_credits</code></a>),
then <code>B</code>, <code>C</code>, and <code>D</code> will all fail.
They are linked.</p>
<p>Transfers <code>A</code> and <code>E</code> fail or succeed
independently of <code>B</code>, <code>C</code>, <code>D</code>, and
each other.</p>
<p>After the chain of linked events has executed, the fact that they
were linked will not be saved. To save the association between Transfers
or Accounts, it must be <a href="#coding-data-modeling">encoded into the data
model</a>, for example by adding an ID to one of the <a
href="#coding-data-modeling-user_data">user data</a> fields.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/linked-events.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-time"><a href="#coding-time" class="anchor">Time</a></h1>
<p>Time is a critical component of all distributed systems and
databases. Within TigerBeetle, we keep track of two types of time:
logical time and physical time. Logical time is about ordering events
relative to each other, and physical time is the everyday time, a
numeric timestamp.</p>
<h2 id="coding-time-logical-time"><a href="#coding-time-logical-time" class="anchor">Logical
Time</a></h2>
<p>TigerBeetle uses a consensus protocol (<a
href="https://pmg.csail.mit.edu/papers/vr-revisited.pdf">Viewstamped
Replication</a>) to guarantee <a
href="http://www.bailis.org/blog/linearizability-versus-serializability/">strict
serializability</a> for all operations.</p>
<p>In other words, to an external observer, TigerBeetle cluster behaves
as if it is just a single machine which processes the incoming requests
in order. If an application submits a batch of transfers with transfer
<code>T1</code>, receives a reply, and then submits a batch with another
transfer <code>T2</code>, it is guaranteed that <code>T2</code> will
observe the effects of <code>T1</code>. Note, however, that there could
be concurrent requests from multiple applications, so, unless
<code>T1</code> and <code>T2</code> are in the same batch of transfers,
some other transfer could happen in between them. See the <a
href="#reference-sessions">reference</a> for precise
guarantees.</p>
<h2 id="coding-time-physical-time"><a href="#coding-time-physical-time" class="anchor">Physical
Time</a></h2>
<p>TigerBeetle uses physical time in addition to the logical time
provided by the consensus algorithm. Financial transactions require
physical time for multiple reasons, including:</p>
<ul>
<li><strong>Liquidity</strong> - TigerBeetle supports <a
href="#coding-two-phase-transfers">Two-Phase Transfers</a> that reserve funds
and hold them in a pending state until they are posted, voided, or the
transfer times out. A timeout is useful to ensure that the reserved
funds are not held in limbo indefinitely.</li>
<li><strong>Compliance and Auditing</strong> - For regulatory and
security purposes, it is useful to have a specific idea of when (in
terms of wall clock time) transfers took place.</li>
</ul>
<p>TigerBeetle uses two-layered approach to physical time. On the basic
layer, each replica asks the underling operating system about the
current time. Then, timing information from several replicas is
aggregated to make sure that the replicas roughly agree on the time, to
prevent a replica with a bad clock from issuing incorrect timestamps.
Additionally, this ‚Äúcluster time‚Äù is made strictly monotonic, for end
user‚Äôs convenience.</p>
<h2 id="coding-time-why-tigerbeetle-manages-timestamps"><a
href="#coding-time-why-tigerbeetle-manages-timestamps" class="anchor">Why
TigerBeetle Manages Timestamps</a></h2>
<p>An important invariant is that the TigerBeetle cluster assigns all
timestamps. In particular, timestamps on <a
href="#reference-transfer-timestamp"><code>Transfer</code>s</a> and
<a href="#reference-account-timestamp"><code>Account</code>s</a>
are set by the cluster when the corresponding event arrives at the
primary. This is why the <code>timestamp</code> field must be set to
<code>0</code> when operations are submitted by the client.</p>
<p>Similarly, the <a
href="#reference-transfer-timeout"><code>Transfer.timeout</code></a>
is given as an interval in seconds, rather than as an absolute
timestamp, because it is also managed by the primary. The
<code>timeout</code> is calculated relative to the
<code>timestamp</code> when the operation arrives at the primary.</p>
<p>This restriction is needed to make sure that any two timestamps
always refer to the same underlying clock (cluster‚Äôs physical time) and
are directly comparable. This in turn provides a set of powerful
guarantees.</p>
<h3 id="coding-time-timestamps-are-totally-ordered"><a
href="#coding-time-timestamps-are-totally-ordered" class="anchor">Timestamps are
Totally Ordered</a></h3>
<p>All <code>timestamp</code>s within TigerBeetle are unique, immutable
and <a href="https://book.mixu.net/distsys/time.html">totally
ordered</a>. A transfer that is created before another transfer is
guaranteed to have an earlier <code>timestamp</code> (even if they were
created in the same request).</p>
<p>In other systems this is also called a ‚Äúphysical‚Äù timestamp,
‚Äúingestion‚Äù timestamp, ‚Äúrecord‚Äù timestamp, or ‚Äúsystem‚Äù timestamp.</p>
<h2 id="coding-time-further-reading"><a href="#coding-time-further-reading"
class="anchor">Further Reading</a></h2>
<p>If you are curious how exactly it is that TigerBeetle achieves
strictly monotonic physical time, we have a talk and a blog post with
details:</p>
<ul>
<li><a href="https://youtu.be/7R-Iz6sJG6Q?si=9sD2TpfD29AxUjOY">Detecting
Clock Sync Failure in Highly Available Systems (YouTube)</a></li>
<li><a
href="https://tigerbeetle.com/blog/three-clocks-are-better-than-one/">Three
Clocks are Better than One (TigerBeetle Blog)</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/time.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes"><a href="#coding-recipes" class="anchor">Recipes</a></h1>
<p>A collection of solutions for common use-cases. What to exchange some
currency? Or made a wrong transfer and want to undo that? We have a
recipe for that!</p>
<ul>
<li><a href="#coding-recipes-currency-exchange">Currency Exchange</a></li>
<li><a href="#coding-recipes-multi-debit-credit-transfers">Multi-Debit, Multi-Credit
Transfers</a></li>
<li><a href="#coding-recipes-close-account">Closing Accounts</a></li>
<li><a href="#coding-recipes-balance-conditional-transfers">Balance-Conditional
Transfers</a></li>
<li><a href="#coding-recipes-balance-invariant-transfers">Balance-Invariant
Transfers</a></li>
<li><a href="#coding-recipes-balance-bounds">Balance Bounds</a></li>
<li><a href="#coding-recipes-correcting-transfers">Correcting Transfers</a></li>
<li><a href="#coding-recipes-rate-limiting">Rate Limiting</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-currency-exchange"><a href="#coding-recipes-currency-exchange"
class="anchor">Currency Exchange</a></h1>
<p>Some applications require multiple currencies. For example, a bank
may hold balances in many different currencies. If a single logical
entity holds multiple currencies, each currency must be held in a
separate TigerBeetle <code>Account</code>. (Normalizing to a single
currency at the application level should be avoided because exchange
rates fluctuate).</p>
<p>Currency exchange is a trade of one type of currency (denoted by the
<code>ledger</code>) for another, facilitated by an entity called the
<em>liquidity provider</em>.</p>
<h2 id="coding-recipes-currency-exchange-data-modeling"><a href="#coding-recipes-currency-exchange-data-modeling" class="anchor">Data
Modeling</a></h2>
<p>Distinct <a
href="#reference-account-ledger"><code>ledger</code></a> values
denote different currencies (or other asset types). Transfers between
pairs of accounts with different <code>ledger</code>s are <a
href="#reference-requests-create_transfers-accounts_must_have_the_same_ledger">not
permitted</a>.</p>
<p>Instead, currency exchange is implemented by creating two <a
href="#reference-transfer-flagslinked">atomically linked</a>
different-ledger transfers between two pairs of same-ledger
accounts.</p>
<p>A simple currency exchange involves four accounts:</p>
<ul>
<li>A <em>source account</em> <code>A‚ÇÅ</code>, on ledger
<code>1</code>.</li>
<li>A <em>destination account</em> <code>A‚ÇÇ</code>, on ledger
<code>2</code>.</li>
<li>A <em>source liquidity account</em> <code>L‚ÇÅ</code>, on ledger
<code>1</code>.</li>
<li>A <em>destination liquidity account</em> <code>L‚ÇÇ</code>, on ledger
<code>2</code>.</li>
</ul>
<p>and two linked transfers:</p>
<ul>
<li>A transfer <code>T‚ÇÅ</code> from the <em>source account</em> to the
<em>source liquidity account</em>.</li>
<li>A transfer <code>T‚ÇÇ</code> from the <em>destination liquidity
account</em> to the <em>destination account</em>.</li>
</ul>
<p>The transfer amounts vary according to the exchange rate.</p>
<ul>
<li>Both liquidity accounts belong to the liquidity provider (e.g. a
bank or exchange).</li>
<li>The source and destination accounts may belong to the same entity as
one another, or different entities, depending on the use case.</li>
</ul>
<h3 id="coding-recipes-currency-exchange-example"><a href="#coding-recipes-currency-exchange-example" class="anchor">Example</a></h3>
<p>Consider sending <code>$100.00</code> from account <code>A‚ÇÅ</code>
(denominated in USD) to account <code>A‚ÇÇ</code> (denominated in INR).
Assuming an exchange rate of <code>$1.00 = ‚Çπ82.42135</code>,
<code>$100.00 = ‚Çπ8242.135</code>:</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A‚ÇÅ</code></td>
<td style="text-align: right;"><code>L‚ÇÅ</code></td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">INR</td>
<td style="text-align: right;"><code>L‚ÇÇ</code></td>
<td style="text-align: right;"><code>A‚ÇÇ</code></td>
<td style="text-align: right;">8242135</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>Amounts are <a
href="#coding-data-modeling-fractional-amounts-and-asset-scale">represented
as integers</a>.</li>
<li>Because both liquidity accounts belong to the same entity, the
entity does not lose money on the transaction.
<ul>
<li>If the exchange rate is precise, the entity breaks even.</li>
<li>If the exchange rate is not precise, the application should round in
favor of the liquidity account to deter arbitrage.</li>
</ul></li>
<li>Because the two transfers are linked together, they will either both
succeed or both fail.</li>
</ul>
<h2 id="coding-recipes-currency-exchange-spread"><a href="#coding-recipes-currency-exchange-spread" class="anchor">Spread</a></h2>
<p>In the prior example, the liquidity provider breaks even. A fee (i.e.
spread) can be included in the <code>linked</code> chain as a separate
transfer from the source account to the source liquidity account
(<code>A‚ÇÅ</code> to <code>L‚ÇÅ</code>).</p>
<p>This is preferable to simply modifying the exchange rate in the
liquidity provider‚Äôs favor because it implicitly records the exchange
rate and spread at the time of the exchange ‚Äî information that cannot be
derived if the two are combined.</p>
<h3 id="coding-recipes-currency-exchange-example-1"><a href="#coding-recipes-currency-exchange-example-1" class="anchor">Example</a></h3>
<p>This depicts the same scenario as the prior example, except the
liquidity provider charges a <code>$0.10</code> fee for the
transaction.</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A‚ÇÅ</code></td>
<td style="text-align: right;"><code>L‚ÇÅ</code></td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A‚ÇÅ</code></td>
<td style="text-align: right;"><code>L‚ÇÅ</code></td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">INR</td>
<td style="text-align: right;"><code>L‚ÇÇ</code></td>
<td style="text-align: right;"><code>A‚ÇÇ</code></td>
<td style="text-align: right;">8242135</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/currency-exchange.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-multi-debit-credit-transfers"><a
href="#coding-recipes-multi-debit-credit-transfers" class="anchor">Multi-Debit,
Multi-Credit Transfers</a></h1>
<p>TigerBeetle is designed for maximum performance. In order to keep it
lean, the database only supports simple transfers with a single debit
and a single credit.</p>
<p>However, you‚Äôll probably run into cases where you want transactions
with multiple debits and/or credits. For example, you might have a
transfer where you want to extract fees and/or taxes.</p>
<p>Read on to see how to implement one-to-many and many-to-many
transfers!</p>
<blockquote>
<p>Note that all of these examples use the <a
href="#reference-transfer-flagslinked">Linked Transfers flag
(<code>flags.linked</code>)</a> to ensure that all of the transfers
succeed or fail together.</p>
</blockquote>
<h2 id="coding-recipes-multi-debit-credit-transfers-one-to-many-transfers"><a href="#coding-recipes-multi-debit-credit-transfers-one-to-many-transfers"
class="anchor">One-to-Many Transfers</a></h2>
<p>Transactions that involve multiple debits and a single credit OR a
single debit and multiple credits are relatively straightforward.</p>
<p>You can use multiple linked transfers as depicted below.</p>
<h3 id="coding-recipes-multi-debit-credit-transfers-single-debit-multiple-credits"><a
href="#coding-recipes-multi-debit-credit-transfers-single-debit-multiple-credits" class="anchor">Single Debit,
Multiple Credits</a></h3>
<p>This example debits a single account and credits multiple accounts.
It uses the following accounts:</p>
<ul>
<li>A <em>source account</em> <code>A</code>, on the <code>USD</code>
ledger.</li>
<li>Three <em>destination accounts</em> <code>X</code>, <code>Y</code>,
and <code>Z</code>, on the <code>USD</code> ledger.</li>
</ul>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>Y</code></td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>Z</code></td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-recipes-multi-debit-credit-transfers-multiple-debits-single-credit"><a
href="#coding-recipes-multi-debit-credit-transfers-multiple-debits-single-credit" class="anchor">Multiple Debits,
Single Credit</a></h3>
<p>This example debits multiple accounts and credits a single account.
It uses the following accounts:</p>
<ul>
<li>Three <em>source accounts</em> <code>A</code>, <code>B</code>, and
<code>C</code> on the <code>USD</code> ledger.</li>
<li>A <em>destination account</em> <code>X</code> on the
<code>USD</code> ledger.</li>
</ul>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-recipes-multi-debit-credit-transfers-multiple-debits-single-credit-balancing-debits"><a
href="#coding-recipes-multi-debit-credit-transfers-multiple-debits-single-credit-balancing-debits"
class="anchor">Multiple Debits, Single Credit, Balancing debits</a></h3>
<p>This example debits multiple accounts and credits a single account.
The total amount to transfer to the credit account is known (in this
case, <code>100</code>), but the balances of the individual debit
accounts are not known. That is, each debit account should contribute as
much as possible (in order of precedence) up to the target, cumulative
transfer amount.</p>
<p>It uses the following accounts:</p>
<ul>
<li>Three <em>source accounts</em> <code>A</code>, <code>B</code>, and
<code>C</code>, with <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>.</li>
<li>A <em>destination account</em> <code>X</code>.</li>
<li>A control account <code>LIMIT</code>, with <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>.</li>
<li>A control account <code>SETUP</code>, for setting up the
<code>LIMIT</code> account.</li>
</ul>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Id</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: left;">Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>SETUP</code></td>
<td style="text-align: right;"><code>LIMIT</code></td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a></td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>SETUP</code></td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a>,
<a
href="#reference-transfer-flagsbalancing_debit"><code>balancing_debit</code></a>,
<a
href="#reference-transfer-flagsbalancing_credit"><code>balancing_credit</code></a></td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;"><code>SETUP</code></td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a>,
<a
href="#reference-transfer-flagsbalancing_debit"><code>balancing_debit</code></a>,
<a
href="#reference-transfer-flagsbalancing_credit"><code>balancing_credit</code></a></td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;"><code>SETUP</code></td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a>,
<a
href="#reference-transfer-flagsbalancing_debit"><code>balancing_debit</code></a>,
<a
href="#reference-transfer-flagsbalancing_credit"><code>balancing_credit</code></a></td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>SETUP</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a></td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>LIMIT</code></td>
<td style="text-align: right;"><code>SETUP</code></td>
<td style="text-align: right;">-0</td>
<td style="text-align: left;"><a
href="#reference-transfer-flagsbalancing_credit"><code>balancing_credit</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>If the cumulative <a
href="#coding-data-modeling-credit-balances">credit balance</a> of
<code>A + B + C</code> is less than <code>100</code>, the chain will
fail (transfer <code>6</code> will return
<code>exceeds_credits</code>).</p>
<h2 id="coding-recipes-multi-debit-credit-transfers-many-to-many-transfers"><a href="#coding-recipes-multi-debit-credit-transfers-many-to-many-transfers"
class="anchor">Many-to-Many Transfers</a></h2>
<p>Transactions with multiple debits and multiple credits are a bit more
involved (but you got this!).</p>
<p>This is where the accounting concept of a Control Account comes in
handy. We can use this as an intermediary account, as illustrated
below.</p>
<p>In this example, we‚Äôll use the following accounts:</p>
<ul>
<li>Two <em>source accounts</em> <code>A</code> and <code>B</code> on
the <code>USD</code> ledger.</li>
<li>Three <em>destination accounts</em> <code>X</code>, <code>Y</code>,
and <code>Z</code>, on the <code>USD</code> ledger.</li>
<li>A <em>compound entry control account</em> <code>Control</code> on
the <code>USD</code> ledger.</li>
</ul>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>Control</code></td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;"><code>Control</code></td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>Control</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">9000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>Control</code></td>
<td style="text-align: right;"><code>Y</code></td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>Control</code></td>
<td style="text-align: right;"><code>Z</code></td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<p>Here, we use two transfers to debit accounts <code>A</code> and
<code>B</code> and credit the <code>Control</code> account, and another
three transfers to credit accounts <code>X</code>, <code>Y</code>, and
<code>Z</code>.</p>
<p>If you looked closely at this example, you may have noticed that we
could have debited <code>B</code> and credited <code>Z</code> directly
because the amounts happened to line up. That is true!</p>
<p>For a little more extreme performance, you <em>might</em> consider
implementing logic to circumvent the control account where possible, to
reduce the number of transfers to implement a compound journal
entry.</p>
<p>However, if you‚Äôre just getting started, you can avoid premature
optimizations (we‚Äôve all been there!). You may find it easier to program
these compound journal entries <em>always</em> using a control account ‚Äì
and you can then come back to squeeze this performance out later!</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/multi-debit-credit-transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-close-account"><a href="#coding-recipes-close-account" class="anchor">Close
Account</a></h1>
<p>In accounting, a <em>closing entry</em> calculates the net debit or
credit balance for an account and then credits or debits this balance
respectively, to zero the account‚Äôs balance and move the balance to
another account.</p>
<p>Additionally, it may be desirable to forbid further transfers on this
account (i.e. at the end of an accounting period, upon account
termination, or even temporarily freezing the account for audit
purposes.</p>
<h3 id="coding-recipes-close-account-example"><a href="#coding-recipes-close-account-example" class="anchor">Example</a></h3>
<p>Given a set of accounts:</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Account</th>
<th style="text-align: right;">Debits Pending</th>
<th style="text-align: right;">Debits Posted</th>
<th style="text-align: right;">Credits Pending</th>
<th style="text-align: right;">Credits Posted</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>credits_must_not_exceed_debits</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>The ‚Äúclosing entries‚Äù for accounts <code>A</code> and <code>B</code>
are expressed as <em>linked chains</em>, so they either succeed or fail
atomically.</p>
<ul>
<li><p>Account <code>A</code>: the linked transfers are <code>T1</code>
and <code>T2</code>.</p></li>
<li><p>Account <code>B</code>: the linked transfers are <code>T3</code>
and <code>T4</code>.</p></li>
<li><p>Account <code>C</code>: is the <em>control account</em> and will
not be closed.</p></li>
</ul>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Transfer</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;">Amount (recorded)</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>T1</code></td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;"><code>AMOUNT_MAX</code></td>
<td style="text-align: right;">10</td>
<td><a
href="#reference-transfer-flagsbalancing_debit"><code>balancing_debit</code></a>,<a
href="#reference-transfer-flagslinked"><code>linked</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>T2</code></td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td><a
href="#reference-transfer-flagsclosing_debit"><code>closing_debit</code></a>,
<a
href="#reference-transfer-flagspending"><code>pending</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>T3</code></td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;"><code>AMOUNT_MAX</code></td>
<td style="text-align: right;">25</td>
<td><a
href="#reference-transfer-flagsbalancing_credit"><code>balancing_credit</code></a>,<a
href="#reference-transfer-flagslinked"><code>linked</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>T4</code></td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td><a
href="#reference-transfer-flagsclosing_credit"><code>closing_credit</code></a>,
<a
href="#reference-transfer-flagspending"><code>pending</code></a></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><code>T1</code> and <code>T3</code> are <em>balancing
transfers</em> with <code>AMOUNT_MAX</code> as the
<code>Transfer.amount</code> so that the application does not need to
know (or query) the balance prior to closing the account.</p>
<p>The stored transfer‚Äôs <code>amount</code> will be set to the actual
amount transferred.</p></li>
<li><p><code>T2</code> and <code>T4</code> are <em>closing
transfers</em> that will cause the respective account to be closed.</p>
<p>The closing transfer must be also a <em>pending transfer</em> so the
action can be reversible.</p></li>
</ul>
<p>After committing these transfers, <code>A</code> and <code>B</code>
are closed with net balance zero, and will reject any further
transfers.</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Account</th>
<th style="text-align: right;">Debits Pending</th>
<th style="text-align: right;">Debits Posted</th>
<th style="text-align: right;">Credits Pending</th>
<th style="text-align: right;">Credits Posted</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a>,
<a
href="#reference-account-flagsclosed"><code>closed</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>credits_must_not_exceed_debits</code></a>,
<a
href="#reference-account-flagsclosed"><code>closed</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>To re-open the closed account, the <em>pending closing transfer</em>
can be <em>voided</em>, reverting the closing action (but not reverting
the net balance):</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Transfer</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;">Pending Transfer</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>T5</code></td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;"><code>T2</code></td>
<td><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>T6</code></td>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;"><code>T4</code></td>
<td><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>After committing these transfers, <code>A</code> and <code>B</code>
are re-opened and can accept transfers again:</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Account</th>
<th style="text-align: right;">Debits Pending</th>
<th style="text-align: right;">Debits Posted</th>
<th style="text-align: right;">Credits Pending</th>
<th style="text-align: right;">Credits Posted</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>B</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>credits_must_not_exceed_debits</code></a></td>
</tr>
<tr>
<td style="text-align: right;"><code>C</code></td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/close-account.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-balance-conditional-transfers"><a
href="#coding-recipes-balance-conditional-transfers" class="anchor">Balance-Conditional
Transfers</a></h1>
<p>In some use cases, you may want to execute a transfer if and only if
an account has at least a certain balance.</p>
<p>It would be unsafe to check an account‚Äôs balance using the <a
href="#reference-requests-lookup_accounts"><code>lookup_accounts</code></a>
and then perform the transfer, because these requests are not be atomic
and the account‚Äôs balance may change between the lookup and the
transfer.</p>
<p>You can atomically run a check against an account‚Äôs balance before
executing a transfer by using a control or temporary account and linked
transfers.</p>
<h2 id="coding-recipes-balance-conditional-transfers-preconditions"><a href="#coding-recipes-balance-conditional-transfers-preconditions"
class="anchor">Preconditions</a></h2>
<h3 id="coding-recipes-balance-conditional-transfers-1-target-account-must-have-a-limited-balance"><a
href="#coding-recipes-balance-conditional-transfers-1-target-account-must-have-a-limited-balance" class="anchor">1.
Target Account Must Have a Limited Balance</a></h3>
<p>The account for whom you want to do the balance check must have one
of these flags set:</p>
<ul>
<li><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
for accounts with <a href="#coding-data-modeling-credit-balances">credit
balances</a></li>
<li><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
for accounts with <a href="#coding-data-modeling-debit-balances">debit
balances</a></li>
</ul>
<h3 id="coding-recipes-balance-conditional-transfers-2-create-a-control-account"><a
href="#coding-recipes-balance-conditional-transfers-2-create-a-control-account" class="anchor">2. Create a Control
Account</a></h3>
<p>There must also be a designated control account. As you can see
below, this account will never actually take control of the target
account‚Äôs funds, but we will set up simultaneous transfers in and out of
the control account.</p>
<h2 id="coding-recipes-balance-conditional-transfers-executing-a-balance-conditional-transfer"><a
href="#coding-recipes-balance-conditional-transfers-executing-a-balance-conditional-transfer"
class="anchor">Executing a Balance-Conditional Transfer</a></h2>
<p>The balance-conditional transfer consists of 3 <a
href="#coding-linked-events">linked transfers</a>.</p>
<p>We will refer to two amounts:</p>
<ul>
<li>The <strong>threshold amount</strong> is the minimum amount the
target account should have in order to execute the transfer.</li>
<li>The <strong>transfer amount</strong> is the amount we want to
transfer if and only if the target account‚Äôs balance meets the
threshold.</li>
</ul>
<h3 id="coding-recipes-balance-conditional-transfers-if-the-source-account-has-a-credit-balance"><a
href="#coding-recipes-balance-conditional-transfers-if-the-source-account-has-a-credit-balance" class="anchor">If the
Source Account Has a Credit Balance</a></h3>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th>Debit Account</th>
<th>Credit Account</th>
<th>Amount</th>
<th>Pending Id</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Source</td>
<td>Control</td>
<td>Threshold</td>
<td>-</td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>,
<a
href="#reference-transfer-flagspending"><code>pending</code></a></td>
</tr>
<tr>
<td>2</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>1</td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>,
<a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a></td>
</tr>
<tr>
<td>3</td>
<td>Source</td>
<td>Destination</td>
<td>Transfer</td>
<td>-</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-recipes-balance-conditional-transfers-if-the-source-account-has-a-debit-balance"><a
href="#coding-recipes-balance-conditional-transfers-if-the-source-account-has-a-debit-balance" class="anchor">If the
Source Account Has a Debit Balance</a></h3>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th>Debit Account</th>
<th>Credit Account</th>
<th>Amount</th>
<th>Pending Id</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Control</td>
<td>Source</td>
<td>Threshold</td>
<td>-</td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>,
<a
href="#reference-transfer-flagspending"><code>pending</code></a></td>
</tr>
<tr>
<td>2</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>1</td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>,
<a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a></td>
</tr>
<tr>
<td>3</td>
<td>Destination</td>
<td>Source</td>
<td>Transfer</td>
<td>-</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<h3 id="coding-recipes-balance-conditional-transfers-understanding-the-mechanism"><a
href="#coding-recipes-balance-conditional-transfers-understanding-the-mechanism" class="anchor">Understanding the
Mechanism</a></h3>
<p>Each of the 3 transfers is linked, meaning they will all succeed or
fail together.</p>
<p>The first transfer attempts to transfer the threshold amount to the
control account. If this transfer would cause the source account‚Äôs net
balance to go below zero, the account‚Äôs balance limit flag would ensure
that the first transfer fails. If the first transfer fails, the other
two linked transfers would also fail.</p>
<p>If the first transfer succeeds, it means that the source account did
have the threshold balance. In this case, the second transfer cancels
the first transfer (returning the threshold amount to the source
account). Then, the third transfer would execute the desired transfer to
the ultimate destination account.</p>
<p>Note that in the tables above, we do the balance check on the source
account. The balance check could also be applied to the destination
account instead.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/balance-conditional-transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-balance-invariant-transfers"><a
href="#coding-recipes-balance-invariant-transfers" class="anchor">Balance-invariant
Transfers</a></h1>
<p>For some accounts, it may be useful to enforce <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
or <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
balance invariants for only a subset of all transfers, rather than all
transfers.</p>
<h2 id="coding-recipes-balance-invariant-transfers-per-transfer-credits_must_not_exceed_debits"><a
href="#coding-recipes-balance-invariant-transfers-per-transfer-credits_must_not_exceed_debits"
class="anchor">Per-transfer
<code>credits_must_not_exceed_debits</code></a></h2>
<p>This recipe requires three accounts:</p>
<ol type="1">
<li>The <strong>source</strong> account, to debit.</li>
<li>The <strong>destination</strong> account, to credit. (With
<em>neither</em> <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
nor <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
set, since in this recipe we are only enforcing the invariant on a
per-transfer basis.</li>
<li>The <strong>control</strong> account, to test the balance invariant.
The control account should have <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
set.</li>
</ol>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Id</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;">Pending Id</th>
<th style="text-align: right;">Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: right;">Source</td>
<td style="text-align: right;">Destination</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a></td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: right;">Destination</td>
<td style="text-align: right;">Control</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;"><a
href="#reference-transfer-flagslinked"><code>linked</code></a>,
<a
href="#reference-transfer-flagspending"><code>pending</code></a>,
<a
href="#reference-transfer-flagsbalancing_debit"><code>balancing_debit</code></a></td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;">-</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;"><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>When the destination account‚Äôs final credits do not exceed its
debits, the chain will succeed. When the destination account‚Äôs final
credits exceeds its debits, transfer <code>2</code> will fail with
<code>exceeds_debits</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/balance-invariant-transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-balance-bounds"><a href="#coding-recipes-balance-bounds" class="anchor">Balance
Bounds</a></h1>
<p>It is easy to limit an account‚Äôs balance using either <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
or <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>.</p>
<p>What if you want an account‚Äôs balance to stay between an upper and a
lower bound?</p>
<p>This is possible to check atomically using a set of linked transfers.
(Note: with the <code>must_not_exceed</code> flag invariants, an account
is guaranteed to never violate those invariants. This maximum balance
approach must be enforced per-transfer ‚Äì it is possible to exceed the
limit simply by not enforcing it for a particular transfer.)</p>
<h2 id="coding-recipes-balance-bounds-preconditions"><a href="#coding-recipes-balance-bounds-preconditions"
class="anchor">Preconditions</a></h2>
<ol type="1">
<li>Target Account Should Have a Limited Balance</li>
</ol>
<p>The account whose balance you want to bound should have one of these
flags set:</p>
<ul>
<li><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
for accounts with <a href="#coding-data-modeling-credit-balances">credit
balances</a></li>
<li><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
for accounts with <a href="#coding-data-modeling-debit-balances">debit
balances</a></li>
</ul>
<ol start="2" type="1">
<li>Create a Control Account with the Opposite Limit</li>
</ol>
<p>There must also be a designated control account.</p>
<p>As you can see below, this account will never actually take control
of the target account‚Äôs funds, but we will set up simultaneous transfers
in and out of the control account to apply the limit.</p>
<p>This account must have the opposite limit applied as the target
account:</p>
<ul>
<li><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
if the target account has a <a
href="#coding-data-modeling-credit-balances">credit balance</a></li>
<li><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
if the target account has a <a
href="#coding-data-modeling-debit-balances">debit balance</a></li>
</ul>
<ol start="3" type="1">
<li>Create an Operator Account</li>
</ol>
<p>The operator account will be used to fund the Control Account.</p>
<h2 id="coding-recipes-balance-bounds-executing-a-transfer-with-a-balance-bounds-check"><a
href="#coding-recipes-balance-bounds-executing-a-transfer-with-a-balance-bounds-check"
class="anchor">Executing a Transfer with a Balance Bounds Check</a></h2>
<p>This consists of 5 <a href="#coding-linked-events">linked
transfers</a>.</p>
<p>We will refer to two amounts:</p>
<ul>
<li>The <strong>limit amount</strong> is upper bound we want to maintain
on the target account‚Äôs balance.</li>
<li>The <strong>transfer amount</strong> is the amount we want to
transfer if and only if the target account‚Äôs balance after a successful
transfer would be within the bounds.</li>
</ul>
<h3 id="coding-recipes-balance-bounds-if-the-target-account-has-a-credit-balance"><a
href="#coding-recipes-balance-bounds-if-the-target-account-has-a-credit-balance" class="anchor">If the
Target Account Has a Credit Balance</a></h3>
<p>In this case, we are keeping the Destination Account‚Äôs balance
between the bounds.</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th>Debit Account</th>
<th>Credit Account</th>
<th>Amount</th>
<th>Pending ID</th>
<th>Flags (Note: <code>|</code> sets multiple flags)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Source</td>
<td>Destination</td>
<td>Transfer</td>
<td><code>0</code></td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a></td>
</tr>
<tr>
<td>2</td>
<td>Control</td>
<td>Operator</td>
<td>Limit</td>
<td><code>0</code></td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a></td>
</tr>
<tr>
<td>3</td>
<td>Destination</td>
<td>Control</td>
<td><code>AMOUNT_MAX</code></td>
<td><code>0</code></td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>
| <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a>
| <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></td>
</tr>
<tr>
<td>4</td>
<td><code>0</code></td>
<td><code>0</code></td>
<td><code>0</code></td>
<td><code>3</code>*</td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>
| <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></td>
</tr>
<tr>
<td>5</td>
<td>Operator</td>
<td>Control</td>
<td>Limit</td>
<td><code>0</code></td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<p>*This must be set to the transfer ID of the pending transfer (in this
example, it is transfer 3).</p>
<h3 id="coding-recipes-balance-bounds-if-the-target-account-has-a-debit-balance"><a
href="#coding-recipes-balance-bounds-if-the-target-account-has-a-debit-balance" class="anchor">If the
Target Account Has a Debit Balance</a></h3>
<p>In this case, we are keeping the Destination Account‚Äôs balance
between the bounds.</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th>Debit Account</th>
<th>Credit Account</th>
<th>Amount</th>
<th>Pending ID</th>
<th>Flags (Note <code>|</code> sets multiple flags)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Destination</td>
<td>Source</td>
<td>Transfer</td>
<td><code>0</code></td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a></td>
</tr>
<tr>
<td>2</td>
<td>Operator</td>
<td>Control</td>
<td>Limit</td>
<td><code>0</code></td>
<td><a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a></td>
</tr>
<tr>
<td>3</td>
<td>Control</td>
<td>Destination</td>
<td><code>AMOUNT_MAX</code></td>
<td><code>0</code></td>
<td><a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a>
| <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a>
| <a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a></td>
</tr>
<tr>
<td>4</td>
<td><code>0</code></td>
<td><code>0</code></td>
<td><code>0</code></td>
<td><code>3</code>*</td>
<td><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>
| <a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a></td>
</tr>
<tr>
<td>5</td>
<td>Control</td>
<td>Operator</td>
<td>Limit</td>
<td><code>0</code></td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
</div>
<p>*This must be set to the transfer ID of the pending transfer (in this
example, it is transfer 3).</p>
<h3 id="coding-recipes-balance-bounds-understanding-the-mechanism"><a
href="#coding-recipes-balance-bounds-understanding-the-mechanism" class="anchor">Understanding the
Mechanism</a></h3>
<p>Each of the 5 transfers is <a href="#coding-linked-events">linked</a>
so that all of them will succeed or all of them will fail.</p>
<p>The first transfer is the one we actually want to send.</p>
<p>The second transfer sets the Control Account‚Äôs balance to the upper
bound we want to impose.</p>
<p>The third transfer uses a <a
href="#reference-transfer-flagsbalancing_debit"><code>balancing_debit</code></a>
or <a
href="#reference-transfer-flagsbalancing_credit"><code>balancing_credit</code></a>
to transfer the Destination Account‚Äôs net credit balance or net debit
balance, respectively, to the Control Account. This transfer will fail
if the first transfer would put the Destination Account‚Äôs balance above
the upper bound.</p>
<p>The third transfer is also a pending transfer, so it won‚Äôt actually
transfer the Destination Account‚Äôs funds, even if it succeeds.</p>
<p>If everything to this point succeeds, the fourth and fifth transfers
simply undo the effects of the second and third transfers. The fourth
transfer voids the pending transfer. And the fifth transfer resets the
Control Account‚Äôs net balance to zero.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/balance-bounds.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-correcting-transfers"><a href="#coding-recipes-correcting-transfers"
class="anchor">Correcting Transfers</a></h1>
<p><a href="#reference-transfer"><code>Transfer</code>s</a> in
TigerBeetle are immutable, so once they are created they cannot be
modified or deleted.</p>
<p>Immutability is useful for creating an auditable log of all of the
business events, but it does raise the question of what to do when a
transfer was made in error or some detail such as the amount was
incorrect.</p>
<h2 id="coding-recipes-correcting-transfers-always-add-more-transfers"><a href="#coding-recipes-correcting-transfers-always-add-more-transfers"
class="anchor">Always Add More Transfers</a></h2>
<p>Correcting transfers or entries in TigerBeetle are handled with more
transfers to reverse or adjust the effects of the previous
transfer(s).</p>
<p>This is important because adding transfers as opposed to deleting or
modifying incorrect ones adds more information to the history. The log
of events includes the original error, when it took place, as well as
any attempts to correct the record and when they took place. A
correcting entry might even be wrong, in which case it itself can be
corrected with yet another transfer. All of these events form a timeline
of the particular business event, which is stored permanently.</p>
<p>Another way to put this is that TigerBeetle is the lowest layer of
the accounting stack and represents the finest-resolution data that is
stored. At a higher-level reporting layer, you can ‚Äúdownsample‚Äù the data
to show only the corrected transfer event. However, it would not be
possible to go back if the original record were modified or deleted.</p>
<p>Two specific recommendations for correcting transfers are:</p>
<ol type="1">
<li>You may want to have a <a
href="#reference-transfer-code"><code>Transfer.code</code></a>
that indicates a given transfer is a correction, or you may want
multiple codes where each one represents a different reason why the
correction has taken place.</li>
<li>If you use the <a
href="#reference-transfer-user_data_128"><code>Transfer.user_data_128</code></a>
to store an ID that links multiple transfers within TigerBeetle or
points to a <a href="#coding-system-architecture">record in an external
database</a>, you may want to use the same <code>user_data_128</code>
field on the correction transfer(s), even if they happen at a later
point.</li>
</ol>
<h3 id="coding-recipes-correcting-transfers-example"><a href="#coding-recipes-correcting-transfers-example" class="anchor">Example</a></h3>
<p>Let‚Äôs say you had a couple of transfers, from account <code>A</code>
to accounts <code>Y</code> and <code>Z</code>:</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>code</code></th>
<th style="text-align: right;"><code>user_data_128</code></th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">123456</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;"><code>Y</code></td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">9000</td>
<td style="text-align: right;">123456</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<p>Now, let‚Äôs say we realized the amount was wrong and we need to adjust
both of the amounts by 10%. We would submit two
<strong>additional</strong> transfers going in the opposite
direction:</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th style="text-align: right;"><code>code</code></th>
<th style="text-align: right;"><code>user_data_128</code></th>
<th style="text-align: right;"><code>flags.linked</code></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>X</code></td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;">1000</td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">123456</td>
<td style="text-align: right;">true</td>
</tr>
<tr>
<td style="text-align: right;">USD</td>
<td style="text-align: right;"><code>Y</code></td>
<td style="text-align: right;"><code>A</code></td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10000</td>
<td style="text-align: right;">123456</td>
<td style="text-align: right;">false</td>
</tr>
</tbody>
</table>
</div>
<p>Note that the codes used here don‚Äôt have any actual meaning, but you
would want to <a href="#coding-data-modeling-code">enumerate your business
events</a> and map each to a numeric code value, including the initial
reasons for transfers and the reasons they might be corrected.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/correcting-transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-recipes-rate-limiting"><a href="#coding-recipes-rate-limiting" class="anchor">Rate
Limiting</a></h1>
<p>TigerBeetle can be used to account for non-financial resources.</p>
<p>In this recipe, we will show you how to use it to implement rate
limiting using the <a
href="https://en.wikipedia.org/wiki/Leaky_bucket">leaky bucket
algorithm</a> based on the user request rate, bandwidth, and money.</p>
<h2 id="coding-recipes-rate-limiting-mechanism"><a href="#coding-recipes-rate-limiting-mechanism"
class="anchor">Mechanism</a></h2>
<p>For each type of resource we want to limit, we will have a ledger
specifically for that resource. On that ledger, we have an operator
account and an account for each user. Each user‚Äôs account will have a
balance limit applied.</p>
<p>To set up the rate limiting system, we will first transfer the
resource limit amount to each of the users. For each user request, we
will then create a <a
href="#coding-two-phase-transfers-reserve-funds-pending-transfer">pending
transfer</a> with a <a
href="#coding-two-phase-transfers-expire-pending-transfer">timeout</a>. We
will never post or void these transfers, but will instead let them
expire.</p>
<p>Since each account‚Äôs ‚Äúbalance‚Äù is limited, we cannot create pending
transfers that would exceed the rate limit. However, when each pending
transfer expires, it automatically replenishes the user‚Äôs balance.</p>
<h2 id="coding-recipes-rate-limiting-request-rate-limiting"><a href="#coding-recipes-rate-limiting-request-rate-limiting"
class="anchor">Request Rate Limiting</a></h2>
<p>Let‚Äôs say we want to limit each user to 10 requests per minute.</p>
<p>We need our user account to have a limited balance.</p>
<div class="table">
<table>
<thead>
<tr>
<th>Ledger</th>
<th>Account</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>Request Rate</td>
<td>Operator</td>
<td><code>0</code></td>
</tr>
<tr>
<td>Request Rate</td>
<td>User</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>We‚Äôll first transfer 10 units from the operator to the user.</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align: right;">Request Rate</td>
<td style="text-align: right;">Operator</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
</div>
<p>Then, for each incoming request, we will create a pending transfer
for 1 unit back to the operator from the user:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th>Timeout</th>
<th style="text-align: right;">Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>2-N</td>
<td style="text-align: right;">Request Rate</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">Operator</td>
<td style="text-align: right;">1</td>
<td>60</td>
<td style="text-align: right;"><a
href="#reference-transfer-flagspending"><code>pending</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>Note that we use a timeout of 60 (seconds), because we wanted to
limit each user to 10 requests <em>per minute</em>.</p>
<p>That‚Äôs it! Each of these transfers will ‚Äúreserve‚Äù some of the user‚Äôs
balance and then replenish the balance after they expire.</p>
<h2 id="coding-recipes-rate-limiting-bandwidth-limiting"><a href="#coding-recipes-rate-limiting-bandwidth-limiting"
class="anchor">Bandwidth Limiting</a></h2>
<p>To limit user requests based on bandwidth as opposed to request rate,
we can apply the same technique but use amounts that represent the
request size.</p>
<p>Let‚Äôs say we wanted to limit each user to 10 MB (10,000,000 bytes)
per minute.</p>
<p>Our account setup is the same as before:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Ledger</th>
<th>Account</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bandwidth</td>
<td>Operator</td>
<td>0</td>
</tr>
<tr>
<td>Bandwidth</td>
<td>User</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>Now, we‚Äôll transfer 10,000,000 units (bytes in this case) from the
operator to the user:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align: right;">Bandwidth</td>
<td style="text-align: right;">Operator</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">10000000</td>
</tr>
</tbody>
</table>
</div>
<p>For each incoming request, we‚Äôll create a pending transfer where the
amount is equal to the request size:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th>Timeout</th>
<th style="text-align: right;">Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>2-N</td>
<td style="text-align: right;">Bandwidth</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">Operator</td>
<td style="text-align: right;">Request Size</td>
<td>60</td>
<td style="text-align: right;"><a
href="#reference-transfer-flagspending"><code>pending</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>We‚Äôre again using a timeout of 60 seconds, but you could adjust this
to be whatever time window you want to use to limit requests.</p>
<h2 id="coding-recipes-rate-limiting-transfer-amount-limiting"><a href="#coding-recipes-rate-limiting-transfer-amount-limiting"
class="anchor">Transfer Amount Limiting</a></h2>
<p>Now, let‚Äôs say you wanted to limit each account to transferring no
more than a certain amount of money per time window. We can do that
using 2 ledgers and linked transfers.</p>
<div class="table">
<table>
<thead>
<tr>
<th>Ledger</th>
<th>Account</th>
<th>Flags</th>
</tr>
</thead>
<tbody>
<tr>
<td>Rate Limiting</td>
<td>Operator</td>
<td>0</td>
</tr>
<tr>
<td>Rate Limiting</td>
<td>User</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a></td>
</tr>
<tr>
<td>USD</td>
<td>Operator</td>
<td>0</td>
</tr>
<tr>
<td>USD</td>
<td>User</td>
<td><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a></td>
</tr>
</tbody>
</table>
</div>
<p>Let‚Äôs say we wanted to limit each account to sending no more than
1000 USD per day.</p>
<p>To set up, we transfer 1000 from the Operator to the User on the Rate
Limiting ledger:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align: right;">Rate Limiting</td>
<td style="text-align: right;">Operator</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">1000</td>
</tr>
</tbody>
</table>
</div>
<p>For each transfer the user wants to do, we will create 2 transfers
that are <a href="#coding-linked-events">linked</a>:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Transfer</th>
<th style="text-align: right;">Ledger</th>
<th style="text-align: right;">Debit Account</th>
<th style="text-align: right;">Credit Account</th>
<th style="text-align: right;">Amount</th>
<th>Timeout</th>
<th style="text-align: right;">Flags (Note <code>|</code> sets multiple
flags)</th>
</tr>
</thead>
<tbody>
<tr>
<td>2N</td>
<td style="text-align: right;">Rate Limiting</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">Operator</td>
<td style="text-align: right;">Transfer Amount</td>
<td>86400</td>
<td style="text-align: right;"><a
href="#reference-transfer-flagspending"><code>pending</code></a>
| <a
href="#reference-transfer-flagslinked"><code>linked</code></a></td>
</tr>
<tr>
<td>2N + 1</td>
<td style="text-align: right;">USD</td>
<td style="text-align: right;">User</td>
<td style="text-align: right;">Destination</td>
<td style="text-align: right;">Transfer Amount</td>
<td>0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<p>Note that we are using a timeout of 86400 seconds, because this is
the number of seconds in a day.</p>
<p>These are linked such that if the first transfer fails, because the
user has already transferred too much money in the past day, the second
transfer will also fail.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/recipes/rate-limiting.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="coding-clients"><a href="#coding-clients" class="anchor">Clients</a></h1>
<p>TigerBeetle has official client libraries for the following
languages:</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/">.Net</a>
(<a href="https://www.nuget.org/packages/tigerbeetle">nuget
package</a>).</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/go/">Go</a>
(<a href="https://github.com/tigerbeetle/tigerbeetle-go">package</a>, <a
href="https://pkg.go.dev/github.com/tigerbeetle/tigerbeetle-go">API
docs</a>).</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/java/">Java</a>
(<a
href="https://central.sonatype.com/artifact/com.tigerbeetle/tigerbeetle-java">maven
central package</a>, <a
href="https://javadoc.io/doc/com.tigerbeetle/tigerbeetle-java/">API
docs</a>).</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/node/">Node</a>
(<a href="https://www.npmjs.com/package/tigerbeetle-node">npm
package</a>).</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/python/">Python</a>
(<a href="https://pypi.org/project/tigerbeetle/">PyPi package</a>).</li>
</ul>
<p>Subscribe to the <a
href="https://github.com/tigerbeetle/tigerbeetle/issues/2231">tracking
issue #2231</a> to receive notifications about breaking changes!</p>
<p>Please report any client bugs to the <a
href="https://github.com/tigerbeetle/tigerbeetle/issues">main issue
tracker</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/coding/clients/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->

<h1 id="coding-clients-dotnet"><a href="#coding-clients-dotnet"
class="anchor">tigerbeetle-dotnet</a></h1>
<p>The TigerBeetle client for .NET.</p>
<h2 id="coding-clients-dotnet-prerequisites"><a href="#coding-clients-dotnet-prerequisites"
class="anchor">Prerequisites</a></h2>
<p>Linux &gt;= 5.6 is the only production environment we support. But
for ease of development we also support macOS and Windows.</p>
<ul>
<li>.NET &gt;= 8.0.</li>
</ul>
<p>And if you do not already have NuGet.org as a package source, make
sure to add it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>dotnet nuget add source https://api.nuget.org/v3/index.json -n nuget.org</code></pre>
</div>
<h2 id="coding-clients-dotnet-setup"><a href="#coding-clients-dotnet-setup" class="anchor">Setup</a></h2>
<p>First, create a directory for your project and <code>cd</code> into
the directory.</p>
<p>Then, install the TigerBeetle client:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>dotnet new console
dotnet add package tigerbeetle</code></pre>
</div>
<p>Now, create <code>Program.cs</code> and copy this into it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb3"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> TigerBeetle<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Validate import works.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;SUCCESS&quot;</span><span class="op">);</span></span></code></pre></div>
</div>
<p>Finally, build and run:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>dotnet run</code></pre>
</div>
<p>Now that all prerequisites and dependencies are correctly set up,
let‚Äôs dig into using TigerBeetle.</p>
<h2 id="coding-clients-dotnet-sample-projects"><a href="#coding-clients-dotnet-sample-projects"
class="anchor">Sample projects</a></h2>
<p>This document is primarily a reference guide to the client. Below are
various sample projects demonstrating features of TigerBeetle.</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/samples/basic/">Basic</a>:
Create two accounts and transfer an amount between them.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/samples/two-phase/">Two-Phase
Transfer</a>: Create two accounts and start a pending transfer between
them, then post the transfer.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/samples/two-phase-many/">Many
Two-Phase Transfers</a>: Create two accounts and start a number of
pending transfer between them, posting and voiding alternating
transfers.</li>
</ul>
<h2 id="coding-clients-dotnet-creating-a-client"><a href="#coding-clients-dotnet-creating-a-client"
class="anchor">Creating a Client</a></h2>
<p>A client is created with a cluster ID and replica addresses for all
replicas in the cluster. The cluster ID and replica addresses are both
chosen by the system that starts the TigerBeetle cluster.</p>
<p>Clients are thread-safe and a single instance should be shared
between multiple concurrent tasks.</p>
<p>Multiple clients are useful when connecting to more than one
TigerBeetle cluster.</p>
<p>In this example the cluster ID is <code>0</code> and there is one
replica. The address is read from the <code>TB_ADDRESS</code>
environment variable and defaults to port <code>3000</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb5"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> tbAddress <span class="op">=</span> Environment<span class="op">.</span><span class="fu">GetEnvironmentVariable</span><span class="op">(</span><span class="st">&quot;TB_ADDRESS&quot;</span><span class="op">);</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> clusterID <span class="op">=</span> UInt128<span class="op">.</span><span class="fu">Zero</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> addresses <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> tbAddress <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> tbAddress <span class="op">:</span> <span class="st">&quot;3000&quot;</span> <span class="op">};</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="op">(</span><span class="dt">var</span> client <span class="op">=</span> <span class="kw">new</span> <span class="fu">Client</span><span class="op">(</span>clusterID<span class="op">,</span> addresses<span class="op">))</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use client</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>The <code>Client</code> class is thread-safe and for better
performance, a single instance should be shared between multiple
concurrent tasks. Multiple clients can be instantiated in case of
connecting to more than one TigerBeetle cluster.</p>
<p>The following are valid addresses:</p>
<ul>
<li><code>3000</code> (interpreted as <code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1:3000</code> (interpreted as
<code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1</code> (interpreted as <code>127.0.0.1:3001</code>,
<code>3001</code> is the default port)</li>
</ul>
<h2 id="coding-clients-dotnet-creating-accounts"><a href="#coding-clients-dotnet-creating-accounts"
class="anchor">Creating Accounts</a></h2>
<p>See details for account fields in the <a
href="#reference-account">Accounts reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb6"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accounts <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Account</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> ID<span class="op">.</span><span class="fu">Create</span><span class="op">(),</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">718</span><span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        Timestamp <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<p>The <code>UInt128</code> fields like <code>ID</code>,
<code>UserData128</code>, <code>Amount</code> and account balances have
a few extension methods to make it easier to convert 128-bit
little-endian unsigned integers between <code>BigInteger</code>,
<code>byte[]</code>, and <code>Guid</code>.</p>
<p>See the class <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/TigerBeetle/UInt128Extensions.cs">UInt128Extensions</a>
for more details.</p>
<h3 id="coding-clients-dotnet-account-flags"><a href="#coding-clients-dotnet-account-flags" class="anchor">Account
Flags</a></h3>
<p>The account flags value is a bitfield. See details for these flags in
the <a href="#reference-account-flags">Accounts reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>AccountFlags</code> object with bitwise-or:</p>
<ul>
<li><code>AccountFlags.None</code></li>
<li><code>AccountFlags.Linked</code></li>
<li><code>AccountFlags.DebitsMustNotExceedCredits</code></li>
<li><code>AccountFlags.CreditsMustNotExceedDebits</code></li>
<li><code>AccountFlags.History</code></li>
</ul>
<p>For example, to link two accounts where the first account
additionally has the <code>debits_must_not_exceed_credits</code>
constraint:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb7"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account0 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">|</span> AccountFlags<span class="op">.</span><span class="fu">DebitsMustNotExceedCredits</span><span class="op">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account1 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">101</span><span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">History</span><span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> account0<span class="op">,</span> account1 <span class="op">});</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-dotnet-response-and-errors"><a href="#coding-clients-dotnet-response-and-errors"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all accounts were created
successfully. If the response is non-empty, each object in the response
array contains error information for an account that failed. The error
object contains an error code and the index of the account in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_accounts">create_accounts
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account0 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account1 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account2 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">104</span><span class="op">,</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> account0<span class="op">,</span> account1<span class="op">,</span> account2 <span class="op">});</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> error <span class="kw">in</span> accountErrors<span class="op">)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">switch</span> <span class="op">(</span>error<span class="op">.</span><span class="fu">Result</span><span class="op">)</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">case</span> CreateAccountResult<span class="op">.</span><span class="fu">Exists</span><span class="op">:</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch account at ${error.Index} already exists.&quot;</span><span class="op">);</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch account at ${error.Index} failed to create ${error.Result}&quot;</span><span class="op">);</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span><span class="op">;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-account-lookup"><a href="#coding-clients-dotnet-account-lookup" class="anchor">Account
Lookup</a></h2>
<p>Account lookup is batched, like account creation. Pass in all IDs to
fetch. The account for each matched ID is returned.</p>
<p>If no account matches an ID, no object is returned for that account.
So the order of accounts in the response is not necessarily the same as
the order of IDs in the request. You can refer to the ID field in the
response to distinguish accounts.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb9"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Account<span class="op">[]</span> accounts <span class="op">=</span> client<span class="op">.</span><span class="fu">LookupAccounts</span><span class="op">(</span><span class="kw">new</span> UInt128<span class="op">[]</span> <span class="op">{</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">101</span> <span class="op">});</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-create-transfers"><a href="#coding-clients-dotnet-create-transfers"
class="anchor">Create Transfers</a></h2>
<p>This creates a journal entry between two accounts.</p>
<p>See details for transfer fields in the <a
href="#reference-transfer">Transfers reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfers <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> ID<span class="op">.</span><span class="fu">Create</span><span class="op">(),</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        Timeout <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        Timestamp <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-dotnet-response-and-errors-1"><a href="#coding-clients-dotnet-response-and-errors-1"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all transfers were created
successfully. If the response is non-empty, each object in the response
array contains error information for a transfer that failed. The error
object contains an error code and the index of the transfer in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_transfers">create_transfers
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfers <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> error <span class="kw">in</span> transferErrors<span class="op">)</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">switch</span> <span class="op">(</span>error<span class="op">.</span><span class="fu">Result</span><span class="op">)</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">case</span> CreateTransferResult<span class="op">.</span><span class="fu">Exists</span><span class="op">:</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch transfer at ${error.Index} already exists.&quot;</span><span class="op">);</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch transfer at ${error.Index} failed to create: ${error.Result}&quot;</span><span class="op">);</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-batching"><a href="#coding-clients-dotnet-batching" class="anchor">Batching</a></h2>
<p>TigerBeetle performance is maximized when you batch API requests. The
client does not do this automatically for you. So, for example, you
<em>can</em> insert 1 million transfers one at a time like so:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb12"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> batch <span class="op">=</span> <span class="kw">new</span> Transfer<span class="op">[]</span> <span class="op">{</span> <span class="op">};</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> t <span class="kw">in</span> batch<span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfer</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>But the insert rate will be a <em>fraction</em> of potential.
Instead, <strong>always batch what you can</strong>.</p>
<p>The maximum batch size is set in the TigerBeetle server. The default
is 8190.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb13"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> batch <span class="op">=</span> <span class="kw">new</span> Transfer<span class="op">[]</span> <span class="op">{</span> <span class="op">};</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> BATCH_SIZE <span class="op">=</span> <span class="dv">8190</span><span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> firstIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> firstIndex <span class="op">&lt;</span> batch<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> firstIndex <span class="op">+=</span> BATCH_SIZE<span class="op">)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> lastIndex <span class="op">=</span> firstIndex <span class="op">+</span> BATCH_SIZE<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>lastIndex <span class="op">&gt;</span> batch<span class="op">.</span><span class="fu">Length</span><span class="op">)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        lastIndex <span class="op">=</span> batch<span class="op">.</span><span class="fu">Length</span><span class="op">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>batch<span class="op">[</span>firstIndex<span class="op">..</span><span class="fu">lastIndex</span><span class="op">]);</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h3 id="coding-clients-dotnet-queues-and-workers"><a href="#coding-clients-dotnet-queues-and-workers"
class="anchor">Queues and Workers</a></h3>
<p>If you are making requests to TigerBeetle from workers pulling jobs
from a queue, you can batch requests to TigerBeetle by having the worker
act on multiple jobs from the queue at once rather than one at a time.
i.e. pulling multiple jobs from the queue rather than just one.</p>
<h2 id="coding-clients-dotnet-transfer-flags"><a href="#coding-clients-dotnet-transfer-flags"
class="anchor">Transfer Flags</a></h2>
<p>The transfer <code>flags</code> value is a bitfield. See details for
these flags in the <a href="#reference-transfer-flags">Transfers
reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>TransferFlags</code> object with bitwise-or:</p>
<ul>
<li><code>TransferFlags.None</code></li>
<li><code>TransferFlags.Linked</code></li>
<li><code>TransferFlags.Pending</code></li>
<li><code>TransferFlags.PostPendingTransfer</code></li>
<li><code>TransferFlags.VoidPendingTransfer</code></li>
</ul>
<p>For example, to link <code>transfer0</code> and
<code>transfer1</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb14"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer0 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span><span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer1 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer0<span class="op">,</span> transfer1 <span class="op">});</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-dotnet-two-phase-transfers"><a href="#coding-clients-dotnet-two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h3>
<p>Two-phase transfers are supported natively by toggling the
appropriate flag. TigerBeetle will then adjust the
<code>credits_pending</code> and <code>debits_pending</code> fields of
the appropriate accounts. A corresponding post pending transfer then
needs to be sent to post or void the transfer.</p>
<h4 id="coding-clients-dotnet-post-a-pending-transfer"><a href="#coding-clients-dotnet-post-a-pending-transfer"
class="anchor">Post a Pending Transfer</a></h4>
<p>With <code>flags</code> set to <code>post_pending_transfer</code>,
TigerBeetle will post the transfer. TigerBeetle will atomically roll
back the changes to <code>debits_pending</code> and
<code>credits_pending</code> of the appropriate accounts and apply them
to the <code>debits_posted</code> and <code>credits_posted</code>
balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb15"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer0 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Pending</span><span class="op">,</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer0 <span class="op">});</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer1 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Post the entire pending amount.</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> Transfer<span class="op">.</span><span class="fu">AmountMax</span><span class="op">,</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    PendingId <span class="op">=</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">PostPendingTransfer</span><span class="op">,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer1 <span class="op">});</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h4 id="coding-clients-dotnet-void-a-pending-transfer"><a href="#coding-clients-dotnet-void-a-pending-transfer"
class="anchor">Void a Pending Transfer</a></h4>
<p>In contrast, with <code>flags</code> set to
<code>void_pending_transfer</code>, TigerBeetle will void the transfer.
TigerBeetle will roll back the changes to <code>debits_pending</code>
and <code>credits_pending</code> of the appropriate accounts and
<strong>not</strong> apply them to the <code>debits_posted</code> and
<code>credits_posted</code> balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb16"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer0 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Pending</span><span class="op">,</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer0 <span class="op">});</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer1 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Post the entire pending amount.</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    PendingId <span class="op">=</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">VoidPendingTransfer</span><span class="op">,</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer1 <span class="op">});</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-transfer-lookup"><a href="#coding-clients-dotnet-transfer-lookup"
class="anchor">Transfer Lookup</a></h2>
<p>NOTE: While transfer lookup exists, it is not a flexible query API.
We are developing query APIs and there will be new methods for querying
transfers in the future.</p>
<p>Transfer lookup is batched, like transfer creation. Pass in all
<code>id</code>s to fetch, and matched transfers are returned.</p>
<p>If no transfer matches an <code>id</code>, no object is returned for
that transfer. So the order of transfers in the response is not
necessarily the same as the order of <code>id</code>s in the request.
You can refer to the <code>id</code> field in the response to
distinguish transfers.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb17"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Transfer<span class="op">[]</span> transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">LookupTransfers</span><span class="op">(</span><span class="kw">new</span> UInt128<span class="op">[]</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span> <span class="op">});</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-get-account-transfers"><a href="#coding-clients-dotnet-get-account-transfers"
class="anchor">Get Account Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the transfers involving a given account, allowing basic
filter and pagination capabilities.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb18"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> AccountFilter</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    AccountId <span class="op">=</span> <span class="dv">101</span><span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Code.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten transfers at most.</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFilterFlags<span class="op">.</span><span class="fu">Debits</span> <span class="op">|</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Credits</span> <span class="op">|</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>Transfer<span class="op">[]</span> transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">GetAccountTransfers</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-get-account-balances"><a href="#coding-clients-dotnet-get-account-balances"
class="anchor">Get Account Balances</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the point-in-time balances of a given account, allowing basic
filter and pagination capabilities.</p>
<p>Only accounts created with the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set
retain <a href="#reference-requests-get_account_balances">historical
balances</a>.</p>
<p>The balances in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb19"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> AccountFilter</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    AccountId <span class="op">=</span> <span class="dv">101</span><span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Code.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFilterFlags<span class="op">.</span><span class="fu">Debits</span> <span class="op">|</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Credits</span> <span class="op">|</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>AccountBalance<span class="op">[]</span> accountBalances <span class="op">=</span> client<span class="op">.</span><span class="fu">GetAccountBalances</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-query-accounts"><a href="#coding-clients-dotnet-query-accounts" class="anchor">Query
Accounts</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query accounts by the intersection of some fields and by timestamp
range.</p>
<p>The accounts in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb20"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> QueryFilter</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// Filter by Code.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Ledger.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> QueryFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>Account<span class="op">[]</span> accounts <span class="op">=</span> client<span class="op">.</span><span class="fu">QueryAccounts</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-query-transfers"><a href="#coding-clients-dotnet-query-transfers" class="anchor">Query
Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query transfers by the intersection of some fields and by timestamp
range.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb21"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> QueryFilter</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// Filter by UserData</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// Filter by Code</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Ledger</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> QueryFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>Transfer<span class="op">[]</span> transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">QueryTransfers</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-linked-events"><a href="#coding-clients-dotnet-linked-events" class="anchor">Linked
Events</a></h2>
<p>When the <code>linked</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it links that
event with the next event in the batch, to create a chain of events, of
arbitrary length, which all succeed or fail together. The tail of a
chain is denoted by the first event without this flag. The last event in
a batch may therefore never have the <code>linked</code> flag set as
this would leave a chain open-ended. Multiple chains or individual
events may coexist within a batch to succeed or fail independently.</p>
<p>Events within a chain are executed within order, or are rolled back
on error, so that the effect of each event in the chain is visible to
the next, and so that the chain is either visible or invisible as a unit
to subsequent events after the chain. The event that was the first to
break the chain will have a unique error result. Other events in the
chain will have their error result set to
<code>linked_event_failed</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb22"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> batch <span class="op">=</span> <span class="kw">new</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">.</span><span class="fu">List</span><span class="op">&lt;</span>Transfer<span class="op">&gt;();</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 4 transfers (the last transfer in the chain closes the chain with linked=false):</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span> <span class="co">// Fail with exists</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span> <span class="co">// Fail without committing</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// This should not see any effect from the failed chain above.</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (the first transfer fails the chain):</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (successful):</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>batch<span class="op">.</span><span class="fu">ToArray</span><span class="op">());</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-dotnet-imported-events"><a href="#coding-clients-dotnet-imported-events"
class="anchor">Imported Events</a></h2>
<p>When the <code>imported</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it allows
importing historical events with a user-defined timestamp.</p>
<p>The entire batch of events must be set with the flag
<code>imported</code>.</p>
<p>It‚Äôs recommended to submit the whole batch as a <code>linked</code>
chain of events, ensuring that if any event fails, none of them are
committed, preserving the last timestamp unchanged. This approach gives
the application a chance to correct failed imported events,
re-submitting the batch again with the same user-defined timestamps.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb23"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// External source of time</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ulong</span> historicalTimestamp <span class="op">=</span> <span class="dv">0UL</span><span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> historicalAccounts <span class="op">=</span> <span class="kw">new</span> Account<span class="op">[]</span> <span class="op">{</span> <span class="co">/* Loaded from an external source */</span> <span class="op">};</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> historicalTransfers <span class="op">=</span> <span class="kw">new</span> Transfer<span class="op">[]</span> <span class="op">{</span> <span class="co">/* Loaded from an external source */</span> <span class="op">};</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">// First, load and import all accounts with their timestamps from the historical source.</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountsBatch <span class="op">=</span> <span class="kw">new</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">.</span><span class="fu">List</span><span class="op">&lt;</span>Account<span class="op">&gt;();</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> historicalAccounts<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> index<span class="op">++)</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> account <span class="op">=</span> historicalAccounts<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span><span class="fu">Timestamp</span> <span class="op">=</span> historicalTimestamp<span class="op">;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the account as `imported`.</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span><span class="fu">Flags</span> <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">Imported</span><span class="op">;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// must be `linked`.</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>index <span class="op">&lt;</span> historicalAccounts<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        account<span class="op">.</span><span class="fu">Flags</span> <span class="op">|=</span> AccountFlags<span class="op">.</span><span class="fu">Linked</span><span class="op">;</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    accountsBatch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>account<span class="op">);</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span>accountsBatch<span class="op">.</span><span class="fu">ToArray</span><span class="op">());</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Then, load and import all transfers with their timestamps from the historical source.</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfersBatch <span class="op">=</span> <span class="kw">new</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">.</span><span class="fu">List</span><span class="op">&lt;</span>Transfer<span class="op">&gt;();</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> historicalTransfers<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> index<span class="op">++)</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> transfer <span class="op">=</span> historicalTransfers<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span><span class="fu">Timestamp</span> <span class="op">=</span> historicalTimestamp<span class="op">;</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the account as `imported`.</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span><span class="fu">Flags</span> <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Imported</span><span class="op">;</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// must be `linked`.</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>index <span class="op">&lt;</span> historicalTransfers<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        transfer<span class="op">.</span><span class="fu">Flags</span> <span class="op">|=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span><span class="op">;</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    transfersBatch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>transfer<span class="op">);</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>transfersBatch<span class="op">.</span><span class="fu">ToArray</span><span class="op">());</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Since it is a linked chain, in case of any error the entire batch is rolled back and can be retried</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="co">// with the same historical timestamps without regressing the cluster timestamp.</span></span></code></pre></div>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/src/clients/dotnet/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->

<h1 id="coding-clients-go"><a href="#coding-clients-go"
class="anchor">tigerbeetle-go</a></h1>
<p>The TigerBeetle client for Go.</p>
<p><a
href="https://pkg.go.dev/github.com/tigerbeetle/tigerbeetle-go"><img
src="https://pkg.go.dev/badge/github.com/tigerbeetle/tigerbeetle-go.svg"
alt="Go Reference" /></a></p>
<p>Make sure to import
<code>github.com/tigerbeetle/tigerbeetle-go</code>, not this repo and
subdirectory.</p>
<h2 id="coding-clients-go-prerequisites"><a href="#coding-clients-go-prerequisites"
class="anchor">Prerequisites</a></h2>
<p>Linux &gt;= 5.6 is the only production environment we support. But
for ease of development we also support macOS and Windows.</p>
<ul>
<li>Go &gt;= 1.21</li>
</ul>
<p><strong>Additionally on Windows</strong>: you must install <a
href="https://ziglang.org/download/#release-0.13.0">Zig 0.13.0</a> and
set the <code>CC</code> environment variable to <code>zig.exe cc</code>.
Use the full path for <code>zig.exe</code>.</p>
<h2 id="coding-clients-go-setup"><a href="#coding-clients-go-setup" class="anchor">Setup</a></h2>
<p>First, create a directory for your project and <code>cd</code> into
the directory.</p>
<p>Then, install the TigerBeetle client:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>go mod init tbtest
go get github.com/tigerbeetle/tigerbeetle-go</code></pre>
</div>
<p>Now, create <code>main.go</code> and copy this into it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;log&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span> <span class="st">&quot;github.com/tigerbeetle/tigerbeetle-go&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span> <span class="st">&quot;github.com/tigerbeetle/tigerbeetle-go/pkg/types&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Println<span class="op">(</span><span class="st">&quot;Import ok!&quot;</span><span class="op">)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Finally, build and run:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>go run main.go</code></pre>
</div>
<p>Now that all prerequisites and dependencies are correctly set up,
let‚Äôs dig into using TigerBeetle.</p>
<h2 id="coding-clients-go-sample-projects"><a href="#coding-clients-go-sample-projects"
class="anchor">Sample projects</a></h2>
<p>This document is primarily a reference guide to the client. Below are
various sample projects demonstrating features of TigerBeetle.</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/go/samples/basic/">Basic</a>:
Create two accounts and transfer an amount between them.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/go/samples/two-phase/">Two-Phase
Transfer</a>: Create two accounts and start a pending transfer between
them, then post the transfer.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/go/samples/two-phase-many/">Many
Two-Phase Transfers</a>: Create two accounts and start a number of
pending transfer between them, posting and voiding alternating
transfers.</li>
</ul>
<h2 id="coding-clients-go-creating-a-client"><a href="#coding-clients-go-creating-a-client"
class="anchor">Creating a Client</a></h2>
<p>A client is created with a cluster ID and replica addresses for all
replicas in the cluster. The cluster ID and replica addresses are both
chosen by the system that starts the TigerBeetle cluster.</p>
<p>Clients are thread-safe and a single instance should be shared
between multiple concurrent tasks.</p>
<p>Multiple clients are useful when connecting to more than one
TigerBeetle cluster.</p>
<p>In this example the cluster ID is <code>0</code> and there is one
replica. The address is read from the <code>TB_ADDRESS</code>
environment variable and defaults to port <code>3000</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tbAddress <span class="op">:=</span> os<span class="op">.</span>Getenv<span class="op">(</span><span class="st">&quot;TB_ADDRESS&quot;</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span><span class="op">(</span>tbAddress<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    tbAddress <span class="op">=</span> <span class="st">&quot;3000&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>client<span class="op">,</span> err <span class="op">:=</span> NewClient<span class="op">(</span>ToUint128<span class="op">(</span><span class="dv">0</span><span class="op">),</span> <span class="op">[]</span><span class="dt">string</span><span class="op">{</span>tbAddress<span class="op">})</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Error creating client: %s&quot;</span><span class="op">,</span> err<span class="op">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="cf">defer</span> client<span class="op">.</span>Close<span class="op">()</span></span></code></pre></div>
</div>
<p>The following are valid addresses:</p>
<ul>
<li><code>3000</code> (interpreted as <code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1:3000</code> (interpreted as
<code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1</code> (interpreted as <code>127.0.0.1:3001</code>,
<code>3001</code> is the default port)</li>
</ul>
<h2 id="coding-clients-go-creating-accounts"><a href="#coding-clients-go-creating-accounts"
class="anchor">Creating Accounts</a></h2>
<p>See details for account fields in the <a
href="#reference-account">Accounts reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>accountErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateAccounts<span class="op">([]</span>Account<span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        ID<span class="op">:</span>          ID<span class="op">(),</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        UserData128<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">0</span><span class="op">),</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        UserData64<span class="op">:</span>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        UserData32<span class="op">:</span>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        Ledger<span class="op">:</span>      <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        Code<span class="op">:</span>        <span class="dv">718</span><span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        Flags<span class="op">:</span>       <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        Timestamp<span class="op">:</span>   <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<p>The <code>Uint128</code> fields like <code>ID</code>,
<code>UserData128</code>, <code>Amount</code> and account balances have
a few helper functions to make it easier to convert 128-bit
little-endian unsigned integers between <code>string</code>,
<code>math/big.Int</code>, and <code>[]byte</code>.</p>
<p>See the type <a
href="https://pkg.go.dev/github.com/tigerbeetle/tigerbeetle-go/pkg/types#Uint128">Uint128</a>
for more details.</p>
<h3 id="coding-clients-go-account-flags"><a href="#coding-clients-go-account-flags" class="anchor">Account
Flags</a></h3>
<p>The account flags value is a bitfield. See details for these flags in
the <a href="#reference-account-flags">Accounts reference</a>.</p>
<p>To toggle behavior for an account, use the
<code>types.AccountFlags</code> struct to combine enum values and
generate a <code>uint16</code>. Here are a few examples:</p>
<ul>
<li><code>AccountFlags{Linked: true}.ToUint16()</code></li>
<li><code>AccountFlags{DebitsMustNotExceedCredits: true}.ToUint16()</code></li>
<li><code>AccountFlags{CreditsMustNotExceedDebits: true}.ToUint16()</code></li>
<li><code>AccountFlags{History: true}.ToUint16()</code></li>
</ul>
<p>For example, to link two accounts where the first account
additionally has the <code>debits_must_not_exceed_credits</code>
constraint:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb6"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>account0 <span class="op">:=</span> Account<span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>     ToUint128<span class="op">(</span><span class="dv">100</span><span class="op">),</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>   <span class="dv">718</span><span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span> AccountFlags<span class="op">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        DebitsMustNotExceedCredits<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        Linked<span class="op">:</span>                     <span class="ot">true</span><span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint16<span class="op">(),</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>account1 <span class="op">:=</span> Account<span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>     ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>   <span class="dv">718</span><span class="op">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span> AccountFlags<span class="op">{</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        History<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint16<span class="op">(),</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>accountErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateAccounts<span class="op">([]</span>Account<span class="op">{</span>account0<span class="op">,</span> account1<span class="op">})</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-go-response-and-errors"><a href="#coding-clients-go-response-and-errors"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all accounts were created
successfully. If the response is non-empty, each object in the response
array contains error information for an account that failed. The error
object contains an error code and the index of the account in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_accounts">create_accounts
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb7"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>account0 <span class="op">:=</span> Account<span class="op">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>     ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>   <span class="dv">718</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>account1 <span class="op">:=</span> Account<span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>     ToUint128<span class="op">(</span><span class="dv">103</span><span class="op">),</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>   <span class="dv">718</span><span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>account2 <span class="op">:=</span> Account<span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>     ToUint128<span class="op">(</span><span class="dv">104</span><span class="op">),</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>   <span class="dv">718</span><span class="op">,</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>  <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>accountErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateAccounts<span class="op">([]</span>Account<span class="op">{</span>account0<span class="op">,</span> account1<span class="op">,</span> account2<span class="op">})</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Error creating accounts: %s&quot;</span><span class="op">,</span> err<span class="op">)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> err <span class="op">:=</span> <span class="kw">range</span> accountErrors <span class="op">{</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> err<span class="op">.</span>Index <span class="op">{</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dt">uint32</span><span class="op">(</span>AccountExists<span class="op">):</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Batch account at %d already exists.&quot;</span><span class="op">,</span> err<span class="op">.</span>Index<span class="op">)</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Batch account at %d failed to create: %s&quot;</span><span class="op">,</span> err<span class="op">.</span>Index<span class="op">,</span> err<span class="op">.</span>Result<span class="op">)</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>To handle errors you can either 1) exactly match error codes returned
from <code>client.createAccounts</code> with enum values in the
<code>CreateAccountError</code> object, or you can 2) look up the error
code in the <code>CreateAccountError</code> object for a human-readable
string.</p>
<h2 id="coding-clients-go-account-lookup"><a href="#coding-clients-go-account-lookup" class="anchor">Account
Lookup</a></h2>
<p>Account lookup is batched, like account creation. Pass in all IDs to
fetch. The account for each matched ID is returned.</p>
<p>If no account matches an ID, no object is returned for that account.
So the order of accounts in the response is not necessarily the same as
the order of IDs in the request. You can refer to the ID field in the
response to distinguish accounts.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>LookupAccounts<span class="op">([]</span>Uint128<span class="op">{</span>ToUint128<span class="op">(</span><span class="dv">100</span><span class="op">),</span> ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">)})</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-create-transfers"><a href="#coding-clients-go-create-transfers"
class="anchor">Create Transfers</a></h2>
<p>This creates a journal entry between two accounts.</p>
<p>See details for transfer fields in the <a
href="#reference-transfer">Transfers reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb9"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ID<span class="op">(),</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    Timestamp<span class="op">:</span>       <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="op">}}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">(</span>transfers<span class="op">)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-go-response-and-errors-1"><a href="#coding-clients-go-response-and-errors-1"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all transfers were created
successfully. If the response is non-empty, each object in the response
array contains error information for a transfer that failed. The error
object contains an error code and the index of the transfer in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_transfers">create_transfers
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="op">},</span> <span class="op">{</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="op">},</span> <span class="op">{</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">3</span><span class="op">),</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="op">}}</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">(</span>transfers<span class="op">)</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> err <span class="op">!=</span> <span class="ot">nil</span> <span class="op">{</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Error creating transfers: %s&quot;</span><span class="op">,</span> err<span class="op">)</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _<span class="op">,</span> err <span class="op">:=</span> <span class="kw">range</span> transferErrors <span class="op">{</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> err<span class="op">.</span>Index <span class="op">{</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dt">uint32</span><span class="op">(</span>TransferExists<span class="op">):</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Batch transfer at %d already exists.&quot;</span><span class="op">,</span> err<span class="op">.</span>Index<span class="op">)</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        log<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Batch transfer at %d failed to create: %s&quot;</span><span class="op">,</span> err<span class="op">.</span>Index<span class="op">,</span> err<span class="op">.</span>Result<span class="op">)</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-batching"><a href="#coding-clients-go-batching" class="anchor">Batching</a></h2>
<p>TigerBeetle performance is maximized when you batch API requests. The
client does not do this automatically for you. So, for example, you
<em>can</em> insert 1 million transfers one at a time like so:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{}</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="bu">len</span><span class="op">(</span>batch<span class="op">);</span> i<span class="op">++</span> <span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">([]</span>Transfer<span class="op">{</span>batch<span class="op">[</span>i<span class="op">]})</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    _<span class="op">,</span> _ <span class="op">=</span> transferErrors<span class="op">,</span> err <span class="co">// Error handling omitted.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>But the insert rate will be a <em>fraction</em> of potential.
Instead, <strong>always batch what you can</strong>.</p>
<p>The maximum batch size is set in the TigerBeetle server. The default
is 8190.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb12"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{}</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">:=</span> <span class="dv">8190</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="op">:=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="bu">len</span><span class="op">(</span>batch<span class="op">);</span> i <span class="op">+=</span> BATCH_SIZE <span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    size <span class="op">:=</span> BATCH_SIZE</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i<span class="op">+</span>BATCH_SIZE <span class="op">&gt;</span> <span class="bu">len</span><span class="op">(</span>batch<span class="op">)</span> <span class="op">{</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        size <span class="op">=</span> <span class="bu">len</span><span class="op">(</span>batch<span class="op">)</span> <span class="op">-</span> i</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">(</span>batch<span class="op">[</span>i <span class="op">:</span> i<span class="op">+</span>size<span class="op">])</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    _<span class="op">,</span> _ <span class="op">=</span> transferErrors<span class="op">,</span> err <span class="co">// Error handling omitted.</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h3 id="coding-clients-go-queues-and-workers"><a href="#coding-clients-go-queues-and-workers"
class="anchor">Queues and Workers</a></h3>
<p>If you are making requests to TigerBeetle from workers pulling jobs
from a queue, you can batch requests to TigerBeetle by having the worker
act on multiple jobs from the queue at once rather than one at a time.
i.e. pulling multiple jobs from the queue rather than just one.</p>
<h2 id="coding-clients-go-transfer-flags"><a href="#coding-clients-go-transfer-flags"
class="anchor">Transfer Flags</a></h2>
<p>The transfer <code>flags</code> value is a bitfield. See details for
these flags in the <a href="#reference-transfer-flags">Transfers
reference</a>.</p>
<p>To toggle behavior for an account, use the
<code>types.TransferFlags</code> struct to combine enum values and
generate a <code>uint16</code>. Here are a few examples:</p>
<ul>
<li><code>TransferFlags{Linked: true}.ToUint16()</code></li>
<li><code>TransferFlags{Pending: true}.ToUint16()</code></li>
<li><code>TransferFlags{PostPendingTransfer: true}.ToUint16()</code></li>
<li><code>TransferFlags{VoidPendingTransfer: true}.ToUint16()</code></li>
</ul>
<p>For example, to link <code>transfer0</code> and
<code>transfer1</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb13"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>transfer0 <span class="op">:=</span> Transfer<span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">4</span><span class="op">),</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           TransferFlags<span class="op">{</span>Linked<span class="op">:</span> <span class="ot">true</span><span class="op">}.</span>ToUint16<span class="op">(),</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>transfer1 <span class="op">:=</span> Transfer<span class="op">{</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">5</span><span class="op">),</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">([]</span>Transfer<span class="op">{</span>transfer0<span class="op">,</span> transfer1<span class="op">})</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-go-two-phase-transfers"><a href="#coding-clients-go-two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h3>
<p>Two-phase transfers are supported natively by toggling the
appropriate flag. TigerBeetle will then adjust the
<code>credits_pending</code> and <code>debits_pending</code> fields of
the appropriate accounts. A corresponding post pending transfer then
needs to be sent to post or void the transfer.</p>
<h4 id="coding-clients-go-post-a-pending-transfer"><a href="#coding-clients-go-post-a-pending-transfer"
class="anchor">Post a Pending Transfer</a></h4>
<p>With <code>flags</code> set to <code>post_pending_transfer</code>,
TigerBeetle will post the transfer. TigerBeetle will atomically roll
back the changes to <code>debits_pending</code> and
<code>credits_pending</code> of the appropriate accounts and apply them
to the <code>debits_posted</code> and <code>credits_posted</code>
balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb14"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>transfer0 <span class="op">:=</span> Transfer<span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">6</span><span class="op">),</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">([]</span>Transfer<span class="op">{</span>transfer0<span class="op">})</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>transfer1 <span class="op">:=</span> Transfer<span class="op">{</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">7</span><span class="op">),</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Post the entire pending amount.</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>    AmountMax<span class="op">,</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    PendingID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">6</span><span class="op">),</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>     TransferFlags<span class="op">{</span>PostPendingTransfer<span class="op">:</span> <span class="ot">true</span><span class="op">}.</span>ToUint16<span class="op">(),</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">=</span> client<span class="op">.</span>CreateTransfers<span class="op">([]</span>Transfer<span class="op">{</span>transfer1<span class="op">})</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h4 id="coding-clients-go-void-a-pending-transfer"><a href="#coding-clients-go-void-a-pending-transfer"
class="anchor">Void a Pending Transfer</a></h4>
<p>In contrast, with <code>flags</code> set to
<code>void_pending_transfer</code>, TigerBeetle will void the transfer.
TigerBeetle will roll back the changes to <code>debits_pending</code>
and <code>credits_pending</code> of the appropriate accounts and
<strong>not</strong> apply them to the <code>debits_posted</code> and
<code>credits_posted</code> balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb15"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>transfer0 <span class="op">:=</span> Transfer<span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span>              ToUint128<span class="op">(</span><span class="dv">8</span><span class="op">),</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    DebitAccountID<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">101</span><span class="op">),</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    CreditAccountID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">102</span><span class="op">),</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>          ToUint128<span class="op">(</span><span class="dv">10</span><span class="op">),</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    Timeout<span class="op">:</span>         <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>          <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>            <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>           <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">([]</span>Transfer<span class="op">{</span>transfer0<span class="op">})</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>transfer1 <span class="op">:=</span> Transfer<span class="op">{</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">9</span><span class="op">),</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Post the entire pending amount.</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    Amount<span class="op">:</span>    ToUint128<span class="op">(</span><span class="dv">0</span><span class="op">),</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    PendingID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">8</span><span class="op">),</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span>     TransferFlags<span class="op">{</span>VoidPendingTransfer<span class="op">:</span> <span class="ot">true</span><span class="op">}.</span>ToUint16<span class="op">(),</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">=</span> client<span class="op">.</span>CreateTransfers<span class="op">([]</span>Transfer<span class="op">{</span>transfer1<span class="op">})</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-transfer-lookup"><a href="#coding-clients-go-transfer-lookup"
class="anchor">Transfer Lookup</a></h2>
<p>NOTE: While transfer lookup exists, it is not a flexible query API.
We are developing query APIs and there will be new methods for querying
transfers in the future.</p>
<p>Transfer lookup is batched, like transfer creation. Pass in all
<code>id</code>s to fetch, and matched transfers are returned.</p>
<p>If no transfer matches an <code>id</code>, no object is returned for
that transfer. So the order of transfers in the response is not
necessarily the same as the order of <code>id</code>s in the request.
You can refer to the <code>id</code> field in the response to
distinguish transfers.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb16"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>LookupTransfers<span class="op">([]</span>Uint128<span class="op">{</span>ToUint128<span class="op">(</span><span class="dv">1</span><span class="op">),</span> ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">)})</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-get-account-transfers"><a href="#coding-clients-go-get-account-transfers"
class="anchor">Get Account Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the transfers involving a given account, allowing basic
filter and pagination capabilities.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb17"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>filter <span class="op">:=</span> AccountFilter<span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    AccountID<span class="op">:</span>    ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    UserData128<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">0</span><span class="op">),</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    UserData64<span class="op">:</span>   <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    UserData32<span class="op">:</span>   <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>         <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Code.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    TimestampMin<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    TimestampMax<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    Limit<span class="op">:</span>        <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten transfers at most.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span> AccountFilterFlags<span class="op">{</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        Debits<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        Credits<span class="op">:</span>  <span class="ot">true</span><span class="op">,</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        Reversed<span class="op">:</span> <span class="ot">true</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint32<span class="op">(),</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>GetAccountTransfers<span class="op">(</span>filter<span class="op">)</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-get-account-balances"><a href="#coding-clients-go-get-account-balances"
class="anchor">Get Account Balances</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the point-in-time balances of a given account, allowing basic
filter and pagination capabilities.</p>
<p>Only accounts created with the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set
retain <a href="#reference-requests-get_account_balances">historical
balances</a>.</p>
<p>The balances in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb18"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>filter <span class="op">:=</span> AccountFilter<span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    AccountID<span class="op">:</span>    ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    UserData128<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">0</span><span class="op">),</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    UserData64<span class="op">:</span>   <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    UserData32<span class="op">:</span>   <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>         <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Code.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    TimestampMin<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    TimestampMax<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    Limit<span class="op">:</span>        <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span> AccountFilterFlags<span class="op">{</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        Debits<span class="op">:</span>   <span class="ot">true</span><span class="op">,</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        Credits<span class="op">:</span>  <span class="ot">true</span><span class="op">,</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        Reversed<span class="op">:</span> <span class="ot">true</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint32<span class="op">(),</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>account_balances<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>GetAccountBalances<span class="op">(</span>filter<span class="op">)</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-query-accounts"><a href="#coding-clients-go-query-accounts" class="anchor">Query
Accounts</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query accounts by the intersection of some fields and by timestamp
range.</p>
<p>The accounts in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb19"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>filter <span class="op">:=</span> QueryFilter<span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    UserData128<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">1000</span><span class="op">),</span> <span class="co">// Filter by UserData</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    UserData64<span class="op">:</span>   <span class="dv">100</span><span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    UserData32<span class="op">:</span>   <span class="dv">10</span><span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>         <span class="dv">1</span><span class="op">,</span>  <span class="co">// Filter by Code</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>       <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Ledger</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    TimestampMin<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    TimestampMax<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    Limit<span class="op">:</span>        <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span> QueryFilterFlags<span class="op">{</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        Reversed<span class="op">:</span> <span class="ot">true</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint32<span class="op">(),</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>QueryAccounts<span class="op">(</span>filter<span class="op">)</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-query-transfers"><a href="#coding-clients-go-query-transfers" class="anchor">Query
Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query transfers by the intersection of some fields and by timestamp
range.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb20"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>filter <span class="op">:=</span> QueryFilter<span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    UserData128<span class="op">:</span>  ToUint128<span class="op">(</span><span class="dv">1000</span><span class="op">),</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    UserData64<span class="op">:</span>   <span class="dv">100</span><span class="op">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    UserData32<span class="op">:</span>   <span class="dv">10</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    Code<span class="op">:</span>         <span class="dv">1</span><span class="op">,</span>  <span class="co">// Filter by Code.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    Ledger<span class="op">:</span>       <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Ledger.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    TimestampMin<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    TimestampMax<span class="op">:</span> <span class="dv">0</span><span class="op">,</span>  <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    Limit<span class="op">:</span>        <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    Flags<span class="op">:</span> QueryFilterFlags<span class="op">{</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        Reversed<span class="op">:</span> <span class="ot">true</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint32<span class="op">(),</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>QueryTransfers<span class="op">(</span>filter<span class="op">)</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-linked-events"><a href="#coding-clients-go-linked-events" class="anchor">Linked
Events</a></h2>
<p>When the <code>linked</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it links that
event with the next event in the batch, to create a chain of events, of
arbitrary length, which all succeed or fail together. The tail of a
chain is denoted by the first event without this flag. The last event in
a batch may therefore never have the <code>linked</code> flag set as
this would leave a chain open-ended. Multiple chains or individual
events may coexist within a batch to succeed or fail independently.</p>
<p>Events within a chain are executed within order, or are rolled back
on error, so that the effect of each event in the chain is visible to
the next, and so that the chain is either visible or invisible as a unit
to subsequent events after the chain. The event that was the first to
break the chain will have a unique error result. Other events in the
chain will have their error result set to
<code>linked_event_failed</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb21"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{}</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>linkedFlag <span class="op">:=</span> TransferFlags<span class="op">{</span>Linked<span class="op">:</span> <span class="ot">true</span><span class="op">}.</span>ToUint16<span class="op">()</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="co">/* ... rest of transfer ... */</span><span class="op">})</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 4 transfers (the last transfer in the chain closes the chain with linked=false):</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="co">/* ... , */</span><span class="op">,</span> Flags<span class="op">:</span> linkedFlag<span class="op">})</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="co">/* ... , */</span><span class="op">,</span> Flags<span class="op">:</span> linkedFlag<span class="op">})</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="co">/* ... , */</span><span class="op">,</span> Flags<span class="op">:</span> linkedFlag<span class="op">})</span> <span class="co">// Fail with exists</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">4</span><span class="op">)</span> <span class="co">/* ... , */</span><span class="op">})</span>                    <span class="co">// Fail without committing</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">// This should not see any effect from the failed chain above.</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="co">/* ... rest of transfer ... */</span><span class="op">})</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (the first transfer fails the chain):</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="co">/* ... rest of transfer ... */</span><span class="op">,</span> Flags<span class="op">:</span> linkedFlag<span class="op">})</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="co">/* ... rest of transfer ... */</span><span class="op">})</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (successful):</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">3</span><span class="op">)</span> <span class="co">/* ... rest of transfer ... */</span><span class="op">,</span> Flags<span class="op">:</span> linkedFlag<span class="op">})</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>batch<span class="op">,</span> Transfer<span class="op">{</span>ID<span class="op">:</span> ToUint128<span class="op">(</span><span class="dv">4</span><span class="op">)</span> <span class="co">/* ... rest of transfer ... */</span><span class="op">})</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">(</span>batch<span class="op">)</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-go-imported-events"><a href="#coding-clients-go-imported-events"
class="anchor">Imported Events</a></h2>
<p>When the <code>imported</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it allows
importing historical events with a user-defined timestamp.</p>
<p>The entire batch of events must be set with the flag
<code>imported</code>.</p>
<p>It‚Äôs recommended to submit the whole batch as a <code>linked</code>
chain of events, ensuring that if any event fails, none of them are
committed, preserving the last timestamp unchanged. This approach gives
the application a chance to correct failed imported events,
re-submitting the batch again with the same user-defined timestamps.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb22"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// External source of time.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> historicalTimestamp <span class="dt">uint64</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>historicalAccounts <span class="op">:=</span> <span class="op">[]</span>Account<span class="op">{</span> <span class="co">/* Loaded from an external source. */</span> <span class="op">}</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>historicalTransfers <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{</span> <span class="co">/* Loaded from an external source. */</span> <span class="op">}</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">// First, load and import all accounts with their timestamps from the historical source.</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>accountsBatch <span class="op">:=</span> <span class="op">[]</span>Account<span class="op">{}</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index<span class="op">,</span> account <span class="op">:=</span> <span class="kw">range</span> historicalAccounts <span class="op">{</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span>Timestamp <span class="op">=</span> historicalTimestamp</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span>Flags <span class="op">=</span> AccountFlags<span class="op">{</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the account as `imported`.</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        Imported<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// must be `linked`.</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        Linked<span class="op">:</span> index <span class="op">&lt;</span> <span class="bu">len</span><span class="op">(</span>historicalAccounts<span class="op">)-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint16<span class="op">()</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    accountsBatch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>accountsBatch<span class="op">,</span> account<span class="op">)</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>accountErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateAccounts<span class="op">(</span>accountsBatch<span class="op">)</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Then, load and import all transfers with their timestamps from the historical source.</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>transfersBatch <span class="op">:=</span> <span class="op">[]</span>Transfer<span class="op">{}</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index<span class="op">,</span> transfer <span class="op">:=</span> <span class="kw">range</span> historicalTransfers <span class="op">{</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span>Timestamp <span class="op">=</span> historicalTimestamp</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span>Flags <span class="op">=</span> TransferFlags<span class="op">{</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Set the transfer as `imported`.</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        Imported<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// must be `linked`.</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        Linked<span class="op">:</span> index <span class="op">&lt;</span> <span class="bu">len</span><span class="op">(</span>historicalAccounts<span class="op">)-</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}.</span>ToUint16<span class="op">()</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    transfersBatch <span class="op">=</span> <span class="bu">append</span><span class="op">(</span>transfersBatch<span class="op">,</span> transfer<span class="op">)</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>transferErrors<span class="op">,</span> err <span class="op">:=</span> client<span class="op">.</span>CreateTransfers<span class="op">(</span>transfersBatch<span class="op">)</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted..</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="co">// Since it is a linked chain, in case of any error the entire batch is rolled back and can be retried</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a><span class="co">// with the same historical timestamps without regressing the cluster timestamp.</span></span></code></pre></div>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/src/clients/go/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->

<h1 id="coding-clients-java"><a href="#coding-clients-java"
class="anchor">tigerbeetle-java</a></h1>
<p>The TigerBeetle client for Java.</p>
<p><a
href="https://javadoc.io/doc/com.tigerbeetle/tigerbeetle-java"><img
src="https://javadoc.io/badge2/com.tigerbeetle/tigerbeetle-java/javadoc.svg"
alt="javadoc" /></a></p>
<p><a href="https://central.sonatype.com/namespace/com.tigerbeetle"><img
src="https://img.shields.io/maven-central/v/com.tigerbeetle/tigerbeetle-java"
alt="maven-central" /></a></p>
<h2 id="coding-clients-java-prerequisites"><a href="#coding-clients-java-prerequisites"
class="anchor">Prerequisites</a></h2>
<p>Linux &gt;= 5.6 is the only production environment we support. But
for ease of development we also support macOS and Windows.</p>
<ul>
<li>Java &gt;= 11</li>
<li>Maven &gt;= 3.6 (not strictly necessary but it‚Äôs what our guides
assume)</li>
</ul>
<h2 id="coding-clients-java-setup"><a href="#coding-clients-java-setup" class="anchor">Setup</a></h2>
<p>First, create a directory for your project and <code>cd</code> into
the directory.</p>
<p>Then create <code>pom.xml</code> and copy this into it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb1"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">project</span><span class="ot"> xmlns=</span><span class="st">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ot">         xmlns:xsi=</span><span class="st">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ot">         xsi:schemaLocation=</span><span class="st">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">modelVersion</span>&gt;4.0.0&lt;/<span class="kw">modelVersion</span>&gt;</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">groupId</span>&gt;com.tigerbeetle&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">artifactId</span>&gt;samples&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">version</span>&gt;1.0-SNAPSHOT&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">properties</span>&gt;</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">maven.compiler.source</span>&gt;11&lt;/<span class="kw">maven.compiler.source</span>&gt;</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">maven.compiler.target</span>&gt;11&lt;/<span class="kw">maven.compiler.target</span>&gt;</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">properties</span>&gt;</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">build</span>&gt;</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">plugins</span>&gt;</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">plugin</span>&gt;</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;org.apache.maven.plugins&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;maven-compiler-plugin&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;3.8.1&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">configuration</span>&gt;</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>          &lt;<span class="kw">compilerArgs</span>&gt;</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">arg</span>&gt;-Xlint:all,-options,-path&lt;/<span class="kw">arg</span>&gt;</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>          &lt;/<span class="kw">compilerArgs</span>&gt;</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">configuration</span>&gt;</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      &lt;/<span class="kw">plugin</span>&gt;</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">plugin</span>&gt;</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">groupId</span>&gt;org.codehaus.mojo&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">artifactId</span>&gt;exec-maven-plugin&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">version</span>&gt;1.6.0&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">configuration</span>&gt;</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>          &lt;<span class="kw">mainClass</span>&gt;com.tigerbeetle.samples.Main&lt;/<span class="kw">mainClass</span>&gt;</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">configuration</span>&gt;</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      &lt;/<span class="kw">plugin</span>&gt;</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">plugins</span>&gt;</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">build</span>&gt;</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">dependencies</span>&gt;</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">dependency</span>&gt;</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">groupId</span>&gt;com.tigerbeetle&lt;/<span class="kw">groupId</span>&gt;</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">artifactId</span>&gt;tigerbeetle-java&lt;/<span class="kw">artifactId</span>&gt;</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      <span class="co">&lt;!-- Grab the latest commit from: https://repo1.maven.org/maven2/com/tigerbeetle/tigerbeetle-java/maven-metadata.xml --&gt;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>      &lt;<span class="kw">version</span>&gt;0.0.1-3431&lt;/<span class="kw">version</span>&gt;</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">dependency</span>&gt;</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">dependencies</span>&gt;</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">project</span>&gt;</span></code></pre></div>
</div>
<p>Then, install the TigerBeetle client:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>mvn install</code></pre>
</div>
<p>Now, create <code>src/main/java/Main.java</code> and copy this into
it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb3"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">com</span><span class="op">.</span><span class="im">tigerbeetle</span><span class="op">.*;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Main <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">)</span> <span class="kw">throws</span> <span class="bu">Exception</span> <span class="op">{</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">&quot;Import ok!&quot;</span><span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Finally, build and run:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>mvn exec:java</code></pre>
</div>
<p>Now that all prerequisites and dependencies are correctly set up,
let‚Äôs dig into using TigerBeetle.</p>
<h2 id="coding-clients-java-sample-projects"><a href="#coding-clients-java-sample-projects"
class="anchor">Sample projects</a></h2>
<p>This document is primarily a reference guide to the client. Below are
various sample projects demonstrating features of TigerBeetle.</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/java/samples/basic/">Basic</a>:
Create two accounts and transfer an amount between them.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/java/samples/two-phase/">Two-Phase
Transfer</a>: Create two accounts and start a pending transfer between
them, then post the transfer.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/java/samples/two-phase-many/">Many
Two-Phase Transfers</a>: Create two accounts and start a number of
pending transfer between them, posting and voiding alternating
transfers.</li>
</ul>
<h2 id="coding-clients-java-creating-a-client"><a href="#coding-clients-java-creating-a-client"
class="anchor">Creating a Client</a></h2>
<p>A client is created with a cluster ID and replica addresses for all
replicas in the cluster. The cluster ID and replica addresses are both
chosen by the system that starts the TigerBeetle cluster.</p>
<p>Clients are thread-safe and a single instance should be shared
between multiple concurrent tasks.</p>
<p>Multiple clients are useful when connecting to more than one
TigerBeetle cluster.</p>
<p>In this example the cluster ID is <code>0</code> and there is one
replica. The address is read from the <code>TB_ADDRESS</code>
environment variable and defaults to port <code>3000</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb5"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> replicaAddress <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">getenv</span><span class="op">(</span><span class="st">&quot;TB_ADDRESS&quot;</span><span class="op">);</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">byte</span><span class="op">[]</span> clusterID <span class="op">=</span> UInt128<span class="op">.</span><span class="fu">asBytes</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span><span class="op">[]</span> replicaAddresses <span class="op">=</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span>replicaAddress <span class="op">==</span> <span class="kw">null</span> <span class="op">?</span> <span class="st">&quot;3000&quot;</span> <span class="op">:</span> replicaAddress<span class="op">};</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">(</span><span class="dt">var</span> client <span class="op">=</span> <span class="kw">new</span> <span class="fu">Client</span><span class="op">(</span>clusterID<span class="op">,</span> replicaAddresses<span class="op">))</span> <span class="op">{</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use client</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>The following are valid addresses:</p>
<ul>
<li><code>3000</code> (interpreted as <code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1:3000</code> (interpreted as
<code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1</code> (interpreted as <code>127.0.0.1:3001</code>,
<code>3001</code> is the default port)</li>
</ul>
<h2 id="coding-clients-java-creating-accounts"><a href="#coding-clients-java-creating-accounts"
class="anchor">Creating Accounts</a></h2>
<p>See details for account fields in the <a
href="#reference-account">Accounts reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb6"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>AccountBatch accounts <span class="op">=</span> <span class="kw">new</span> <span class="fu">AccountBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>UInt128<span class="op">.</span><span class="fu">id</span><span class="op">());</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setUserData128</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setUserData64</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setUserData32</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">718</span><span class="op">);</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setTimestamp</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>CreateAccountResultBatch accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<p>The 128-bit fields like <code>id</code> and
<code>user_data_128</code> have a few overrides to make it easier to
integrate. You can either pass in a long, a pair of longs (least and
most significant bits), or a <code>byte[]</code>.</p>
<p>There is also a <code>com.tigerbeetle.UInt128</code> helper with
static methods for converting 128-bit little-endian unsigned integers
between instances of <code>long</code>, <code>java.util.UUID</code>,
<code>java.math.BigInteger</code> and <code>byte[]</code>.</p>
<p>The fields for transfer amounts and account balances are also
128-bit, but they are always represented as a
<code>java.math.BigInteger</code>.</p>
<h3 id="coding-clients-java-account-flags"><a href="#coding-clients-java-account-flags" class="anchor">Account
Flags</a></h3>
<p>The account flags value is a bitfield. See details for these flags in
the <a href="#reference-account-flags">Accounts reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>AccountFlags</code> object with bitwise-or:</p>
<ul>
<li><code>AccountFlags.LINKED</code></li>
<li><code>AccountFlags.DEBITS_MUST_NOT_EXCEED_CREDITS</code></li>
<li><code>AccountFlags.CREDITS_MUST_NOT_EXCEED_CREDITS</code></li>
<li><code>AccountFlags.HISTORY</code></li>
</ul>
<p>For example, to link two accounts where the first account
additionally has the <code>debits_must_not_exceed_credits</code>
constraint:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb7"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>AccountBatch accounts <span class="op">=</span> <span class="kw">new</span> <span class="fu">AccountBatch</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">718</span><span class="op">);</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">LINKED</span> <span class="op">|</span> AccountFlags<span class="op">.</span><span class="fu">DEBITS_MUST_NOT_EXCEED_CREDITS</span><span class="op">);</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">101</span><span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">718</span><span class="op">);</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">HISTORY</span><span class="op">);</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>CreateAccountResultBatch accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-java-response-and-errors"><a href="#coding-clients-java-response-and-errors"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all accounts were created
successfully. If the response is non-empty, each object in the response
array contains error information for an account that failed. The error
object contains an error code and the index of the account in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_accounts">create_accounts
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>AccountBatch accounts <span class="op">=</span> <span class="kw">new</span> <span class="fu">AccountBatch</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">718</span><span class="op">);</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">718</span><span class="op">);</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">104</span><span class="op">);</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">718</span><span class="op">);</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>CreateAccountResultBatch accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>accountErrors<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>accountErrors<span class="op">.</span><span class="fu">getResult</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> Exists<span class="op">:</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">err</span><span class="op">.</span><span class="fu">printf</span><span class="op">(</span><span class="st">&quot;Batch account at </span><span class="sc">%d</span><span class="st"> already exists.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                    accountErrors<span class="op">.</span><span class="fu">getIndex</span><span class="op">());</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">err</span><span class="op">.</span><span class="fu">printf</span><span class="op">(</span><span class="st">&quot;Batch account at </span><span class="sc">%d</span><span class="st"> failed to create </span><span class="sc">%s</span><span class="st">.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                    accountErrors<span class="op">.</span><span class="fu">getIndex</span><span class="op">(),</span> accountErrors<span class="op">.</span><span class="fu">getResult</span><span class="op">());</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-account-lookup"><a href="#coding-clients-java-account-lookup" class="anchor">Account
Lookup</a></h2>
<p>Account lookup is batched, like account creation. Pass in all IDs to
fetch. The account for each matched ID is returned.</p>
<p>If no account matches an ID, no object is returned for that account.
So the order of accounts in the response is not necessarily the same as
the order of IDs in the request. You can refer to the ID field in the
response to distinguish accounts.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb9"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>IdBatch ids <span class="op">=</span> <span class="kw">new</span> <span class="fu">IdBatch</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ids<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ids<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">101</span><span class="op">);</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>AccountBatch accounts <span class="op">=</span> client<span class="op">.</span><span class="fu">lookupAccounts</span><span class="op">(</span>ids<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-create-transfers"><a href="#coding-clients-java-create-transfers"
class="anchor">Create Transfers</a></h2>
<p>This creates a journal entry between two accounts.</p>
<p>See details for transfer fields in the <a
href="#reference-transfer">Transfers reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>UInt128<span class="op">.</span><span class="fu">id</span><span class="op">());</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setUserData128</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setUserData64</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setUserData32</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setTimeout</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setTimeout</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-java-response-and-errors-1"><a href="#coding-clients-java-response-and-errors-1"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all transfers were created
successfully. If the response is non-empty, each object in the response
array contains error information for a transfer that failed. The error
object contains an error code and the index of the transfer in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_transfers">create_transfers
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>transferErrors<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>transferErrors<span class="op">.</span><span class="fu">getResult</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> ExceedsCredits<span class="op">:</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">err</span><span class="op">.</span><span class="fu">printf</span><span class="op">(</span><span class="st">&quot;Batch transfer at </span><span class="sc">%d</span><span class="st"> already exists.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>                    transferErrors<span class="op">.</span><span class="fu">getIndex</span><span class="op">());</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">err</span><span class="op">.</span><span class="fu">printf</span><span class="op">(</span><span class="st">&quot;Batch transfer at </span><span class="sc">%d</span><span class="st"> failed to create: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                    transferErrors<span class="op">.</span><span class="fu">getIndex</span><span class="op">(),</span> transferErrors<span class="op">.</span><span class="fu">getResult</span><span class="op">());</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-batching"><a href="#coding-clients-java-batching" class="anchor">Batching</a></h2>
<p>TigerBeetle performance is maximized when you batch API requests. The
client does not do this automatically for you. So, for example, you
<em>can</em> insert 1 million transfers one at a time like so:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb12"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ResultSet</span> dataSource <span class="op">=</span> <span class="kw">null</span><span class="op">;</span> <span class="co">/* Loaded from an external source. */</span><span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    TransferBatch batch <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">));</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;debit_account_id&quot;</span><span class="op">));</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;credit_account_id&quot;</span><span class="op">));</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBigDecimal</span><span class="op">(</span><span class="st">&quot;amount&quot;</span><span class="op">).</span><span class="fu">toBigInteger</span><span class="op">());</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;ledger&quot;</span><span class="op">));</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;code&quot;</span><span class="op">));</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>batch<span class="op">);</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>But the insert rate will be a <em>fraction</em> of potential.
Instead, <strong>always batch what you can</strong>.</p>
<p>The maximum batch size is set in the TigerBeetle server. The default
is 8190.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb13"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ResultSet</span> dataSource <span class="op">=</span> <span class="kw">null</span><span class="op">;</span> <span class="co">/* Loaded from an external source. */</span><span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> BATCH_SIZE <span class="op">=</span> <span class="dv">8190</span><span class="op">;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>TransferBatch batch <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span>BATCH_SIZE<span class="op">);</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">));</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;debit_account_id&quot;</span><span class="op">));</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;credit_account_id&quot;</span><span class="op">));</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getBigDecimal</span><span class="op">(</span><span class="st">&quot;amount&quot;</span><span class="op">).</span><span class="fu">toBigInteger</span><span class="op">());</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;ledger&quot;</span><span class="op">));</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span>dataSource<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;code&quot;</span><span class="op">));</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>batch<span class="op">.</span><span class="fu">getLength</span><span class="op">()</span> <span class="op">==</span> BATCH_SIZE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>batch<span class="op">);</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Error handling omitted.</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Reset the batch for the next iteration.</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        batch<span class="op">.</span><span class="fu">beforeFirst</span><span class="op">();</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>batch<span class="op">.</span><span class="fu">getLength</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send the remaining items.</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>batch<span class="op">);</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h3 id="coding-clients-java-queues-and-workers"><a href="#coding-clients-java-queues-and-workers"
class="anchor">Queues and Workers</a></h3>
<p>If you are making requests to TigerBeetle from workers pulling jobs
from a queue, you can batch requests to TigerBeetle by having the worker
act on multiple jobs from the queue at once rather than one at a time.
i.e. pulling multiple jobs from the queue rather than just one.</p>
<h2 id="coding-clients-java-transfer-flags"><a href="#coding-clients-java-transfer-flags"
class="anchor">Transfer Flags</a></h2>
<p>The transfer <code>flags</code> value is a bitfield. See details for
these flags in the <a href="#reference-transfer-flags">Transfers
reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>TransferFlags</code> object with bitwise-or:</p>
<ul>
<li><code>TransferFlags.NONE</code></li>
<li><code>TransferFlags.LINKED</code></li>
<li><code>TransferFlags.PENDING</code></li>
<li><code>TransferFlags.POST_PENDING_TRANSFER</code></li>
<li><code>TransferFlags.VOID_PENDING_TRANSFER</code></li>
</ul>
<p>For example, to link <code>transfer0</code> and
<code>transfer1</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb14"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">// First transfer</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">5</span><span class="op">);</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-java-two-phase-transfers"><a href="#coding-clients-java-two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h3>
<p>Two-phase transfers are supported natively by toggling the
appropriate flag. TigerBeetle will then adjust the
<code>credits_pending</code> and <code>debits_pending</code> fields of
the appropriate accounts. A corresponding post pending transfer then
needs to be sent to post or void the transfer.</p>
<h4 id="coding-clients-java-post-a-pending-transfer"><a href="#coding-clients-java-post-a-pending-transfer"
class="anchor">Post a Pending Transfer</a></h4>
<p>With <code>flags</code> set to <code>post_pending_transfer</code>,
TigerBeetle will post the transfer. TigerBeetle will atomically roll
back the changes to <code>debits_pending</code> and
<code>credits_pending</code> of the appropriate accounts and apply them
to the <code>debits_posted</code> and <code>credits_posted</code>
balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb15"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">6</span><span class="op">);</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">PENDING</span><span class="op">);</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">7</span><span class="op">);</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span>TransferBatch<span class="op">.</span><span class="fu">AMOUNT_MAX</span><span class="op">);</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setPendingId</span><span class="op">(</span><span class="dv">6</span><span class="op">);</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">POST_PENDING_TRANSFER</span><span class="op">);</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h4 id="coding-clients-java-void-a-pending-transfer"><a href="#coding-clients-java-void-a-pending-transfer"
class="anchor">Void a Pending Transfer</a></h4>
<p>In contrast, with <code>flags</code> set to
<code>void_pending_transfer</code>, TigerBeetle will void the transfer.
TigerBeetle will roll back the changes to <code>debits_pending</code>
and <code>credits_pending</code> of the appropriate accounts and
<strong>not</strong> apply them to the <code>debits_posted</code> and
<code>credits_posted</code> balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb16"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">8</span><span class="op">);</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span><span class="dv">102</span><span class="op">);</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span><span class="dv">103</span><span class="op">);</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">PENDING</span><span class="op">);</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">9</span><span class="op">);</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setPendingId</span><span class="op">(</span><span class="dv">8</span><span class="op">);</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">VOID_PENDING_TRANSFER</span><span class="op">);</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-transfer-lookup"><a href="#coding-clients-java-transfer-lookup"
class="anchor">Transfer Lookup</a></h2>
<p>NOTE: While transfer lookup exists, it is not a flexible query API.
We are developing query APIs and there will be new methods for querying
transfers in the future.</p>
<p>Transfer lookup is batched, like transfer creation. Pass in all
<code>id</code>s to fetch, and matched transfers are returned.</p>
<p>If no transfer matches an <code>id</code>, no object is returned for
that transfer. So the order of transfers in the response is not
necessarily the same as the order of <code>id</code>s in the request.
You can refer to the <code>id</code> field in the response to
distinguish transfers.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb17"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>IdBatch ids <span class="op">=</span> <span class="kw">new</span> <span class="fu">IdBatch</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ids<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ids<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">lookupTransfers</span><span class="op">(</span>ids<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-get-account-transfers"><a href="#coding-clients-java-get-account-transfers"
class="anchor">Get Account Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the transfers involving a given account, allowing basic
filter and pagination capabilities.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb18"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>AccountFilter filter <span class="op">=</span> <span class="kw">new</span> <span class="fu">AccountFilter</span><span class="op">();</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setAccountId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData128</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData64</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData32</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Code.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMin</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMax</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setLimit</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// Limit to ten transfers at most.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setDebits</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setCredits</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setReversed</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">getAccountTransfers</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-get-account-balances"><a href="#coding-clients-java-get-account-balances"
class="anchor">Get Account Balances</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the point-in-time balances of a given account, allowing basic
filter and pagination capabilities.</p>
<p>Only accounts created with the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set
retain <a href="#reference-requests-get_account_balances">historical
balances</a>.</p>
<p>The balances in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb19"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>AccountFilter filter <span class="op">=</span> <span class="kw">new</span> <span class="fu">AccountFilter</span><span class="op">();</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setAccountId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData128</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData64</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData32</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Code.</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMin</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMax</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setLimit</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setDebits</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setCredits</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setReversed</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>AccountBalanceBatch account_balances <span class="op">=</span> client<span class="op">.</span><span class="fu">getAccountBalances</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-query-accounts"><a href="#coding-clients-java-query-accounts" class="anchor">Query
Accounts</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query accounts by the intersection of some fields and by timestamp
range.</p>
<p>The accounts in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb20"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>QueryFilter filter <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryFilter</span><span class="op">();</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData128</span><span class="op">(</span><span class="dv">1000</span><span class="op">);</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData64</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData32</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span> <span class="co">// Filter by Code.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Ledger.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMin</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMax</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setLimit</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setReversed</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>AccountBatch accounts <span class="op">=</span> client<span class="op">.</span><span class="fu">queryAccounts</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-query-transfers"><a href="#coding-clients-java-query-transfers" class="anchor">Query
Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query transfers by the intersection of some fields and by timestamp
range.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb21"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>QueryFilter filter <span class="op">=</span> <span class="kw">new</span> <span class="fu">QueryFilter</span><span class="op">();</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData128</span><span class="op">(</span><span class="dv">1000</span><span class="op">);</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData64</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setUserData32</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span> <span class="co">// Filter by Code.</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Ledger.</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMin</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setTimestampMax</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setLimit</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>filter<span class="op">.</span><span class="fu">setReversed</span><span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">queryTransfers</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-linked-events"><a href="#coding-clients-java-linked-events" class="anchor">Linked
Events</a></h2>
<p>When the <code>linked</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it links that
event with the next event in the batch, to create a chain of events, of
arbitrary length, which all succeed or fail together. The tail of a
chain is denoted by the first event without this flag. The last event in
a batch may therefore never have the <code>linked</code> flag set as
this would leave a chain open-ended. Multiple chains or individual
events may coexist within a batch to succeed or fail independently.</p>
<p>Events within a chain are executed within order, or are rolled back
on error, so that the effect of each event in the chain is visible to
the next, and so that the chain is either visible or invisible as a unit
to subsequent events after the chain. The event that was the first to
break the chain will have a unique error result. Other events in the
chain will have their error result set to
<code>linked_event_failed</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb22"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 4 transfers (the last transfer in the chain closes the chain with</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">// linked=false):</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span> <span class="co">// Fail with exists</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">4</span><span class="op">);</span> <span class="co">// Fail without committing</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">// This should not see any effect from the failed chain above.</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (the first transfer fails the chain):</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (successful):</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span><span class="dv">4</span><span class="op">);</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a><span class="co">// ... rest of transfer ...</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">NONE</span><span class="op">);</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-java-imported-events"><a href="#coding-clients-java-imported-events"
class="anchor">Imported Events</a></h2>
<p>When the <code>imported</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it allows
importing historical events with a user-defined timestamp.</p>
<p>The entire batch of events must be set with the flag
<code>imported</code>.</p>
<p>It‚Äôs recommended to submit the whole batch as a <code>linked</code>
chain of events, ensuring that if any event fails, none of them are
committed, preserving the last timestamp unchanged. This approach gives
the application a chance to correct failed imported events,
re-submitting the batch again with the same user-defined timestamps.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb23"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// External source of time</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> historicalTimestamp <span class="op">=</span> <span class="dv">0L</span><span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">ResultSet</span> historicalAccounts <span class="op">=</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// Loaded from an external source;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="bu">ResultSet</span> historicalTransfers <span class="op">=</span> <span class="kw">null</span> <span class="op">;</span> <span class="co">// Loaded from an external source.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> BATCH_SIZE <span class="op">=</span> <span class="dv">8190</span><span class="op">;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">// First, load and import all accounts with their timestamps from the historical source.</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>AccountBatch accounts <span class="op">=</span> <span class="kw">new</span> <span class="fu">AccountBatch</span><span class="op">(</span>BATCH_SIZE<span class="op">);</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>historicalAccounts<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>historicalAccounts<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">));</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span>historicalAccounts<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;ledger&quot;</span><span class="op">));</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span>historicalAccounts<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;code&quot;</span><span class="op">));</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    accounts<span class="op">.</span><span class="fu">setTimestamp</span><span class="op">(</span>historicalTimestamp<span class="op">);</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the account as `imported`.</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">// must be `linked`.</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>accounts<span class="op">.</span><span class="fu">getLength</span><span class="op">()</span> <span class="op">&lt;</span> BATCH_SIZE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">IMPORTED</span> <span class="op">|</span> AccountFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        accounts<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>AccountFlags<span class="op">.</span><span class="fu">IMPORTED</span><span class="op">);</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        CreateAccountResultBatch accountsErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Error handling omitted.</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Reset the batch for the next iteration.</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        accounts<span class="op">.</span><span class="fu">beforeFirst</span><span class="op">();</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>accounts<span class="op">.</span><span class="fu">getLength</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send the remaining items.</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    CreateAccountResultBatch accountsErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co">// Then, load and import all transfers with their timestamps from the historical source.</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>TransferBatch transfers <span class="op">=</span> <span class="kw">new</span> <span class="fu">TransferBatch</span><span class="op">(</span>BATCH_SIZE<span class="op">);</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">next</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">add</span><span class="op">();</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setId</span><span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;id&quot;</span><span class="op">));</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setDebitAccountId</span><span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;debit_account_id&quot;</span><span class="op">));</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setCreditAccountId</span><span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">getBytes</span><span class="op">(</span><span class="st">&quot;credit_account_id&quot;</span><span class="op">));</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setAmount</span><span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">getBigDecimal</span><span class="op">(</span><span class="st">&quot;amount&quot;</span><span class="op">).</span><span class="fu">toBigInteger</span><span class="op">());</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setLedger</span><span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;ledger&quot;</span><span class="op">));</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setCode</span><span class="op">(</span>historicalTransfers<span class="op">.</span><span class="fu">getInt</span><span class="op">(</span><span class="st">&quot;code&quot;</span><span class="op">));</span></span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    transfers<span class="op">.</span><span class="fu">setTimestamp</span><span class="op">(</span>historicalTimestamp<span class="op">);</span></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the transfer as `imported`.</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">// must be `linked`.</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>transfers<span class="op">.</span><span class="fu">getLength</span><span class="op">()</span> <span class="op">&lt;</span> BATCH_SIZE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>        transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">IMPORTED</span> <span class="op">|</span> TransferFlags<span class="op">.</span><span class="fu">LINKED</span><span class="op">);</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>        transfers<span class="op">.</span><span class="fu">setFlags</span><span class="op">(</span>TransferFlags<span class="op">.</span><span class="fu">IMPORTED</span><span class="op">);</span></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>        CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Error handling omitted.</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Reset the batch for the next iteration.</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>        transfers<span class="op">.</span><span class="fu">beforeFirst</span><span class="op">();</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>transfers<span class="op">.</span><span class="fu">getLength</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send the remaining items.</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>    CreateTransferResultBatch transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">createTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a><span class="co">// Since it is a linked chain, in case of any error the entire batch is rolled back and can be retried</span></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a><span class="co">// with the same historical timestamps without regressing the cluster timestamp.</span></span></code></pre></div>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/src/clients/java/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->

<h1 id="coding-clients-node"><a href="#coding-clients-node"
class="anchor">tigerbeetle-node</a></h1>
<p>The TigerBeetle client for Node.js.</p>
<h2 id="coding-clients-node-prerequisites"><a href="#coding-clients-node-prerequisites"
class="anchor">Prerequisites</a></h2>
<p>Linux &gt;= 5.6 is the only production environment we support. But
for ease of development we also support macOS and Windows.</p>
<ul>
<li>NodeJS &gt;= <code>18</code></li>
</ul>
<h2 id="coding-clients-node-setup"><a href="#coding-clients-node-setup" class="anchor">Setup</a></h2>
<p>First, create a directory for your project and <code>cd</code> into
the directory.</p>
<p>Then, install the TigerBeetle client:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>npm install --save-exact tigerbeetle-node</code></pre>
</div>
<p>Now, create <code>main.js</code> and copy this into it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb2"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { id } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;tigerbeetle-node&quot;</span>)<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { createClient } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;tigerbeetle-node&quot;</span>)<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="bu">process</span> <span class="op">=</span> <span class="pp">require</span>(<span class="st">&quot;process&quot;</span>)<span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;Import ok!&quot;</span>)<span class="op">;</span></span></code></pre></div>
</div>
<p>Finally, build and run:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>node main.js</code></pre>
</div>
<p>Now that all prerequisites and dependencies are correctly set up,
let‚Äôs dig into using TigerBeetle.</p>
<h2 id="coding-clients-node-sample-projects"><a href="#coding-clients-node-sample-projects"
class="anchor">Sample projects</a></h2>
<p>This document is primarily a reference guide to the client. Below are
various sample projects demonstrating features of TigerBeetle.</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/node/samples/basic/">Basic</a>:
Create two accounts and transfer an amount between them.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/node/samples/two-phase/">Two-Phase
Transfer</a>: Create two accounts and start a pending transfer between
them, then post the transfer.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/node/samples/two-phase-many/">Many
Two-Phase Transfers</a>: Create two accounts and start a number of
pending transfer between them, posting and voiding alternating
transfers.</li>
</ul>
<h3 id="coding-clients-node-sidenote-bigint"><a href="#coding-clients-node-sidenote-bigint"
class="anchor">Sidenote: <code>BigInt</code></a></h3>
<p>TigerBeetle uses 64-bit integers for many fields while JavaScript‚Äôs
builtin <code>Number</code> maximum value is <code>2^53-1</code>. The
<code>n</code> suffix in JavaScript means the value is a
<code>BigInt</code>. This is useful for literal numbers. If you already
have a <code>Number</code> variable though, you can call the
<code>BigInt</code> constructor to get a <code>BigInt</code> from it.
For example, <code>1n</code> is the same as <code>BigInt(1)</code>.</p>
<h2 id="coding-clients-node-creating-a-client"><a href="#coding-clients-node-creating-a-client"
class="anchor">Creating a Client</a></h2>
<p>A client is created with a cluster ID and replica addresses for all
replicas in the cluster. The cluster ID and replica addresses are both
chosen by the system that starts the TigerBeetle cluster.</p>
<p>Clients are thread-safe and a single instance should be shared
between multiple concurrent tasks.</p>
<p>Multiple clients are useful when connecting to more than one
TigerBeetle cluster.</p>
<p>In this example the cluster ID is <code>0</code> and there is one
replica. The address is read from the <code>TB_ADDRESS</code>
environment variable and defaults to port <code>3000</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> client <span class="op">=</span> <span class="fu">createClient</span>({</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cluster_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">replica_addresses</span><span class="op">:</span> [<span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">TB_ADDRESS</span> <span class="op">||</span> <span class="st">&quot;3000&quot;</span>]<span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
</div>
<p>The following are valid addresses:</p>
<ul>
<li><code>3000</code> (interpreted as <code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1:3000</code> (interpreted as
<code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1</code> (interpreted as <code>127.0.0.1:3001</code>,
<code>3001</code> is the default port)</li>
</ul>
<h2 id="coding-clients-node-creating-accounts"><a href="#coding-clients-node-creating-accounts"
class="anchor">Creating Accounts</a></h2>
<p>See details for account fields in the <a
href="#reference-account">Accounts reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb5"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account <span class="op">=</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="fu">id</span>()<span class="op">,</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reserved</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">718</span><span class="op">,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createAccounts</span>([account])<span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-node-account-flags"><a href="#coding-clients-node-account-flags" class="anchor">Account
Flags</a></h3>
<p>The account flags value is a bitfield. See details for these flags in
the <a href="#reference-account-flags">Accounts reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>AccountFlags</code> object (in TypeScript it is an actual enum)
with bitwise-or:</p>
<ul>
<li><code>AccountFlags.linked</code></li>
<li><code>AccountFlags.debits_must_not_exceed_credits</code></li>
<li><code>AccountFlags.credits_must_not_exceed_credits</code></li>
<li><code>AccountFlags.history</code></li>
</ul>
<p>For example, to link two accounts where the first account
additionally has the <code>debits_must_not_exceed_credits</code>
constraint:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb6"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account0 <span class="op">=</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">100</span>n<span class="op">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reserved</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> AccountFlags<span class="op">.</span><span class="at">linked</span> <span class="op">|</span> AccountFlags<span class="op">.</span><span class="at">debits_must_not_exceed_credits</span><span class="op">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account1 <span class="op">=</span> {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">101</span>n<span class="op">,</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reserved</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> AccountFlags<span class="op">.</span><span class="at">history</span><span class="op">,</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createAccounts</span>([account0<span class="op">,</span> account1])<span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-node-response-and-errors"><a href="#coding-clients-node-response-and-errors"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all accounts were created
successfully. If the response is non-empty, each object in the response
array contains error information for an account that failed. The error
object contains an error code and the index of the account in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_accounts">create_accounts
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb7"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account0 <span class="op">=</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reserved</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account1 <span class="op">=</span> {</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reserved</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account2 <span class="op">=</span> {</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">104</span>n<span class="op">,</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_pending</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credits_posted</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reserved</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createAccounts</span>([account0<span class="op">,</span> account1<span class="op">,</span> account2])<span class="op">;</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">const</span> error <span class="kw">of</span> account_errors) {</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span> (error<span class="op">.</span><span class="at">result</span>) {</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> CreateAccountError<span class="op">.</span><span class="at">exists</span><span class="op">:</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="vs">`Batch account at </span><span class="sc">${</span>error<span class="op">.</span><span class="at">index</span><span class="sc">}</span><span class="vs"> already exists.`</span>)<span class="op">;</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span><span class="op">;</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`Batch account at </span><span class="sc">${</span>error<span class="op">.</span><span class="at">index</span><span class="sc">}</span><span class="vs"> failed to create: </span><span class="sc">${</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>          CreateAccountError[error<span class="op">.</span><span class="at">result</span>]</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>        <span class="sc">}</span><span class="vs">.`</span><span class="op">,</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>To handle errors you can either 1) exactly match error codes returned
from <code>client.createAccounts</code> with enum values in the
<code>CreateAccountError</code> object, or you can 2) look up the error
code in the <code>CreateAccountError</code> object for a human-readable
string.</p>
<h2 id="coding-clients-node-account-lookup"><a href="#coding-clients-node-account-lookup" class="anchor">Account
Lookup</a></h2>
<p>Account lookup is batched, like account creation. Pass in all IDs to
fetch. The account for each matched ID is returned.</p>
<p>If no account matches an ID, no object is returned for that account.
So the order of accounts in the response is not necessarily the same as
the order of IDs in the request. You can refer to the ID field in the
response to distinguish accounts.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> accounts <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">lookupAccounts</span>([<span class="dv">100</span>n<span class="op">,</span> <span class="dv">101</span>n])<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-create-transfers"><a href="#coding-clients-node-create-transfers"
class="anchor">Create Transfers</a></h2>
<p>This creates a journal entry between two accounts.</p>
<p>See details for transfer fields in the <a
href="#reference-transfer">Transfers reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb9"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfers <span class="op">=</span> [{</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="fu">id</span>()<span class="op">,</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>}]<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>(transfers)<span class="op">;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-node-response-and-errors-1"><a href="#coding-clients-node-response-and-errors-1"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all transfers were created
successfully. If the response is non-empty, each object in the response
array contains error information for a transfer that failed. The error
object contains an error code and the index of the transfer in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_transfers">create_transfers
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfers <span class="op">=</span> [{</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span>n<span class="op">,</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">3</span>n<span class="op">,</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>}]<span class="op">;</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>(batch)<span class="op">;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">const</span> error <span class="kw">of</span> transfer_errors) {</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span> (error<span class="op">.</span><span class="at">result</span>) {</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> CreateTransferError<span class="op">.</span><span class="at">exists</span><span class="op">:</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="vs">`Batch transfer at </span><span class="sc">${</span>error<span class="op">.</span><span class="at">index</span><span class="sc">}</span><span class="vs"> already exists.`</span>)<span class="op">;</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span><span class="op">;</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`Batch transfer at </span><span class="sc">${</span>error<span class="op">.</span><span class="at">index</span><span class="sc">}</span><span class="vs"> failed to create: </span><span class="sc">${</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>          CreateTransferError[error<span class="op">.</span><span class="at">result</span>]</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        <span class="sc">}</span><span class="vs">.`</span><span class="op">,</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>To handle errors you can either 1) exactly match error codes returned
from <code>client.createTransfers</code> with enum values in the
<code>CreateTransferError</code> object, or you can 2) look up the error
code in the <code>CreateTransferError</code> object for a human-readable
string.</p>
<h2 id="coding-clients-node-batching"><a href="#coding-clients-node-batching" class="anchor">Batching</a></h2>
<p>TigerBeetle performance is maximized when you batch API requests. The
client does not do this automatically for you. So, for example, you
<em>can</em> insert 1 million transfers one at a time like so:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> batch <span class="op">=</span> []<span class="op">;</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> batch<span class="op">.</span><span class="at">len</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>(batch[i])<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Error handling omitted.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<p>But the insert rate will be a <em>fraction</em> of potential.
Instead, <strong>always batch what you can</strong>.</p>
<p>The maximum batch size is set in the TigerBeetle server. The default
is 8190.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb12"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> batch <span class="op">=</span> []<span class="op">;</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> BATCH_SIZE <span class="op">=</span> <span class="dv">8190</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> batch<span class="op">.</span><span class="at">length</span><span class="op">;</span> i <span class="op">+=</span> BATCH_SIZE) {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    batch<span class="op">.</span><span class="fu">slice</span>(i<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(batch<span class="op">.</span><span class="at">length</span><span class="op">,</span> BATCH_SIZE))<span class="op">,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Error handling omitted.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<h3 id="coding-clients-node-queues-and-workers"><a href="#coding-clients-node-queues-and-workers"
class="anchor">Queues and Workers</a></h3>
<p>If you are making requests to TigerBeetle from workers pulling jobs
from a queue, you can batch requests to TigerBeetle by having the worker
act on multiple jobs from the queue at once rather than one at a time.
i.e. pulling multiple jobs from the queue rather than just one.</p>
<h2 id="coding-clients-node-transfer-flags"><a href="#coding-clients-node-transfer-flags"
class="anchor">Transfer Flags</a></h2>
<p>The transfer <code>flags</code> value is a bitfield. See details for
these flags in the <a href="#reference-transfer-flags">Transfers
reference</a>.</p>
<p>To toggle behavior for a transfer, combine enum values stored in the
<code>TransferFlags</code> object (in TypeScript it is an actual enum)
with bitwise-or:</p>
<ul>
<li><code>TransferFlags.linked</code></li>
<li><code>TransferFlags.pending</code></li>
<li><code>TransferFlags.post_pending_transfer</code></li>
<li><code>TransferFlags.void_pending_transfer</code></li>
</ul>
<p>For example, to link <code>transfer0</code> and
<code>transfer1</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb13"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer0 <span class="op">=</span> {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">4</span>n<span class="op">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> TransferFlags<span class="op">.</span><span class="at">linked</span><span class="op">,</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer1 <span class="op">=</span> {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">5</span>n<span class="op">,</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Create the transfer</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>([transfer0<span class="op">,</span> transfer1])<span class="op">;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-node-two-phase-transfers"><a href="#coding-clients-node-two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h3>
<p>Two-phase transfers are supported natively by toggling the
appropriate flag. TigerBeetle will then adjust the
<code>credits_pending</code> and <code>debits_pending</code> fields of
the appropriate accounts. A corresponding post pending transfer then
needs to be sent to post or void the transfer.</p>
<h4 id="coding-clients-node-post-a-pending-transfer"><a href="#coding-clients-node-post-a-pending-transfer"
class="anchor">Post a Pending Transfer</a></h4>
<p>With <code>flags</code> set to <code>post_pending_transfer</code>,
TigerBeetle will post the transfer. TigerBeetle will atomically roll
back the changes to <code>debits_pending</code> and
<code>credits_pending</code> of the appropriate accounts and apply them
to the <code>debits_posted</code> and <code>credits_posted</code>
balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb14"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer0 <span class="op">=</span> {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">6</span>n<span class="op">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> TransferFlags<span class="op">.</span><span class="at">pending</span><span class="op">,</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>([transfer0])<span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer1 <span class="op">=</span> {</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">7</span>n<span class="op">,</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Post the entire pending amount.</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> amount_max<span class="op">,</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">6</span>n<span class="op">,</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> TransferFlags<span class="op">.</span><span class="at">post_pending_transfer</span><span class="op">,</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>([transfer1])<span class="op">;</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h4 id="coding-clients-node-void-a-pending-transfer"><a href="#coding-clients-node-void-a-pending-transfer"
class="anchor">Void a Pending Transfer</a></h4>
<p>In contrast, with <code>flags</code> set to
<code>void_pending_transfer</code>, TigerBeetle will void the transfer.
TigerBeetle will roll back the changes to <code>debits_pending</code>
and <code>credits_pending</code> of the appropriate accounts and
<strong>not</strong> apply them to the <code>debits_posted</code> and
<code>credits_posted</code> balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb15"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer0 <span class="op">=</span> {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">8</span>n<span class="op">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> TransferFlags<span class="op">.</span><span class="at">pending</span><span class="op">,</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>([transfer0])<span class="op">;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer1 <span class="op">=</span> {</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">id</span><span class="op">:</span> <span class="dv">9</span>n<span class="op">,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">debit_account_id</span><span class="op">:</span> <span class="dv">102</span>n<span class="op">,</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">credit_account_id</span><span class="op">:</span> <span class="dv">103</span>n<span class="op">,</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">amount</span><span class="op">:</span> <span class="dv">10</span>n<span class="op">,</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pending_id</span><span class="op">:</span> <span class="dv">8</span>n<span class="op">,</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeout</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">720</span><span class="op">,</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> TransferFlags<span class="op">.</span><span class="at">void_pending_transfer</span><span class="op">,</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>([transfer1])<span class="op">;</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-transfer-lookup"><a href="#coding-clients-node-transfer-lookup"
class="anchor">Transfer Lookup</a></h2>
<p>NOTE: While transfer lookup exists, it is not a flexible query API.
We are developing query APIs and there will be new methods for querying
transfers in the future.</p>
<p>Transfer lookup is batched, like transfer creation. Pass in all
<code>id</code>s to fetch, and matched transfers are returned.</p>
<p>If no transfer matches an <code>id</code>, no object is returned for
that transfer. So the order of transfers in the response is not
necessarily the same as the order of <code>id</code>s in the request.
You can refer to the <code>id</code> field in the response to
distinguish transfers.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb16"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfers <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">lookupTransfers</span>([<span class="dv">1</span>n<span class="op">,</span> <span class="dv">2</span>n])<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-get-account-transfers"><a href="#coding-clients-node-get-account-transfers"
class="anchor">Get Account Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the transfers involving a given account, allowing basic
filter and pagination capabilities.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb17"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> filter <span class="op">=</span> {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">account_id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Code.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_min</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_max</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> AccountFilterFlags<span class="op">.</span><span class="at">debits</span> <span class="op">|</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    AccountFilterFlags<span class="op">.</span><span class="at">credits</span> <span class="op">|</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    AccountFilterFlags<span class="op">.</span><span class="at">reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account_transfers <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">getAccountTransfers</span>(filter)<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-get-account-balances"><a href="#coding-clients-node-get-account-balances"
class="anchor">Get Account Balances</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the point-in-time balances of a given account, allowing basic
filter and pagination capabilities.</p>
<p>Only accounts created with the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set
retain <a href="#reference-requests-get_account_balances">historical
balances</a>.</p>
<p>The balances in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb18"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> filter <span class="op">=</span> {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">account_id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Code.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_min</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_max</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> AccountFilterFlags<span class="op">.</span><span class="at">debits</span> <span class="op">|</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    AccountFilterFlags<span class="op">.</span><span class="at">credits</span> <span class="op">|</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    AccountFilterFlags<span class="op">.</span><span class="at">reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account_balances <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">getAccountBalances</span>(filter)<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-query-accounts"><a href="#coding-clients-node-query-accounts" class="anchor">Query
Accounts</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query accounts by the intersection of some fields and by timestamp
range.</p>
<p>The accounts in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb19"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> query_filter <span class="op">=</span> {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">1000</span>n<span class="op">,</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">100</span>n<span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// Filter by Code.</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Ledger.</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_min</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_max</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> QueryFilterFlags<span class="op">.</span><span class="at">reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> query_accounts <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">queryAccounts</span>(query_filter)<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-query-transfers"><a href="#coding-clients-node-query-transfers" class="anchor">Query
Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query transfers by the intersection of some fields and by timestamp
range.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb20"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> query_filter <span class="op">=</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_128</span><span class="op">:</span> <span class="dv">1000</span>n<span class="op">,</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_64</span><span class="op">:</span> <span class="dv">100</span>n<span class="op">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">user_data_32</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// Filter by Code.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ledger</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Ledger.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_min</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timestamp_max</span><span class="op">:</span> <span class="dv">0</span>n<span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">flags</span><span class="op">:</span> QueryFilterFlags<span class="op">.</span><span class="at">reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> query_transfers <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">queryTransfers</span>(query_filter)<span class="op">;</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-linked-events"><a href="#coding-clients-node-linked-events" class="anchor">Linked
Events</a></h2>
<p>When the <code>linked</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it links that
event with the next event in the batch, to create a chain of events, of
arbitrary length, which all succeed or fail together. The tail of a
chain is denoted by the first event without this flag. The last event in
a batch may therefore never have the <code>linked</code> flag set as
this would leave a chain open-ended. Multiple chains or individual
events may coexist within a batch to succeed or fail independently.</p>
<p>Events within a chain are executed within order, or are rolled back
on error, so that the effect of each event in the chain is visible to
the next, and so that the chain is either visible or invisible as a unit
to subsequent events after the chain. The event that was the first to
break the chain will have a unique error result. Other events in the
chain will have their error result set to
<code>linked_event_failed</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb21"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> batch <span class="op">=</span> []<span class="op">;</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> linkedFlag <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>linkedFlag <span class="op">|=</span> TransferFlags<span class="op">.</span><span class="at">linked</span><span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span>n <span class="co">/* , ... */</span> })<span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 4 transfers (the last transfer in the chain closes the chain with linked=false):</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> linkedFlag })<span class="op">;</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">3</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> linkedFlag })<span class="op">;</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> linkedFlag })<span class="op">;</span> <span class="co">// Fail with exists</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">4</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span> <span class="co">// Fail without committing.</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">// This should not see any effect from the failed chain above.</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (the first transfer fails the chain):</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">2</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> linkedFlag })<span class="op">;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">3</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (successful):</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">3</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> linkedFlag })<span class="op">;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">push</span>({ <span class="dt">id</span><span class="op">:</span> <span class="dv">4</span>n<span class="op">,</span> <span class="co">/* ..., */</span> <span class="dt">flags</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">;</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>(batch)<span class="op">;</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-node-imported-events"><a href="#coding-clients-node-imported-events"
class="anchor">Imported Events</a></h2>
<p>When the <code>imported</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it allows
importing historical events with a user-defined timestamp.</p>
<p>The entire batch of events must be set with the flag
<code>imported</code>.</p>
<p>It‚Äôs recommended to submit the whole batch as a <code>linked</code>
chain of events, ensuring that if any event fails, none of them are
committed, preserving the last timestamp unchanged. This approach gives
the application a chance to correct failed imported events,
re-submitting the batch again with the same user-defined timestamps.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb22"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// External source of time.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> historical_timestamp <span class="op">=</span> <span class="dv">0</span>n</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Events loaded from an external source.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> historical_accounts <span class="op">=</span> []<span class="op">;</span> <span class="co">// Loaded from an external source.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> historical_transfers <span class="op">=</span> []<span class="op">;</span> <span class="co">// Loaded from an external source.</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">// First, load and import all accounts with their timestamps from the historical source.</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> accounts <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> historical_accounts<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> account <span class="op">=</span> historical_accounts[i]<span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  historical_timestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  account<span class="op">.</span><span class="at">timestamp</span> <span class="op">=</span> historical_timestamp<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set the account as `imported`.</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  account<span class="op">.</span><span class="at">flags</span> <span class="op">=</span> AccountFlags<span class="op">.</span><span class="at">imported</span><span class="op">;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// must be `linked`.</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (index <span class="op">&lt;</span> historical_accounts<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span><span class="at">flags</span> <span class="op">|=</span> AccountFlags<span class="op">.</span><span class="at">linked</span><span class="op">;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  accounts<span class="op">.</span><span class="fu">push</span>(account)<span class="op">;</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> account_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createAccounts</span>(accounts)<span class="op">;</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Then, load and import all transfers with their timestamps from the historical source.</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfers <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> historical_transfers<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> transfer <span class="op">=</span> historical_transfers[i]<span class="op">;</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  historical_timestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  transfer<span class="op">.</span><span class="at">timestamp</span> <span class="op">=</span> historical_timestamp<span class="op">;</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set the account as `imported`.</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  transfer<span class="op">.</span><span class="at">flags</span> <span class="op">=</span> TransferFlags<span class="op">.</span><span class="at">imported</span><span class="op">;</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// must be `linked`.</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (index <span class="op">&lt;</span> historical_transfers<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span><span class="at">flags</span> <span class="op">|=</span> TransferFlags<span class="op">.</span><span class="at">linked</span><span class="op">;</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  transfers<span class="op">.</span><span class="fu">push</span>(transfer)<span class="op">;</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> transfer_errors <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">createTransfers</span>(transfers)<span class="op">;</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a><span class="co">// Since it is a linked chain, in case of any error the entire batch is rolled back and can be retried</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a><span class="co">// with the same historical timestamps without regressing the cluster timestamp.</span></span></code></pre></div>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/src/clients/node/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->

<h1 id="coding-clients-python"><a href="#coding-clients-python"
class="anchor">tigerbeetle</a></h1>
<p>The TigerBeetle client for Python.</p>
<h2 id="coding-clients-python-prerequisites"><a href="#coding-clients-python-prerequisites"
class="anchor">Prerequisites</a></h2>
<p>Linux &gt;= 5.6 is the only production environment we support. But
for ease of development we also support macOS and Windows.</p>
<ul>
<li>Python (or PyPy, etc) &gt;= <code>3.7</code></li>
</ul>
<h2 id="coding-clients-python-setup"><a href="#coding-clients-python-setup" class="anchor">Setup</a></h2>
<p>First, create a directory for your project and <code>cd</code> into
the directory.</p>
<p>Then, install the TigerBeetle client:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>pip install tigerbeetle</code></pre>
</div>
<p>Now, create <code>main.py</code> and copy this into it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tigerbeetle <span class="im">as</span> tb</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Import OK!&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># To enable debug logging, via Python&#39;s built in logging module:</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># logging.basicConfig(level=logging.DEBUG)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tb.configure_logging(debug=True)</span></span></code></pre></div>
</div>
<p>Finally, build and run:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>python3 main.py</code></pre>
</div>
<p>Now that all prerequisites and dependencies are correctly set up,
let‚Äôs dig into using TigerBeetle.</p>
<h2 id="coding-clients-python-sample-projects"><a href="#coding-clients-python-sample-projects"
class="anchor">Sample projects</a></h2>
<p>This document is primarily a reference guide to the client. Below are
various sample projects demonstrating features of TigerBeetle.</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/python/samples/basic/">Basic</a>:
Create two accounts and transfer an amount between them.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/python/samples/two-phase/">Two-Phase
Transfer</a>: Create two accounts and start a pending transfer between
them, then post the transfer.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/python/samples/two-phase-many/">Many
Two-Phase Transfers</a>: Create two accounts and start a number of
pending transfer between them, posting and voiding alternating
transfers.</li>
</ul>
<h2 id="coding-clients-python-creating-a-client"><a href="#coding-clients-python-creating-a-client"
class="anchor">Creating a Client</a></h2>
<p>A client is created with a cluster ID and replica addresses for all
replicas in the cluster. The cluster ID and replica addresses are both
chosen by the system that starts the TigerBeetle cluster.</p>
<p>Clients are thread-safe and a single instance should be shared
between multiple concurrent tasks.</p>
<p>Multiple clients are useful when connecting to more than one
TigerBeetle cluster.</p>
<p>In this example the cluster ID is <code>0</code> and there is one
replica. The address is read from the <code>TB_ADDRESS</code>
environment variable and defaults to port <code>3000</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tb.ClientSync(cluster_id<span class="op">=</span><span class="dv">0</span>, replica_addresses<span class="op">=</span>os.getenv(<span class="st">&quot;TB_ADDRESS&quot;</span>, <span class="st">&quot;3000&quot;</span>)) <span class="im">as</span> client:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the client.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span></code></pre></div>
</div>
<p>The following are valid addresses:</p>
<ul>
<li><code>3000</code> (interpreted as <code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1:3000</code> (interpreted as
<code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1</code> (interpreted as <code>127.0.0.1:3001</code>,
<code>3001</code> is the default port)</li>
</ul>
<h2 id="coding-clients-python-creating-accounts"><a href="#coding-clients-python-creating-accounts"
class="anchor">Creating Accounts</a></h2>
<p>See details for account fields in the <a
href="#reference-account">Accounts reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>account <span class="op">=</span> tb.Account(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span>tb.<span class="bu">id</span>(), <span class="co"># TigerBeetle time-based ID.</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    debits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    debits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    credits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    credits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">718</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>account_errors <span class="op">=</span> client.create_accounts([account])</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-python-account-flags"><a href="#coding-clients-python-account-flags" class="anchor">Account
Flags</a></h3>
<p>The account flags value is a bitfield. See details for these flags in
the <a href="#reference-account-flags">Accounts reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>AccountFlags</code> object (it‚Äôs an <code>enum.IntFlag</code>)
with bitwise-or:</p>
<ul>
<li><code>AccountFlags.linked</code></li>
<li><code>AccountFlags.debits_must_not_exceed_credits</code></li>
<li><code>AccountFlags.credits_must_not_exceed_credits</code></li>
<li><code>AccountFlags.history</code></li>
</ul>
<p>For example, to link two accounts where the first account
additionally has the <code>debits_must_not_exceed_credits</code>
constraint:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>account0 <span class="op">=</span> tb.Account(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    debits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    debits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    credits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    credits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.AccountFlags.LINKED <span class="op">|</span> tb.AccountFlags.DEBITS_MUST_NOT_EXCEED_CREDITS,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>account1 <span class="op">=</span> tb.Account(</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">101</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    debits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    debits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    credits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    credits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.AccountFlags.HISTORY,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>account_errors <span class="op">=</span> client.create_accounts([account0, account1])</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-python-response-and-errors"><a href="#coding-clients-python-response-and-errors"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all accounts were created
successfully. If the response is non-empty, each object in the response
array contains error information for an account that failed. The error
object contains an error code and the index of the account in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_accounts">create_accounts
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>account0 <span class="op">=</span> tb.Account(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    debits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    debits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    credits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    credits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>account1 <span class="op">=</span> tb.Account(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    debits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    debits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    credits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    credits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>account2 <span class="op">=</span> tb.Account(</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">104</span>,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    debits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    debits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    credits_pending<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    credits_posted<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>account_errors <span class="op">=</span> client.create_accounts([account0, account1, account2])</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> error <span class="kw">in</span> account_errors:</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> error.result <span class="op">==</span> tb.CreateAccountResult.EXISTS:</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Batch account at </span><span class="sc">{</span>error<span class="sc">.</span>index<span class="sc">}</span><span class="ss"> already exists.&quot;</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Batch account at $</span><span class="sc">{</span>error<span class="sc">.</span>index<span class="sc">}</span><span class="ss"> failed to create: </span><span class="sc">{</span>error<span class="sc">.</span>result<span class="sc">}</span><span class="ss">.&quot;</span>)</span></code></pre></div>
</div>
<p>To handle errors you can compare the result code returned from
<code>client.create_accounts</code> with enum values in the
<code>CreateAccountResult</code> object.</p>
<h2 id="coding-clients-python-account-lookup"><a href="#coding-clients-python-account-lookup" class="anchor">Account
Lookup</a></h2>
<p>Account lookup is batched, like account creation. Pass in all IDs to
fetch. The account for each matched ID is returned.</p>
<p>If no account matches an ID, no object is returned for that account.
So the order of accounts in the response is not necessarily the same as
the order of IDs in the request. You can refer to the ID field in the
response to distinguish accounts.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>accounts <span class="op">=</span> client.lookup_accounts([<span class="dv">100</span>, <span class="dv">101</span>])</span></code></pre></div>
</div>
<h2 id="coding-clients-python-create-transfers"><a href="#coding-clients-python-create-transfers"
class="anchor">Create Transfers</a></h2>
<p>This creates a journal entry between two accounts.</p>
<p>See details for transfer fields in the <a
href="#reference-transfer">Transfers reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">=</span> [tb.Transfer(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span>tb.<span class="bu">id</span>(), <span class="co"># TigerBeetle time-based ID.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers(transfers)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="coding-clients-python-response-and-errors-1"><a href="#coding-clients-python-response-and-errors-1"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all transfers were created
successfully. If the response is non-empty, each object in the response
array contains error information for a transfer that failed. The error
object contains an error code and the index of the transfer in the
request batch.</p>
<p>See all error conditions in the <a
href="#reference-requests-create_transfers">create_transfers
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> [tb.Transfer(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    tb.Transfer(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    tb.Transfer(</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers(batch)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> error <span class="kw">in</span> transfer_errors:</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> error.result <span class="op">==</span> tb.CreateTransferResult.EXISTS:</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Batch transfer at </span><span class="sc">{</span>error<span class="sc">.</span>index<span class="sc">}</span><span class="ss"> already exists.&quot;</span>)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Batch transfer at </span><span class="sc">{</span>error<span class="sc">.</span>index<span class="sc">}</span><span class="ss"> failed to create: </span><span class="sc">{</span>error<span class="sc">.</span>result<span class="sc">}</span><span class="ss">.&quot;</span>)</span></code></pre></div>
</div>
<p>To handle errors you can compare the result code returned from
<code>client.create_transfers</code> with enum values in the
<code>CreateTransferResult</code> object.</p>
<h2 id="coding-clients-python-batching"><a href="#coding-clients-python-batching" class="anchor">Batching</a></h2>
<p>TigerBeetle performance is maximized when you batch API requests. The
client does not do this automatically for you. So, for example, you
<em>can</em> insert 1 million transfers one at a time like so:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> [] <span class="co"># Array of transfer to create.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> transfer <span class="kw">in</span> batch:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    transfer_errors <span class="op">=</span> client.create_transfers([transfer])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<p>But the insert rate will be a <em>fraction</em> of potential.
Instead, <strong>always batch what you can</strong>.</p>
<p>The maximum batch size is set in the TigerBeetle server. The default
is 8190.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> [] <span class="co"># Array of transfer to create.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">8190</span> <span class="co">#FIXME</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(batch), BATCH_SIZE):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    transfer_errors <span class="op">=</span> client.create_transfers(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        batch[i:<span class="bu">min</span>(<span class="bu">len</span>(batch), BATCH_SIZE)],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-python-queues-and-workers"><a href="#coding-clients-python-queues-and-workers"
class="anchor">Queues and Workers</a></h3>
<p>If you are making requests to TigerBeetle from workers pulling jobs
from a queue, you can batch requests to TigerBeetle by having the worker
act on multiple jobs from the queue at once rather than one at a time.
i.e. pulling multiple jobs from the queue rather than just one.</p>
<h2 id="coding-clients-python-transfer-flags"><a href="#coding-clients-python-transfer-flags"
class="anchor">Transfer Flags</a></h2>
<p>The transfer <code>flags</code> value is a bitfield. See details for
these flags in the <a href="#reference-transfer-flags">Transfers
reference</a>.</p>
<p>To toggle behavior for a transfer, combine enum values stored in the
<code>TransferFlags</code> object (it‚Äôs an <code>enum.IntFlag</code>)
with bitwise-or:</p>
<ul>
<li><code>TransferFlags.linked</code></li>
<li><code>TransferFlags.pending</code></li>
<li><code>TransferFlags.post_pending_transfer</code></li>
<li><code>TransferFlags.void_pending_transfer</code></li>
</ul>
<p>For example, to link <code>transfer0</code> and
<code>transfer1</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>transfer0 <span class="op">=</span> tb.Transfer(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.TransferFlags.LINKED,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>transfer1 <span class="op">=</span> tb.Transfer(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the transfer</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers([transfer0, transfer1])</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="coding-clients-python-two-phase-transfers"><a href="#coding-clients-python-two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h3>
<p>Two-phase transfers are supported natively by toggling the
appropriate flag. TigerBeetle will then adjust the
<code>credits_pending</code> and <code>debits_pending</code> fields of
the appropriate accounts. A corresponding post pending transfer then
needs to be sent to post or void the transfer.</p>
<h4 id="coding-clients-python-post-a-pending-transfer"><a href="#coding-clients-python-post-a-pending-transfer"
class="anchor">Post a Pending Transfer</a></h4>
<p>With <code>flags</code> set to <code>post_pending_transfer</code>,
TigerBeetle will post the transfer. TigerBeetle will atomically roll
back the changes to <code>debits_pending</code> and
<code>credits_pending</code> of the appropriate accounts and apply them
to the <code>debits_posted</code> and <code>credits_posted</code>
balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>transfer0 <span class="op">=</span> tb.Transfer(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.TransferFlags.PENDING,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers([transfer0])</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>transfer1 <span class="op">=</span> tb.Transfer(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">7</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Post the entire pending amount.</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span>tb.amount_max,</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.TransferFlags.POST_PENDING_TRANSFER,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers([transfer1])</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<h4 id="coding-clients-python-void-a-pending-transfer"><a href="#coding-clients-python-void-a-pending-transfer"
class="anchor">Void a Pending Transfer</a></h4>
<p>In contrast, with <code>flags</code> set to
<code>void_pending_transfer</code>, TigerBeetle will void the transfer.
TigerBeetle will roll back the changes to <code>debits_pending</code>
and <code>credits_pending</code> of the appropriate accounts and
<strong>not</strong> apply them to the <code>debits_posted</code> and
<code>credits_posted</code> balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>transfer0 <span class="op">=</span> tb.Transfer(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.TransferFlags.PENDING,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers([transfer0])</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>transfer1 <span class="op">=</span> tb.Transfer(</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span><span class="op">=</span><span class="dv">9</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    debit_account_id<span class="op">=</span><span class="dv">102</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    credit_account_id<span class="op">=</span><span class="dv">103</span>,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    pending_id<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    timeout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">720</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.TransferFlags.VOID_PENDING_TRANSFER,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers([transfer1])</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-python-transfer-lookup"><a href="#coding-clients-python-transfer-lookup"
class="anchor">Transfer Lookup</a></h2>
<p>NOTE: While transfer lookup exists, it is not a flexible query API.
We are developing query APIs and there will be new methods for querying
transfers in the future.</p>
<p>Transfer lookup is batched, like transfer creation. Pass in all
<code>id</code>s to fetch, and matched transfers are returned.</p>
<p>If no transfer matches an <code>id</code>, no object is returned for
that transfer. So the order of transfers in the response is not
necessarily the same as the order of <code>id</code>s in the request.
You can refer to the <code>id</code> field in the response to
distinguish transfers.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">=</span> client.lookup_transfers([<span class="dv">1</span>, <span class="dv">2</span>])</span></code></pre></div>
</div>
<h2 id="coding-clients-python-get-account-transfers"><a href="#coding-clients-python-get-account-transfers"
class="anchor">Get Account Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the transfers involving a given account, allowing basic
filter and pagination capabilities.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> tb.AccountFilter(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    account_id<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by UserData.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Code.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    timestamp_min<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    timestamp_max<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>, <span class="co"># Limit to ten balances at most.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.AccountFilterFlags.DEBITS <span class="op">|</span> <span class="co"># Include transfer from the debit side.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    tb.AccountFilterFlags.CREDITS <span class="op">|</span> <span class="co"># Include transfer from the credit side.</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    tb.AccountFilterFlags.REVERSED, <span class="co"># Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>account_transfers <span class="op">=</span> client.get_account_transfers(<span class="bu">filter</span>)</span></code></pre></div>
</div>
<h2 id="coding-clients-python-get-account-balances"><a href="#coding-clients-python-get-account-balances"
class="anchor">Get Account Balances</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the point-in-time balances of a given account, allowing basic
filter and pagination capabilities.</p>
<p>Only accounts created with the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set
retain <a href="#reference-requests-get_account_balances">historical
balances</a>.</p>
<p>The balances in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">filter</span> <span class="op">=</span> tb.AccountFilter(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    account_id<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by UserData.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Code.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    timestamp_min<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    timestamp_max<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>, <span class="co"># Limit to ten balances at most.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.AccountFilterFlags.DEBITS <span class="op">|</span> <span class="co"># Include transfer from the debit side.</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    tb.AccountFilterFlags.CREDITS <span class="op">|</span> <span class="co"># Include transfer from the credit side.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    tb.AccountFilterFlags.REVERSED, <span class="co"># Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>account_balances <span class="op">=</span> client.get_account_balances(<span class="bu">filter</span>)</span></code></pre></div>
</div>
<h2 id="coding-clients-python-query-accounts"><a href="#coding-clients-python-query-accounts" class="anchor">Query
Accounts</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query accounts by the intersection of some fields and by timestamp
range.</p>
<p>The accounts in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>query_filter <span class="op">=</span> tb.QueryFilter(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">1000</span>, <span class="co"># Filter by UserData.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>, <span class="co"># Filter by Code.</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Ledger.</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    timestamp_min<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    timestamp_max<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>, <span class="co"># Limit to ten balances at most.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.QueryFilterFlags.REVERSED, <span class="co"># Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>query_accounts <span class="op">=</span> client.query_accounts(query_filter)</span></code></pre></div>
</div>
<h2 id="coding-clients-python-query-transfers"><a href="#coding-clients-python-query-transfers" class="anchor">Query
Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query transfers by the intersection of some fields and by timestamp
range.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>query_filter <span class="op">=</span> tb.QueryFilter(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    user_data_128<span class="op">=</span><span class="dv">1000</span>, <span class="co"># Filter by UserData.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    user_data_64<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    user_data_32<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    code<span class="op">=</span><span class="dv">1</span>, <span class="co"># Filter by Code.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    ledger<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Ledger.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    timestamp_min<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    timestamp_max<span class="op">=</span><span class="dv">0</span>, <span class="co"># No filter by Timestamp.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">=</span><span class="dv">10</span>, <span class="co"># Limit to ten balances at most.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    flags<span class="op">=</span>tb.QueryFilterFlags.REVERSED, <span class="co"># Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>query_transfers <span class="op">=</span> client.query_transfers(query_filter)</span></code></pre></div>
</div>
<h2 id="coding-clients-python-linked-events"><a href="#coding-clients-python-linked-events" class="anchor">Linked
Events</a></h2>
<p>When the <code>linked</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it links that
event with the next event in the batch, to create a chain of events, of
arbitrary length, which all succeed or fail together. The tail of a
chain is denoted by the first event without this flag. The last event in
a batch may therefore never have the <code>linked</code> flag set as
this would leave a chain open-ended. Multiple chains or individual
events may coexist within a batch to succeed or fail independently.</p>
<p>Events within a chain are executed within order, or are rolled back
on error, so that the effect of each event in the chain is visible to
the next, and so that the chain is either visible or invisible as a unit
to subsequent events after the chain. The event that was the first to
break the chain will have a unique error result. Other events in the
chain will have their error result set to
<code>linked_event_failed</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>batch <span class="op">=</span> [] <span class="co"># List of tb.Transfers to create.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>linkedFlag <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>linkedFlag <span class="op">|=</span> tb.TransferFlags.LINKED</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># An individual transfer (successful):</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># A chain of 4 transfers (the last transfer in the chain closes the chain with linked=false):</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">2</span>, flags<span class="op">=</span>linkedFlag)) <span class="co"># Commit/rollback.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">3</span>, flags<span class="op">=</span>linkedFlag)) <span class="co"># Commit/rollback.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">2</span>, flags<span class="op">=</span>linkedFlag)) <span class="co"># Fail with exists</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">4</span>, flags<span class="op">=</span><span class="dv">0</span>)) <span class="co"># Fail without committing.</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># An individual transfer (successful):</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># This should not see any effect from the failed chain above.</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">2</span>, flags<span class="op">=</span><span class="dv">0</span> ))</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># A chain of 2 transfers (the first transfer fails the chain):</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">2</span>, flags<span class="op">=</span>linkedFlag))</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">3</span>, flags<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># A chain of 2 transfers (successful):</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">3</span>, flags<span class="op">=</span>linkedFlag))</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>batch.append(tb.Transfer(<span class="bu">id</span><span class="op">=</span><span class="dv">4</span>, flags<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers(batch)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="coding-clients-python-imported-events"><a href="#coding-clients-python-imported-events"
class="anchor">Imported Events</a></h2>
<p>When the <code>imported</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it allows
importing historical events with a user-defined timestamp.</p>
<p>The entire batch of events must be set with the flag
<code>imported</code>.</p>
<p>It‚Äôs recommended to submit the whole batch as a <code>linked</code>
chain of events, ensuring that if any event fails, none of them are
committed, preserving the last timestamp unchanged. This approach gives
the application a chance to correct failed imported events,
re-submitting the batch again with the same user-defined timestamps.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># External source of time.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>historical_timestamp <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Events loaded from an external source.</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>historical_accounts <span class="op">=</span> [] <span class="co"># Loaded from an external source.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>historical_transfers <span class="op">=</span> [] <span class="co"># Loaded from an external source.</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># First, load and import all accounts with their timestamps from the historical source.</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>accounts <span class="op">=</span> []</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, account <span class="kw">in</span> <span class="bu">enumerate</span>(historical_accounts):</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set a unique and strictly increasing timestamp.</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    historical_timestamp <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    account.timestamp <span class="op">=</span> historical_timestamp</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the account as `imported`.</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    account.flags <span class="op">=</span> tb.AccountFlags.IMPORTED</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># must be `linked`.</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> index <span class="op">&lt;</span> <span class="bu">len</span>(historical_accounts) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        account.flags <span class="op">|=</span> tb.AccountFlags.LINKED</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    accounts.append(account)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>account_errors <span class="op">=</span> client.create_accounts(accounts)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The, load and import all transfers with their timestamps from the historical source.</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>transfers <span class="op">=</span> []</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, transfer <span class="kw">in</span> <span class="bu">enumerate</span>(historical_transfers):</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set a unique and strictly increasing timestamp.</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    historical_timestamp <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    transfer.timestamp <span class="op">=</span> historical_timestamp</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the account as `imported`.</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    transfer.flags <span class="op">=</span> tb.TransferFlags.IMPORTED</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># must be `linked`.</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> index <span class="op">&lt;</span> <span class="bu">len</span>(historical_transfers) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        transfer.flags <span class="op">|=</span> tb.AccountFlags.LINKED</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    transfers.append(transfer)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>transfer_errors <span class="op">=</span> client.create_transfers(transfers)</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Error handling omitted.</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Since it is a linked chain, in case of any error the entire batch is rolled back and can be retried</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="co"># with the same historical timestamps without regressing the cluster timestamp.</span></span></code></pre></div>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/src/clients/python/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating"><a href="#operating"
class="anchor">Operating</a></h1>
<p>This section is for anyone managing their own TigerBeetle cluster.
While tiger beetles thrive even in the harshest conditions, there‚Äôs
certainly a preferred way to handle one!</p>
<ul>
<li><a href="#operating-installing">Installing</a> list all the various way to
get the freshest TigerBeetle binary.</li>
<li><a href="#operating-hardware">Hardware</a> specifies the host
requirements.</li>
<li><a href="#operating-cluster">Cluster</a> specifies the overall cluster
requirements and recommendations.</li>
<li><a href="#operating-deploying">Deploying</a> spells out deployment process
and its variations.</li>
<li><a href="#operating-upgrading">Upgrading</a> explains how to move to a newer
TigerBeetle version without downtime.</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-installing"><a href="#operating-installing"
class="anchor">Installing</a></h1>
<h2 id="operating-installing-quick-install"><a href="#operating-installing-quick-install" class="anchor">Quick
Install</a></h2>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code># macOS
curl -Lo tigerbeetle.zip https://mac.tigerbeetle.com &amp;&amp; unzip tigerbeetle.zip &amp;&amp; ./tigerbeetle version</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code># Linux
curl -Lo tigerbeetle.zip https://linux.tigerbeetle.com &amp;&amp; unzip tigerbeetle.zip &amp;&amp; ./tigerbeetle version</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code># Windows
powershell -command &quot;curl.exe -Lo tigerbeetle.zip https://windows.tigerbeetle.com; Expand-Archive tigerbeetle.zip .; .\tigerbeetle version&quot;</code></pre>
</div>
<h2 id="operating-installing-latest-release"><a href="#operating-installing-latest-release" class="anchor">Latest
Release</a></h2>
<p>You can download prebuilt binaries for the latest release here:</p>
<div class="table">
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">Linux</th>
<th style="text-align: left;">Windows</th>
<th style="text-align: left;">MacOS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">x86_64</td>
<td style="text-align: left;"><a
href="https://github.com/tigerbeetle/tigerbeetle/releases/latest/download/tigerbeetle-x86_64-linux.zip">tigerbeetle-x86_64-linux.zip</a></td>
<td style="text-align: left;"><a
href="https://github.com/tigerbeetle/tigerbeetle/releases/latest/download/tigerbeetle-x86_64-windows.zip">tigerbeetle-x86_64-windows.zip</a></td>
<td style="text-align: left;"><a
href="https://github.com/tigerbeetle/tigerbeetle/releases/latest/download/tigerbeetle-universal-macos.zip">tigerbeetle-universal-macos.zip</a></td>
</tr>
<tr>
<td style="text-align: left;">aarch64</td>
<td style="text-align: left;"><a
href="https://github.com/tigerbeetle/tigerbeetle/releases/latest/download/tigerbeetle-aarch64-linux.zip">tigerbeetle-aarch64-linux.zip</a></td>
<td style="text-align: left;">N/A</td>
<td style="text-align: left;"><a
href="https://github.com/tigerbeetle/tigerbeetle/releases/latest/download/tigerbeetle-universal-macos.zip">tigerbeetle-universal-macos.zip</a></td>
</tr>
</tbody>
</table>
</div>
<h2 id="operating-installing-past-releases"><a href="#operating-installing-past-releases" class="anchor">Past
Releases</a></h2>
<p>The releases page lists all past and current releases:</p>
<p><a
href="https://github.com/tigerbeetle/tigerbeetle/releases">https://github.com/tigerbeetle/tigerbeetle/releases</a></p>
<p>TigerBeetle can be upgraded without downtime, this is documented in
<a href="#operating-upgrading">Upgrading</a>.</p>
<h2 id="operating-installing-building-from-source"><a href="#operating-installing-building-from-source"
class="anchor">Building from Source</a></h2>
<p>Building from source is easy, but is not recommended for production
deployments, as extra care is needed to ensure compatibility with
clients and upgradability. Refer to the <a
href="https://github.com/tigerbeetle/tigerbeetle/tree/main/docs/internal">internal
documentation</a> for compilation instructions.</p>
<h2 id="operating-installing-client-libraries"><a href="#operating-installing-client-libraries"
class="anchor">Client Libraries</a></h2>
<p>Client libraries for .Net, Go, Java, Node, and Python are published
to the respective package repositories, see <a
href="#coding-clients">Clients</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/installing.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-hardware"><a href="#operating-hardware" class="anchor">Hardware</a></h1>
<p>TigerBeetle is designed to operate and provide more than adequate
performance even on commodity hardware.</p>
<h2 id="operating-hardware-storage"><a href="#operating-hardware-storage" class="anchor">Storage</a></h2>
<p>Local NVMe drives are highly recommended for production deployments,
and there‚Äôs no requirement for RAID.</p>
<p>In cloud or more complex deployments, remote block storage (e.g.,
EBS, NVMe-oF) may be used but will be slower and care must be taken to
ensure <a href="#operating-cluster-hardware-fault-tolerance">independent fault
domains</a> across replicas.</p>
<p>Currently, TigerBeetle uses around 16TiB for 40 billion transfers. If
you wish to use more capacity than a single disk, RAID 10 / RAID 0 is
recommended over parity RAID levels.</p>
<p>The data file is created before the server is initially run and grows
automatically. TigerBeetle has been more extensively tested on ext4, but
ext4 only supports data files up to 16TiB. XFS is supported, but has
seen less testing. TigerBeetle can also be run against the raw block
device.</p>
<h2 id="operating-hardware-memory"><a href="#operating-hardware-memory" class="anchor">Memory</a></h2>
<p>ECC memory is required for production deployments.</p>
<p>A replica requires at least 6 GiB RAM per machine. Between 16 GiB and
32 GiB or more (depending on budget) is recommended to be allocated to
each replica for caching. TigerBeetle uses static allocation and will
use exactly how much memory is explicitly allocated to it for caching
via command line argument.</p>
<h2 id="operating-hardware-cpu"><a href="#operating-hardware-cpu" class="anchor">CPU</a></h2>
<p>TigerBeetle requires only a single core per replica machine.
TigerBeetle at present does not utilize more cores, but may in
future.</p>
<p>It‚Äôs recommended to have at least one additional core free for the
operating system.</p>
<h2 id="operating-hardware-network"><a href="#operating-hardware-network" class="anchor">Network</a></h2>
<p>A minimum of a 1Gbps network connection is recommended.</p>
<h2 id="operating-hardware-multitenancy"><a href="#operating-hardware-multitenancy"
class="anchor">Multitenancy</a></h2>
<p>There are no restrictions on sharing a server with other tenant
processes.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/hardware.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-cluster"><a href="#operating-cluster"
class="anchor">Cluster Recommendations</a></h1>
<p>A TigerBeetle <strong>cluster</strong> is a set of machines each
running the TigerBeetle server for strict serializability, high
availability and durability. The TigerBeetle server is a single
binary.</p>
<p>Each server operates on a single local data file.</p>
<p>The TigerBeetle server binary plus its single data file is called a
<strong>replica</strong>.</p>
<p>A cluster guarantees strict serializability, the highest level of
consistency, by automatically electing a primary replica to order and
backup transactions across replicas in the cluster.</p>
<h2 id="operating-cluster-fault-tolerance"><a href="#operating-cluster-fault-tolerance" class="anchor">Fault
Tolerance</a></h2>
<p><strong>The optimal, recommended size for any production cluster is 6
replicas.</strong></p>
<p>Given a cluster of 6 replicas:</p>
<ul>
<li>4/6 replicas are required to elect a new primary if the old primary
fails.</li>
<li>A cluster remains highly available (able to process transactions),
preserving strict serializability, provided that at least 3/6 machines
have not failed (provided that the primary has not also failed) or
provided that at least 4/6 machines have not failed (if the primary also
failed and a new primary needs to be elected).</li>
<li>A cluster preserves durability (surviving, detecting, and repairing
corruption of any data file) provided that the cluster remains
available. If machines go offline temporarily and the cluster becomes
available again later, the cluster will be able to repair data file
corruption once availability is restored.</li>
<li>A cluster will correctly remain unavailable if too many machine
failures have occurred to preserve data. In other words, TigerBeetle is
designed to operate correctly or else to shut down safely if safe
operation with respect to strict serializability is no longer possible
due to permanent data loss.</li>
</ul>
<h3 id="operating-cluster-geographic-fault-tolerance"><a
href="#operating-cluster-geographic-fault-tolerance" class="anchor">Geographic Fault
Tolerance</a></h3>
<p>All 6 replicas may be within the same data center (zero geographic
fault tolerance), or spread across 2 or more data centers, availability
zones or regions (‚Äúsites‚Äù) for geographic fault tolerance.</p>
<p><strong>For mission critical availability, the optimal number of
sites is 3</strong>, since each site would then contain 2 replicas so
that the loss of an entire site would not impair the availability of the
cluster.</p>
<p>Sites should preferably be within a few milliseconds of each other,
since each transaction must be replicated across sites before being
committed.</p>
<h3 id="operating-cluster-hardware-fault-tolerance"><a href="#operating-cluster-hardware-fault-tolerance"
class="anchor">Hardware Fault Tolerance</a></h3>
<p>It is important to ensure independent fault domains for each
replica‚Äôs data file, that each replica‚Äôs data file is stored on a
separate disk (required), machine (required), rack (recommended), data
center (recommended) etc.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/cluster.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-deploying"><a href="#operating-deploying"
class="anchor">Deploying</a></h1>
<p>TigerBeetle is a single, statically linked binary without external
dependencies, so the overall deployment procedure is simple:</p>
<ul>
<li>Get the <code>tigerbeetle</code> binary onto each of the cluster‚Äôs
machines (see <a href="#operating-installing">Installing</a>).</li>
<li>Format the data files, specifying cluster id, replica count, and
replica index.</li>
<li>Start replicas, specifying path to the data file and addresses of
all replicas in the cluster.</li>
</ul>
<p>Here‚Äôs how to deploy a three replica cluster running on a single
machine:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>curl -Lo tigerbeetle.zip https://linux.tigerbeetle.com &amp;&amp; unzip tigerbeetle.zip &amp;&amp; ./tigerbeetle version
./tigerbeetle format --cluster=0 --replica-count=3 --replica=0 ./0_0.tigerbeetle
./tigerbeetle format --cluster=0 --replica-count=3 --replica=1 ./0_1.tigerbeetle
./tigerbeetle format --cluster=0 --replica-count=3 --replica=2 ./0_2.tigerbeetle

./tigerbeetle start --addresses=127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002 ./0_0.tigerbeetle &amp;
./tigerbeetle start --addresses=127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002 ./0_1.tigerbeetle &amp;
./tigerbeetle start --addresses=127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002 ./0_2.tigerbeetle &amp;</code></pre>
</div>
<p>Here what the arguments mean:</p>
<ul>
<li><code>--cluster</code> specifies a globally unique 128 bit cluster
ID. It is recommended to use a random number for a cluster id, cluster
ID <code>0</code> is reserved for testing.</li>
<li><code>--replica-count</code> specifies the size of the cluster. In
the current version of TigerBeetle, cluster size can not be changed
after creation, but this limitation will be lifted in the future.</li>
<li><code>--replica</code> is a zero-based index of the current replica.
While <code>--cluster</code> and <code>--replica-count</code> arguments
must match across all replicas of the cluster, <code>--replica</code>
arguments must be unique.</li>
<li><code>./0_0.tigerbeetle</code> is a path to the data file. It
doesn‚Äôt matter how you name it, but the suggested naming schema is
<code>${CLUSTER_ID}_${REPLICA_INDEX}.tigerbeetle</code>.</li>
<li><code>--addresses</code> specify IP addresses of all the replicas in
the cluster. <strong>The order of addresses must correspond to the order
of replicas</strong>. In particular, the <code>--addresses</code>
argument must be the same for all replicas and all clients, and the
address at the replica index must correspond to replica‚Äôs own
address.</li>
</ul>
<p>Production deployment differs in three aspects (see <a
href="#operating-cluster">Cluster Recommendations</a>):</p>
<ul>
<li>Each replica runs on a dedicated machine.</li>
<li>Six replicas are used rather than three.</li>
<li>There‚Äôs a supervisor process to restart a replica process after a
crash.</li>
</ul>
<h2 id="operating-deploying-deployment-recipes"><a href="#operating-deploying-deployment-recipes"
class="anchor">Deployment Recipes</a></h2>
<p>We have recipes for some commonly used deployment tools:</p>
<ul>
<li><a href="#operating-deploying-systemd">systemd</a></li>
<li><a href="#operating-deploying-docker">Docker</a></li>
<li><a href="#operating-deploying-managed-service">Managed</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/deploying/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-deploying-systemd"><a href="#operating-deploying-systemd"
class="anchor">Deploying with systemd</a></h1>
<p>The following includes an example systemd unit for running
TigerBeetle with Linux systems that use systemd. The unit is configured
to start a single-node cluster, so you may need to adjust it for other
cluster configurations.</p>
<h3 id="operating-deploying-systemd-tigerbeetleservice"><a href="#operating-deploying-systemd-tigerbeetleservice"
class="anchor"><strong>tigerbeetle.service</strong></a></h3>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>[Unit]
Description=TigerBeetle Replica
Documentation=https://docs.tigerbeetle.com/
After=network-online.target
Wants=network-online.target systemd-networkd-wait-online.service

[Service]
AmbientCapabilities=CAP_IPC_LOCK

Environment=TIGERBEETLE_CACHE_GRID_SIZE=1GiB
Environment=TIGERBEETLE_ADDRESSES=3001
Environment=TIGERBEETLE_REPLICA_COUNT=1
Environment=TIGERBEETLE_REPLICA_INDEX=0
Environment=TIGERBEETLE_CLUSTER_ID=0
Environment=TIGERBEETLE_DATA_FILE=%S/tigerbeetle/0_0.tigerbeetle

DevicePolicy=closed
DynamicUser=true
LockPersonality=true
ProtectClock=true
ProtectControlGroups=true
ProtectHome=true
ProtectHostname=true
ProtectKernelLogs=true
ProtectKernelModules=true
ProtectKernelTunables=true
ProtectProc=noaccess
ProtectSystem=strict
RestrictAddressFamilies=AF_INET AF_INET6
RestrictNamespaces=true
RestrictRealtime=true
RestrictSUIDSGID=true

StateDirectory=tigerbeetle
StateDirectoryMode=700

Type=exec
ExecStart=/usr/local/bin/tigerbeetle start --cache-grid=${TIGERBEETLE_CACHE_GRID_SIZE} --addresses=${TIGERBEETLE_ADDRESSES} ${TIGERBEETLE_DATA_FILE}

[Install]
WantedBy=multi-user.target</code></pre>
</div>
<h2 id="operating-deploying-systemd-adjusting"><a href="#operating-deploying-systemd-adjusting"
class="anchor">Adjusting</a></h2>
<p>You can adjust multiple aspects of this systemd service. Each
specific adjustment is listed below with instructions.</p>
<p>It is not recommended to adjust some values directly in the service
file. When this is the case, the instructions will ask you to instead
use systemd‚Äôs drop-in file support. Here‚Äôs how to do that:</p>
<ol type="1">
<li>Install the service unit in systemd (usually by adding it to
<code>/etc/systemd/system</code>).</li>
<li>Create a drop-in file to override the environment variables. Run
<code>systemctl edit tigerbeetle.service</code>. This will bring you to
an editor with instructions.</li>
<li>Add your overrides. Example:
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>[Service]
Environment=TIGERBEETLE_CACHE_GRID_SIZE=4GiB
Environment=TIGERBEETLE_ADDRESSES=0.0.0.0:3001</code></pre>
</div></li>
</ol>
<h3 id="operating-deploying-systemd-pre-start-script"><a href="#operating-deploying-systemd-pre-start-script"
class="anchor">Pre-start script</a></h3>
<p>You can place the following script in <code>/usr/local/bin</code>.
This script is responsible for ensuring that a replica data file exists.
It will create a data file if it doesn‚Äôt exist.</p>
<h4 id="operating-deploying-systemd-tigerbeetle-pre-startsh"><a href="#operating-deploying-systemd-tigerbeetle-pre-startsh"
class="anchor"><strong>tigerbeetle-pre-start.sh</strong></a></h4>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-eu</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="ot">! </span><span class="bu">test</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${TIGERBEETLE_DATA_FILE}</span><span class="st">&quot;</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/usr/local/bin/tigerbeetle</span> format <span class="at">--cluster</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${TIGERBEETLE_CLUSTER_ID}</span><span class="st">&quot;</span> <span class="at">--replica</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${TIGERBEETLE_REPLICA_INDEX}</span><span class="st">&quot;</span> <span class="at">--replica-count</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${TIGERBEETLE_REPLICA_COUNT}</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">${TIGERBEETLE_DATA_FILE}</span><span class="st">&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
</div>
<p>The script assumes that <code>/bin/sh</code> exists and points to a
POSIX-compliant shell, and the <code>test</code> utility is either
built-in or in the script‚Äôs search path. If this is not the case, adjust
the script‚Äôs shebang.</p>
<p>Add the following line to <code>tigerbeetle.service</code> before
<code>ExecStart</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>ExecStartPre=/usr/local/bin/tigerbeetle-pre-start.sh</code></pre>
</div>
<p>The service then executes the <code>tigerbeetle-pre-start.sh</code>
script before starting TigerBeetle.</p>
<h3 id="operating-deploying-systemd-tigerbeetle-executable"><a href="#operating-deploying-systemd-tigerbeetle-executable"
class="anchor">TigerBeetle executable</a></h3>
<p>The <code>tigerbeetle</code> executable is assumed to be installed in
<code>/usr/local/bin</code>. If this is not the case, adjust both
<code>tigerbeetle.service</code> and
<code>tigerbeetle-pre-start.sh</code> to use the correct location.</p>
<h3 id="operating-deploying-systemd-environment-variables"><a href="#operating-deploying-systemd-environment-variables"
class="anchor">Environment variables</a></h3>
<p>This service uses environment variables to provide default values for
a simple single-node cluster. To configure a different cluster
structure, or a cluster with different values, adjust the values in the
environment variables. It is <strong>not recommended</strong> to change
these default values directly in the service file, because it may be
important to revert to the default behavior later. Instead, use
systemd‚Äôs drop-in file support.</p>
<h3 id="operating-deploying-systemd-state-directory-and-replica-data-file-path"><a
href="#operating-deploying-systemd-state-directory-and-replica-data-file-path" class="anchor">State
directory and replica data file path</a></h3>
<p>This service configures a state directory, which means that systemd
will make sure the directory is created before the service starts, and
the directory will have the correct permissions. This is especially
important because the service uses systemd‚Äôs dynamic user capabilities.
systemd forces the state directory to be in <code>/var/lib</code>, which
means that this service will have its replica data file at
<code>/var/lib/tigerbeetle/</code>. It is <strong>not
recommended</strong> to adjust the state directory directly in the
service file, because it may be important to revert to the default
behavior later. Instead, use systemd‚Äôs drop-in file support. If you do
so, remember to also adjust the <code>TIGERBEETLE_DATA_FILE</code>
environment variable, because it also hardcodes the
<code>tigerbeetle</code> state directory value.</p>
<p>Due to systemd‚Äôs dynamic user capabilities, the replica data file
path will not be owned by any existing user of the system.</p>
<h3 id="operating-deploying-systemd-hardening-configurations"><a href="#operating-deploying-systemd-hardening-configurations"
class="anchor">Hardening configurations</a></h3>
<p>Some hardening configurations are enabled for added security when
running the service. It is <strong>not recommended</strong> to change
these, since they have additional implications on all other
configurations and values defined in this service file. If you wish to
change those, you are expected to understand those implications and make
any other adjustments accordingly.</p>
<h3 id="operating-deploying-systemd-development-mode"><a href="#operating-deploying-systemd-development-mode"
class="anchor">Development mode</a></h3>
<p>The service was created assuming it‚Äôll be used in a production
scenario.</p>
<p>In case you want to use this service for development as well, you may
need to adjust the <code>ExecStart</code> line to include the
<code>--development</code> flag if your development environment doesn‚Äôt
support Direct IO, or if you require smaller cache sizes and/or batch
sizes due to memory constraints.</p>
<h3 id="operating-deploying-systemd-memory-locking"><a href="#operating-deploying-systemd-memory-locking" class="anchor">Memory
Locking</a></h3>
<p>TigerBeetle requires <code>RLIMIT_MEMLOCK</code> to be set high
enough to:</p>
<ol type="1">
<li>initialize io_uring, which requires memory shared with the kernel to
be locked, as well as</li>
<li>lock all allocated memory, and so prevent the kernel from swapping
any pages to disk, which would not only affect performance but also
bypass TigerBeetle‚Äôs storage fault-tolerance.</li>
</ol>
<p>If the required memory cannot be locked, then the environment should
be modified either by (in order of preference):</p>
<ol type="1">
<li>giving the local <code>tigerbeetle</code> binary the
<code>CAP_IPC_LOCK</code> capability
(<code>sudo setcap "cap_ipc_lock=+ep" ./tigerbeetle</code>), or</li>
<li>raising the global <code>memlock</code> value under
<code>/etc/security/limits.conf</code>, or else</li>
<li>disabling swap (io_uring may still require an RLIMIT increase).</li>
</ol>
<p>Memory locking is disabled for development environments when using
the <code>--development</code> flag.</p>
<p>For Linux running under Docker, refer to <a
href="#operating-deploying-docker-allowing-memlock">Allowing MEMLOCK</a>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/deploying/systemd.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-deploying-docker"><a href="#operating-deploying-docker" class="anchor">Docker</a></h1>
<p>TigerBeetle can be run using Docker. However, it is not
recommended.</p>
<p>TigerBeetle is distributed as a single, small, statically-linked
binary. It should be easy to run directly on the target machine. Using
Docker as an abstraction adds complexity while providing relatively
little in this case.</p>
<h2 id="operating-deploying-docker-image"><a href="#operating-deploying-docker-image" class="anchor">Image</a></h2>
<p>The Docker image is available from the GitHub Container Registry:</p>
<p><a
href="https://github.com/tigerbeetle/tigerbeetle/pkgs/container/tigerbeetle">https://github.com/tigerbeetle/tigerbeetle/pkgs/container/tigerbeetle</a></p>
<h2 id="operating-deploying-docker-format-the-data-file"><a href="#operating-deploying-docker-format-the-data-file"
class="anchor">Format the Data File</a></h2>
<p>When using Docker, the data file must be mounted as a volume:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="shell"><code>docker run --security-opt seccomp=unconfined \
     -v $(pwd)/data:/data ghcr.io/tigerbeetle/tigerbeetle \
    format --cluster=0 --replica=0 --replica-count=1 /data/0_0.tigerbeetle</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>info(io): creating &quot;0_0.tigerbeetle&quot;...
info(io): allocating 660.140625MiB...</code></pre>
</div>
<h2 id="operating-deploying-docker-run-the-server"><a href="#operating-deploying-docker-run-the-server" class="anchor">Run the
Server</a></h2>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>docker run -it --security-opt seccomp=unconfined \
    -p 3000:3000 -v $(pwd)/data:/data ghcr.io/tigerbeetle/tigerbeetle \
    start --addresses=0.0.0.0:3000 /data/0_0.tigerbeetle</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>info(io): opening &quot;0_0.tigerbeetle&quot;...
info(main): 0: cluster=0: listening on 0.0.0.0:3000</code></pre>
</div>
<h2 id="operating-deploying-docker-run-a-multi-node-cluster-using-docker-compose"><a
href="#operating-deploying-docker-run-a-multi-node-cluster-using-docker-compose" class="anchor">Run
a Multi-Node Cluster Using Docker Compose</a></h2>
<p>Format the data file for each replica:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>docker run --security-opt seccomp=unconfined -v $(pwd)/data:/data ghcr.io/tigerbeetle/tigerbeetle format --cluster=0 --replica=0 --replica-count=3 /data/0_0.tigerbeetle
docker run --security-opt seccomp=unconfined -v $(pwd)/data:/data ghcr.io/tigerbeetle/tigerbeetle format --cluster=0 --replica=1 --replica-count=3 /data/0_1.tigerbeetle
docker run --security-opt seccomp=unconfined -v $(pwd)/data:/data ghcr.io/tigerbeetle/tigerbeetle format --cluster=0 --replica=2 --replica-count=3 /data/0_2.tigerbeetle</code></pre>
</div>
<p>Note that the data file stores which replica in the cluster the file
belongs to.</p>
<p>Then, create a docker-compose.yml file:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="docker-compose"><code>version: &quot;3.7&quot;

##
# Note: this example might only work with linux + using `network_mode:host` because of 2 reasons:
#
# 1. When specifying an internal docker network, other containers are only available using dns based routing:
#    e.g. from tigerbeetle_0, the other replicas are available at `tigerbeetle_1:3002` and
#    `tigerbeetle_2:3003` respectively.
#
# 2. Tigerbeetle performs some validation of the ip address provided in the `--addresses` parameter
#    and won&#39;t let us specify a custom domain name.
#
# The workaround for now is to use `network_mode:host` in the containers instead of specifying our
# own internal docker network
##

services:
  tigerbeetle_0:
    image: ghcr.io/tigerbeetle/tigerbeetle
    command: &quot;start --addresses=0.0.0.0:3001,0.0.0.0:3002,0.0.0.0:3003 /data/0_0.tigerbeetle&quot;
    network_mode: host
    volumes:
      - ./data:/data
    security_opt:
      - &quot;seccomp=unconfined&quot;

  tigerbeetle_1:
    image: ghcr.io/tigerbeetle/tigerbeetle
    command: &quot;start --addresses=0.0.0.0:3001,0.0.0.0:3002,0.0.0.0:3003 /data/0_1.tigerbeetle&quot;
    network_mode: host
    volumes:
      - ./data:/data
    security_opt:
      - &quot;seccomp=unconfined&quot;

  tigerbeetle_2:
    image: ghcr.io/tigerbeetle/tigerbeetle
    command: &quot;start --addresses=0.0.0.0:3001,0.0.0.0:3002,0.0.0.0:3003 /data/0_2.tigerbeetle&quot;
    network_mode: host
    volumes:
      - ./data:/data
    security_opt:
      - &quot;seccomp=unconfined&quot;</code></pre>
</div>
<p>And run it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>docker-compose up</code></pre>
</div>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>docker-compose up
Starting tigerbeetle_0   ... done
Starting tigerbeetle_2   ... done
Recreating tigerbeetle_1 ... done
Attaching to tigerbeetle_0, tigerbeetle_2, tigerbeetle_1
tigerbeetle_1    | info(io): opening &quot;0_1.tigerbeetle&quot;...
tigerbeetle_2    | info(io): opening &quot;0_2.tigerbeetle&quot;...
tigerbeetle_0    | info(io): opening &quot;0_0.tigerbeetle&quot;...
tigerbeetle_0    | info(main): 0: cluster=0: listening on 0.0.0.0:3001
tigerbeetle_2    | info(main): 2: cluster=0: listening on 0.0.0.0:3003
tigerbeetle_1    | info(main): 1: cluster=0: listening on 0.0.0.0:3002
tigerbeetle_0    | info(message_bus): connected to replica 1
tigerbeetle_0    | info(message_bus): connected to replica 2
tigerbeetle_1    | info(message_bus): connected to replica 2
tigerbeetle_1    | info(message_bus): connection from replica 0
tigerbeetle_2    | info(message_bus): connection from replica 0
tigerbeetle_2    | info(message_bus): connection from replica 1
tigerbeetle_0    | info(clock): 0: system time is 83ns ahead
tigerbeetle_2    | info(clock): 2: system time is 83ns ahead
tigerbeetle_1    | info(clock): 1: system time is 78ns ahead

... and so on ...</code></pre>
</div>
<h2 id="operating-deploying-docker-troubleshooting"><a href="#operating-deploying-docker-troubleshooting"
class="anchor">Troubleshooting</a></h2>
<h3 id="operating-deploying-docker-error-permissiondenied"><a href="#operating-deploying-docker-error-permissiondenied"
class="anchor"><code>error: PermissionDenied</code></a></h3>
<p>If you see this error at startup, it is likely because you are
running Docker 25.0.0 or newer, which blocks io_uring by default. Set
<code>--security-opt seccomp=unconfined</code> to fix it.</p>
<h3 id="operating-deploying-docker-exited-with-code-137"><a href="#operating-deploying-docker-exited-with-code-137"
class="anchor"><code>exited with code 137</code></a></h3>
<p>If you see this error without any logs from TigerBeetle, it is likely
that the Linux OOMKiller is killing the process. If you are running
Docker inside a virtual machine (such as is required on Docker or Podman
for macOS), try increasing the virtual machine memory limit.</p>
<p>Alternatively, in a development environment, you can lower the size
of the cache so TigerBeetle uses less memory. For example, set
<code>--cache-grid=256MiB</code> when running
<code>tigerbeetle start</code>.</p>
<h3 id="operating-deploying-docker-debugging-panics"><a href="#operating-deploying-docker-debugging-panics"
class="anchor">Debugging panics</a></h3>
<p>If TigerBeetle panics and you can reproduce the panic, you can get a
better stack trace by switching to a debug image (by using the
<code>:debug</code> Docker image tag).</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>docker run -p 3000:3000 -v $(pwd)/data:/data ghcr.io/tigerbeetle/tigerbeetle:debug \
    start --addresses=0.0.0.0:3000 /data/0_0.tigerbeetle</code></pre>
</div>
<h3 id="operating-deploying-docker-on-macos"><a href="#operating-deploying-docker-on-macos" class="anchor">On MacOS</a></h3>
<h4 id="operating-deploying-docker-error-systemresources"><a href="#operating-deploying-docker-error-systemresources"
class="anchor"><code>error: SystemResources</code></a></h4>
<p>If you get <code>error: SystemResources</code> when running
TigerBeetle in Docker on macOS, the container may be blocking
TigerBeetle from locking memory, which is necessary both for io_uring
and to prevent the kernel‚Äôs use of swap from bypassing TigerBeetle‚Äôs
storage fault tolerance.</p>
<h4 id="operating-deploying-docker-allowing-memlock"><a href="#operating-deploying-docker-allowing-memlock"
class="anchor">Allowing MEMLOCK</a></h4>
<p>To raise the memory lock limits under Docker, execute one of the
following:</p>
<ol type="1">
<li>Run <code>docker run</code> with
<code>--cap-add IPC_LOCK</code></li>
<li>Run <code>docker run</code> with
<code>--ulimit memlock=-1:-1</code></li>
<li>Or modify the defaults in <code>$HOME/.docker/daemon.json</code> and
restart the Docker for Mac application:</li>
</ol>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span> <span class="er">other</span> <span class="er">settings</span> <span class="er">...</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;default-ulimits&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;memlock&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Hard&quot;</span><span class="fu">:</span> <span class="dv">-1</span><span class="fu">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;memlock&quot;</span><span class="fu">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;Soft&quot;</span><span class="fu">:</span> <span class="dv">-1</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">...</span> <span class="er">other</span> <span class="er">settings</span> <span class="er">...</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<p>If you are running TigerBeetle with Docker Compose, you will need to
add the <code>IPC_LOCK</code> capability like this:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">... rest of docker-compose.yml ...</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">tigerbeetle_0</span><span class="kw">:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> ghcr.io/tigerbeetle/tigerbeetle</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;start --addresses=0.0.0.0:3001,0.0.0.0:3002,0.0.0.0:3003 /data/0_0.tigerbeetle&quot;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">network_mode</span><span class="kw">:</span><span class="at"> host</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">cap_add</span><span class="kw">:</span><span class="co">       # HERE</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> IPC_LOCK</span><span class="co">   # HERE</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./data:/data</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="at">... rest of docker-compose.yml ...</span></span></code></pre></div>
</div>
<p>See <a
href="https://github.com/tigerbeetle/tigerbeetle/issues/92">https://github.com/tigerbeetle/tigerbeetle/issues/92</a>
for discussion.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/deploying/docker.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-deploying-managed-service"><a href="#operating-deploying-managed-service"
class="anchor">Managed Service</a></h1>
<p>Want to use TigerBeetle in production, along with automated disaster
recovery, monitoring, and dedicated support from the TigerBeetle
team?</p>
<p>Let us help you get up and running faster! Contact our CEO, Joran
Dirk Greef, at <a
href="mailto:joran@tigerbeetle.com">joran@tigerbeetle.com</a> to set up
a call.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/deploying/managed-service.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="operating-upgrading"><a href="#operating-upgrading"
class="anchor">Upgrading</a></h1>
<p>TigerBeetle guarantees storage stability and provides forward
upgradeability. In other words, data files created by a particular past
version of TigerBeetle can be migrated to any future version of
TigerBeetle.</p>
<p>Migration is automatic and the upgrade process is usually as simple
as:</p>
<ul>
<li>Upgrade the replicas, by replacing the <code>./tigerbeetle</code>
binary with a newer version on each replica (they will restart
automatically when needed).</li>
<li>Upgrade the clients, by updating the corresponding client libraries,
recompiling and redeploying as usual.</li>
</ul>
<p>There‚Äôs no need to stop the cluster for upgrades, and the client
upgrades can be rolled out gradually as any change to the client code
might.</p>
<p>NOTE: if you are upgrading from 0.15.3 (the first stable version),
the upgrade procedure is more involved, see the <a
href="https://github.com/tigerbeetle/tigerbeetle/releases/tag/0.15.4">release
notes for 0.15.4</a>.</p>
<h2 id="operating-upgrading-api-stability"><a href="#operating-upgrading-api-stability" class="anchor">API
Stability</a></h2>
<p>At the moment, TigerBeetle doesn‚Äôt guarantee complete API stability,
subscribe to the <a
href="https://github.com/tigerbeetle/tigerbeetle/issues/2231">tracking
issue #2231</a> to receive notifications about breaking changes!</p>
<h2 id="operating-upgrading-planning-for-upgrades"><a href="#operating-upgrading-planning-for-upgrades"
class="anchor">Planning for upgrades</a></h2>
<p>When upgrading TigerBeetle, each release specifies two important
versions:</p>
<ul>
<li>the oldest release that can be upgraded from and,</li>
<li>the oldest supported client version.</li>
</ul>
<p>It‚Äôs critical to make sure that the release you intend to upgrade
from is supported by the release you‚Äôre upgrading to. This is a hard
requirement, but also a hard guarantee: if you wish to upgrade to
<code>0.15.20</code> which says it supports down to <code>0.15.5</code>,
<code>0.15.5</code> <em>will</em> work and <code>0.15.4</code> <em>will
not</em>. You will have to perform multiple upgrades in this case.</p>
<p>The upgrade process involves first upgrading the replicas, followed
by upgrading the clients. The client version <em>cannot</em> be newer
than the replica version, and will fail with an error message if so.
Provided the supported version ranges overlap, coordinating the upgrade
between clients and replicas is not required.</p>
<p>Upgrading causes a short period of unavailability as the replicas
restart. This is on the order of 5 seconds, and will show up as a
latency spike on requests. The TigerBeetle clients will internally retry
any requests during the period.</p>
<p>Even though this period is short, scheduling a maintenance windows
for upgrades is still recommended, for an extra layer of safety.</p>
<p>Any special instructions, like that when upgrading from 0.15.3 to
0.15.4, will be explicitly mentioned in the <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/CHANGELOG.md">changelog</a>
and <a
href="https://github.com/tigerbeetle/tigerbeetle/releases">release
notes</a>.</p>
<p>Additionally, subscribe to <a
href="https://github.com/tigerbeetle/tigerbeetle/issues/2231">this
tracking issue</a> to be notified when there are breaking API/behavior
changes that are visible to the client.</p>
<h2 id="operating-upgrading-upgrading-binary-based-installations"><a
href="#operating-upgrading-upgrading-binary-based-installations" class="anchor">Upgrading
binary-based installations</a></h2>
<p>If TigerBeetle is installed under <code>/usr/bin/tigerbeetle</code>,
and you wish to upgrade to <code>0.15.4</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SSH to each replica, in no particular order:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/tigerbeetle/tigerbeetle/releases/download/0.15.4/tigerbeetle-x86_64-linux.zip</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> tigerbeetle-x86_64-linux.zip</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the binary on the same file system as the target, so mv is atomic.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> tigerbeetle /usr/bin/tigerbeetle-new</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> /usr/bin/tigerbeetle /usr/bin/tigerbeetle-old</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mv</span> /usr/bin/tigerbeetle-new /usr/bin/tigerbeetle</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart TigerBeetle. Only required when upgrading from 0.15.3.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise, it will detect new versions are available and coordinate the upgrade itself.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">systemctl</span> restart tigerbeetle <span class="co"># or, however you are managing TigerBeetle.</span></span></code></pre></div>
</div>
<h2 id="operating-upgrading-upgrading-docker-based-installations"><a
href="#operating-upgrading-upgrading-docker-based-installations" class="anchor">Upgrading
Docker-based installations</a></h2>
<p>If you‚Äôre running TigerBeetle inside Kubernetes or Docker, update the
tag that is pointed to the release you wish to upgrade to. Before
beginning, it‚Äôs strongly recommend to have a rolling deploy strategy set
up.</p>
<p>For example:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>image: ghcr.io/tigerbeetle/tigerbeetle:0.15.3</code></pre>
</div>
<p>becomes</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>image: ghcr.io/tigerbeetle/tigerbeetle:0.15.4</code></pre>
</div>
<p>Due to the way upgrades work internally, this will restart with the
new binary available, but still running the older version. TigerBeetle
will then coordinate the actual upgrade when all replicas are ready and
have the latest version available.</p>
<h2 id="operating-upgrading-upgrading-clients"><a href="#operating-upgrading-upgrading-clients"
class="anchor">Upgrading clients</a></h2>
<p>Update your language‚Äôs specific package management, to reference the
same version of the TigerBeetle client:</p>
<h3 id="operating-upgrading-net"><a href="#operating-upgrading-net" class="anchor">.NET</a></h3>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>dotnet add package tigerbeetle --version 0.15.4</code></pre>
</div>
<h3 id="operating-upgrading-go"><a href="#operating-upgrading-go" class="anchor">Go</a></h3>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>go mod edit -require github.com/tigerbeetle/tigerbeetle-go@v0.15.4</code></pre>
</div>
<h3 id="operating-upgrading-java"><a href="#operating-upgrading-java" class="anchor">Java</a></h3>
<p>Edit your <code>pom.xml</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;com.tigerbeetle&lt;/groupId&gt;
        &lt;artifactId&gt;tigerbeetle-java&lt;/artifactId&gt;
        &lt;version&gt;0.15.4&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
</div>
<h3 id="operating-upgrading-nodejs"><a href="#operating-upgrading-nodejs" class="anchor">Node.js</a></h3>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>npm install --save-exact tigerbeetle-node@0.15.4</code></pre>
</div>
<h3 id="operating-upgrading-python"><a href="#operating-upgrading-python" class="anchor">Python</a></h3>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre><code>pip install tigerbeetle==0.15.4</code></pre>
</div>
<h2 id="operating-upgrading-troubleshooting"><a href="#operating-upgrading-troubleshooting"
class="anchor">Troubleshooting</a></h2>
<h3 id="operating-upgrading-upgrading-to-a-newer-version-with-incompatible-clients"><a
href="#operating-upgrading-upgrading-to-a-newer-version-with-incompatible-clients"
class="anchor">Upgrading to a newer version with incompatible
clients</a></h3>
<p>If a release of TigerBeetle no longer supports the client version
you‚Äôre using, it‚Äôs still possible to upgrade, with two options:</p>
<ul>
<li>Upgrade the replicas to the latest version. In this case, the
clients will stop working for the duration of the upgrade and
unavailability will be extended.</li>
<li>Upgrade the replicas to the latest release that supports the client
version in use, then upgrade the clients to that version. Repeat this
until you‚Äôre on the latest release.</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/operating/upgrading.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference"><a href="#reference"
class="anchor">Reference</a></h1>
<p>Like the <a href="#coding">Coding</a> section, the reference is
aimed at programmers building applications on top of TigerBeetle. While
Coding provides a series of topical guide, the Reference exhaustively
documents every single aspect of TigerBeetle. Any answer can be found
here, but it might take some digging!</p>
<ul>
<li><a href="#reference-sessions">Client Sessions</a></li>
<li><a href="#reference-account">Account</a></li>
<li><a href="#reference-transfer">Transfer</a></li>
<li><a href="#reference-account-balance">AccountBalance</a></li>
<li><a href="#reference-account-filter">AccountFilter</a></li>
<li><a href="#reference-query-filter">QueryFilter</a></li>
<li><a href="#reference-requests">Requests</a>
<ul>
<li><a
href="#reference-requests-create_accounts"><code>create_accounts</code></a></li>
<li><a
href="#reference-requests-create_transfers"><code>create_transfers</code></a></li>
<li><a
href="#reference-requests-lookup_accounts"><code>lookup_accounts</code></a></li>
<li><a
href="#reference-requests-lookup_transfers"><code>lookup_transfers</code></a></li>
<li><a
href="#reference-requests-get_account_balances"><code>get_account_balances</code></a></li>
<li><a
href="#reference-requests-get_account_transfers"><code>get_account_transfers</code></a></li>
<li><a
href="#reference-requests-query_accounts"><code>query_accounts</code></a></li>
<li><a
href="#reference-requests-query_transfers"><code>query_transfers</code></a></li>
</ul></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-sessions"><a href="#reference-sessions"
class="anchor">Client Sessions</a></h1>
<p>A <em>client session</em> is a sequence of <a
href="#coding-requests">requests</a> and replies sent between a
client and a cluster.</p>
<p>A client session may have <strong>at most one in-flight
request</strong> ‚Äî i.e. at most one unique request on the network for
which a reply has not been received. This simplifies consistency and
allows the cluster to statically guarantee capacity in its incoming
message queue. Additional requests from the application are queued by
the client, to be dequeued and sent when their preceding request
receives a reply.</p>
<p>Similar to other databases, TigerBeetle has a <a
href="#reference-sessions-eviction">hard limit</a> on the number of concurrent client
sessions. To maximize throughput, users are encouraged to minimize the
number of concurrent clients and <a
href="#coding-requests-batching-events">batch</a> as many events as
possible per request.</p>
<h2 id="reference-sessions-lifecycle"><a href="#reference-sessions-lifecycle"
class="anchor">Lifecycle</a></h2>
<p>A client session begins when a client registers itself with the
cluster.</p>
<ul>
<li>Each client session has a unique identifier (‚Äúclient id‚Äù) ‚Äî an
ephemeral random 128-bit id.</li>
<li>The client sends a special ‚Äúregister‚Äù message which is committed by
the cluster, at which point the client is ‚Äúregistered‚Äù ‚Äî once it
receives the reply, it may begin sending requests.</li>
<li>Client registration is handled automatically by the TigerBeetle
client implementation when the client is initialized, before it sends
its first request.</li>
<li>When a client restarts (for example, the application service running
the TigerBeetle client is restarted) it does not resume its old session
‚Äî it starts a new session, with a new (random) client id.</li>
</ul>
<p>A client session ends when either:</p>
<ul>
<li>the client session is <a href="#reference-sessions-eviction">evicted</a>, or</li>
<li>the client terminates</li>
</ul>
<p>‚Äî whichever occurs first.</p>
<h2 id="reference-sessions-eviction"><a href="#reference-sessions-eviction" class="anchor">Eviction</a></h2>
<p>When a client session is registering and the number of active
sessions in the cluster is already at the cluster‚Äôs concurrent client
session <a
href="https://tigerbeetle.com/blog/2022-10-12-a-database-without-dynamic-memory">limit</a>
(<code>config.clients_max</code>, 64 by default), an existing client
session must be evicted to make space for the new session.</p>
<ul>
<li>After a session is evicted by the cluster, no future requests from
that session will ever execute.</li>
<li>The evicted session is chosen as the session that committed a
request the longest time ago.</li>
</ul>
<p>The cluster sends a message to notify the evicted session that it has
ended. Typically the evicted client is no longer active (already
terminated), but if it is active, the eviction message causes it to
self-terminate, bubbling up to the application as an
<code>session evicted</code> error.</p>
<p>If active clients are terminating with <code>session evicted</code>
errors, it most likely indicates that the application is trying to run
too many concurrent clients. For performance reasons, it is recommended
to <a href="#coding-requests-batching-events">batch</a> as many
events as possible into each request sent by each client.</p>
<h2 id="reference-sessions-retries"><a href="#reference-sessions-retries" class="anchor">Retries</a></h2>
<p>A client session will automatically retry a request until either:</p>
<ul>
<li>the client receives a corresponding reply from the cluster, or</li>
<li>the client is terminated.</li>
</ul>
<p>Unlike most database or RPC clients:</p>
<ul>
<li>the TigerBeetle client will never time out</li>
<li>the TigerBeetle client has no retry limits</li>
<li>the TigerBeetle client does not surface network errors</li>
</ul>
<p>With TigerBeetle‚Äôs strict consistency model, surfacing these errors
at the client/application level would be misleading. An error would
imply that a request did not execute, when that is not known:</p>
<ul>
<li>A request delayed by the network could execute after its
timeout.</li>
<li>A reply delayed by the network could execute before its
timeout.</li>
</ul>
<h2 id="reference-sessions-guarantees"><a href="#reference-sessions-guarantees"
class="anchor">Guarantees</a></h2>
<ul>
<li>A client session may have at most one in-flight <a
href="#coding-requests">request</a>.</li>
<li>A client session <a
href="https://jepsen.io/consistency/models/read-your-writes">reads its
own writes</a>, meaning that read operations that happen after a given
write operation will observe the effects of the write.</li>
<li>A client session observes writes in the order that they occur on the
cluster.</li>
<li>A client session observes <a
href="#reference-account-debits_posted"><code>debits_posted</code></a> and <a
href="#reference-account-credits_posted"><code>credits_posted</code></a> as
monotonically increasing. That is, a client session will never see
<code>credits_posted</code> or <code>debits_posted</code> decrease.</li>
<li>A client session never observes uncommitted updates.</li>
<li>A client session never observes a broken invariant (e.g. <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
or <a
href="#reference-transfer-flagslinked"><code>flags.linked</code></a>).</li>
<li>Multiple client sessions may receive replies out of order relative
to one another. For example, if two clients submit requests around the
same time, the client whose request is committed first might receive the
reply later.</li>
<li>A client session can consider a request executed when it receives a
reply for the request.</li>
<li>If a client session is terminated and restarts, it is guaranteed to
see the effects of updates for which the corresponding reply was
received prior to termination.</li>
<li>If a client session is terminated and restarts, it is <em>not</em>
guaranteed to see the effects of updates for which the corresponding
reply was <em>not</em> received prior to the restart. Those updates may
occur at any point in the future, or never. Handling application crash
recovery safely requires <a
href="#coding-reliable-transaction-submission">using
<code>id</code>s to idempotently retry events</a>.</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/sessions.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-account"><a href="#reference-account"
class="anchor"><code>Account</code></a></h1>
<p>An <code>Account</code> is a record storing the cumulative effect of
committed <a href="#reference-transfer">transfers</a>.</p>
<h3 id="reference-account-updates"><a href="#reference-account-updates" class="anchor">Updates</a></h3>
<p>Account fields <em>cannot be changed by the user</em> after creation.
However, debits and credits fields are updated by TigerBeetle as
transfers move money to and from an account.</p>
<h3 id="reference-account-deletion"><a href="#reference-account-deletion" class="anchor">Deletion</a></h3>
<p>Accounts <strong>cannot be deleted</strong> after creation. This
provides a strong guarantee for an audit trail ‚Äì and the account record
is only 128 bytes.</p>
<p>If an account is no longer in use, you may want to <a
href="#coding-recipes-close-account">zero out its balance</a>.</p>
<h3 id="reference-account-guarantees"><a href="#reference-account-guarantees"
class="anchor">Guarantees</a></h3>
<ul>
<li>Accounts are immutable. They are never modified once they are
successfully created (excluding balance fields, which are modified by
transfers).</li>
<li>There is at most one <code>Account</code> with a particular <a
href="#reference-account-id"><code>id</code></a>.</li>
<li>The sum of all accounts‚Äô <a
href="#reference-account-debits_pending"><code>debits_pending</code></a> equals the sum of
all accounts‚Äô <a
href="#reference-account-credits_pending"><code>credits_pending</code></a>.</li>
<li>The sum of all accounts‚Äô <a
href="#reference-account-debits_posted"><code>debits_posted</code></a> equals the sum of
all accounts‚Äô <a
href="#reference-account-credits_posted"><code>credits_posted</code></a>.</li>
</ul>
<h2 id="reference-account-fields"><a href="#reference-account-fields" class="anchor">Fields</a></h2>
<h3 id="reference-account-id"><a href="#reference-account-id" class="anchor"><code>id</code></a></h3>
<p>This is a unique, client-defined identifier for the account.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must not be zero or <code>2^128 - 1</code> (the highest 128-bit
unsigned integer)</li>
<li>Must not conflict with another account in the cluster</li>
</ul>
<p>See the <a href="#coding-data-modeling-id"><code>id</code>
section in the data modeling doc</a> for more recommendations on
choosing an ID scheme.</p>
<p>Note that account IDs are unique for the cluster ‚Äì not per ledger. If
you want to store a relationship between accounts, such as indicating
that multiple accounts on different ledgers belong to the same user, you
should store a user ID in one of the <a
href="#reference-account-user_data_128"><code>user_data</code></a> fields.</p>
<h3 id="reference-account-debits_pending"><a href="#reference-account-debits_pending"
class="anchor"><code>debits_pending</code></a></h3>
<p><code>debits_pending</code> counts debits reserved by pending
transfers. When a pending transfer posts, voids, or times out, the
amount is removed from <code>debits_pending</code>.</p>
<p>Money in <code>debits_pending</code> is reserved ‚Äî that is, it cannot
be spent until the corresponding pending transfer resolves.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must be zero when the account is created</li>
</ul>
<h3 id="reference-account-debits_posted"><a href="#reference-account-debits_posted"
class="anchor"><code>debits_posted</code></a></h3>
<p>Amount of posted debits.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must be zero when the account is created</li>
</ul>
<h3 id="reference-account-credits_pending"><a href="#reference-account-credits_pending"
class="anchor"><code>credits_pending</code></a></h3>
<p><code>credits_pending</code> counts credits reserved by pending
transfers. When a pending transfer posts, voids, or times out, the
amount is removed from <code>credits_pending</code>.</p>
<p>Money in <code>credits_pending</code> is reserved ‚Äî that is, it
cannot be spent until the corresponding pending transfer resolves.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must be zero when the account is created</li>
</ul>
<h3 id="reference-account-credits_posted"><a href="#reference-account-credits_posted"
class="anchor"><code>credits_posted</code></a></h3>
<p>Amount of posted credits.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must be zero when the account is created</li>
</ul>
<h3 id="reference-account-user_data_128"><a href="#reference-account-user_data_128"
class="anchor"><code>user_data_128</code></a></h3>
<p>This is an optional 128-bit secondary identifier to link this account
to an external entity or event.</p>
<p>When set to zero, no secondary identifier will be associated with the
account, therefore only non-zero values can be used as <a
href="#reference-query-filter">query filter</a>.</p>
<p>As an example, you might use a <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">ULID</a>
that ties together a group of accounts.</p>
<p>For more information, see <a
href="#coding-data-modeling-user_data">Data Modeling</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-account-user_data_64"><a href="#reference-account-user_data_64"
class="anchor"><code>user_data_64</code></a></h3>
<p>This is an optional 64-bit secondary identifier to link this account
to an external entity or event.</p>
<p>When set to zero, no secondary identifier will be associated with the
account, therefore only non-zero values can be used as <a
href="#reference-query-filter">query filter</a>.</p>
<p>As an example, you might use this field store an external
timestamp.</p>
<p>For more information, see <a
href="#coding-data-modeling-user_data">Data Modeling</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
</ul>
<h3 id="reference-account-user_data_32"><a href="#reference-account-user_data_32"
class="anchor"><code>user_data_32</code></a></h3>
<p>This is an optional 32-bit secondary identifier to link this account
to an external entity or event.</p>
<p>When set to zero, no secondary identifier will be associated with the
account, therefore only non-zero values can be used as <a
href="#reference-query-filter">query filter</a>.</p>
<p>As an example, you might use this field to store a timezone or
locale.</p>
<p>For more information, see <a
href="#coding-data-modeling-user_data">Data Modeling</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h3 id="reference-account-reserved"><a href="#reference-account-reserved"
class="anchor"><code>reserved</code></a></h3>
<p>This space may be used for additional data in the future.</p>
<p>Constraints:</p>
<ul>
<li>Type is 4 bytes</li>
<li>Must be zero</li>
</ul>
<h3 id="reference-account-ledger"><a href="#reference-account-ledger"
class="anchor"><code>ledger</code></a></h3>
<p>This is an identifier that partitions the sets of accounts that can
transact with each other.</p>
<p>See <a href="#coding-data-modeling-ledgers">data modeling</a>
for more details about how to think about setting up your ledgers.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
<li>Must not be zero</li>
</ul>
<h3 id="reference-account-code"><a href="#reference-account-code" class="anchor"><code>code</code></a></h3>
<p>This is a user-defined enum denoting the category of the account.</p>
<p>As an example, you might use codes
<code>1000</code>-<code>3340</code> to indicate asset accounts in
general, where <code>1001</code> is Bank Account and <code>1002</code>
is Money Market Account and <code>2003</code> is Motor Vehicles and so
on.</p>
<p>Constraints:</p>
<ul>
<li>Type is 16-bit unsigned integer (2 bytes)</li>
<li>Must not be zero</li>
</ul>
<h3 id="reference-account-flags"><a href="#reference-account-flags"
class="anchor"><code>flags</code></a></h3>
<p>A bitfield that toggles additional behavior.</p>
<p>Constraints:</p>
<ul>
<li>Type is 16-bit unsigned integer (2 bytes)</li>
<li>Some flags are mutually exclusive; see <a
href="#reference-requests-create_accounts-flags_are_mutually_exclusive"><code>flags_are_mutually_exclusive</code></a>.</li>
</ul>
<h4 id="reference-account-flagslinked"><a href="#reference-account-flagslinked"
class="anchor"><code>flags.linked</code></a></h4>
<p>This flag links the result of this account creation to the result of
the next one in the request, such that they will either succeed or fail
together.</p>
<p>The last account in a chain of linked accounts does
<strong>not</strong> have this flag set.</p>
<p>You can read more about <a href="#coding-linked-events">linked
events</a>.</p>
<h4 id="reference-account-flagsdebits_must_not_exceed_credits"><a
href="#reference-account-flagsdebits_must_not_exceed_credits"
class="anchor"><code>flags.debits_must_not_exceed_credits</code></a></h4>
<p>When set, transfers will be rejected that would cause this account‚Äôs
debits to exceed credits. Specifically when
<code>account.debits_pending + account.debits_posted + transfer.amount &gt; account.credits_posted</code>.</p>
<p>This cannot be set when <code>credits_must_not_exceed_debits</code>
is also set.</p>
<h4 id="reference-account-flagscredits_must_not_exceed_debits"><a
href="#reference-account-flagscredits_must_not_exceed_debits"
class="anchor"><code>flags.credits_must_not_exceed_debits</code></a></h4>
<p>When set, transfers will be rejected that would cause this account‚Äôs
credits to exceed debits. Specifically when
<code>account.credits_pending + account.credits_posted + transfer.amount &gt; account.debits_posted</code>.</p>
<p>This cannot be set when <code>debits_must_not_exceed_credits</code>
is also set.</p>
<h4 id="reference-account-flagshistory"><a href="#reference-account-flagshistory"
class="anchor"><code>flags.history</code></a></h4>
<p>When set, the account will retain the history of balances at each
transfer.</p>
<p>Note that the <a
href="#reference-requests-get_account_balances"><code>get_account_balances</code></a>
operation only works for accounts with this flag set.</p>
<h4 id="reference-account-flagsimported"><a href="#reference-account-flagsimported"
class="anchor"><code>flags.imported</code></a></h4>
<p>When set, allows importing historical <code>Account</code>s with
their original <a href="#reference-account-timestamp"><code>timestamp</code></a>.</p>
<p>TigerBeetle will not use the <a href="#coding-time">cluster
clock</a> to assign the timestamp, allowing the user to define it,
expressing <em>when</em> the account was effectively created by an
external event.</p>
<p>To maintain system invariants regarding auditability and
traceability, some constraints are necessary:</p>
<ul>
<li><p>It is not allowed to mix events with the <code>imported</code>
flag set and <em>not</em> set in the same batch. The application must
submit batches of imported events separately.</p></li>
<li><p>User-defined timestamps must be <strong>unique</strong> and
expressed as nanoseconds since the UNIX epoch. No two objects can have
the same timestamp, even different objects like an <code>Account</code>
and a <code>Transfer</code> cannot share the same timestamp.</p></li>
<li><p>User-defined timestamps must be a past date, never ahead of the
cluster clock at the time the request arrives.</p></li>
<li><p>Timestamps must be strictly increasing.</p>
<p>Even user-defined timestamps that are required to be past dates need
to be at least one nanosecond ahead of the timestamp of the last account
committed by the cluster.</p>
<p>Since the timestamp cannot regress, importing past events can be
naturally restrictive without coordination, as the last timestamp can be
updated using the cluster clock during regular cluster activity.
Instead, it‚Äôs recommended to import events only on a fresh cluster or
during a scheduled maintenance window.</p>
<p>It‚Äôs recommended to submit the entire batch as a <a
href="#reference-account-flagslinked">linked chain</a>, ensuring that if any account
fails, none of them are committed, preserving the last timestamp
unchanged. This approach gives the application a chance to correct
failed imported accounts, re-submitting the batch again with the same
user-defined timestamps.</p></li>
</ul>
<h4 id="reference-account-flagsclosed"><a href="#reference-account-flagsclosed"
class="anchor"><code>flags.closed</code></a></h4>
<p>When set, the account will reject further transfers, except for <a
href="#reference-transfer-modes">voiding two-phase transfers</a> that are still
pending.</p>
<ul>
<li>This flag can be set during the account creation.</li>
<li>This flag can also be set by sending a <a
href="#reference-transfer-flagspending">two-phase pending transfer</a> with the
<a
href="#reference-transfer-flagsclosing_debit"><code>Transfer.flags.closing_debit</code></a>
and/or <a
href="#reference-transfer-flagsclosing_credit"><code>Transfer.flags.closing_credit</code></a>
flags set.</li>
<li>This flag can be <em>unset</em> by <a
href="#reference-transfer-flagsvoid_pending_transfer">voiding</a> the two-phase
pending transfer that closed the account.</li>
</ul>
<h3 id="reference-account-timestamp"><a href="#reference-account-timestamp"
class="anchor"><code>timestamp</code></a></h3>
<p>This is the time the account was created, as nanoseconds since UNIX
epoch. You can read more about <a href="#coding-time">Time in
TigerBeetle</a>.</p>
<p>Constraints:</p>
<ul>
<li><p>Type is 64-bit unsigned integer (8 bytes)</p></li>
<li><p>Must be <code>0</code> when the <code>Account</code> is created
with <a href="#reference-account-flagsimported"><code>flags.imported</code></a>
<em>not</em> set</p>
<p>It is set by TigerBeetle to the moment the account arrives at the
cluster.</p></li>
<li><p>Must be greater than <code>0</code> and less than
<code>2^63</code> when the <code>Account</code> is created with <a
href="#reference-account-flagsimported"><code>flags.imported</code></a> set</p></li>
</ul>
<h2 id="reference-account-internals"><a href="#reference-account-internals"
class="anchor">Internals</a></h2>
<p>If you‚Äôre curious and want to learn more, you can find the source
code for this struct in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/tigerbeetle.zig">src/tigerbeetle.zig</a>.
Search for <code>const Account = extern struct {</code>.</p>
<p>You can find the source code for creating an account in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/state_machine.zig">src/state_machine.zig</a>.
Search for <code>fn create_account(</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/account.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-transfer"><a href="#reference-transfer"
class="anchor"><code>Transfer</code></a></h1>
<p>A <code>transfer</code> is an immutable record of a financial
transaction between two accounts.</p>
<p>In TigerBeetle, financial transactions are called ‚Äútransfers‚Äù instead
of ‚Äútransactions‚Äù because the latter term is heavily overloaded in the
context of databases.</p>
<p>Note that transfers debit a single account and credit a single
account on the same ledger. You can compose these into more complex
transactions using the methods described in <a
href="#coding-recipes-currency-exchange">Currency Exchange</a> and
<a href="#coding-recipes-multi-debit-credit-transfers">Multi-Debit,
Multi-Credit Transfers</a>.</p>
<h3 id="reference-transfer-updates"><a href="#reference-transfer-updates" class="anchor">Updates</a></h3>
<p>Transfers <em>cannot be modified</em> after creation.</p>
<p>If a detail of a transfer is incorrect and needs to be modified, this
is done using <a
href="#coding-recipes-correcting-transfers">correcting
transfers</a>.</p>
<h3 id="reference-transfer-deletion"><a href="#reference-transfer-deletion" class="anchor">Deletion</a></h3>
<p>Transfers <em>cannot be deleted</em> after creation.</p>
<p>If a transfer is made in error, its effects can be reversed using a
<a href="#coding-recipes-correcting-transfers">correcting
transfer</a>.</p>
<h3 id="reference-transfer-guarantees"><a href="#reference-transfer-guarantees"
class="anchor">Guarantees</a></h3>
<ul>
<li>Transfers are immutable. They are never modified once they are
successfully created.</li>
<li>There is at most one <code>Transfer</code> with a particular <a
href="#reference-transfer-id"><code>id</code></a>.</li>
<li>A <a
href="#coding-two-phase-transfers-reserve-funds-pending-transfer">pending
transfer</a> resolves at most once.</li>
<li>Transfer <a href="#reference-transfer-timeout">timeouts</a> are deterministic, driven
by the <a
href="#coding-time-why-tigerbeetle-manages-timestamps">cluster‚Äôs
timestamp</a>.</li>
</ul>
<h2 id="reference-transfer-modes"><a href="#reference-transfer-modes" class="anchor">Modes</a></h2>
<p>Transfers can either be Single-Phase, where they are executed
immediately, or Two-Phase, where they are first put in a Pending state
and then either Posted or Voided. For more details on the latter, see
the <a href="#coding-two-phase-transfers">Two-Phase Transfer
guide</a>.</p>
<p>Fields used by each mode of transfer:</p>
<div class="table">
<table>
<thead>
<tr>
<th>Field</th>
<th>Single-Phase</th>
<th>Pending</th>
<th>Post-Pending</th>
<th>Void-Pending</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>required</td>
<td>required</td>
<td>required</td>
<td>required</td>
</tr>
<tr>
<td><code>debit_account_id</code></td>
<td>required</td>
<td>required</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>credit_account_id</code></td>
<td>required</td>
<td>required</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>amount</code></td>
<td>required</td>
<td>required</td>
<td>required</td>
<td>optional</td>
</tr>
<tr>
<td><code>pending_id</code></td>
<td>none</td>
<td>none</td>
<td>required</td>
<td>required</td>
</tr>
<tr>
<td><code>user_data_128</code></td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>user_data_64</code></td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>user_data_32</code></td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>none</td>
<td>optional¬π</td>
<td>none</td>
<td>none</td>
</tr>
<tr>
<td><code>ledger</code></td>
<td>required</td>
<td>required</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>code</code></td>
<td>required</td>
<td>required</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>flags.linked</code></td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>flags.pending</code></td>
<td>false</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td><code>flags.post_pending_transfer</code></td>
<td>false</td>
<td>false</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td><code>flags.void_pending_transfer</code></td>
<td>false</td>
<td>false</td>
<td>false</td>
<td>true</td>
</tr>
<tr>
<td><code>flags.balancing_debit</code></td>
<td>optional</td>
<td>optional</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td><code>flags.balancing_credit</code></td>
<td>optional</td>
<td>optional</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td><code>flags.closing_debit</code></td>
<td>optional</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td><code>flags.closing_credit</code></td>
<td>optional</td>
<td>true</td>
<td>false</td>
<td>false</td>
</tr>
<tr>
<td><code>flags.imported</code></td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
<td>optional</td>
</tr>
<tr>
<td><code>timestamp</code></td>
<td>none¬≤</td>
<td>none¬≤</td>
<td>none¬≤</td>
<td>none¬≤</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><em>¬π None if <code>flags.imported</code> is set.</em><br/> <em>¬≤
Required if <code>flags.imported</code> is set.</em></p>
</blockquote>
<h2 id="reference-transfer-fields"><a href="#reference-transfer-fields" class="anchor">Fields</a></h2>
<h3 id="reference-transfer-id"><a href="#reference-transfer-id" class="anchor"><code>id</code></a></h3>
<p>This is a unique identifier for the transaction.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must not be zero or <code>2^128 - 1</code></li>
<li>Must not conflict with another transfer in the cluster</li>
</ul>
<p>See the <a href="#coding-data-modeling-id"><code>id</code>
section in the data modeling doc</a> for more recommendations on
choosing an ID scheme.</p>
<p>Note that transfer IDs are unique for the cluster ‚Äì not the ledger.
If you want to store a relationship between multiple transfers, such as
indicating that multiple transfers on different ledgers were part of a
single transaction, you should store a transaction ID in one of the <a
href="#reference-transfer-user_data_128"><code>user_data</code></a> fields.</p>
<h3 id="reference-transfer-debit_account_id"><a href="#reference-transfer-debit_account_id"
class="anchor"><code>debit_account_id</code></a></h3>
<p>This refers to the account to debit the transfer‚Äôs <a
href="#reference-transfer-amount"><code>amount</code></a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>When <code>flags.post_pending_transfer</code> and
<code>flags.void_pending_transfer</code> are <em>not</em> set:
<ul>
<li>Must match an existing account</li>
<li>Must not be the same as <code>credit_account_id</code></li>
</ul></li>
<li>When <code>flags.post_pending_transfer</code> or
<code>flags.void_pending_transfer</code> are set:
<ul>
<li>If <code>debit_account_id</code> is zero, it will be automatically
set to the pending transfer‚Äôs <code>debit_account_id</code>.</li>
<li>If <code>debit_account_id</code> is nonzero, it must match the
corresponding pending transfer‚Äôs <code>debit_account_id</code>.</li>
</ul></li>
<li>When <code>flags.imported</code> is set:
<ul>
<li>The matching account‚Äôs <a href="#reference-account-timestamp">timestamp</a>
must be less than or equal to the transfer‚Äôs <a
href="#reference-transfer-timestamp">timestamp</a>.</li>
</ul></li>
</ul>
<h3 id="reference-transfer-credit_account_id"><a href="#reference-transfer-credit_account_id"
class="anchor"><code>credit_account_id</code></a></h3>
<p>This refers to the account to credit the transfer‚Äôs <a
href="#reference-transfer-amount"><code>amount</code></a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>When <code>flags.post_pending_transfer</code> and
<code>flags.void_pending_transfer</code> are <em>not</em> set:
<ul>
<li>Must match an existing account</li>
<li>Must not be the same as <code>debit_account_id</code></li>
</ul></li>
<li>When <code>flags.post_pending_transfer</code> or
<code>flags.void_pending_transfer</code> are set:
<ul>
<li>If <code>credit_account_id</code> is zero, it will be automatically
set to the pending transfer‚Äôs <code>credit_account_id</code>.</li>
<li>If <code>credit_account_id</code> is nonzero, it must match the
corresponding pending transfer‚Äôs <code>credit_account_id</code>.</li>
</ul></li>
<li>When <code>flags.imported</code> is set:
<ul>
<li>The matching account‚Äôs <a href="#reference-account-timestamp">timestamp</a>
must be less than or equal to the transfer‚Äôs <a
href="#reference-transfer-timestamp">timestamp</a>.</li>
</ul></li>
</ul>
<h3 id="reference-transfer-amount"><a href="#reference-transfer-amount"
class="anchor"><code>amount</code></a></h3>
<p>This is how much should be debited from the
<code>debit_account_id</code> account and credited to the
<code>credit_account_id</code> account.</p>
<p>Note that this is an unsigned 128-bit integer. You can read more
about using <a
href="#coding-data-modeling-debits-vs-credits">debits and
credits</a> to represent positive and negative balances as well as <a
href="#coding-data-modeling-fractional-amounts-and-asset-scale">fractional
amounts and asset scales</a>.</p>
<ul>
<li>When <code>flags.balancing_debit</code> is set, this is the maximum
amount that will be debited/credited, where the actual transfer amount
is determined by the debit account‚Äôs constraints.</li>
<li>When <code>flags.balancing_credit</code> is set, this is the maximum
amount that will be debited/credited, where the actual transfer amount
is determined by the credit account‚Äôs constraints.</li>
<li>When <code>flags.post_pending_transfer</code> is set, the amount
posted will be:
<ul>
<li>the pending transfer‚Äôs amount, when the posted transfer‚Äôs
<code>amount</code> is <code>AMOUNT_MAX</code></li>
<li>the posting transfer‚Äôs amount, when the posted transfer‚Äôs
<code>amount</code> is less than or equal to the pending transfer‚Äôs
amount.</li>
</ul></li>
</ul>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>When <code>flags.void_pending_transfer</code> is set:
<ul>
<li>If <code>amount</code> is zero, it will be automatically be set to
the pending transfer‚Äôs <code>amount</code>.</li>
<li>If <code>amount</code> is nonzero, it must be equal to the pending
transfer‚Äôs <code>amount</code>.</li>
</ul></li>
<li>When <code>flags.post_pending_transfer</code> is set:
<ul>
<li>If <code>amount</code> is <code>AMOUNT_MAX</code>
(<code>2^128 - 1</code>), it will automatically be set to the pending
transfer‚Äôs <code>amount</code>.</li>
<li>If <code>amount</code> is not <code>AMOUNT_MAX</code>, it must be
less than or equal to the pending transfer‚Äôs <code>amount</code>.</li>
</ul></li>
</ul>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>Additional constraints:</p>
<ul>
<li>When <code>flags.post_pending_transfer</code> is set:
<ul>
<li>If <code>amount</code> is zero, it will be automatically be set to
the pending transfer‚Äôs <code>amount</code>.</li>
<li>If <code>amount</code> is nonzero, it must be less than or equal to
the pending transfer‚Äôs <code>amount</code>.</li>
</ul></li>
<li>When <code>flags.balancing_debit</code> and/or
<code>flags.balancing_credit</code> is set, if <code>amount</code> is
zero, it will automatically be set to the maximum amount that does not
violate the corresponding account limits. (Equivalent to setting
<code>amount = 2^128 - 1</code>).</li>
<li>When all of the following flags are not set, <code>amount</code>
must be nonzero:
<ul>
<li><code>flags.post_pending_transfer</code></li>
<li><code>flags.void_pending_transfer</code></li>
<li><code>flags.balancing_debit</code></li>
<li><code>flags.balancing_credit</code></li>
</ul></li>
</ul>
</details>

<h4 id="reference-transfer-examples"><a href="#reference-transfer-examples" class="anchor">Examples</a></h4>
<ul>
<li>For representing fractional amounts (e.g. <code>$12.34</code>), see
<a
href="#coding-data-modeling-fractional-amounts-and-asset-scale">Fractional
Amounts</a>.</li>
<li>For balancing transfers, see <a
href="#coding-recipes-close-account">Close Account</a>.</li>
</ul>
<h3 id="reference-transfer-pending_id"><a href="#reference-transfer-pending_id"
class="anchor"><code>pending_id</code></a></h3>
<p>If this transfer will post or void a pending transfer,
<code>pending_id</code> references that pending transfer. If this is not
a post or void transfer, it must be zero.</p>
<p>See the section on <a
href="#coding-two-phase-transfers">Two-Phase Transfers</a> for more
information on how the <code>pending_id</code> is used.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must be zero if neither void nor pending transfer flag is set</li>
<li>Must match an existing transfer‚Äôs <a href="#reference-transfer-id"><code>id</code></a>
if non-zero</li>
</ul>
<h3 id="reference-transfer-user_data_128"><a href="#reference-transfer-user_data_128"
class="anchor"><code>user_data_128</code></a></h3>
<p>This is an optional 128-bit secondary identifier to link this
transfer to an external entity or event.</p>
<p>When set to zero, no secondary identifier will be associated with the
account, therefore only non-zero values can be used as <a
href="#reference-query-filter">query filter</a>.</p>
<p>When set to zero, if <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>
or <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>
is set, then it will be automatically set to the pending transfer‚Äôs
<code>user_data_128</code>.</p>
<p>As an example, you might generate a <a
href="#coding-data-modeling-tigerbeetle-time-based-identifiers-recommended">TigerBeetle
Time-Based Identifier</a> that ties together a group of transfers.</p>
<p>For more information, see <a
href="#coding-data-modeling-user_data">Data Modeling</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-transfer-user_data_64"><a href="#reference-transfer-user_data_64"
class="anchor"><code>user_data_64</code></a></h3>
<p>This is an optional 64-bit secondary identifier to link this transfer
to an external entity or event.</p>
<p>When set to zero, no secondary identifier will be associated with the
account, therefore only non-zero values can be used as <a
href="#reference-query-filter">query filter</a>.</p>
<p>When set to zero, if <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>
or <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>
is set, then it will be automatically set to the pending transfer‚Äôs
<code>user_data_64</code>.</p>
<p>As an example, you might use this field store an external
timestamp.</p>
<p>For more information, see <a
href="#coding-data-modeling-user_data">Data Modeling</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
</ul>
<h3 id="reference-transfer-user_data_32"><a href="#reference-transfer-user_data_32"
class="anchor"><code>user_data_32</code></a></h3>
<p>This is an optional 32-bit secondary identifier to link this transfer
to an external entity or event.</p>
<p>When set to zero, no secondary identifier will be associated with the
account, therefore only non-zero values can be used as <a
href="#reference-query-filter">query filter</a>.</p>
<p>When set to zero, if <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>
or <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>
is set, then it will be automatically set to the pending transfer‚Äôs
<code>user_data_32</code>.</p>
<p>As an example, you might use this field to store a timezone or
locale.</p>
<p>For more information, see <a
href="#coding-data-modeling-user_data">Data Modeling</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h3 id="reference-transfer-timeout"><a href="#reference-transfer-timeout"
class="anchor"><code>timeout</code></a></h3>
<p>This is the interval in seconds after a <a
href="#reference-transfer-flagspending"><code>pending</code></a> transfer‚Äôs <a
href="#reference-transfer-timestamp">arrival at the cluster</a> that it may be <a
href="#reference-transfer-flagspost_pending_transfer">posted</a> or <a
href="#reference-transfer-flagsvoid_pending_transfer">voided</a>. Zero denotes absence of
timeout.</p>
<p>Non-pending transfers cannot have a timeout.</p>
<p>Imported transfers cannot have a timeout.</p>
<p>TigerBeetle makes a best-effort approach to remove pending balances
of expired transfers automatically:</p>
<ul>
<li><p>Transfers expire <em>exactly</em> at their expiry time (<a
href="#reference-transfer-timestamp"><code>timestamp</code></a> <em>plus</em>
<code>timeout</code> converted in nanoseconds).</p></li>
<li><p>Pending balances will never be removed before its
expiry.</p></li>
<li><p>Expired transfers cannot be manually posted or voided.</p></li>
<li><p>It is not guaranteed that the pending balance will be removed
exactly at its expiry.</p>
<p>In particular, client requests may observe still-pending balances for
expired transfers.</p></li>
<li><p>Pending balances are removed in chronological order by expiry. If
multiple transfers expire at the same time, then ordered by the
transfer‚Äôs creation <a href="#reference-transfer-timestamp"><code>timestamp</code></a>.</p>
<p>If a transfer <code>A</code> has expiry <code>E‚ÇÅ</code> and transfer
<code>B</code> has expiry <code>E‚ÇÇ</code>, and <code>E‚ÇÅ&lt;E‚ÇÇ</code>, if
transfer <code>B</code> had the pending balance removed, then transfer
<code>A</code> had the pending balance removed as well.</p></li>
</ul>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
<li>Must be zero if <code>flags.pending</code> is <em>not</em> set</li>
<li>Must be zero if <code>flags.imported</code> is set.</li>
</ul>
<p>The <code>timeout</code> is an interval in seconds rather than an
absolute timestamp because this is more robust to clock skew between the
cluster and the application. (Watch this talk on <a
href="https://youtu.be/7R-Iz6sJG6Q?si=9sD2TpfD29AxUjOY">Detecting Clock
Sync Failure in Highly Available Systems</a> on YouTube for more
details.)</p>
<h3 id="reference-transfer-ledger"><a href="#reference-transfer-ledger"
class="anchor"><code>ledger</code></a></h3>
<p>This is an identifier that partitions the sets of accounts that can
transact with each other.</p>
<p>See <a href="#coding-data-modeling-ledgers">data modeling</a>
for more details about how to think about setting up your ledgers.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
<li>When <code>flags.post_pending_transfer</code> or
<code>flags.void_pending_transfer</code> is set:
<ul>
<li>If <code>ledger</code> is zero, it will be automatically be set to
the pending transfer‚Äôs <code>ledger</code>.</li>
<li>If <code>ledger</code> is nonzero, it must match the
<code>ledger</code> value on the pending transfer‚Äôs
<code>debit_account_id</code> <strong>and</strong>
<code>credit_account_id</code>.</li>
</ul></li>
<li>When <code>flags.post_pending_transfer</code> and
<code>flags.void_pending_transfer</code> are not set:
<ul>
<li><code>ledger</code> must not be zero.</li>
<li><code>ledger</code> must match the <code>ledger</code> value on the
accounts referenced in <code>debit_account_id</code>
<strong>and</strong> <code>credit_account_id</code>.</li>
</ul></li>
</ul>
<h3 id="reference-transfer-code"><a href="#reference-transfer-code" class="anchor"><code>code</code></a></h3>
<p>This is a user-defined enum denoting the reason for (or category of)
the transfer.</p>
<p>Constraints:</p>
<ul>
<li>Type is 16-bit unsigned integer (2 bytes)</li>
<li>When <code>flags.post_pending_transfer</code> or
<code>flags.void_pending_transfer</code> is set:
<ul>
<li>If <code>code</code> is zero, it will be automatically be set to the
pending transfer‚Äôs <code>code</code>.</li>
<li>If <code>code</code> is nonzero, it must match the pending
transfer‚Äôs <code>code</code>.</li>
</ul></li>
<li>When <code>flags.post_pending_transfer</code> and
<code>flags.void_pending_transfer</code> are not set, <code>code</code>
must not be zero.</li>
</ul>
<h3 id="reference-transfer-flags"><a href="#reference-transfer-flags"
class="anchor"><code>flags</code></a></h3>
<p>This specifies (optional) transfer behavior.</p>
<p>Constraints:</p>
<ul>
<li>Type is 16-bit unsigned integer (2 bytes)</li>
<li>Some flags are mutually exclusive; see <a
href="#reference-requests-create_transfers-flags_are_mutually_exclusive"><code>flags_are_mutually_exclusive</code></a>.</li>
</ul>
<h4 id="reference-transfer-flagslinked"><a href="#reference-transfer-flagslinked"
class="anchor"><code>flags.linked</code></a></h4>
<p>This flag links the result of this transfer to the outcome of the
next transfer in the request such that they will either succeed or fail
together.</p>
<p>The last transfer in a chain of linked transfers does
<strong>not</strong> have this flag set.</p>
<p>You can read more about <a href="#coding-linked-events">linked
events</a>.</p>
<h5 id="reference-transfer-examples-1"><a href="#reference-transfer-examples-1"
class="anchor">Examples</a></h5>
<ul>
<li><a href="#coding-recipes-currency-exchange">Currency
Exchange</a></li>
</ul>
<h4 id="reference-transfer-flagspending"><a href="#reference-transfer-flagspending"
class="anchor"><code>flags.pending</code></a></h4>
<p>Mark the transfer as a <a
href="#coding-two-phase-transfers-reserve-funds-pending-transfer">pending
transfer</a>.</p>
<h4 id="reference-transfer-flagspost_pending_transfer"><a
href="#reference-transfer-flagspost_pending_transfer"
class="anchor"><code>flags.post_pending_transfer</code></a></h4>
<p>Mark the transfer as a <a
href="#coding-two-phase-transfers-post-pending-transfer">post-pending
transfer</a>.</p>
<h4 id="reference-transfer-flagsvoid_pending_transfer"><a
href="#reference-transfer-flagsvoid_pending_transfer"
class="anchor"><code>flags.void_pending_transfer</code></a></h4>
<p>Mark the transfer as a <a
href="#coding-two-phase-transfers-void-pending-transfer">void-pending
transfer</a>.</p>
<h4 id="reference-transfer-flagsbalancing_debit"><a href="#reference-transfer-flagsbalancing_debit"
class="anchor"><code>flags.balancing_debit</code></a></h4>
<p>Transfer at most <a href="#reference-transfer-amount"><code>amount</code></a> ‚Äî
automatically transferring less than <code>amount</code> as necessary
such that
<code>debit_account.debits_pending + debit_account.debits_posted ‚â§ debit_account.credits_posted</code>.</p>
<p>The <code>amount</code> of the recorded transfer is set to the actual
amount that was transferred, which is less than or equal to the amount
that was passed to <code>create_transfers</code>.</p>
<p>Retrying a balancing transfer will return <a
href="#reference-requests-create_transfers-exists_with_different_amount"><code>exists_with_different_amount</code></a>
only when the maximum amount passed to <code>create_transfers</code> is
insufficient to fulfill the amount that was actually transferred.
Otherwise it may return <a
href="#reference-requests-create_transfers-exists"><code>exists</code></a> even
if the retry amount differs from the original value.</p>
<p><code>flags.balancing_debit</code> is exclusive with the
<code>flags.post_pending_transfer</code>/<code>flags.void_pending_transfer</code>
flags because posting or voiding a pending transfer will never
exceed/overflow either account‚Äôs limits.</p>
<p><code>flags.balancing_debit</code> is compatible with (and orthogonal
to) <code>flags.balancing_credit</code>.</p>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>Transfer at most <a href="#reference-transfer-amount"><code>amount</code></a> ‚Äî
automatically transferring less than <code>amount</code> as necessary
such that
<code>debit_account.debits_pending + debit_account.debits_posted ‚â§ debit_account.credits_posted</code>.
If <code>amount</code> is set to <code>0</code>, transfer at most
<code>2^64 - 1</code> (i.e. as much as possible).</p>
<p>If the highest amount transferable is <code>0</code>, returns <a
href="#reference-requests-create_transfers-exceeds_credits"><code>exceeds_credits</code></a>.</p>
</details>

<h5 id="reference-transfer-examples-2"><a href="#reference-transfer-examples-2"
class="anchor">Examples</a></h5>
<ul>
<li><a href="#coding-recipes-close-account">Close Account</a></li>
</ul>
<h4 id="reference-transfer-flagsbalancing_credit"><a href="#reference-transfer-flagsbalancing_credit"
class="anchor"><code>flags.balancing_credit</code></a></h4>
<p>Transfer at most <a href="#reference-transfer-amount"><code>amount</code></a> ‚Äî
automatically transferring less than <code>amount</code> as necessary
such that
<code>credit_account.credits_pending + credit_account.credits_posted ‚â§ credit_account.debits_posted</code>.</p>
<p>The <code>amount</code> of the recorded transfer is set to the actual
amount that was transferred, which is less than or equal to the amount
that was passed to <code>create_transfers</code>.</p>
<p>Retrying a balancing transfer will return <a
href="#reference-requests-create_transfers-exists_with_different_amount"><code>exists_with_different_amount</code></a>
only when the maximum amount passed to <code>create_transfers</code> is
insufficient to fulfill the amount that was actually transferred.
Otherwise it may return <a
href="#reference-requests-create_transfers-exists"><code>exists</code></a> even
if the retry amount differs from the original value.</p>
<p><code>flags.balancing_credit</code> is exclusive with the
<code>flags.post_pending_transfer</code>/<code>flags.void_pending_transfer</code>
flags because posting or voiding a pending transfer will never
exceed/overflow either account‚Äôs limits.</p>
<p><code>flags.balancing_credit</code> is compatible with (and
orthogonal to) <code>flags.balancing_debit</code>.</p>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>Transfer at most <a href="#reference-transfer-amount"><code>amount</code></a> ‚Äî
automatically transferring less than <code>amount</code> as necessary
such that
<code>credit_account.credits_pending + credit_account.credits_posted ‚â§ credit_account.debits_posted</code>.
If <code>amount</code> is set to <code>0</code>, transfer at most
<code>2^64 - 1</code> (i.e. as much as possible).</p>
<p>If the highest amount transferable is <code>0</code>, returns <a
href="#reference-requests-create_transfers-exceeds_debits"><code>exceeds_debits</code></a>.</p>
</details>

<h5 id="reference-transfer-examples-3"><a href="#reference-transfer-examples-3"
class="anchor">Examples</a></h5>
<ul>
<li><a href="#coding-recipes-close-account">Close Account</a></li>
</ul>
<h4 id="reference-transfer-flagsclosing_debit"><a href="#reference-transfer-flagsclosing_debit"
class="anchor"><code>flags.closing_debit</code></a></h4>
<p>When set, it will cause the <a
href="#reference-account-flagsclosed"><code>Account.flags.closed</code></a> flag
of the <a href="#reference-transfer-debit_account_id">debit account</a> to be set if the
transfer succeeds.</p>
<p>This flag requires a <a href="#reference-transfer-modes">two-phase transfer</a>, so the
flag <a href="#reference-transfer-flagspending"><code>flags.pending</code></a> must also be
set. This ensures that closing transfers are reversible by <a
href="#reference-transfer-flagsvoid_pending_transfer">voiding</a> the pending transfer, and
requires that the reversal operation references the corresponding
closing transfer, guarding against unexpected interleaving of
close/unclose operations.</p>
<h4 id="reference-transfer-flagsclosing_credit"><a href="#reference-transfer-flagsclosing_credit"
class="anchor"><code>flags.closing_credit</code></a></h4>
<p>When set, it will cause the <a
href="#reference-account-flagsclosed"><code>Account.flags.closed</code></a> flag
of the <a href="#reference-transfer-credit_account_id">credit account</a> to be set if the
transfer succeeds.</p>
<p>This flag requires a <a href="#reference-transfer-modes">two-phase transfer</a>, so the
flag <a href="#reference-transfer-flagspending"><code>flags.pending</code></a> must also be
set. This ensures that closing transfers are reversible by <a
href="#reference-transfer-flagsvoid_pending_transfer">voiding</a> the pending transfer, and
requires that the reversal operation references the corresponding
closing transfer, guarding against unexpected interleaving of
close/unclose operations.</p>
<h4 id="reference-transfer-flagsimported"><a href="#reference-transfer-flagsimported"
class="anchor"><code>flags.imported</code></a></h4>
<p>When set, allows importing historical <code>Transfer</code>s with
their original <a href="#reference-transfer-timestamp"><code>timestamp</code></a>.</p>
<p>TigerBeetle will not use the <a href="#coding-time">cluster
clock</a> to assign the timestamp, allowing the user to define it,
expressing <em>when</em> the transfer was effectively created by an
external event.</p>
<p>To maintain system invariants regarding auditability and
traceability, some constraints are necessary:</p>
<ul>
<li><p>It is not allowed to mix events with the <code>imported</code>
flag set and <em>not</em> set in the same batch. The application must
submit batches of imported events separately.</p></li>
<li><p>User-defined timestamps must be <strong>unique</strong> and
expressed as nanoseconds since the UNIX epoch. No two objects can have
the same timestamp, even different objects like an <code>Account</code>
and a <code>Transfer</code> cannot share the same timestamp.</p></li>
<li><p>User-defined timestamps must be a past date, never ahead of the
cluster clock at the time the request arrives.</p></li>
<li><p>Timestamps must be strictly increasing.</p>
<p>Even user-defined timestamps that are required to be past dates need
to be at least one nanosecond ahead of the timestamp of the last
transfer committed by the cluster.</p>
<p>Since the timestamp cannot regress, importing past events can be
naturally restrictive without coordination, as the last timestamp can be
updated using the cluster clock during regular cluster activity.
Instead, it‚Äôs recommended to import events only on a fresh cluster or
during a scheduled maintenance window.</p>
<p>It‚Äôs recommended to submit the entire batch as a <a
href="#reference-transfer-flagslinked">linked chain</a>, ensuring that if any transfer
fails, none of them are committed, preserving the last timestamp
unchanged. This approach gives the application a chance to correct
failed imported transfers, re-submitting the batch again with the same
user-defined timestamps.</p></li>
<li><p>Imported transfers cannot have a <a
href="#reference-transfer-timeout"><code>timeout</code></a>.</p>
<p>It‚Äôs possible to import <a href="#reference-transfer-flagspending">pending</a> transfers
with a user-defined timestamp, but since it‚Äôs not driven by the cluster
clock, it cannot define a <a href="#reference-transfer-timeout"><code>timeout</code></a>
for automatic expiration. In those cases, the <a
href="#coding-two-phase-transfers">two-phase post or rollback</a>
must be done manually.</p></li>
</ul>
<h3 id="reference-transfer-timestamp"><a href="#reference-transfer-timestamp"
class="anchor"><code>timestamp</code></a></h3>
<p>This is the time the transfer was created, as nanoseconds since UNIX
epoch. You can read more about <a href="#coding-time">Time in
TigerBeetle</a>.</p>
<p>Constraints:</p>
<ul>
<li><p>Type is 64-bit unsigned integer (8 bytes)</p></li>
<li><p>Must be <code>0</code> when the <code>Transfer</code> is created
with <a href="#reference-transfer-flagsimported"><code>flags.imported</code></a>
<em>not</em> set</p>
<p>It is set by TigerBeetle to the moment the transfer arrives at the
cluster.</p></li>
<li><p>Must be greater than <code>0</code> and less than
<code>2^63</code> when the <code>Transfer</code> is created with <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a> set</p></li>
</ul>
<h2 id="reference-transfer-internals"><a href="#reference-transfer-internals"
class="anchor">Internals</a></h2>
<p>If you‚Äôre curious and want to learn more, you can find the source
code for this struct in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/tigerbeetle.zig">src/tigerbeetle.zig</a>.
Search for <code>const Transfer = extern struct {</code>.</p>
<p>You can find the source code for creating a transfer in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/state_machine.zig">src/state_machine.zig</a>.
Search for <code>fn create_transfer(</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/transfer.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-account-balance"><a href="#reference-account-balance"
class="anchor"><code>AccountBalance</code></a></h1>
<p>An <code>AccountBalance</code> is a record storing the <a
href="#reference-account"><code>Account</code></a>‚Äôs balance at a given point in
time.</p>
<p>Only Accounts with the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set retain <a
href="#reference-requests-get_account_balances">historical
balances</a>.</p>
<h2 id="reference-account-balance-fields"><a href="#reference-account-balance-fields" class="anchor">Fields</a></h2>
<h3 id="reference-account-balance-timestamp"><a href="#reference-account-balance-timestamp"
class="anchor"><code>timestamp</code></a></h3>
<p>This is the time the account balance was updated, as nanoseconds
since UNIX epoch.</p>
<p>The timestamp refers to the same <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> which
changed the <a href="#reference-account"><code>Account</code></a>.</p>
<p>The amounts refer to the account balance recorded <em>after</em> the
transfer execution.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
</ul>
<h3 id="reference-account-balance-debits_pending"><a href="#reference-account-balance-debits_pending"
class="anchor"><code>debits_pending</code></a></h3>
<p>Amount of <a href="#reference-account-debits_pending">pending debits</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-account-balance-debits_posted"><a href="#reference-account-balance-debits_posted"
class="anchor"><code>debits_posted</code></a></h3>
<p>Amount of <a href="#reference-account-debits_posted">posted debits</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-account-balance-credits_pending"><a href="#reference-account-balance-credits_pending"
class="anchor"><code>credits_pending</code></a></h3>
<p>Amount of <a href="#reference-account-credits_pending">pending
credits</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-account-balance-credits_posted"><a href="#reference-account-balance-credits_posted"
class="anchor"><code>credits_posted</code></a></h3>
<p>Amount of <a href="#reference-account-credits_posted">posted credits</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-account-balance-reserved"><a href="#reference-account-balance-reserved"
class="anchor"><code>reserved</code></a></h3>
<p>This space may be used for additional data in the future.</p>
<p>Constraints:</p>
<ul>
<li>Type is 56 bytes</li>
<li>Must be zero</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/account-balance.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-account-filter"><a href="#reference-account-filter"
class="anchor"><code>AccountFilter</code></a></h1>
<p>An <code>AccountFilter</code> is a record containing the filter
parameters for querying the <a
href="#reference-requests-get_account_transfers">account transfers</a> and the
<a href="#reference-requests-get_account_balances">account historical
balances</a>.</p>
<h2 id="reference-account-filter-fields"><a href="#reference-account-filter-fields" class="anchor">Fields</a></h2>
<h3 id="reference-account-filter-account_id"><a href="#reference-account-filter-account_id"
class="anchor"><code>account_id</code></a></h3>
<p>The unique <a href="#reference-account-id">identifier</a> of the account for
which the results will be retrieved.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
<li>Must not be zero or <code>2^128 - 1</code></li>
</ul>
<h3 id="reference-account-filter-user_data_128"><a href="#reference-account-filter-user_data_128"
class="anchor"><code>user_data_128</code></a></h3>
<p>Filter the results by the field <a
href="#reference-transfer-user_data_128"><code>Transfer.user_data_128</code></a>.
Optional; set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-account-filter-user_data_64"><a href="#reference-account-filter-user_data_64"
class="anchor"><code>user_data_64</code></a></h3>
<p>Filter the results by the field <a
href="#reference-transfer-user_data_64"><code>Transfer.user_data_64</code></a>.
Optional; set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
</ul>
<h3 id="reference-account-filter-user_data_32"><a href="#reference-account-filter-user_data_32"
class="anchor"><code>user_data_32</code></a></h3>
<p>Filter the results by the field <a
href="#reference-transfer-user_data_32"><code>Transfer.user_data_32</code></a>.
Optional; set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h3 id="reference-account-filter-code"><a href="#reference-account-filter-code" class="anchor"><code>code</code></a></h3>
<p>Filter the results by the <a
href="#reference-transfer-code"><code>Transfer.code</code></a>. Optional; set to
zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 16-bit unsigned integer (2 bytes)</li>
</ul>
<h3 id="reference-account-filter-reserved"><a href="#reference-account-filter-reserved"
class="anchor"><code>reserved</code></a></h3>
<p>This space may be used for additional data in the future.</p>
<p>Constraints:</p>
<ul>
<li>Type is 58 bytes</li>
<li>Must be zero</li>
</ul>
<h3 id="reference-account-filter-timestamp_min"><a href="#reference-account-filter-timestamp_min"
class="anchor"><code>timestamp_min</code></a></h3>
<p>The minimum <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> from
which results will be returned, inclusive range. Optional; set to zero
to disable the lower-bound filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
<li>Must be less than <code>2^63</code>.</li>
</ul>
<h3 id="reference-account-filter-timestamp_max"><a href="#reference-account-filter-timestamp_max"
class="anchor"><code>timestamp_max</code></a></h3>
<p>The maximum <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> from
which results will be returned, inclusive range. Optional; set to zero
to disable the upper-bound filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
<li>Must be less than <code>2^63</code>.</li>
</ul>
<h3 id="reference-account-filter-limit"><a href="#reference-account-filter-limit"
class="anchor"><code>limit</code></a></h3>
<p>The maximum number of results that can be returned by this query.</p>
<p>Limited by the <a
href="#coding-requests-batching-events">maximum message
size</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
<li>Must not be zero</li>
</ul>
<h3 id="reference-account-filter-flags"><a href="#reference-account-filter-flags"
class="anchor"><code>flags</code></a></h3>
<p>A bitfield that specifies querying behavior.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h4 id="reference-account-filter-flagsdebits"><a href="#reference-account-filter-flagsdebits"
class="anchor"><code>flags.debits</code></a></h4>
<p>Whether or not to include results where the field <a
href="#reference-transfer-debit_account_id"><code>debit_account_id</code></a>
matches the parameter <a
href="#reference-account-filter-account_id"><code>account_id</code></a>.</p>
<h4 id="reference-account-filter-flagscredits"><a href="#reference-account-filter-flagscredits"
class="anchor"><code>flags.credits</code></a></h4>
<p>Whether or not to include results where the field <a
href="#reference-transfer-credit_account_id"><code>credit_account_id</code></a>
matches the parameter <a
href="#reference-account-filter-account_id"><code>account_id</code></a>.</p>
<h4 id="reference-account-filter-flagsreversed"><a href="#reference-account-filter-flagsreversed"
class="anchor"><code>flags.reversed</code></a></h4>
<p>Whether the results are sorted by timestamp in chronological or
reverse-chronological order. If the flag is not set, the event that
happened first (has the smallest timestamp) will come first. If the flag
is set, the event that happened last (has the largest timestamp) will
come first.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/account-filter.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-query-filter"><a href="#reference-query-filter"
class="anchor"><code>QueryFilter</code></a></h1>
<p>A <code>QueryFilter</code> is a record containing the filter
parameters for <a href="#reference-requests-query_accounts">querying
accounts</a> and <a href="#reference-requests-query_transfers">querying
transfers</a>.</p>
<h2 id="reference-query-filter-fields"><a href="#reference-query-filter-fields" class="anchor">Fields</a></h2>
<h3 id="reference-query-filter-user_data_128"><a href="#reference-query-filter-user_data_128"
class="anchor"><code>user_data_128</code></a></h3>
<p>Filter the results by the field <a
href="#reference-account-user_data_128"><code>Account.user_data_128</code></a>
or <a
href="#reference-transfer-user_data_128"><code>Transfer.user_data_128</code></a>.
Optional; set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 128-bit unsigned integer (16 bytes)</li>
</ul>
<h3 id="reference-query-filter-user_data_64"><a href="#reference-query-filter-user_data_64"
class="anchor"><code>user_data_64</code></a></h3>
<p>Filter the results by the field <a
href="#reference-account-user_data_64"><code>Account.user_data_64</code></a> or
<a
href="#reference-transfer-user_data_64"><code>Transfer.user_data_64</code></a>.
Optional; set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
</ul>
<h3 id="reference-query-filter-user_data_32"><a href="#reference-query-filter-user_data_32"
class="anchor"><code>user_data_32</code></a></h3>
<p>Filter the results by the field <a
href="#reference-account-user_data_32"><code>Account.user_data_32</code></a> or
<a
href="#reference-transfer-user_data_32"><code>Transfer.user_data_32</code></a>.
Optional; set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h3 id="reference-query-filter-ledger"><a href="#reference-query-filter-ledger"
class="anchor"><code>ledger</code></a></h3>
<p>Filter the results by the field <a
href="#reference-account-ledger"><code>Account.ledger</code></a> or <a
href="#reference-transfer-ledger"><code>Transfer.ledger</code></a>. Optional;
set to zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h3 id="reference-query-filter-code"><a href="#reference-query-filter-code" class="anchor"><code>code</code></a></h3>
<p>Filter the results by the field <a
href="#reference-account-code"><code>Account.code</code></a> or <a
href="#reference-transfer-code"><code>Transfer.code</code></a>. Optional; set to
zero to disable the filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 16-bit unsigned integer (2 bytes)</li>
</ul>
<h3 id="reference-query-filter-timestamp_min"><a href="#reference-query-filter-timestamp_min"
class="anchor"><code>timestamp_min</code></a></h3>
<p>The minimum <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a> or <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> from
which results will be returned, inclusive range. Optional; set to zero
to disable the lower-bound filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
<li>Must not be <code>2^64 - 1</code></li>
</ul>
<h3 id="reference-query-filter-timestamp_max"><a href="#reference-query-filter-timestamp_max"
class="anchor"><code>timestamp_max</code></a></h3>
<p>The maximum <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a> or <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> from
which results will be returned, inclusive range. Optional; set to zero
to disable the upper-bound filter.</p>
<p>Constraints:</p>
<ul>
<li>Type is 64-bit unsigned integer (8 bytes)</li>
<li>Must not be <code>2^64 - 1</code></li>
</ul>
<h3 id="reference-query-filter-limit"><a href="#reference-query-filter-limit"
class="anchor"><code>limit</code></a></h3>
<p>The maximum number of results that can be returned by this query.</p>
<p>Limited by the <a
href="#coding-requests-batching-events">maximum message
size</a>.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
<li>Must not be zero</li>
</ul>
<h3 id="reference-query-filter-flags"><a href="#reference-query-filter-flags"
class="anchor"><code>flags</code></a></h3>
<p>A bitfield that specifies querying behavior.</p>
<p>Constraints:</p>
<ul>
<li>Type is 32-bit unsigned integer (4 bytes)</li>
</ul>
<h4 id="reference-query-filter-flagsreversed"><a href="#reference-query-filter-flagsreversed"
class="anchor"><code>flags.reversed</code></a></h4>
<p>Whether the results are sorted by timestamp in chronological or
reverse-chronological order. If the flag is not set, the event that
happened first (has the smallest timestamp) will come first. If the flag
is set, the event that happened last (has the largest timestamp) will
come first.</p>
<h3 id="reference-query-filter-reserved"><a href="#reference-query-filter-reserved"
class="anchor"><code>reserved</code></a></h3>
<p>This space may be used for additional data in the future.</p>
<p>Constraints:</p>
<ul>
<li>Type is 6 bytes</li>
<li>Must be zero</li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/query-filter.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests"><a href="#reference-requests" class="anchor">Requests</a></h1>
<p>TigerBeetle supports the following request types:</p>
<ul>
<li><a href="#reference-requests-create_accounts"><code>create_accounts</code></a>: create
<a href="#reference-account"><code>Account</code>s</a></li>
<li><a href="#reference-requests-create_transfers"><code>create_transfers</code></a>:
create <a href="#reference-transfer"><code>Transfer</code>s</a></li>
<li><a href="#reference-requests-lookup_accounts"><code>lookup_accounts</code></a>: fetch
<code>Account</code>s by <code>id</code></li>
<li><a href="#reference-requests-lookup_transfers"><code>lookup_transfers</code></a>:
fetch <code>Transfer</code>s by <code>id</code></li>
<li><a
href="#reference-requests-get_account_transfers"><code>get_account_transfers</code></a>:
fetch <code>Transfer</code>s by <code>debit_account_id</code> or
<code>credit_account_id</code></li>
<li><a
href="#reference-requests-get_account_balances"><code>get_account_balances</code></a>:
fetch the historical account balance by the <code>Account</code>‚Äôs
<code>id</code>.</li>
<li><a href="#reference-requests-query_accounts"><code>query_accounts</code></a>: query
<code>Account</code>s</li>
<li><a href="#reference-requests-query_transfers"><code>query_transfers</code></a>: query
<code>Transfer</code>s</li>
</ul>
<p><em>More request types, including more powerful queries, are coming
soon!</em></p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-create_accounts"><a href="#reference-requests-create_accounts"
class="anchor"><code>create_accounts</code></a></h1>
<p>Create one or more <a
href="#reference-account"><code>Account</code></a>s.</p>
<h2 id="reference-requests-create_accounts-event"><a href="#reference-requests-create_accounts-event" class="anchor">Event</a></h2>
<p>The account to create. See <a
href="#reference-account"><code>Account</code></a> for constraints.</p>
<h2 id="reference-requests-create_accounts-result"><a href="#reference-requests-create_accounts-result" class="anchor">Result</a></h2>
<p>Results are listed in this section in order of descending precedence
‚Äî that is, if more than one error is applicable to the account being
created, only the result listed first is returned.</p>
<h3 id="reference-requests-create_accounts-ok"><a href="#reference-requests-create_accounts-ok" class="anchor"><code>ok</code></a></h3>
<p>The account was successfully created; it did not previously
exist.</p>
<p>Note that <code>ok</code> is generated by the client implementation;
the network protocol does not include a result when the account was
successfully created.</p>
<h3 id="reference-requests-create_accounts-linked_event_failed"><a href="#reference-requests-create_accounts-linked_event_failed"
class="anchor"><code>linked_event_failed</code></a></h3>
<p>The account was not created. One or more of the accounts in the <a
href="#reference-account-flagslinked">linked chain</a> is invalid, so the
whole chain failed.</p>
<h3 id="reference-requests-create_accounts-linked_event_chain_open"><a href="#reference-requests-create_accounts-linked_event_chain_open"
class="anchor"><code>linked_event_chain_open</code></a></h3>
<p>The account was not created. The <a
href="#reference-account-flagslinked"><code>Account.flags.linked</code></a>
flag was set on the last event in the batch, which is not legal.
(<code>flags.linked</code> indicates that the chain continues to the
next operation).</p>
<h3 id="reference-requests-create_accounts-imported_event_expected"><a href="#reference-requests-create_accounts-imported_event_expected"
class="anchor"><code>imported_event_expected</code></a></h3>
<p>The account was not created. The <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
was set on the first account of the batch, but not all accounts in the
batch. Batches cannot mix imported accounts with non-imported
accounts.</p>
<h3 id="reference-requests-create_accounts-imported_event_not_expected"><a
href="#reference-requests-create_accounts-imported_event_not_expected"
class="anchor"><code>imported_event_not_expected</code></a></h3>
<p>The account was not created. The <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
was expected to <em>not</em> be set, as it‚Äôs not allowed to mix accounts
with different <code>imported</code> flag in the same batch. The first
account determines the entire operation.</p>
<h3 id="reference-requests-create_accounts-timestamp_must_be_zero"><a href="#reference-requests-create_accounts-timestamp_must_be_zero"
class="anchor"><code>timestamp_must_be_zero</code></a></h3>
<p>This result only applies when <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
is <em>not</em> set.</p>
<p>The account was not created. The <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a> is
nonzero, but must be zero. The cluster is responsible for setting this
field.</p>
<p>The <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a> can
only be assigned when creating accounts with <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
set.</p>
<h3 id="reference-requests-create_accounts-imported_event_timestamp_out_of_range"><a
href="#reference-requests-create_accounts-imported_event_timestamp_out_of_range"
class="anchor"><code>imported_event_timestamp_out_of_range</code></a></h3>
<p>This result only applies when <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
is set.</p>
<p>The account was not created. The <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a> is out
of range, but must be a user-defined timestamp greater than
<code>0</code> and less than <code>2^63</code>.</p>
<h3 id="reference-requests-create_accounts-imported_event_timestamp_must_not_advance"><a
href="#reference-requests-create_accounts-imported_event_timestamp_must_not_advance"
class="anchor"><code>imported_event_timestamp_must_not_advance</code></a></h3>
<p>This result only applies when <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
is set.</p>
<p>The account was not created. The user-defined <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a> is
greater than the current <a href="#coding-time">cluster
time</a>, but it must be a past timestamp.</p>
<h3 id="reference-requests-create_accounts-reserved_field"><a href="#reference-requests-create_accounts-reserved_field"
class="anchor"><code>reserved_field</code></a></h3>
<p>The account was not created. <a
href="#reference-account-reserved"><code>Account.reserved</code></a> is
nonzero, but must be zero.</p>
<h3 id="reference-requests-create_accounts-reserved_flag"><a href="#reference-requests-create_accounts-reserved_flag"
class="anchor"><code>reserved_flag</code></a></h3>
<p>The account was not created. <code>Account.flags.reserved</code> is
nonzero, but must be zero.</p>
<h3 id="reference-requests-create_accounts-id_must_not_be_zero"><a href="#reference-requests-create_accounts-id_must_not_be_zero"
class="anchor"><code>id_must_not_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-id"><code>Account.id</code></a> is zero, which is a
reserved value.</p>
<h3 id="reference-requests-create_accounts-id_must_not_be_int_max"><a href="#reference-requests-create_accounts-id_must_not_be_int_max"
class="anchor"><code>id_must_not_be_int_max</code></a></h3>
<p>The account was not created. <a
href="#reference-account-id"><code>Account.id</code></a> is
<code>2^128 - 1</code>, which is a reserved value.</p>
<h3 id="reference-requests-create_accounts-exists_with_different_flags"><a
href="#reference-requests-create_accounts-exists_with_different_flags"
class="anchor"><code>exists_with_different_flags</code></a></h3>
<p>An account with the same <code>id</code> already exists, but with
different <a href="#reference-account-flags"><code>flags</code></a>.</p>
<h3 id="reference-requests-create_accounts-exists_with_different_user_data_128"><a
href="#reference-requests-create_accounts-exists_with_different_user_data_128"
class="anchor"><code>exists_with_different_user_data_128</code></a></h3>
<p>An account with the same <code>id</code> already exists, but with
different <a
href="#reference-account-user_data_128"><code>user_data_128</code></a>.</p>
<h3 id="reference-requests-create_accounts-exists_with_different_user_data_64"><a
href="#reference-requests-create_accounts-exists_with_different_user_data_64"
class="anchor"><code>exists_with_different_user_data_64</code></a></h3>
<p>An account with the same <code>id</code> already exists, but with
different <a
href="#reference-account-user_data_64"><code>user_data_64</code></a>.</p>
<h3 id="reference-requests-create_accounts-exists_with_different_user_data_32"><a
href="#reference-requests-create_accounts-exists_with_different_user_data_32"
class="anchor"><code>exists_with_different_user_data_32</code></a></h3>
<p>An account with the same <code>id</code> already exists, but with
different <a
href="#reference-account-user_data_32"><code>user_data_32</code></a>.</p>
<h3 id="reference-requests-create_accounts-exists_with_different_ledger"><a
href="#reference-requests-create_accounts-exists_with_different_ledger"
class="anchor"><code>exists_with_different_ledger</code></a></h3>
<p>An account with the same <code>id</code> already exists, but with
different <a href="#reference-account-ledger"><code>ledger</code></a>.</p>
<h3 id="reference-requests-create_accounts-exists_with_different_code"><a
href="#reference-requests-create_accounts-exists_with_different_code"
class="anchor"><code>exists_with_different_code</code></a></h3>
<p>An account with the same <code>id</code> already exists, but with
different <a href="#reference-account-code"><code>code</code></a>.</p>
<h3 id="reference-requests-create_accounts-exists"><a href="#reference-requests-create_accounts-exists"
class="anchor"><code>exists</code></a></h3>
<p>An account with the same <code>id</code> already exists.</p>
<p>With the possible exception of the following fields, the existing
account is identical to the account in the request:</p>
<ul>
<li><code>timestamp</code></li>
<li><code>debits_pending</code></li>
<li><code>debits_posted</code></li>
<li><code>credits_pending</code></li>
<li><code>credits_posted</code></li>
</ul>
<p>To correctly <a
href="#coding-reliable-transaction-submission">recover from
application crashes</a>, many applications should handle
<code>exists</code> exactly as <a href="#reference-requests-create_accounts-ok"><code>ok</code></a>.</p>
<h3 id="reference-requests-create_accounts-flags_are_mutually_exclusive"><a
href="#reference-requests-create_accounts-flags_are_mutually_exclusive"
class="anchor"><code>flags_are_mutually_exclusive</code></a></h3>
<p>The account was not created. An account cannot be created with the
specified combination of <a
href="#reference-account-flags"><code>Account.flags</code></a>.</p>
<p>The following flags are mutually exclusive:</p>
<ul>
<li><a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>Account.flags.debits_must_not_exceed_credits</code></a></li>
<li><a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>Account.flags.credits_must_not_exceed_debits</code></a></li>
</ul>
<h3 id="reference-requests-create_accounts-debits_pending_must_be_zero"><a
href="#reference-requests-create_accounts-debits_pending_must_be_zero"
class="anchor"><code>debits_pending_must_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-debits_pending"><code>Account.debits_pending</code></a>
is nonzero, but must be zero.</p>
<p>An account‚Äôs debits and credits are only modified by transfers.</p>
<h3 id="reference-requests-create_accounts-debits_posted_must_be_zero"><a
href="#reference-requests-create_accounts-debits_posted_must_be_zero"
class="anchor"><code>debits_posted_must_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-debits_posted"><code>Account.debits_posted</code></a>
is nonzero, but must be zero.</p>
<p>An account‚Äôs debits and credits are only modified by transfers.</p>
<h3 id="reference-requests-create_accounts-credits_pending_must_be_zero"><a
href="#reference-requests-create_accounts-credits_pending_must_be_zero"
class="anchor"><code>credits_pending_must_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-credits_pending"><code>Account.credits_pending</code></a>
is nonzero, but must be zero.</p>
<p>An account‚Äôs debits and credits are only modified by transfers.</p>
<h3 id="reference-requests-create_accounts-credits_posted_must_be_zero"><a
href="#reference-requests-create_accounts-credits_posted_must_be_zero"
class="anchor"><code>credits_posted_must_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-credits_posted"><code>Account.credits_posted</code></a>
is nonzero, but must be zero.</p>
<p>An account‚Äôs debits and credits are only modified by transfers.</p>
<h3 id="reference-requests-create_accounts-ledger_must_not_be_zero"><a href="#reference-requests-create_accounts-ledger_must_not_be_zero"
class="anchor"><code>ledger_must_not_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-ledger"><code>Account.ledger</code></a> is zero, but
must be nonzero.</p>
<h3 id="reference-requests-create_accounts-code_must_not_be_zero"><a href="#reference-requests-create_accounts-code_must_not_be_zero"
class="anchor"><code>code_must_not_be_zero</code></a></h3>
<p>The account was not created. <a
href="#reference-account-code"><code>Account.code</code></a> is zero, but
must be nonzero.</p>
<h3 id="reference-requests-create_accounts-imported_event_timestamp_must_not_regress"><a
href="#reference-requests-create_accounts-imported_event_timestamp_must_not_regress"
class="anchor"><code>imported_event_timestamp_must_not_regress</code></a></h3>
<p>This result only applies when <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
is set.</p>
<p>The account was not created. The user-defined <a
href="#reference-account-timestamp"><code>Account.timestamp</code></a>
regressed, but it must be greater than the last timestamp assigned to
any <code>Account</code> in the cluster and cannot be equal to the
timestamp of any existing <a
href="#reference-transfer"><code>Transfer</code></a>.</p>
<h2 id="reference-requests-create_accounts-client-libraries"><a href="#reference-requests-create_accounts-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-creating-accounts">.NET
library</a></li>
<li><a href="#coding-clients-java-creating-accounts">Java
library</a></li>
<li><a href="#coding-clients-go-creating-accounts">Go library</a></li>
<li><a href="#coding-clients-node-creating-accounts">Node.js
library</a></li>
<li><a href="#coding-clients-python-creating-accounts">Python
library</a></li>
</ul>
<h2 id="reference-requests-create_accounts-internals"><a href="#reference-requests-create_accounts-internals"
class="anchor">Internals</a></h2>
<p>If you‚Äôre curious and want to learn more, you can find the source
code for creating an account in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/state_machine.zig">src/state_machine.zig</a>.
Search for <code>fn create_account(</code> and
<code>fn execute(</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/create_accounts.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-create_transfers"><a href="#reference-requests-create_transfers"
class="anchor"><code>create_transfers</code></a></h1>
<p>Create one or more <a
href="#reference-transfer"><code>Transfer</code></a>s. A successfully created
transfer will modify the amount fields of its <a
href="#reference-transfer-debit_account_id">debit</a> and <a
href="#reference-transfer-credit_account_id">credit</a> accounts.</p>
<h2 id="reference-requests-create_transfers-event"><a href="#reference-requests-create_transfers-event" class="anchor">Event</a></h2>
<p>The transfer to create. See <a
href="#reference-transfer"><code>Transfer</code></a> for constraints.</p>
<h2 id="reference-requests-create_transfers-result"><a href="#reference-requests-create_transfers-result" class="anchor">Result</a></h2>
<p>Results are listed in this section in order of descending precedence
‚Äî that is, if more than one error is applicable to the transfer being
created, only the result listed first is returned.</p>
<h3 id="reference-requests-create_transfers-ok"><a href="#reference-requests-create_transfers-ok" class="anchor"><code>ok</code></a></h3>
<p>The transfer was successfully created; did not previously exist.</p>
<p>Note that <code>ok</code> is generated by the client implementation;
the network protocol does not include a result when the transfer was
successfully created.</p>
<h3 id="reference-requests-create_transfers-linked_event_failed"><a href="#reference-requests-create_transfers-linked_event_failed"
class="anchor"><code>linked_event_failed</code></a></h3>
<p>The transfer was not created. One or more of the other transfers in
the <a href="#reference-transfer-flagslinked">linked chain</a> is invalid, so
the whole chain failed.</p>
<h3 id="reference-requests-create_transfers-linked_event_chain_open"><a href="#reference-requests-create_transfers-linked_event_chain_open"
class="anchor"><code>linked_event_chain_open</code></a></h3>
<p>The transfer was not created. The <a
href="#reference-transfer-flagslinked"><code>Transfer.flags.linked</code></a>
flag was set on the last event in the batch, which is not legal.
(<code>flags.linked</code> indicates that the chain continues to the
next operation).</p>
<h3 id="reference-requests-create_transfers-imported_event_expected"><a href="#reference-requests-create_transfers-imported_event_expected"
class="anchor"><code>imported_event_expected</code></a></h3>
<p>The transfer was not created. The <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
was set on the first transfer of the batch, but not all transfers in the
batch. Batches cannot mix imported transfers with non-imported
transfers.</p>
<h3 id="reference-requests-create_transfers-imported_event_not_expected"><a
href="#reference-requests-create_transfers-imported_event_not_expected"
class="anchor"><code>imported_event_not_expected</code></a></h3>
<p>The transfer was not created. The <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
was expected to <em>not</em> be set, as it‚Äôs not allowed to mix
transfers with different <code>imported</code> flag in the same batch.
The first transfer determines the entire operation.</p>
<h3 id="reference-requests-create_transfers-timestamp_must_be_zero"><a href="#reference-requests-create_transfers-timestamp_must_be_zero"
class="anchor"><code>timestamp_must_be_zero</code></a></h3>
<p>This result only applies when <a
href="#reference-account-flagsimported"><code>Account.flags.imported</code></a>
is <em>not</em> set.</p>
<p>The transfer was not created. The <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> is
nonzero, but must be zero. The cluster is responsible for setting this
field.</p>
<p>The <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> can
only be assigned when creating transfers with <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
set.</p>
<h3 id="reference-requests-create_transfers-imported_event_timestamp_out_of_range"><a
href="#reference-requests-create_transfers-imported_event_timestamp_out_of_range"
class="anchor"><code>imported_event_timestamp_out_of_range</code></a></h3>
<p>This result only applies when <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
is set.</p>
<p>The transfer was not created. The <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> is
out of range, but must be a user-defined timestamp greater than
<code>0</code> and less than <code>2^63</code>.</p>
<h3 id="reference-requests-create_transfers-imported_event_timestamp_must_not_advance"><a
href="#reference-requests-create_transfers-imported_event_timestamp_must_not_advance"
class="anchor"><code>imported_event_timestamp_must_not_advance</code></a></h3>
<p>This result only applies when <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
is set.</p>
<p>The transfer was not created. The user-defined <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a> is
greater than the current <a href="#coding-time">cluster
time</a>, but it must be a past timestamp.</p>
<h3 id="reference-requests-create_transfers-reserved_flag"><a href="#reference-requests-create_transfers-reserved_flag"
class="anchor"><code>reserved_flag</code></a></h3>
<p>The transfer was not created. <code>Transfer.flags.reserved</code> is
nonzero, but must be zero.</p>
<h3 id="reference-requests-create_transfers-id_must_not_be_zero"><a href="#reference-requests-create_transfers-id_must_not_be_zero"
class="anchor"><code>id_must_not_be_zero</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-id"><code>Transfer.id</code></a> is zero, which is
a reserved value.</p>
<h3 id="reference-requests-create_transfers-id_must_not_be_int_max"><a href="#reference-requests-create_transfers-id_must_not_be_int_max"
class="anchor"><code>id_must_not_be_int_max</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-id"><code>Transfer.id</code></a> is
<code>2^128 - 1</code>, which is a reserved value.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_flags"><a
href="#reference-requests-create_transfers-exists_with_different_flags"
class="anchor"><code>exists_with_different_flags</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with
different <a href="#reference-transfer-flags"><code>flags</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_pending_id"><a
href="#reference-requests-create_transfers-exists_with_different_pending_id"
class="anchor"><code>exists_with_different_pending_id</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a
href="#reference-transfer-pending_id"><code>pending_id</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_timeout"><a
href="#reference-requests-create_transfers-exists_with_different_timeout"
class="anchor"><code>exists_with_different_timeout</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a href="#reference-transfer-timeout"><code>timeout</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_debit_account_id"><a
href="#reference-requests-create_transfers-exists_with_different_debit_account_id"
class="anchor"><code>exists_with_different_debit_account_id</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a
href="#reference-transfer-debit_account_id"><code>debit_account_id</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_credit_account_id"><a
href="#reference-requests-create_transfers-exists_with_different_credit_account_id"
class="anchor"><code>exists_with_different_credit_account_id</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a
href="#reference-transfer-credit_account_id"><code>credit_account_id</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_amount"><a
href="#reference-requests-create_transfers-exists_with_different_amount"
class="anchor"><code>exists_with_different_amount</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a href="#reference-transfer-amount"><code>amount</code></a>.</p>
<p>If the transfer has <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a>
or <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a>
set, then the actual amount transferred exceeds this failed transfer‚Äôs
<code>amount</code>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_user_data_128"><a
href="#reference-requests-create_transfers-exists_with_different_user_data_128"
class="anchor"><code>exists_with_different_user_data_128</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a
href="#reference-transfer-user_data_128"><code>user_data_128</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_user_data_64"><a
href="#reference-requests-create_transfers-exists_with_different_user_data_64"
class="anchor"><code>exists_with_different_user_data_64</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a
href="#reference-transfer-user_data_64"><code>user_data_64</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_user_data_32"><a
href="#reference-requests-create_transfers-exists_with_different_user_data_32"
class="anchor"><code>exists_with_different_user_data_32</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a
href="#reference-transfer-user_data_32"><code>user_data_32</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_ledger"><a
href="#reference-requests-create_transfers-exists_with_different_ledger"
class="anchor"><code>exists_with_different_ledger</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a href="#reference-transfer-ledger"><code>ledger</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists_with_different_code"><a
href="#reference-requests-create_transfers-exists_with_different_code"
class="anchor"><code>exists_with_different_code</code></a></h3>
<p>A transfer with the same <code>id</code> already exists, but with a
different <a href="#reference-transfer-code"><code>code</code></a>.</p>
<h3 id="reference-requests-create_transfers-exists"><a href="#reference-requests-create_transfers-exists"
class="anchor"><code>exists</code></a></h3>
<p>A transfer with the same <code>id</code> already exists.</p>
<p>If the transfer has <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a>
or <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a>
set, then the existing transfer may have a different <a
href="#reference-transfer-amount"><code>amount</code></a>, limited to the
maximum <code>amount</code> of the transfer in the request.</p>
<p>If the transfer has <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>
set, then the existing transfer may have a different <a
href="#reference-transfer-amount"><code>amount</code></a>:</p>
<ul>
<li>If the original posted amount was less than the pending amount, then
the transfer amount must be equal to the posted amount.</li>
<li>Otherwise, the transfer amount must be greater than or equal to the
pending amount.</li>
</ul>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>If the transfer has <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a>
or <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a>
set, then the existing transfer may have a different <a
href="#reference-transfer-amount"><code>amount</code></a>, limited to the
maximum <code>amount</code> of the transfer in the request.</p>
</details>

<p>Otherwise, with the possible exception of the <code>timestamp</code>
field, the existing transfer is identical to the transfer in the
request.</p>
<p>To correctly <a
href="#coding-reliable-transaction-submission">recover from
application crashes</a>, many applications should handle
<code>exists</code> exactly as <a href="#reference-requests-create_transfers-ok"><code>ok</code></a>.</p>
<h3 id="reference-requests-create_transfers-id_already_failed"><a href="#reference-requests-create_transfers-id_already_failed"
class="anchor"><code>id_already_failed</code></a></h3>
<p>The transfer was not created. A previous transfer with the same <a
href="#reference-transfer-id"><code>id</code></a> failed due to one of the
following <em>transient errors</em>:</p>
<ul>
<li><a
href="#reference-requests-create_transfers-debit_account_not_found"><code>debit_account_not_found</code></a></li>
<li><a
href="#reference-requests-create_transfers-credit_account_not_found"><code>credit_account_not_found</code></a></li>
<li><a
href="#reference-requests-create_transfers-pending_transfer_not_found"><code>pending_transfer_not_found</code></a></li>
<li><a href="#reference-requests-create_transfers-exceeds_credits"><code>exceeds_credits</code></a></li>
<li><a href="#reference-requests-create_transfers-exceeds_debits"><code>exceeds_debits</code></a></li>
<li><a
href="#reference-requests-create_transfers-debit_account_already_closed"><code>debit_account_already_closed</code></a></li>
<li><a
href="#reference-requests-create_transfers-credit_account_already_closed"><code>credit_account_already_closed</code></a></li>
</ul>
<p>Transient errors depend on the database state at a given point in
time, and each attempt is uniquely associated with the corresponding <a
href="#reference-transfer-id"><code>Transfer.id</code></a>. This behavior
guarantees that retrying a transfer will not produce a different outcome
(either success or failure).</p>
<p>Without this mechanism, a transfer that previously failed could
succeed if retried when the underlying state changes (e.g., the target
account has sufficient credits).</p>
<p><strong>Note:</strong> The application should retry an event only if
it was unable to acknowledge the last response (e.g., due to an
application restart) or because it is correcting a previously rejected
malformed request (e.g., due to an application bug). If the application
intends to submit the transfer again even after a transient error, it
must generate a new <a
href="#coding-data-modeling-id">idempotency id</a>.</p>
<details>
<summary>Client release &lt; 0.16.4</summary>

<p>The <a href="#reference-transfer-id"><code>id</code></a> is never checked
against failed transfers, regardless of the error. Therefore, a transfer
that failed due to a transient error could succeed if retried later.</p>
</details>

<h3 id="reference-requests-create_transfers-flags_are_mutually_exclusive"><a
href="#reference-requests-create_transfers-flags_are_mutually_exclusive"
class="anchor"><code>flags_are_mutually_exclusive</code></a></h3>
<p>The transfer was not created. A transfer cannot be created with the
specified combination of <a
href="#reference-transfer-flags"><code>Transfer.flags</code></a>.</p>
<p>Flag compatibility (‚úì = compatible, ‚úó = mutually exclusive):</p>
<ul>
<li><a href="#reference-transfer-flagspending"><code>flags.pending</code></a>
<ul>
<li>‚úó <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a>
<ul>
<li>‚úó <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a>
<ul>
<li>‚úó <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a>
<ul>
<li>‚úì <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a>
<ul>
<li>‚úì <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a>
<ul>
<li>‚úì <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a>
<ul>
<li>‚úì <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úó <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a></li>
</ul></li>
<li><a
href="#reference-transfer-flagsimported"><code>flags.imported</code></a>
<ul>
<li>‚úì <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagspost_pending_transfer"><code>flags.post_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>flags.void_pending_transfer</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_debit"><code>flags.closing_debit</code></a></li>
<li>‚úì <a
href="#reference-transfer-flagsclosing_credit"><code>flags.closing_credit</code></a></li>
</ul></li>
</ul>
<h3 id="reference-requests-create_transfers-debit_account_id_must_not_be_zero"><a
href="#reference-requests-create_transfers-debit_account_id_must_not_be_zero"
class="anchor"><code>debit_account_id_must_not_be_zero</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
is zero, but must be a valid account id.</p>
<h3 id="reference-requests-create_transfers-debit_account_id_must_not_be_int_max"><a
href="#reference-requests-create_transfers-debit_account_id_must_not_be_int_max"
class="anchor"><code>debit_account_id_must_not_be_int_max</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
is <code>2^128 - 1</code>, but must be a valid account id.</p>
<h3 id="reference-requests-create_transfers-credit_account_id_must_not_be_zero"><a
href="#reference-requests-create_transfers-credit_account_id_must_not_be_zero"
class="anchor"><code>credit_account_id_must_not_be_zero</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
is zero, but must be a valid account id.</p>
<h3 id="reference-requests-create_transfers-credit_account_id_must_not_be_int_max"><a
href="#reference-requests-create_transfers-credit_account_id_must_not_be_int_max"
class="anchor"><code>credit_account_id_must_not_be_int_max</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
is <code>2^128 - 1</code>, but must be a valid account id.</p>
<h3 id="reference-requests-create_transfers-accounts_must_be_different"><a
href="#reference-requests-create_transfers-accounts_must_be_different"
class="anchor"><code>accounts_must_be_different</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
and <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
must not be equal.</p>
<p>That is, an account cannot transfer money to itself.</p>
<h3 id="reference-requests-create_transfers-pending_id_must_be_zero"><a href="#reference-requests-create_transfers-pending_id_must_be_zero"
class="anchor"><code>pending_id_must_be_zero</code></a></h3>
<p>The transfer was not created. Only post/void transfers can reference
a pending transfer.</p>
<p>Either:</p>
<ul>
<li><a
href="#reference-transfer-flagspost_pending_transfer"><code>Transfer.flags.post_pending_transfer</code></a>
must be set, or</li>
<li><a
href="#reference-transfer-flagsvoid_pending_transfer"><code>Transfer.flags.void_pending_transfer</code></a>
must be set, or</li>
<li><a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
must be zero.</li>
</ul>
<h3 id="reference-requests-create_transfers-pending_id_must_not_be_zero"><a
href="#reference-requests-create_transfers-pending_id_must_not_be_zero"
class="anchor"><code>pending_id_must_not_be_zero</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-flagspost_pending_transfer"><code>Transfer.flags.post_pending_transfer</code></a>
or <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>Transfer.flags.void_pending_transfer</code></a>
is set, but <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a> is
zero. A posting or voiding transfer must reference a <a
href="#reference-transfer-flagspending"><code>pending</code></a>
transfer.</p>
<h3 id="reference-requests-create_transfers-pending_id_must_not_be_int_max"><a
href="#reference-requests-create_transfers-pending_id_must_not_be_int_max"
class="anchor"><code>pending_id_must_not_be_int_max</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a> is
<code>2^128 - 1</code>, which is a reserved value.</p>
<h3 id="reference-requests-create_transfers-pending_id_must_be_different"><a
href="#reference-requests-create_transfers-pending_id_must_be_different"
class="anchor"><code>pending_id_must_be_different</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a> is
set to the same id as <a
href="#reference-transfer-id"><code>Transfer.id</code></a>. Instead it should
refer to a different (existing) transfer.</p>
<h3 id="reference-requests-create_transfers-timeout_reserved_for_pending_transfer"><a
href="#reference-requests-create_transfers-timeout_reserved_for_pending_transfer"
class="anchor"><code>timeout_reserved_for_pending_transfer</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-timeout"><code>Transfer.timeout</code></a> is
nonzero, but only <a href="#reference-transfer-flagspending">pending</a>
transfers have nonzero timeouts.</p>
<h3 id="reference-requests-create_transfers-closing_transfer_must_be_pending"><a
href="#reference-requests-create_transfers-closing_transfer_must_be_pending"
class="anchor"><code>closing_transfer_must_be_pending</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-flagspending"><code>Transfer.flags.pending</code></a>
is not set, but closing transfers must be two-phase pending
transfers.</p>
<p>If either <a
href="#reference-transfer-flagsclosing_debit"><code>Transfer.flags.closing_debit</code></a>
or <a
href="#reference-transfer-flagsclosing_credit"><code>Transfer.flags.closing_credit</code></a>
is set, <a
href="#reference-transfer-flagspending"><code>Transfer.flags.pending</code></a>
must also be set.</p>
<p>This ensures that closing transfers are reversible by <a
href="#reference-transfer-flagsvoid_pending_transfer">voiding</a> the pending
transfer, and requires that the reversal operation references the
corresponding closing transfer, guarding against unexpected interleaving
of close/unclose operations.</p>
<h3 id="reference-requests-create_transfers-amount_must_not_be_zero"><a href="#reference-requests-create_transfers-amount_must_not_be_zero"
class="anchor"><code>amount_must_not_be_zero</code></a></h3>
<p><strong>Deprecated</strong>: This error code is only returned to
clients prior to release <code>0.16.0</code>. Since <code>0.16.0</code>,
zero-amount transfers are permitted.</p>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>The transfer was not created. <a
href="#reference-transfer-amount"><code>Transfer.amount</code></a> is zero,
but must be nonzero.</p>
<p>Every transfer must move value. Only posting and voiding transfer
amounts may be zero ‚Äî when zero, they will move the full pending
amount.</p>
</details>

<h3 id="reference-requests-create_transfers-ledger_must_not_be_zero"><a href="#reference-requests-create_transfers-ledger_must_not_be_zero"
class="anchor"><code>ledger_must_not_be_zero</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-ledger"><code>Transfer.ledger</code></a> is zero,
but must be nonzero.</p>
<h3 id="reference-requests-create_transfers-code_must_not_be_zero"><a href="#reference-requests-create_transfers-code_must_not_be_zero"
class="anchor"><code>code_must_not_be_zero</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-code"><code>Transfer.code</code></a> is zero, but
must be nonzero.</p>
<h3 id="reference-requests-create_transfers-debit_account_not_found"><a href="#reference-requests-create_transfers-debit_account_not_found"
class="anchor"><code>debit_account_not_found</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
must refer to an existing <code>Account</code>.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<h3 id="reference-requests-create_transfers-credit_account_not_found"><a href="#reference-requests-create_transfers-credit_account_not_found"
class="anchor"><code>credit_account_not_found</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
must refer to an existing <code>Account</code>.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<h3 id="reference-requests-create_transfers-accounts_must_have_the_same_ledger"><a
href="#reference-requests-create_transfers-accounts_must_have_the_same_ledger"
class="anchor"><code>accounts_must_have_the_same_ledger</code></a></h3>
<p>The transfer was not created. The accounts referred to by <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
and <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
must have an identical <a
href="#reference-account-ledger"><code>ledger</code></a>.</p>
<p><a href="#coding-recipes-currency-exchange">Currency
exchange</a> is implemented with multiple transfers.</p>
<h3 id="reference-requests-create_transfers-transfer_must_have_the_same_ledger_as_accounts"><a
href="#reference-requests-create_transfers-transfer_must_have_the_same_ledger_as_accounts"
class="anchor"><code>transfer_must_have_the_same_ledger_as_accounts</code></a></h3>
<p>The transfer was not created. The accounts referred to by <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
and <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
are equivalent, but differ from the <a
href="#reference-transfer-ledger"><code>Transfer.ledger</code></a>.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_not_found"><a
href="#reference-requests-create_transfers-pending_transfer_not_found"
class="anchor"><code>pending_transfer_not_found</code></a></h3>
<p>The transfer was not created. The transfer referenced by <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
does not exist.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_not_pending"><a
href="#reference-requests-create_transfers-pending_transfer_not_pending"
class="anchor"><code>pending_transfer_not_pending</code></a></h3>
<p>The transfer was not created. The transfer referenced by <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
exists, but does not have <a
href="#reference-transfer-flagspending"><code>flags.pending</code></a>
set.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_has_different_debit_account_id"><a
href="#reference-requests-create_transfers-pending_transfer_has_different_debit_account_id"
class="anchor"><code>pending_transfer_has_different_debit_account_id</code></a></h3>
<p>The transfer was not created. The transfer referenced by <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
exists, but with a different <a
href="#reference-transfer-debit_account_id"><code>debit_account_id</code></a>.</p>
<p>The post/void transfer‚Äôs <code>debit_account_id</code> must either be
<code>0</code> or identical to the pending transfer‚Äôs
<code>debit_account_id</code>.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_has_different_credit_account_id"><a
href="#reference-requests-create_transfers-pending_transfer_has_different_credit_account_id"
class="anchor"><code>pending_transfer_has_different_credit_account_id</code></a></h3>
<p>The transfer was not created. The transfer referenced by <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
exists, but with a different <a
href="#reference-transfer-credit_account_id"><code>credit_account_id</code></a>.</p>
<p>The post/void transfer‚Äôs <code>credit_account_id</code> must either
be <code>0</code> or identical to the pending transfer‚Äôs
<code>credit_account_id</code>.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_has_different_ledger"><a
href="#reference-requests-create_transfers-pending_transfer_has_different_ledger"
class="anchor"><code>pending_transfer_has_different_ledger</code></a></h3>
<p>The transfer was not created. The transfer referenced by <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
exists, but with a different <a
href="#reference-transfer-ledger"><code>ledger</code></a>.</p>
<p>The post/void transfer‚Äôs <code>ledger</code> must either be
<code>0</code> or identical to the pending transfer‚Äôs
<code>ledger</code>.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_has_different_code"><a
href="#reference-requests-create_transfers-pending_transfer_has_different_code"
class="anchor"><code>pending_transfer_has_different_code</code></a></h3>
<p>The transfer was not created. The transfer referenced by <a
href="#reference-transfer-pending_id"><code>Transfer.pending_id</code></a>
exists, but with a different <a
href="#reference-transfer-code"><code>code</code></a>.</p>
<p>The post/void transfer‚Äôs <code>code</code> must either be
<code>0</code> or identical to the pending transfer‚Äôs
<code>code</code>.</p>
<h3 id="reference-requests-create_transfers-exceeds_pending_transfer_amount"><a
href="#reference-requests-create_transfers-exceeds_pending_transfer_amount"
class="anchor"><code>exceeds_pending_transfer_amount</code></a></h3>
<p>The transfer was not created. The transfer‚Äôs <a
href="#reference-transfer-amount"><code>amount</code></a> exceeds the
<code>amount</code> of its <a
href="#reference-transfer-pending_id">pending</a> transfer.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_has_different_amount"><a
href="#reference-requests-create_transfers-pending_transfer_has_different_amount"
class="anchor"><code>pending_transfer_has_different_amount</code></a></h3>
<p>The transfer was not created. The transfer is attempting to <a
href="#reference-transfer-flagsvoid_pending_transfer">void</a> a pending
transfer. The voiding transfer‚Äôs <a
href="#reference-transfer-amount"><code>amount</code></a> must be either
<code>0</code> or exactly the <code>amount</code> of the pending
transfer.</p>
<p>To partially void a transfer, create a <a
href="#reference-transfer-flagspost_pending_transfer">posting transfer</a>
with an amount less than the pending transfer‚Äôs <code>amount</code>.</p>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>To partially void a transfer, create a <a
href="#reference-transfer-flagspost_pending_transfer">posting transfer</a>
with an amount between <code>0</code> and the pending transfer‚Äôs
<code>amount</code>.</p>
</details>

<h3 id="reference-requests-create_transfers-pending_transfer_already_posted"><a
href="#reference-requests-create_transfers-pending_transfer_already_posted"
class="anchor"><code>pending_transfer_already_posted</code></a></h3>
<p>The transfer was not created. The referenced <a
href="#reference-transfer-pending_id">pending</a> transfer was already posted
by a <a
href="#reference-transfer-flagspost_pending_transfer"><code>post_pending_transfer</code></a>.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_already_voided"><a
href="#reference-requests-create_transfers-pending_transfer_already_voided"
class="anchor"><code>pending_transfer_already_voided</code></a></h3>
<p>The transfer was not created. The referenced <a
href="#reference-transfer-pending_id">pending</a> transfer was already voided
by a <a
href="#reference-transfer-flagsvoid_pending_transfer"><code>void_pending_transfer</code></a>.</p>
<h3 id="reference-requests-create_transfers-pending_transfer_expired"><a href="#reference-requests-create_transfers-pending_transfer_expired"
class="anchor"><code>pending_transfer_expired</code></a></h3>
<p>The transfer was not created. The referenced <a
href="#reference-transfer-pending_id">pending</a> transfer was already voided
because its <a href="#reference-transfer-timeout">timeout</a> has passed.</p>
<h3 id="reference-requests-create_transfers-imported_event_timestamp_must_not_regress"><a
href="#reference-requests-create_transfers-imported_event_timestamp_must_not_regress"
class="anchor"><code>imported_event_timestamp_must_not_regress</code></a></h3>
<p>This result only applies when <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
is set.</p>
<p>The transfer was not created. The user-defined <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a>
regressed, but it must be greater than the last timestamp assigned to
any <code>Transfer</code> in the cluster and cannot be equal to the
timestamp of any existing <a
href="#reference-account"><code>Account</code></a>.</p>
<h3 id="reference-requests-create_transfers-imported_event_timestamp_must_postdate_debit_account"><a
href="#reference-requests-create_transfers-imported_event_timestamp_must_postdate_debit_account"
class="anchor"><code>imported_event_timestamp_must_postdate_debit_account</code></a></h3>
<p>This result only applies when <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
is set.</p>
<p>The transfer was not created. <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
must refer to an <code>Account</code> whose <a
href="#reference-account-timestamp"><code>timestamp</code></a> is less than
the <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a>.</p>
<h3 id="reference-requests-create_transfers-imported_event_timestamp_must_postdate_credit_account"><a
href="#reference-requests-create_transfers-imported_event_timestamp_must_postdate_credit_account"
class="anchor"><code>imported_event_timestamp_must_postdate_credit_account</code></a></h3>
<p>This result only applies when <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
is set.</p>
<p>The transfer was not created. <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
must refer to an <code>Account</code> whose <a
href="#reference-account-timestamp"><code>timestamp</code></a> is less than
the <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a>.</p>
<h3 id="reference-requests-create_transfers-imported_event_timeout_must_be_zero"><a
href="#reference-requests-create_transfers-imported_event_timeout_must_be_zero"
class="anchor"><code>imported_event_timeout_must_be_zero</code></a></h3>
<p>This result only applies when <a
href="#reference-transfer-flagsimported"><code>Transfer.flags.imported</code></a>
is set.</p>
<p>The transfer was not created. The <a
href="#reference-transfer-timeout"><code>Transfer.timeout</code></a> is
nonzero, but must be zero.</p>
<p>It‚Äôs possible to import <a
href="#reference-transfer-flagspending">pending</a> transfers with a
user-defined timestamp, but since it‚Äôs not driven by the cluster clock,
it cannot define a timeout for automatic expiration. In those cases, the
<a href="#coding-two-phase-transfers">two-phase post or
rollback</a> must be done manually.</p>
<h3 id="reference-requests-create_transfers-debit_account_already_closed"><a
href="#reference-requests-create_transfers-debit_account_already_closed"
class="anchor"><code>debit_account_already_closed</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-debit_account_id"><code>Transfer.debit_account_id</code></a>
must refer to an <code>Account</code> whose <a
href="#reference-account-flagsclosed"><code>Account.flags.closed</code></a>
is not already set.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<h3 id="reference-requests-create_transfers-credit_account_already_closed"><a
href="#reference-requests-create_transfers-credit_account_already_closed"
class="anchor"><code>credit_account_already_closed</code></a></h3>
<p>The transfer was not created. <a
href="#reference-transfer-credit_account_id"><code>Transfer.credit_account_id</code></a>
must refer to an <code>Account</code> whose <a
href="#reference-account-flagsclosed"><code>Account.flags.closed</code></a>
is not already set.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<h3 id="reference-requests-create_transfers-overflows_debits_pending"><a href="#reference-requests-create_transfers-overflows_debits_pending"
class="anchor"><code>overflows_debits_pending</code></a></h3>
<p>The transfer was not created.
<code>debit_account.debits_pending + transfer.amount</code> would
overflow a 128-bit unsigned integer.</p>
<h3 id="reference-requests-create_transfers-overflows_credits_pending"><a href="#reference-requests-create_transfers-overflows_credits_pending"
class="anchor"><code>overflows_credits_pending</code></a></h3>
<p>The transfer was not created.
<code>credit_account.credits_pending + transfer.amount</code> would
overflow a 128-bit unsigned integer.</p>
<h3 id="reference-requests-create_transfers-overflows_debits_posted"><a href="#reference-requests-create_transfers-overflows_debits_posted"
class="anchor"><code>overflows_debits_posted</code></a></h3>
<p>The transfer was not created.
<code>debit_account.debits_posted + transfer.amount</code> would
overflow a 128-bit unsigned integer.</p>
<h3 id="reference-requests-create_transfers-overflows_credits_posted"><a href="#reference-requests-create_transfers-overflows_credits_posted"
class="anchor"><code>overflows_credits_posted</code></a></h3>
<p>The transfer was not created.
<code>debit_account.credits_posted + transfer.amount</code> would
overflow a 128-bit unsigned integer.</p>
<h3 id="reference-requests-create_transfers-overflows_debits"><a href="#reference-requests-create_transfers-overflows_debits"
class="anchor"><code>overflows_debits</code></a></h3>
<p>The transfer was not created.
<code>debit_account.debits_pending + debit_account.debits_posted + transfer.amount</code>
would overflow a 128-bit unsigned integer.</p>
<h3 id="reference-requests-create_transfers-overflows_credits"><a href="#reference-requests-create_transfers-overflows_credits"
class="anchor"><code>overflows_credits</code></a></h3>
<p>The transfer was not created.
<code>credit_account.credits_pending + credit_account.credits_posted + transfer.amount</code>
would overflow a 128-bit unsigned integer.</p>
<h3 id="reference-requests-create_transfers-overflows_timeout"><a href="#reference-requests-create_transfers-overflows_timeout"
class="anchor"><code>overflows_timeout</code></a></h3>
<p>The transfer was not created.
<code>transfer.timestamp + (transfer.timeout * 1_000_000_000)</code>
would exceed <code>2^63</code>.</p>
<p><a href="#reference-transfer-timeout"><code>Transfer.timeout</code></a> is
converted to nanoseconds.</p>
<p>This computation uses the <a
href="#reference-transfer-timestamp"><code>Transfer.timestamp</code></a>
value assigned by the replica, not the <code>0</code> value sent by the
client.</p>
<h3 id="reference-requests-create_transfers-exceeds_credits"><a href="#reference-requests-create_transfers-exceeds_credits"
class="anchor"><code>exceeds_credits</code></a></h3>
<p>The transfer was not created.</p>
<p>The <a href="#reference-transfer-debit_account_id">debit account</a> has
<a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>flags.debits_must_not_exceed_credits</code></a>
set, but
<code>debit_account.debits_pending + debit_account.debits_posted + transfer.amount</code>
would exceed <code>debit_account.credits_posted</code>.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>If <a
href="#reference-transfer-flagsbalancing_debit"><code>flags.balancing_debit</code></a>
is set, then
<code>debit_account.debits_pending + debit_account.debits_posted + 1</code>
would exceed <code>debit_account.credits_posted</code>.</p>
</details>

<h3 id="reference-requests-create_transfers-exceeds_debits"><a href="#reference-requests-create_transfers-exceeds_debits"
class="anchor"><code>exceeds_debits</code></a></h3>
<p>The transfer was not created.</p>
<p>The <a href="#reference-transfer-credit_account_id">credit account</a> has
<a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>flags.credits_must_not_exceed_debits</code></a>
set, but
<code>credit_account.credits_pending + credit_account.credits_posted + transfer.amount</code>
would exceed <code>credit_account.debits_posted</code>.</p>
<p>This is a <a href="#reference-requests-create_transfers-id_already_failed">transient error</a>. The <a
href="#reference-transfer-id"><code>Transfer.id</code></a> associated with
this particular attempt will always fail upon retry, even if the
underlying issue is resolved. To succeed, a new <a
href="#coding-data-modeling-id">idempotency id</a> must be
submitted.</p>
<details>
<summary>Client release &lt; 0.16.0</summary>

<p>If <a
href="#reference-transfer-flagsbalancing_credit"><code>flags.balancing_credit</code></a>
is set, then
<code>credit_account.credits_pending + credit_account.credits_posted + 1</code>
would exceed <code>credit_account.debits_posted</code>.</p>
</details>

<h2 id="reference-requests-create_transfers-client-libraries"><a href="#reference-requests-create_transfers-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-create-transfers">.NET
library</a></li>
<li><a href="#coding-clients-java-create-transfers">Java
library</a></li>
<li><a href="#coding-clients-go-create-transfers">Go library</a></li>
<li><a href="#coding-clients-node-create-transfers">Node.js
library</a></li>
<li><a href="#coding-clients-python-create-transfers">Python
library</a></li>
</ul>
<h2 id="reference-requests-create_transfers-internals"><a href="#reference-requests-create_transfers-internals"
class="anchor">Internals</a></h2>
<p>If you‚Äôre curious and want to learn more, you can find the source
code for creating a transfer in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/state_machine.zig">src/state_machine.zig</a>.
Search for <code>fn create_transfer(</code> and
<code>fn execute(</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/create_transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-lookup_accounts"><a href="#reference-requests-lookup_accounts"
class="anchor"><code>lookup_accounts</code></a></h1>
<p>Fetch one or more accounts by their <code>id</code>s.</p>
<p>‚ö†Ô∏è Note that you <strong>should not</strong> check an account‚Äôs
balance using this request before creating a transfer. That would not be
atomic and the balance could change in between the check and the
transfer. Instead, set the <a
href="#reference-account-flagsdebits_must_not_exceed_credits"><code>debits_must_not_exceed_credits</code></a>
or <a
href="#reference-account-flagscredits_must_not_exceed_debits"><code>credits_must_not_exceed_debits</code></a>
flag on the accounts to limit their account balances. More complex
conditional transfers can be expressed using <a
href="#coding-recipes-balance-conditional-transfers">balance-conditional
transfers</a>.</p>
<p>‚ö†Ô∏è It is not possible currently to look up more than a full batch
(8190) of accounts atomically. When issuing multiple
<code>lookup_accounts</code> calls, it can happen that other operations
will interleave between the calls leading to read skew. Consider using
the <a href="#reference-account-flagshistory"><code>history</code></a> flag
to enable atomic lookups.</p>
<h2 id="reference-requests-lookup_accounts-event"><a href="#reference-requests-lookup_accounts-event" class="anchor">Event</a></h2>
<p>An <a href="#reference-account-id"><code>id</code></a> belonging to a <a
href="#reference-account"><code>Account</code></a>.</p>
<h2 id="reference-requests-lookup_accounts-result"><a href="#reference-requests-lookup_accounts-result" class="anchor">Result</a></h2>
<ul>
<li>If the account exists, return the <a
href="#reference-account"><code>Account</code></a>.</li>
<li>If the account does not exist, return nothing.</li>
</ul>
<h2 id="reference-requests-lookup_accounts-client-libraries"><a href="#reference-requests-lookup_accounts-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-account-lookup">.NET
library</a></li>
<li><a href="#coding-clients-java-account-lookup">Java library</a></li>
<li><a href="#coding-clients-go-account-lookup">Go library</a></li>
<li><a href="#coding-clients-node-account-lookup">Node.js
library</a></li>
</ul>
<h2 id="reference-requests-lookup_accounts-internals"><a href="#reference-requests-lookup_accounts-internals"
class="anchor">Internals</a></h2>
<p>If you‚Äôre curious and want to learn more, you can find the source
code for looking up an account in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/state_machine.zig">src/state_machine.zig</a>.
Search for <code>fn execute_lookup_accounts(</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/lookup_accounts.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-lookup_transfers"><a href="#reference-requests-lookup_transfers"
class="anchor"><code>lookup_transfers</code></a></h1>
<p>Fetch one or more transfers by their <code>id</code>s.</p>
<h2 id="reference-requests-lookup_transfers-event"><a href="#reference-requests-lookup_transfers-event" class="anchor">Event</a></h2>
<p>An <a href="#reference-transfer-id"><code>id</code></a> belonging to a <a
href="#reference-transfer"><code>Transfer</code></a>.</p>
<h2 id="reference-requests-lookup_transfers-result"><a href="#reference-requests-lookup_transfers-result" class="anchor">Result</a></h2>
<ul>
<li>If the transfer exists, return the <a
href="#reference-transfer"><code>Transfer</code></a>.</li>
<li>If the transfer does not exist, return nothing.</li>
</ul>
<h2 id="reference-requests-lookup_transfers-client-libraries"><a href="#reference-requests-lookup_transfers-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-transfer-lookup">.NET
library</a></li>
<li><a href="#coding-clients-java-transfer-lookup">Java
library</a></li>
<li><a href="#coding-clients-go-transfer-lookup">Go library</a></li>
<li><a href="#coding-clients-node-transfer-lookup">Node.js
library</a></li>
</ul>
<h2 id="reference-requests-lookup_transfers-internals"><a href="#reference-requests-lookup_transfers-internals"
class="anchor">Internals</a></h2>
<p>If you‚Äôre curious and want to learn more, you can find the source
code for looking up a transfer in <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/state_machine.zig">src/state_machine.zig</a>.
Search for <code>fn execute_lookup_transfers(</code>.</p>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/lookup_transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-get_account_transfers"><a href="#reference-requests-get_account_transfers"
class="anchor"><code>get_account_transfers</code></a></h1>
<p>Fetch <a href="#reference-transfer"><code>Transfer</code></a>s involving a
given <a href="#reference-account"><code>Account</code></a>.</p>
<h2 id="reference-requests-get_account_transfers-event"><a href="#reference-requests-get_account_transfers-event" class="anchor">Event</a></h2>
<p>The account filter. See <a
href="#reference-account-filter"><code>AccountFilter</code></a> for
constraints.</p>
<h2 id="reference-requests-get_account_transfers-result"><a href="#reference-requests-get_account_transfers-result" class="anchor">Result</a></h2>
<ul>
<li>Return a (possibly empty) array of <a
href="#reference-transfer"><code>Transfer</code></a>s that match the
filter.</li>
<li>If any constraint is violated, return nothing.</li>
<li>By default, <code>Transfer</code>s are sorted chronologically by
<code>timestamp</code>. You can use the <a
href="#reference-account-filter-flagsreversed"><code>reversed</code></a> to
change this.</li>
<li>The result is always limited in size. If there are more results, you
need to page through them using the <code>AccountFilter</code>‚Äôs <a
href="#reference-account-filter-timestamp_min"><code>timestamp_min</code></a>
and/or <a
href="#reference-account-filter-timestamp_max"><code>timestamp_max</code></a>.</li>
</ul>
<h2 id="reference-requests-get_account_transfers-client-libraries"><a href="#reference-requests-get_account_transfers-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-get-account-transfers">.NET
library</a></li>
<li><a href="#coding-clients-java-get-account-transfers">Java
library</a></li>
<li><a href="#coding-clients-go-get-account-transfers">Go
library</a></li>
<li><a href="#coding-clients-node-get-account-transfers">Node.js
library</a></li>
<li><a href="#coding-clients-python-get-account-transfers">Python
library</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/get_account_transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-get_account_balances"><a href="#reference-requests-get_account_balances"
class="anchor"><code>get_account_balances</code></a></h1>
<p>Fetch the historical <a
href="#reference-account-balance"><code>AccountBalance</code></a>s of a given
<a href="#reference-account"><code>Account</code></a>.</p>
<p><strong>Only accounts created with the <a
href="#reference-account-flagshistory"><code>history</code></a> flag set
retain historical balances.</strong> This is off by default.</p>
<ul>
<li><p>Each balance returned has a corresponding transfer with the same
<a href="#reference-transfer-timestamp"><code>timestamp</code></a>. See the
<a
href="#reference-requests-get_account_transfers"><code>get_account_transfers</code></a>
operation for more details.</p></li>
<li><p>The amounts refer to the account balance recorded <em>after</em>
the transfer execution.</p></li>
<li><p><a href="#reference-transfer-flagspending">Pending</a> balances
automatically removed due to <a
href="#reference-transfer-timeout">timeout</a> expiration don‚Äôt change
historical balances.</p></li>
</ul>
<h2 id="reference-requests-get_account_balances-event"><a href="#reference-requests-get_account_balances-event" class="anchor">Event</a></h2>
<p>The account filter. See <a
href="#reference-account-filter"><code>AccountFilter</code></a> for
constraints.</p>
<h2 id="reference-requests-get_account_balances-result"><a href="#reference-requests-get_account_balances-result" class="anchor">Result</a></h2>
<ul>
<li>If the account has the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set and any
matching balances exist, return an array of <a
href="#reference-account-balance"><code>AccountBalance</code></a>s.</li>
<li>If the account does not have the flag <a
href="#reference-account-flagshistory"><code>history</code></a> set, return
nothing.</li>
<li>If no matching balances exist, return nothing.</li>
<li>If any constraint is violated, return nothing.</li>
</ul>
<h2 id="reference-requests-get_account_balances-client-libraries"><a href="#reference-requests-get_account_balances-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-get-account-balances">.NET
library</a></li>
<li><a href="#coding-clients-java-get-account-balances">Java
library</a></li>
<li><a href="#coding-clients-go-get-account-balances">Go
library</a></li>
<li><a href="#coding-clients-node-get-account-balances">Node.js
library</a></li>
<li><a href="#coding-clients-python-get-account-balances">Python
library</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/get_account_balances.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-query_accounts"><a href="#reference-requests-query_accounts"
class="anchor"><code>query_accounts</code></a></h1>
<p>Query <a href="#reference-account"><code>Account</code></a>s by the
intersection of some fields and by timestamp range.</p>
<p>‚ö†Ô∏è It is not possible currently to query more than a full batch
(8190) of accounts atomically. When issuing multiple
<code>query_accounts</code> calls, it can happen that other operations
will interleave between the calls leading to read skew. Consider using
the <a href="#reference-account-flagshistory"><code>history</code></a> flag
to enable atomic lookups.</p>
<h2 id="reference-requests-query_accounts-event"><a href="#reference-requests-query_accounts-event" class="anchor">Event</a></h2>
<p>The query filter. See <a
href="#reference-query-filter"><code>QueryFilter</code></a> for
constraints.</p>
<h2 id="reference-requests-query_accounts-result"><a href="#reference-requests-query_accounts-result" class="anchor">Result</a></h2>
<ul>
<li>Return a (possibly empty) array of <a
href="#reference-account"><code>Account</code></a>s that match the
filter.</li>
<li>If any constraint is violated, return nothing.</li>
<li>By default, <code>Account</code>s are sorted chronologically by
<code>timestamp</code>. You can use the <a
href="#reference-query-filter-flagsreversed"><code>reversed</code></a> to
change this.</li>
<li>The result is always limited in size. If there are more results, you
need to page through them using the <code>QueryFilter</code>‚Äôs <a
href="#reference-query-filter-timestamp_min"><code>timestamp_min</code></a>
and/or <a
href="#reference-query-filter-timestamp_max"><code>timestamp_max</code></a>.</li>
</ul>
<h2 id="reference-requests-query_accounts-client-libraries"><a href="#reference-requests-query_accounts-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-query-accounts">.NET
library</a></li>
<li><a href="#coding-clients-java-query-accounts">Java library</a></li>
<li><a href="#coding-clients-go-query-accounts">Go library</a></li>
<li><a href="#coding-clients-node-query-accounts">Node.js
library</a></li>
<li><a href="#coding-clients-python-query-accounts">Python
library</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/query_accounts.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

<h1 id="reference-requests-query_transfers"><a href="#reference-requests-query_transfers"
class="anchor"><code>query_transfers</code></a></h1>
<p>Query <a href="#reference-transfer"><code>Transfer</code></a>s by the
intersection of some fields and by timestamp range.</p>
<h2 id="reference-requests-query_transfers-event"><a href="#reference-requests-query_transfers-event" class="anchor">Event</a></h2>
<p>The query filter. See <a
href="#reference-query-filter"><code>QueryFilter</code></a> for
constraints.</p>
<h2 id="reference-requests-query_transfers-result"><a href="#reference-requests-query_transfers-result" class="anchor">Result</a></h2>
<ul>
<li>Return a (possibly empty) array of <a
href="#reference-transfer"><code>Transfer</code></a>s that match the
filter.</li>
<li>If any constraint is violated, return nothing.</li>
<li>By default, <code>Transfer</code>s are sorted chronologically by
<code>timestamp</code>. You can use the <a
href="#reference-query-filter-flagsreversed"><code>reversed</code></a> to
change this.</li>
<li>The result is always limited in size. If there are more results, you
need to page through them using the <code>QueryFilter</code>‚Äôs <a
href="#reference-query-filter-timestamp_min"><code>timestamp_min</code></a>
and/or <a
href="#reference-query-filter-timestamp_max"><code>timestamp_max</code></a>.</li>
</ul>
<h2 id="reference-requests-query_transfers-client-libraries"><a href="#reference-requests-query_transfers-client-libraries"
class="anchor">Client libraries</a></h2>
<p>For language-specific docs see:</p>
<ul>
<li><a href="#coding-clients-dotnet-query-transfers">.NET
library</a></li>
<li><a href="#coding-clients-java-query-transfers">Java
library</a></li>
<li><a href="#coding-clients-go-query-transfers">Go library</a></li>
<li><a href="#coding-clients-node-query-transfers">Node.js
library</a></li>
<li><a href="#coding-clients-python-query-transfers">Python
library</a></li>
</ul>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/docs/reference/requests/query_transfers.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>


        </div>
      </article>
    </main>
    <div id="svg-templates" style="width: 0; height: 0; overflow: hidden;" aria-hidden="true">
      <svg id="svg-tigerbeetle-logo" width="127" height="24" viewBox="0 0 127 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="m20.637 6.4656h-20.637c0-3.5378 3.1347-6.4656 6.7918-6.4656h20.637c0 3.5378-3.1347 6.4656-6.7919 6.4656z" fill="currentColor"/>
        <path d="m8.0098 22.84 1.4016-9.5939c0.59548-4.076 4.0996-7.1037 8.2215-7.1037l-1.8889 12.465c-0.6421 2.9286-4.0162 4.867-7.7342 4.2322z" fill="currentColor"/>
        <path d="m32.351 7.7116 0.3579-2.1298h10.035l-0.358 2.1298h-3.7406l-1.6705 10.088h-2.5534l1.6705-10.088h-3.7406zm9.969 10.088 1.5273-9.1636h2.5414l-1.5272 9.1636h-2.5415zm3.0605-10.357c-0.3778 0-0.69-0.12528-0.9366-0.37585-0.2427-0.25455-0.3421-0.55682-0.2983-0.90682 0.0437-0.35796 0.2147-0.66023 0.513-0.90682 0.2983-0.25057 0.6364-0.37585 1.0142-0.37585 0.3779 0 0.6861 0.12528 0.9248 0.37585 0.2386 0.24659 0.338 0.54886 0.2983 0.90682-0.0398 0.35-0.2089 0.65227-0.5072 0.90682-0.2943 0.25057-0.6303 0.37585-1.0082 0.37585zm5.0725 13.984c-0.8272 0-1.5173-0.1134-2.0701-0.3401-0.5489-0.2227-0.9665-0.527-1.2529-0.9128-0.2824-0.3858-0.4375-0.8193-0.4653-1.3005l2.4102-0.3162c0.0437 0.1869 0.1273 0.3599 0.2506 0.519 0.1272 0.1591 0.3082 0.2864 0.5429 0.3818 0.2386 0.0955 0.5468 0.1432 0.9247 0.1432 0.5528 0 1.0341-0.1352 1.4437-0.4057 0.4097-0.2665 0.6622-0.7139 0.7577-1.3423l0.2744-1.6764h-0.1074c-0.1511 0.2545-0.3579 0.4951-0.6204 0.7218-0.2585 0.2267-0.5747 0.4117-0.9486 0.5549-0.3699 0.1431-0.7974 0.2147-1.2827 0.2147-0.692 0-1.2926-0.1591-1.8017-0.4772-0.5051-0.3222-0.871-0.8134-1.0977-1.4736-0.2227-0.6642-0.2506-1.5034-0.0835-2.5176 0.175-1.0381 0.4892-1.9051 0.9426-2.6012 0.4534-0.69599 0.9903-1.217 1.6108-1.563s1.2668-0.51904 1.9389-0.51904c0.5131 0 0.9267 0.0875 1.2409 0.2625 0.3182 0.17103 0.5628 0.3858 0.7338 0.64432 0.1711 0.25455 0.2924 0.50512 0.364 0.75175h0.1014l0.2505-1.5392h2.5236l-1.5392 9.2532c-0.1233 0.7835-0.4196 1.4358-0.8889 1.9568-0.4653 0.525-1.056 0.9187-1.7719 1.1812-0.7159 0.2665-1.5094 0.3998-2.3804 0.3998zm0.9546-5.6677c0.4057 0 0.7696-0.1014 1.0917-0.3042 0.3262-0.2068 0.5986-0.5012 0.8174-0.883 0.2187-0.3858 0.3718-0.8471 0.4593-1.3841 0.0875-0.5369 0.0855-1.0022-0.0059-1.396-0.0875-0.3977-0.2586-0.7059-0.5131-0.9247-0.2506-0.2187-0.5807-0.3281-0.9903-0.3281-0.4216 0-0.7915 0.1133-1.1097 0.34-0.3182 0.2228-0.5827 0.533-0.7935 0.9307-0.2068 0.3977-0.352 0.8571-0.4355 1.3781-0.0875 0.529-0.0915 0.9864-0.0119 1.3722 0.0835 0.3818 0.2486 0.6781 0.4952 0.8889 0.2466 0.2068 0.5787 0.3102 0.9963 0.3102zm10.273 2.2194c-0.9387 0-1.7162-0.1909-2.3327-0.5728-0.6165-0.3858-1.05-0.9306-1.3006-1.6346-0.2466-0.708-0.2883-1.5452-0.1253-2.5117 0.1591-0.9426 0.4793-1.7699 0.9606-2.4818 0.4852-0.7119 1.0937-1.2668 1.8255-1.6645 0.7318-0.39772 1.5472-0.59659 2.446-0.59659 0.6046 0 1.1515 0.09745 1.6407 0.29233 0.4932 0.19091 0.9028 0.48125 1.2289 0.87103 0.3262 0.38581 0.5489 0.86901 0.6682 1.4497 0.1233 0.5807 0.1213 1.2608-0.0059 2.0403l-0.1134 0.6981h-7.7318l0.2446-1.575h5.3454c0.0597-0.366 0.0358-0.6901-0.0715-0.9725-0.1074-0.2824-0.2864-0.5031-0.537-0.6622-0.2505-0.1631-0.5588-0.2446-0.9247-0.2446-0.3739 0-0.7239 0.0915-1.05 0.2744-0.3261 0.183-0.6006 0.4236-0.8233 0.7219-0.2187 0.2943-0.3599 0.6145-0.4236 0.9605l-0.2804 1.5631c-0.0795 0.4812-0.0636 0.8809 0.0478 1.1991 0.1153 0.3182 0.3142 0.5568 0.5966 0.7159 0.2823 0.1551 0.6403 0.2327 1.0738 0.2327 0.2824 0 0.5469-0.0398 0.7935-0.1193 0.2506-0.0796 0.4733-0.1969 0.6682-0.352 0.1949-0.1591 0.3539-0.356 0.4772-0.5906l2.3208 0.1551c-0.2148 0.5648-0.5409 1.0579-0.9784 1.4795-0.4375 0.4176-0.9645 0.7438-1.581 0.9784-0.6125 0.2307-1.2986 0.3461-2.0582 0.3461zm5.9047-0.179 1.5273-9.1636h2.4639l-0.2684 1.5988h0.0954c0.2625-0.56873 0.6145-0.99828 1.056-1.2886 0.4454-0.29432 0.9247-0.44148 1.4378-0.44148 0.1272 0 0.2605 0.00796 0.3997 0.02386 0.1432 0.01194 0.2704 0.03182 0.3818 0.05966l-0.3818 2.2611c-0.1114-0.0398-0.2705-0.0716-0.4773-0.0955-0.2028-0.0278-0.3957-0.0417-0.5787-0.0417-0.3699 0-0.7139 0.0815-1.0321 0.2446-0.3182 0.1591-0.5866 0.3818-0.8054 0.6682-0.2148 0.2863-0.356 0.6164-0.4236 0.9903l-0.8531 5.1844h-2.5415zm6.922 0 2.0284-12.218h4.892c0.8989 0 1.6267 0.13323 2.1835 0.39971 0.5608 0.26648 0.9526 0.63637 1.1753 1.1097 0.2228 0.46932 0.2824 1.0102 0.179 1.6227-0.0835 0.47727-0.2525 0.89488-0.5071 1.2528-0.2506 0.35795-0.5608 0.65225-0.9307 0.88295s-0.7716 0.3938-1.2051 0.4892l-0.0239 0.1193c0.4614 0.0199 0.877 0.1512 1.2469 0.3938 0.3699 0.2386 0.6463 0.5767 0.8293 1.0142 0.1829 0.4375 0.2247 0.9565 0.1253 1.5571-0.1074 0.6483-0.364 1.227-0.7696 1.7361-0.4057 0.5051-0.9466 0.9048-1.6228 1.1991-0.6721 0.2943-1.4656 0.4415-2.3804 0.4415h-5.2201zm2.9412-2.1119h2.1059c0.7159 0 1.2628-0.1392 1.6407-0.4177 0.3778-0.2784 0.6045-0.6463 0.6801-1.1037 0.0517-0.338 0.0179-0.6363-0.1015-0.8948-0.1153-0.2586-0.3122-0.4614-0.5906-0.6086-0.2744-0.1471-0.6224-0.2207-1.044-0.2207h-2.1597l-0.5309 3.2455zm0.8292-4.9935h1.9151c0.35 0 0.6741-0.0617 0.9724-0.185 0.3023-0.1272 0.5509-0.3062 0.7458-0.53688 0.1988-0.23466 0.3241-0.51108 0.3758-0.82927 0.0716-0.44545-0.0278-0.80142-0.2983-1.0679-0.2665-0.27046-0.6841-0.40569-1.2528-0.40569h-1.9568l-0.5012 3.0247zm11.441 7.2844c-0.9386 0-1.7161-0.1909-2.3326-0.5728-0.6165-0.3858-1.05-0.9306-1.3006-1.6346-0.2466-0.708-0.2883-1.5452-0.1253-2.5117 0.1591-0.9426 0.4793-1.7699 0.9605-2.4818 0.4853-0.7119 1.0938-1.2668 1.8256-1.6645 0.7318-0.39772 1.5472-0.59659 2.446-0.59659 0.6046 0 1.1514 0.09745 1.6406 0.29233 0.4932 0.19091 0.9029 0.48125 1.229 0.87103 0.3262 0.38581 0.5489 0.86901 0.6682 1.4497 0.1233 0.5807 0.1213 1.2608-6e-3 2.0403l-0.1133 0.6981h-7.7318l0.2446-1.575h5.3454c0.0597-0.366 0.0358-0.6901-0.0716-0.9725-0.1073-0.2824-0.2863-0.5031-0.5369-0.6622-0.2506-0.1631-0.5588-0.2446-0.9247-0.2446-0.3739 0-0.7239 0.0915-1.05 0.2744-0.3261 0.183-0.6006 0.4236-0.8233 0.7219-0.2188 0.2943-0.3599 0.6145-0.4236 0.9605l-0.2804 1.5631c-0.0795 0.4812-0.0636 0.8809 0.0477 1.1991 0.1154 0.3182 0.3142 0.5568 0.5966 0.7159 0.2824 0.1551 0.6404 0.2327 1.0739 0.2327 0.2824 0 0.5469-0.0398 0.7935-0.1193 0.2505-0.0796 0.4733-0.1969 0.6681-0.352 0.1949-0.1591 0.354-0.356 0.4773-0.5906l2.3208 0.1551c-0.2148 0.5648-0.541 1.0579-0.9785 1.4795-0.4375 0.4176-0.9644 0.7438-1.5809 0.9784-0.6125 0.2307-1.2986 0.3461-2.0583 0.3461zm10.057 0c-0.9387 0-1.7162-0.1909-2.3327-0.5728-0.6165-0.3858-1.05-0.9306-1.3006-1.6346-0.2466-0.708-0.2883-1.5452-0.1252-2.5117 0.159-0.9426 0.4792-1.7699 0.9605-2.4818 0.4852-0.7119 1.0937-1.2668 1.8255-1.6645 0.7319-0.39772 1.5472-0.59659 2.4462-0.59659 0.604 0 1.151 0.09745 1.64 0.29233 0.494 0.19091 0.903 0.48125 1.229 0.87103 0.327 0.38581 0.549 0.86901 0.669 1.4497 0.123 0.5807 0.121 1.2608-6e-3 2.0403l-0.114 0.6981h-7.7315l0.2446-1.575h5.3459c0.059-0.366 0.035-0.6901-0.072-0.9725s-0.286-0.5031-0.537-0.6622c-0.251-0.1631-0.559-0.2446-0.925-0.2446-0.374 0-0.724 0.0915-1.0497 0.2744-0.3261 0.183-0.6005 0.4236-0.8233 0.7219-0.2187 0.2943-0.3599 0.6145-0.4236 0.9605l-0.2804 1.5631c-0.0795 0.4812-0.0636 0.8809 0.0478 1.1991 0.1153 0.3182 0.3142 0.5568 0.5966 0.7159 0.2824 0.1551 0.6403 0.2327 1.0736 0.2327 0.283 0 0.547-0.0398 0.794-0.1193 0.25-0.0796 0.473-0.1969 0.668-0.352 0.195-0.1591 0.354-0.356 0.477-0.5906l2.321 0.1551c-0.215 0.5648-0.541 1.0579-0.979 1.4795-0.437 0.4176-0.964 0.7438-1.58 0.9784-0.613 0.2307-1.299 0.3461-2.0587 0.3461zm12.306-9.3426-0.316 1.909h-5.524l0.322-1.909h5.518zm-3.907-2.1954h2.541l-1.42 8.5432c-0.039 0.2346-0.033 0.4176 0.018 0.5488 0.052 0.1273 0.137 0.2168 0.257 0.2685 0.123 0.0517 0.27 0.0776 0.441 0.0776 0.12 0 0.241-0.01 0.364-0.0299 0.123-0.0238 0.217-0.0417 0.281-0.0537l0.095 1.8912c-0.143 0.0438-0.336 0.0915-0.579 0.1432-0.238 0.0517-0.521 0.0835-0.847 0.0955-0.62 0.0238-1.145-0.0577-1.575-0.2446-0.429-0.1909-0.738-0.4833-0.925-0.877-0.186-0.3938-0.226-0.8889-0.119-1.4855l1.468-8.8773zm8.802-0.85909-2.028 12.218h-2.541l2.028-12.218h2.541zm4.16 12.397c-0.938 0-1.716-0.1909-2.332-0.5728-0.617-0.3858-1.05-0.9306-1.301-1.6346-0.247-0.708-0.288-1.5452-0.125-2.5117 0.159-0.9426 0.479-1.7699 0.96-2.4818 0.485-0.7119 1.094-1.2668 1.826-1.6645 0.732-0.39772 1.547-0.59659 2.446-0.59659 0.604 0 1.151 0.09745 1.64 0.29233 0.494 0.19091 0.903 0.48125 1.229 0.87103 0.327 0.38581 0.549 0.86901 0.669 1.4497 0.123 0.5807 0.121 1.2608-6e-3 2.0403l-0.114 0.6981h-7.732l0.245-1.575h5.345c0.06-0.366 0.036-0.6901-0.071-0.9725s-0.286-0.5031-0.537-0.6622c-0.251-0.1631-0.559-0.2446-0.925-0.2446-0.374 0-0.724 0.0915-1.05 0.2744-0.326 0.183-0.6 0.4236-0.823 0.7219-0.219 0.2943-0.36 0.6145-0.424 0.9605l-0.28 1.5631c-0.08 0.4812-0.064 0.8809 0.048 1.1991 0.115 0.3182 0.314 0.5568 0.596 0.7159 0.283 0.1551 0.641 0.2327 1.074 0.2327 0.283 0 0.547-0.0398 0.794-0.1193 0.25-0.0796 0.473-0.1969 0.668-0.352 0.195-0.1591 0.354-0.356 0.477-0.5906l2.321 0.1551c-0.215 0.5648-0.541 1.0579-0.979 1.4795-0.437 0.4176-0.964 0.7438-1.581 0.9784-0.612 0.2307-1.298 0.3461-2.058 0.3461z" fill="currentColor"/>
      </svg>
      <svg id="svg-copy" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <clipPath id="a"><path d="m4 0v6h6v6h6v-12" /></clipPath>
        <g stroke="currentColor" stroke-width="1.5">
          <rect x="1.75" y="5.75" width="8.5" height="8.5" rx="2.25" />
          <rect x="5.75" y="1.75" width="8.5" height="8.5" rx="2.25" clip-path="url(#a)" />
        </g>
      </svg>
    </div>
    <script>function assert(condition) {
  if (!condition) {
    alert("Assertion failed");
    throw "Assertion failed";
  }
}

window.urlPrefix = "";

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register(urlPrefix + "/service-worker.js");
}

document.querySelector("article").focus();
const content = document.querySelector("article>.content");
const leftPane = document.querySelector(".left-pane");
const resizer = document.querySelector(".resizer");
resizer.addEventListener("mousedown", () => {
  resizer.classList.add("resizing");
  document.body.style.cursor = "col-resize";
  document.body.style.userSelect = document.body.style.webkitUserSelect = "none";
  document.addEventListener("mousemove", onMouseMove);
  document.addEventListener("mouseup", onMouseUp);
  function onMouseMove(e) {
    leftPane.style.width = Math.max(176, e.clientX) + "px";
    if (e.clientX < 130) {
      document.body.classList.add("sidenav-collapsed");
    } else if (e.clientX > 140) {
      document.body.classList.remove("sidenav-collapsed");
    }
  }
  function onMouseUp() {
    resizer.classList.remove("resizing");
    document.body.style.cursor = "";
    document.body.style.userSelect = document.body.style.webkitUserSelect = "";
    document.removeEventListener("mousemove", onMouseMove);
  }
});
resizer.addEventListener("dblclick", () => leftPane.style.removeProperty("width"));

const collapseButton = document.querySelector(".collapse-button");
collapseButton.addEventListener("click", () => document.body.classList.add("sidenav-collapsed"));
const expandButton = document.querySelector(".expand-button");
expandButton.addEventListener("click", () => document.body.classList.remove("sidenav-collapsed"));
document.addEventListener("keydown", event => {
  if (event.ctrlKey || event.altKey || event.metaKey) return;
  if (document.activeElement.tagName === "INPUT") return;
  if (event.key === "m") document.body.classList.toggle("sidenav-collapsed");
});

const menuButton = document.querySelector(".menu-button");
menuButton.addEventListener("click", () => {
  document.body.classList.toggle("mobile-expanded");
  if (leftPane.classList.contains("search-active")) closeSearch();
});

// Restore and save the state of the side navigation.
const navState = JSON.parse(localStorage.getItem("navState"));
if (navState) {
  leftPane.style.width = navState.width;
  if (navState.collapsed) document.body.classList.add("sidenav-collapsed");
  leftPane.scrollTop = navState.scrollTop;
}
window.addEventListener("beforeunload", () => {
  const navState = {
    width: leftPane.style.width,
    collapsed: document.body.classList.contains("sidenav-collapsed"),
    scrollTop: leftPane.scrollTop,
  };
  localStorage.setItem("navState", JSON.stringify(navState));
});

function syncSideNavWithLocation() {
  const target = document.querySelector("nav.side .target");
  if (target) target.classList.remove("target");
  document.querySelectorAll("nav.side details").forEach(details => details.open = false);

  let path = location.pathname;
  if (path.includes("single-page")) path = location.hash;
  if (path.length > 1) {
    document.querySelectorAll("nav.side a").forEach(a => {
      if (a.href.endsWith(path)) {
        a.classList.add("target");
        for (let parent = a.parentElement; parent; parent = parent.parentElement) {
          if (parent.tagName === "DETAILS") parent.open = true;
        }
      }
    });
  }
}

syncSideNavWithLocation();
addEventListener("hashchange", syncSideNavWithLocation);

function addContentEventHandlers() {
  function copyCode(button) {
    let codeBlock = button.nextElementSibling;
    navigator.clipboard.writeText(codeBlock.innerText).then(() => {
      const before = button.innerHTML;
      button.innerText = "Copied!";
      setTimeout(() => button.innerHTML = before, 1000);
    });
  }

  content.querySelectorAll("button.copy").forEach(button =>
    button.addEventListener("click", () => copyCode(button))
  );
}

addContentEventHandlers();
</script>
    
  </body>
</html>
