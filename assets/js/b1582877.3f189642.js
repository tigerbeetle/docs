"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4062],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),p=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(o.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),g=a,h=c["".concat(o,".").concat(g)]||c[g]||d[g]||i;return n?r.createElement(h,l(l({ref:t},u),{},{components:n})):r.createElement(h,l({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=g;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[c]="string"==typeof e?e:a,l[1]=s;for(var p=2;p<i;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},6247:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:6},l="Releases",s={unversionedId:"internals/releases",id:"internals/releases",title:"Releases",description:"How a new TigerBeetle release is made. Note that the process is being established, so this document",source:"@site/pages/internals/releases.md",sourceDirName:"internals",slug:"/internals/releases",permalink:"/internals/releases",draft:!1,editUrl:"https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/internals/releases.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Testing",permalink:"/internals/testing"}},o={},p=[{value:"What Is a Release?",id:"what-is-a-release",level:2},{value:"Publishing",id:"publishing",level:2},{value:"Versioning",id:"versioning",level:2},{value:"Release Process",id:"release-process",level:2},{value:"Changelog Guidelines",id:"changelog-guidelines",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"releases"},"Releases"),(0,a.kt)("p",null,"How a new TigerBeetle release is made. Note that the process is being established, so this document\nmight not perfectly reflect reality just yet."),(0,a.kt)("h2",{id:"what-is-a-release"},"What Is a Release?"),(0,a.kt)("p",null,"TigerBeetle is distributed in binary form. There are two main reasons for this:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"to ensure correctness and rule out large classes of configuration errors, the actual machine code\nmust be tested."),(0,a.kt)("li",{parentName:"ul"},"Zig is not stable yet. Binary releases insulate the users from this instability and keep the\nlanguage as an implementation detail.")),(0,a.kt)("p",null,"TigerBeetle binary is released in lockstep with client libraries. At the moment, implementation\nof the client libraries is tightly integrated and shares code with TigerBeetle, requiring matching\nversions."),(0,a.kt)("p",null,'Canonical form of the "release" is a ',(0,a.kt)("inlineCode",{parentName:"p"},"dist/")," folder with the following artifacts:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"tigerbeetle/")," subdirectory with ",(0,a.kt)("inlineCode",{parentName:"li"},".zip")," archived ",(0,a.kt)("inlineCode",{parentName:"li"},"tigerbeetle")," binaries built for all supported\narchitectures."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"dotnet/")," subdirectory with a Nuget package."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"go/")," subdirectory with the source code of the go client and precompiled native libraries for\nall supported platforms."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"java/")," subdirectory with a ",(0,a.kt)("inlineCode",{parentName:"li"},".jar")," file."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"node/")," subdirectory with a ",(0,a.kt)("inlineCode",{parentName:"li"},".tgz")," package for npm.")),(0,a.kt)("h2",{id:"publishing"},"Publishing"),(0,a.kt)("p",null,"Release artifacts are uploaded to appropriate package registries. GitHub release is used for\nsynchronization:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"a draft release is created at the start of the publishing process,"),(0,a.kt)("li",{parentName:"ul"},"artifacts are uploaded to GitHub releases, npm, Maven Central, and Nuget. For Go, a new commit\nis pushed to ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/tigerbeetle/tigerbeetle-go"},"https://github.com/tigerbeetle/tigerbeetle-go")),(0,a.kt)("li",{parentName:"ul"},"if publishing to all registries were successfully, the release is marked as non-draft.")),(0,a.kt)("p",null,"All publishing keys are stored as GitHub Actions in the ",(0,a.kt)("inlineCode",{parentName:"p"},"release")," environment."),(0,a.kt)("h2",{id:"versioning"},"Versioning"),(0,a.kt)("p",null,"Because releases are frequent, we avoid specifying the version in the source code. Instead, the\nversion is setup automatically by the release process itself, using sequential build numbers as the\npatch version. It might the case that a particular version is skipped (e.g., if a release partially\nfailed). It is also a possibility that two releases are functionally identical (this means that no\npull requests were merged in a week)."),(0,a.kt)("h2",{id:"release-process"},"Release Process"),(0,a.kt)("p",null,"Releases are triggered manually, on Monday. Default release rotation is stateless and determined by\nthe following one-liner:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ python3 -c \"import datetime; print((sorted(['batiati', 'cb22', 'kprotty', 'matklad', 'sentientwaffle']) * 142)[datetime.datetime.utcnow().isocalendar().week:][:3])\"\n        current release\n              V\n['batiati', 'cb22', 'kprotty']\n    ^                   ^ release next week\n    + previous release\n")),(0,a.kt)("p",null,"The middle name is the default release manager for the ",(0,a.kt)("em",{parentName:"p"},"current")," week. After the release, please\nping the next person to pass the baton."),(0,a.kt)("p",null,"Before triggering a release, update CHANGELOG.md with the changes since the last release. You can\nuse the following command to see all relevant merges:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ git fetch origin && git log --merges origin/release..origin/main\n")),(0,a.kt)("p",null,"After the changelog PR is merged, trigger a release  by pushing a commit from ",(0,a.kt)("inlineCode",{parentName:"p"},"origin/main")," to\n",(0,a.kt)("inlineCode",{parentName:"p"},"origin/release"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ git fetch origin && git push origin origin/main:release\n")),(0,a.kt)("p",null,"This triggers the ",(0,a.kt)("inlineCode",{parentName:"p"},"release.yml")," workflow. The workflow doesn't run unit-tests,\n",(0,a.kt)("a",{parentName:"p",href:"https://graydon2.dreamwidth.org/1597.html"},"not rocket science")," rule is assumed. The workflow\nrequires an approval of at least one other person."),(0,a.kt)("p",null,"If the release manager isn't available on Monday, a volunteer picks up that release. Releases can be\nskipped if there are not enough people to make a release (at least two are required) or if there\naren't any changes in a given week."),(0,a.kt)("h2",{id:"changelog-guidelines"},"Changelog Guidelines"),(0,a.kt)("p",null,"Purposes of the changelog:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'For everyone: give project a visible "pulse".'),(0,a.kt)("li",{parentName:"ul"},"For TigerBeetle developers: tell fine grained project evolution story, form shared context,\nprovide material for the monthly newsletter."),(0,a.kt)("li",{parentName:"ul"},"For TigerBeetle users: inform about all visible and potentially relevant changes.")),(0,a.kt)("p",null,"As such:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Consider skipping over trivial changes in the changelog."),(0,a.kt)("li",{parentName:"ul"},"Don't skip over meaningful changes of the internals, even if they are not externally visible."),(0,a.kt)("li",{parentName:"ul"},"If there is a story behind a series of pull requests, tell it."),(0,a.kt)("li",{parentName:"ul"},"And don't forget the TigerTrack of the week!")))}d.isMDXComponent=!0}}]);