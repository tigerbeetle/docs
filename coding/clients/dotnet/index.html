<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' plausible.io 'sha256-W1GNp3+VWjJioYCdm8AYiKdLkMCj2IaEzYszX8JFTh4='">
    <meta name="description" content="The financial transactions database to power the next 30 years of Online Transaction Processing.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@TigerBeetleDB">
    <meta name="twitter:author" content="@TigerBeetleDB">
    <meta name="twitter:description" content="The financial transactions database to power the next 30 years of Online Transaction Processing.">
    <meta name="twitter:title" content="tigerbeetle-dotnet">
    <meta name="twitter:image" content="https://docs.tigerbeetle.com/img/preview.webp">
    <meta property="og:type" content="website">
    <meta property="og:title" content="tigerbeetle-dotnet">
    <meta property="og:image" content="https://docs.tigerbeetle.com/img/preview.webp">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="TigerBeetle Team">
    <title id="title">tigerbeetle-dotnet</title>
    <link rel="icon" href="/img/favicon.png">
    <link rel="canonical" href="/coding/clients/dotnet/">
    <link rel="stylesheet" type="text/css" href="/style/style.css">
    <link rel="stylesheet" type="text/css" href="/style/highlight.css">
    <script defer data-domain="docs.tigerbeetle.com" src="https://plausible.io/js/script.js"></script>
  </head>
  <body>
    <a class="expand-button" title="Show menu (press M to toggle)">
      <div>
        <svg width="28" height="24" viewBox="0 0 28 24" aria-label="TigerBeetle logo">
          <use href="#svg-tigerbeetle-logo"></use>
        </svg>
        <svg class="tick" width="16" height="16" fill="none">
          <path d="M7 5L10 8L7 11" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
        </svg>
      </div>
    </a>
    <nav class="left-pane">
      <div class="top-wrapper">
        <div class="top">
          <header>
            <div class="logo">
              <a href="https://tigerbeetle.com" aria-label="TigerBeetle website">
                <svg width="127" height="24" viewBox="0 0 127 24" aria-label="TigerBeetle logo">
                  <use href="#svg-tigerbeetle-logo"></use>
                </svg>
              </a>
            </div>
            <div class="line"></div>
            <a href="/">Docs</a>
            <div class="spacer"></div>
            <a class="menu-button">
              <svg class="icon-burger" width="24" height="24">
                <path d="M2.5 5.5 21.5 5.5M2.5 12 21.5 12M2.5 18.5 21.5 18.5" stroke-width="1.5" stroke-linecap="round" stroke="currentColor" />
              </svg>
              <svg class="icon-x" width="24" height="24" fill="none">
                <path d="M6 6 18 18M6 18 18 6" stroke-width="1.5" stroke-linecap="round" stroke="currentColor" />
              </svg>
            </a>
            <a class="collapse-button" title="Hide menu (press M to toggle)">
              <svg width="16" height="16" fill="none">
                <path d="M7 5L4 8L7 11M12 5L9 8L12 11" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
              </svg>
            </a>
          </header>
                    <div class="search-box">
            <input type="search" placeholder="Search">
            <svg class="search-icon" width="16" height="16" fill="none">
              <circle cx="6.5" cy="6.5" r="4.5" stroke-width="1.5" stroke="currentColor"/>
              <path d="M10 10l4 4" stroke-width="1.5" stroke-linecap="round" stroke="currentColor"/>
            </svg>
            <a class="hotkey" title="Press / to activate search">
              <svg width="14" height="14" fill="none">
                <path d="m8.56 2.39-2.34 8.71h-0.77l2.34-8.71h0.77z" fill="var(--gray-11)"/>
              </svg>
            </a>
            <svg class="clear-button" width="16" height="16">
              <path d="m16 8a8 8 0 0 0-16 0 8 8 0 0 0 16 0m-9 0-2.5-2.5 1-1 2.5 2.5 2.5-2.5 1 1-2.5 2.5 2.5 2.5-1 1-2.5-2.5-2.5 2.5-1-1" fill="currentColor" />
            </svg>
          </div>
          <p class="search-stats"></p>

        </div>
      </div>
            <div class="search-results"></div>
      <div class="search-notfound">
        <picture>
          <source width="158" height="119" srcset="/img/notfound-light.webp" media="(prefers-color-scheme: light)">
          <source width="160" height="119" srcset="/img/notfound-dark.webp" media="(prefers-color-scheme: dark)">
          <img width="158" height="119" src="/img/notfound-light.webp" alt="Result not found illustration">
        </picture>
        <p>
          Still haven't found what you're looking for?<br>
          <a href="https://slack.tigerbeetle.com/join">Ask the TigerBeetle Slack Community.</a>
        </p>
      </div>

      <nav class="side">
        <ol>
<li class="item"><a href="/start/">Start</a></li>
<li>
<details><summary class="item"><a href="/concepts/">Concepts</a></summary>
<ol>
<li class="item"><a href="/concepts/oltp/">OLTP</a></li>
<li class="item"><a href="/concepts/debit-credit/">Debit-Credit</a></li>
<li class="item"><a href="/concepts/performance/">Performance</a></li>
<li class="item"><a href="/concepts/safety/">Safety</a></li>
</ol>
</details></li>
<li>
<details open><summary class="item"><a href="/coding/">Coding</a></summary>
<ol>
<li class="item"><a href="/coding/system-architecture/">System Architecture</a></li>
<li class="item"><a href="/coding/data-modeling/">Data Modeling</a></li>
<li class="item"><a href="/coding/financial-accounting/">Financial Accounting</a></li>
<li class="item"><a href="/coding/requests/">Requests</a></li>
<li class="item"><a href="/coding/reliable-transaction-submission/">Reliable Transaction Submission</a></li>
<li class="item"><a href="/coding/two-phase-transfers/">Two-Phase Transfers</a></li>
<li class="item"><a href="/coding/linked-events/">Linked Events</a></li>
<li class="item"><a href="/coding/time/">Time</a></li>
<li>
<details><summary class="item"><a href="/coding/recipes/">Recipes</a></summary>
<ol>
<li class="item"><a href="/coding/recipes/currency-exchange/">Currency Exchange</a></li>
<li class="item"><a href="/coding/recipes/multi-debit-credit-transfers/">Multi-Debit, Multi-Credit Transfers</a></li>
<li class="item"><a href="/coding/recipes/close-account/">Closing Accounts</a></li>
<li class="item"><a href="/coding/recipes/balance-conditional-transfers/">Balance-Conditional Transfers</a></li>
<li class="item"><a href="/coding/recipes/balance-invariant-transfers/">Balance-Invariant Transfers</a></li>
<li class="item"><a href="/coding/recipes/balance-bounds/">Balance Bounds</a></li>
<li class="item"><a href="/coding/recipes/correcting-transfers/">Correcting Transfers</a></li>
<li class="item"><a href="/coding/recipes/rate-limiting/">Rate Limiting</a></li>
</ol>
</details></li>
<li>
<details open><summary class="item"><a href="/coding/clients/">Clients</a></summary>
<ol>
<li class="item"><a href="/coding/clients/dotnet/" class="target">.Net</a></li>
<li class="item"><a href="/coding/clients/go/">Go</a></li>
<li class="item"><a href="/coding/clients/java/">Java</a></li>
<li class="item"><a href="/coding/clients/node/">Node</a></li>
<li class="item"><a href="/coding/clients/python/">Python</a></li>
</ol>
</details></li>
</ol>
</details></li>
<li>
<details><summary class="item"><a href="/operating/">Operating</a></summary>
<ol>
<li class="item"><a href="/operating/installing/">Installing</a></li>
<li class="item"><a href="/operating/hardware/">Hardware</a></li>
<li class="item"><a href="/operating/cluster/">Cluster</a></li>
<li>
<details><summary class="item"><a href="/operating/deploying/">Deploying</a></summary>
<ol>
<li class="item"><a href="/operating/deploying/systemd/">systemd</a></li>
<li class="item"><a href="/operating/deploying/docker/">Docker</a></li>
<li class="item"><a href="/operating/deploying/managed-service/">Managed</a></li>
</ol>
</details></li>
<li class="item"><a href="/operating/upgrading/">Upgrading</a></li>
</ol>
</details></li>
<li>
<details><summary class="item"><a href="/reference/">Reference</a></summary>
<ol>
<li class="item"><a href="/reference/sessions/">Client Sessions</a></li>
<li class="item"><a href="/reference/account/">Account</a></li>
<li class="item"><a href="/reference/transfer/">Transfer</a></li>
<li class="item"><a href="/reference/account-balance/">AccountBalance</a></li>
<li class="item"><a href="/reference/account-filter/">AccountFilter</a></li>
<li class="item"><a href="/reference/query-filter/">QueryFilter</a></li>
<li>
<details><summary class="item"><a href="/reference/requests/">Requests</a></summary>
<ol>
<li class="item"><a href="/reference/requests/create_accounts/">create_accounts</a></li>
<li class="item"><a href="/reference/requests/create_transfers/">create_transfers</a></li>
<li class="item"><a href="/reference/requests/lookup_accounts/">lookup_accounts</a></li>
<li class="item"><a href="/reference/requests/lookup_transfers/">lookup_transfers</a></li>
<li class="item"><a href="/reference/requests/get_account_transfers/">get_account_transfers</a></li>
<li class="item"><a href="/reference/requests/get_account_balances/">get_account_balances</a></li>
<li class="item"><a href="/reference/requests/query_accounts/">query_accounts</a></li>
<li class="item"><a href="/reference/requests/query_transfers/">query_transfers</a></li>
</ol>
</details></li>
</ol>
</details></li>
</ol>
        <a id="single-page-link" href="/single-page/">
          <svg width="16" height="24" fill="none" viewBox="0 0 16 24" xmlns="http://www.w3.org/2000/svg">
            <path d="m14.031 8.5938v11.031c0 .5523-.4477 1-1 1h-10.063c-.55228 0-1-.4477-1-1v-14.969c0-.55228.44772-1 1-1h6.0625m5 4.9375-5-4.9375m5 4.9375h-4c-.55228 0-1-.44772-1-1v-3.9375M6.8125 13l1.375-1.375v4.8125" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          Single Page
        </a>

      </nav>
    </nav>
    <div class="resizer"></div>
    <main>
      <article>
        <aside id="note-nested-css">Note: this site uses nested CSS selectors. Please upgrade your browser or use the reader mode.</aside>
        <a id="github-link" href="https://github.com/tigerbeetle/tigerbeetle">
          GitHub
          <svg width="16" height="16">
            <path d="M5.75 4.75H11.25M11.25 4.75V10.25M11.25 4.75L4.75 11.25" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
          </svg>
        </a>
        <div class="content">
          <!-- This file is generated by [/src/scripts/client_readmes.zig](/src/scripts/client_readmes.zig). -->

<h1 id="tigerbeetle-dotnet"><a href="#tigerbeetle-dotnet"
class="anchor">tigerbeetle-dotnet</a></h1>
<p>The TigerBeetle client for .NET.</p>
<h2 id="prerequisites"><a href="#prerequisites"
class="anchor">Prerequisites</a></h2>
<p>Linux &gt;= 5.6 is the only production environment we support. But
for ease of development we also support macOS and Windows.</p>
<ul>
<li>.NET &gt;= 8.0.</li>
</ul>
<p>And if you do not already have NuGet.org as a package source, make
sure to add it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>dotnet nuget add source https://api.nuget.org/v3/index.json -n nuget.org</code></pre>
</div>
<h2 id="setup"><a href="#setup" class="anchor">Setup</a></h2>
<p>First, create a directory for your project and <code>cd</code> into
the directory.</p>
<p>Then, install the TigerBeetle client:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>dotnet new console
dotnet add package tigerbeetle</code></pre>
</div>
<p>Now, create <code>Program.cs</code> and copy this into it:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb3"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> TigerBeetle<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Validate import works.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;SUCCESS&quot;</span><span class="op">);</span></span></code></pre></div>
</div>
<p>Finally, build and run:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<pre class="console"><code>dotnet run</code></pre>
</div>
<p>Now that all prerequisites and dependencies are correctly set up,
letâ€™s dig into using TigerBeetle.</p>
<h2 id="sample-projects"><a href="#sample-projects"
class="anchor">Sample projects</a></h2>
<p>This document is primarily a reference guide to the client. Below are
various sample projects demonstrating features of TigerBeetle.</p>
<ul>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/samples/basic/">Basic</a>:
Create two accounts and transfer an amount between them.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/samples/two-phase/">Two-Phase
Transfer</a>: Create two accounts and start a pending transfer between
them, then post the transfer.</li>
<li><a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/samples/two-phase-many/">Many
Two-Phase Transfers</a>: Create two accounts and start a number of
pending transfer between them, posting and voiding alternating
transfers.</li>
</ul>
<h2 id="creating-a-client"><a href="#creating-a-client"
class="anchor">Creating a Client</a></h2>
<p>A client is created with a cluster ID and replica addresses for all
replicas in the cluster. The cluster ID and replica addresses are both
chosen by the system that starts the TigerBeetle cluster.</p>
<p>Clients are thread-safe and a single instance should be shared
between multiple concurrent tasks.</p>
<p>Multiple clients are useful when connecting to more than one
TigerBeetle cluster.</p>
<p>In this example the cluster ID is <code>0</code> and there is one
replica. The address is read from the <code>TB_ADDRESS</code>
environment variable and defaults to port <code>3000</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb5"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> tbAddress <span class="op">=</span> Environment<span class="op">.</span><span class="fu">GetEnvironmentVariable</span><span class="op">(</span><span class="st">&quot;TB_ADDRESS&quot;</span><span class="op">);</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> clusterID <span class="op">=</span> UInt128<span class="op">.</span><span class="fu">Zero</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> addresses <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> tbAddress <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> tbAddress <span class="op">:</span> <span class="st">&quot;3000&quot;</span> <span class="op">};</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="op">(</span><span class="dt">var</span> client <span class="op">=</span> <span class="kw">new</span> <span class="fu">Client</span><span class="op">(</span>clusterID<span class="op">,</span> addresses<span class="op">))</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use client</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>The <code>Client</code> class is thread-safe and for better
performance, a single instance should be shared between multiple
concurrent tasks. Multiple clients can be instantiated in case of
connecting to more than one TigerBeetle cluster.</p>
<p>The following are valid addresses:</p>
<ul>
<li><code>3000</code> (interpreted as <code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1:3000</code> (interpreted as
<code>127.0.0.1:3000</code>)</li>
<li><code>127.0.0.1</code> (interpreted as <code>127.0.0.1:3001</code>,
<code>3001</code> is the default port)</li>
</ul>
<h2 id="creating-accounts"><a href="#creating-accounts"
class="anchor">Creating Accounts</a></h2>
<p>See details for account fields in the <a
href="/reference/account">Accounts reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb6"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accounts <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Account</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> ID<span class="op">.</span><span class="fu">Create</span><span class="op">(),</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">718</span><span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        Timestamp <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span>accounts<span class="op">);</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="/coding/data-modeling#tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<p>The <code>UInt128</code> fields like <code>ID</code>,
<code>UserData128</code>, <code>Amount</code> and account balances have
a few extension methods to make it easier to convert 128-bit
little-endian unsigned integers between <code>BigInteger</code>,
<code>byte[]</code>, and <code>Guid</code>.</p>
<p>See the class <a
href="https://github.com/tigerbeetle/tigerbeetle/blob/main/src/clients/dotnet/TigerBeetle/UInt128Extensions.cs">UInt128Extensions</a>
for more details.</p>
<h3 id="account-flags"><a href="#account-flags" class="anchor">Account
Flags</a></h3>
<p>The account flags value is a bitfield. See details for these flags in
the <a href="/reference/account#flags">Accounts reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>AccountFlags</code> object with bitwise-or:</p>
<ul>
<li><code>AccountFlags.None</code></li>
<li><code>AccountFlags.Linked</code></li>
<li><code>AccountFlags.DebitsMustNotExceedCredits</code></li>
<li><code>AccountFlags.CreditsMustNotExceedDebits</code></li>
<li><code>AccountFlags.History</code></li>
</ul>
<p>For example, to link two accounts where the first account
additionally has the <code>debits_must_not_exceed_credits</code>
constraint:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb7"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account0 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">|</span> AccountFlags<span class="op">.</span><span class="fu">DebitsMustNotExceedCredits</span><span class="op">,</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account1 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">101</span><span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">History</span><span class="op">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> account0<span class="op">,</span> account1 <span class="op">});</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="response-and-errors"><a href="#response-and-errors"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all accounts were created
successfully. If the response is non-empty, each object in the response
array contains error information for an account that failed. The error
object contains an error code and the index of the account in the
request batch.</p>
<p>See all error conditions in the <a
href="/reference/requests/create_accounts">create_accounts
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb8"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account0 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account1 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> account2 <span class="op">=</span> <span class="kw">new</span> Account</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">104</span><span class="op">,</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> account0<span class="op">,</span> account1<span class="op">,</span> account2 <span class="op">});</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> error <span class="kw">in</span> accountErrors<span class="op">)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">switch</span> <span class="op">(</span>error<span class="op">.</span><span class="fu">Result</span><span class="op">)</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">case</span> CreateAccountResult<span class="op">.</span><span class="fu">Exists</span><span class="op">:</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch account at ${error.Index} already exists.&quot;</span><span class="op">);</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch account at ${error.Index} failed to create ${error.Result}&quot;</span><span class="op">);</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span><span class="op">;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="account-lookup"><a href="#account-lookup" class="anchor">Account
Lookup</a></h2>
<p>Account lookup is batched, like account creation. Pass in all IDs to
fetch. The account for each matched ID is returned.</p>
<p>If no account matches an ID, no object is returned for that account.
So the order of accounts in the response is not necessarily the same as
the order of IDs in the request. You can refer to the ID field in the
response to distinguish accounts.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb9"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Account<span class="op">[]</span> accounts <span class="op">=</span> client<span class="op">.</span><span class="fu">LookupAccounts</span><span class="op">(</span><span class="kw">new</span> UInt128<span class="op">[]</span> <span class="op">{</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">101</span> <span class="op">});</span></span></code></pre></div>
</div>
<h2 id="create-transfers"><a href="#create-transfers"
class="anchor">Create Transfers</a></h2>
<p>This creates a journal entry between two accounts.</p>
<p>See details for transfer fields in the <a
href="/reference/transfer">Transfers reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb10"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfers <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> ID<span class="op">.</span><span class="fu">Create</span><span class="op">(),</span> <span class="co">// TigerBeetle time-based ID.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        Timeout <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        Timestamp <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<p>See details for the recommended ID scheme in <a
href="/coding/data-modeling#tigerbeetle-time-based-identifiers-recommended">time-based
identifiers</a>.</p>
<h3 id="response-and-errors-1"><a href="#response-and-errors-1"
class="anchor">Response and Errors</a></h3>
<p>The response is an empty array if all transfers were created
successfully. If the response is non-empty, each object in the response
array contains error information for a transfer that failed. The error
object contains an error code and the index of the transfer in the
request batch.</p>
<p>See all error conditions in the <a
href="/reference/requests/create_transfers">create_transfers
reference</a>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb11"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfers <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> Transfer</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>        DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>        Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>        Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>transfers<span class="op">);</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> error <span class="kw">in</span> transferErrors<span class="op">)</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">switch</span> <span class="op">(</span>error<span class="op">.</span><span class="fu">Result</span><span class="op">)</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">case</span> CreateTransferResult<span class="op">.</span><span class="fu">Exists</span><span class="op">:</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch transfer at ${error.Index} already exists.&quot;</span><span class="op">);</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">default</span><span class="op">:</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>$<span class="st">&quot;Batch transfer at ${error.Index} failed to create: ${error.Result}&quot;</span><span class="op">);</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h2 id="batching"><a href="#batching" class="anchor">Batching</a></h2>
<p>TigerBeetle performance is maximized when you batch API requests. A
client instance shared across multiple threads/tasks can automatically
batch concurrent requests, but the application must still send as many
events as possible in a single call. For example, if you insert 1
million transfers sequentially, one at a time, the insert rate will be a
<em>fraction</em> of the potential, because the client will wait for a
reply between each one.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb12"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> batch <span class="op">=</span> <span class="kw">new</span> Transfer<span class="op">[]</span> <span class="op">{</span> <span class="op">};</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> t <span class="kw">in</span> batch<span class="op">)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfer</span><span class="op">(</span>t<span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<p>Instead, <strong>always batch as much as you can</strong>. The
maximum batch size is set in the TigerBeetle server. The default is
8189.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb13"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> batch <span class="op">=</span> <span class="kw">new</span> Transfer<span class="op">[]</span> <span class="op">{</span> <span class="op">};</span> <span class="co">// Array of transfer to create.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> BATCH_SIZE <span class="op">=</span> <span class="dv">8189</span><span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> firstIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> firstIndex <span class="op">&lt;</span> batch<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> firstIndex <span class="op">+=</span> BATCH_SIZE<span class="op">)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> lastIndex <span class="op">=</span> firstIndex <span class="op">+</span> BATCH_SIZE<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>lastIndex <span class="op">&gt;</span> batch<span class="op">.</span><span class="fu">Length</span><span class="op">)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        lastIndex <span class="op">=</span> batch<span class="op">.</span><span class="fu">Length</span><span class="op">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>batch<span class="op">[</span>firstIndex<span class="op">..</span><span class="fu">lastIndex</span><span class="op">]);</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Error handling omitted.</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<h3 id="queues-and-workers"><a href="#queues-and-workers"
class="anchor">Queues and Workers</a></h3>
<p>If you are making requests to TigerBeetle from workers pulling jobs
from a queue, you can batch requests to TigerBeetle by having the worker
act on multiple jobs from the queue at once rather than one at a time.
i.e. pulling multiple jobs from the queue rather than just one.</p>
<h2 id="transfer-flags"><a href="#transfer-flags"
class="anchor">Transfer Flags</a></h2>
<p>The transfer <code>flags</code> value is a bitfield. See details for
these flags in the <a href="/reference/transfer#flags">Transfers
reference</a>.</p>
<p>To toggle behavior for an account, combine enum values stored in the
<code>TransferFlags</code> object with bitwise-or:</p>
<ul>
<li><code>TransferFlags.None</code></li>
<li><code>TransferFlags.Linked</code></li>
<li><code>TransferFlags.Pending</code></li>
<li><code>TransferFlags.PostPendingTransfer</code></li>
<li><code>TransferFlags.VoidPendingTransfer</code></li>
</ul>
<p>For example, to link <code>transfer0</code> and
<code>transfer1</code>:</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb14"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer0 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span><span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer1 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">None</span><span class="op">,</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer0<span class="op">,</span> transfer1 <span class="op">});</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h3 id="two-phase-transfers"><a href="#two-phase-transfers"
class="anchor">Two-Phase Transfers</a></h3>
<p>Two-phase transfers are supported natively by toggling the
appropriate flag. TigerBeetle will then adjust the
<code>credits_pending</code> and <code>debits_pending</code> fields of
the appropriate accounts. A corresponding post pending transfer then
needs to be sent to post or void the transfer.</p>
<h4 id="post-a-pending-transfer"><a href="#post-a-pending-transfer"
class="anchor">Post a Pending Transfer</a></h4>
<p>With <code>flags</code> set to <code>post_pending_transfer</code>,
TigerBeetle will post the transfer. TigerBeetle will atomically roll
back the changes to <code>debits_pending</code> and
<code>credits_pending</code> of the appropriate accounts and apply them
to the <code>debits_posted</code> and <code>credits_posted</code>
balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb15"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer0 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Pending</span><span class="op">,</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer0 <span class="op">});</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer1 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Post the entire pending amount.</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> Transfer<span class="op">.</span><span class="fu">AmountMax</span><span class="op">,</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    PendingId <span class="op">=</span> <span class="dv">6</span><span class="op">,</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">PostPendingTransfer</span><span class="op">,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer1 <span class="op">});</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h4 id="void-a-pending-transfer"><a href="#void-a-pending-transfer"
class="anchor">Void a Pending Transfer</a></h4>
<p>In contrast, with <code>flags</code> set to
<code>void_pending_transfer</code>, TigerBeetle will void the transfer.
TigerBeetle will roll back the changes to <code>debits_pending</code>
and <code>credits_pending</code> of the appropriate accounts and
<strong>not</strong> apply them to the <code>debits_posted</code> and
<code>credits_posted</code> balances.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb16"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer0 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    DebitAccountId <span class="op">=</span> <span class="dv">102</span><span class="op">,</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    CreditAccountId <span class="op">=</span> <span class="dv">103</span><span class="op">,</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Pending</span><span class="op">,</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer0 <span class="op">});</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfer1 <span class="op">=</span> <span class="kw">new</span> Transfer</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    Id <span class="op">=</span> <span class="dv">9</span><span class="op">,</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Post the entire pending amount.</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    Amount <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    PendingId <span class="op">=</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">VoidPendingTransfer</span><span class="op">,</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span><span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> transfer1 <span class="op">});</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="transfer-lookup"><a href="#transfer-lookup"
class="anchor">Transfer Lookup</a></h2>
<p>NOTE: While transfer lookup exists, it is not a flexible query API.
We are developing query APIs and there will be new methods for querying
transfers in the future.</p>
<p>Transfer lookup is batched, like transfer creation. Pass in all
<code>id</code>s to fetch, and matched transfers are returned.</p>
<p>If no transfer matches an <code>id</code>, no object is returned for
that transfer. So the order of transfers in the response is not
necessarily the same as the order of <code>id</code>s in the request.
You can refer to the <code>id</code> field in the response to
distinguish transfers.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb17"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Transfer<span class="op">[]</span> transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">LookupTransfers</span><span class="op">(</span><span class="kw">new</span> UInt128<span class="op">[]</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span> <span class="op">});</span></span></code></pre></div>
</div>
<h2 id="get-account-transfers"><a href="#get-account-transfers"
class="anchor">Get Account Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the transfers involving a given account, allowing basic
filter and pagination capabilities.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb18"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> AccountFilter</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    AccountId <span class="op">=</span> <span class="dv">101</span><span class="op">,</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Code.</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten transfers at most.</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFilterFlags<span class="op">.</span><span class="fu">Debits</span> <span class="op">|</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Credits</span> <span class="op">|</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>Transfer<span class="op">[]</span> transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">GetAccountTransfers</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="get-account-balances"><a href="#get-account-balances"
class="anchor">Get Account Balances</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Fetches the point-in-time balances of a given account, allowing basic
filter and pagination capabilities.</p>
<p>Only accounts created with the flag <a
href="/reference/account#flagshistory"><code>history</code></a> set
retain <a href="/reference/requests/get_account_balances">historical
balances</a>.</p>
<p>The balances in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb19"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> AccountFilter</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    AccountId <span class="op">=</span> <span class="dv">101</span><span class="op">,</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by UserData.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Code.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> AccountFilterFlags<span class="op">.</span><span class="fu">Debits</span> <span class="op">|</span> <span class="co">// Include transfer from the debit side.</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Credits</span> <span class="op">|</span> <span class="co">// Include transfer from the credit side.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        AccountFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>AccountBalance<span class="op">[]</span> accountBalances <span class="op">=</span> client<span class="op">.</span><span class="fu">GetAccountBalances</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="query-accounts"><a href="#query-accounts" class="anchor">Query
Accounts</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query accounts by the intersection of some fields and by timestamp
range.</p>
<p>The accounts in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb20"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> QueryFilter</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// Filter by UserData.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// Filter by Code.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Ledger.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> QueryFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>Account<span class="op">[]</span> accounts <span class="op">=</span> client<span class="op">.</span><span class="fu">QueryAccounts</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="query-transfers"><a href="#query-transfers" class="anchor">Query
Transfers</a></h2>
<p>NOTE: This is a preview API that is subject to breaking changes once
we have a stable querying API.</p>
<p>Query transfers by the intersection of some fields and by timestamp
range.</p>
<p>The transfers in the response are sorted by <code>timestamp</code> in
chronological or reverse-chronological order.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb21"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> filter <span class="op">=</span> <span class="kw">new</span> QueryFilter</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    UserData128 <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// Filter by UserData</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    UserData64 <span class="op">=</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    UserData32 <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    Code <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="co">// Filter by Code</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    Ledger <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Ledger</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    TimestampMin <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    TimestampMax <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="co">// No filter by Timestamp.</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    Limit <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="co">// Limit to ten balances at most.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    Flags <span class="op">=</span> QueryFilterFlags<span class="op">.</span><span class="fu">Reversed</span><span class="op">,</span> <span class="co">// Sort by timestamp in reverse-chronological order.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>Transfer<span class="op">[]</span> transfers <span class="op">=</span> client<span class="op">.</span><span class="fu">QueryTransfers</span><span class="op">(</span>filter<span class="op">);</span></span></code></pre></div>
</div>
<h2 id="linked-events"><a href="#linked-events" class="anchor">Linked
Events</a></h2>
<p>When the <code>linked</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it links that
event with the next event in the batch, to create a chain of events, of
arbitrary length, which all succeed or fail together. The tail of a
chain is denoted by the first event without this flag. The last event in
a batch may therefore never have the <code>linked</code> flag set as
this would leave a chain open-ended. Multiple chains or individual
events may coexist within a batch to succeed or fail independently.</p>
<p>Events within a chain are executed within order, or are rolled back
on error, so that the effect of each event in the chain is visible to
the next, and so that the chain is either visible or invisible as a unit
to subsequent events after the chain. The event that was the first to
break the chain will have a unique error result. Other events in the
chain will have their error result set to
<code>linked_event_failed</code>.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb22"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> batch <span class="op">=</span> <span class="kw">new</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">.</span><span class="fu">List</span><span class="op">&lt;</span>Transfer<span class="op">&gt;();</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 4 transfers (the last transfer in the chain closes the chain with linked=false):</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span> <span class="co">// Commit/rollback.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span> <span class="co">// Fail with exists</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span> <span class="co">// Fail without committing</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">// An individual transfer (successful):</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">// This should not see any effect from the failed chain above.</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (the first transfer fails the chain):</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">// A chain of 2 transfers (successful):</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> Flags <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span> <span class="op">});</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>batch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> Transfer <span class="op">{</span> Id <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> <span class="co">/* ... rest of transfer ... */</span> <span class="op">});</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>batch<span class="op">.</span><span class="fu">ToArray</span><span class="op">());</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span></code></pre></div>
</div>
<h2 id="imported-events"><a href="#imported-events"
class="anchor">Imported Events</a></h2>
<p>When the <code>imported</code> flag is specified for an account when
creating accounts or a transfer when creating transfers, it allows
importing historical events with a user-defined timestamp.</p>
<p>The entire batch of events must be set with the flag
<code>imported</code>.</p>
<p>Itâ€™s recommended to submit the whole batch as a <code>linked</code>
chain of events, ensuring that if any event fails, none of them are
committed, preserving the last timestamp unchanged. This approach gives
the application a chance to correct failed imported events,
re-submitting the batch again with the same user-defined timestamps.</p>
<div class="code-wrapper">
<button class="copy" title="Copy">
    <svg width="16" height="16"><use href="#svg-copy"></use></svg>
</button>
    
<div class="sourceCode" id="cb23"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// External source of time</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ulong</span> historicalTimestamp <span class="op">=</span> <span class="dv">0UL</span><span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> historicalAccounts <span class="op">=</span> <span class="kw">new</span> Account<span class="op">[]</span> <span class="op">{</span> <span class="co">/* Loaded from an external source */</span> <span class="op">};</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> historicalTransfers <span class="op">=</span> <span class="kw">new</span> Transfer<span class="op">[]</span> <span class="op">{</span> <span class="co">/* Loaded from an external source */</span> <span class="op">};</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">// First, load and import all accounts with their timestamps from the historical source.</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountsBatch <span class="op">=</span> <span class="kw">new</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">.</span><span class="fu">List</span><span class="op">&lt;</span>Account<span class="op">&gt;();</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> historicalAccounts<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> index<span class="op">++)</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> account <span class="op">=</span> historicalAccounts<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span><span class="fu">Timestamp</span> <span class="op">=</span> historicalTimestamp<span class="op">;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the account as `imported`.</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    account<span class="op">.</span><span class="fu">Flags</span> <span class="op">=</span> AccountFlags<span class="op">.</span><span class="fu">Imported</span><span class="op">;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// must be `linked`.</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>index <span class="op">&lt;</span> historicalAccounts<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>        account<span class="op">.</span><span class="fu">Flags</span> <span class="op">|=</span> AccountFlags<span class="op">.</span><span class="fu">Linked</span><span class="op">;</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    accountsBatch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>account<span class="op">);</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> accountErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateAccounts</span><span class="op">(</span>accountsBatch<span class="op">.</span><span class="fu">ToArray</span><span class="op">());</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Then, load and import all transfers with their timestamps from the historical source.</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transfersBatch <span class="op">=</span> <span class="kw">new</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">.</span><span class="fu">List</span><span class="op">&lt;</span>Transfer<span class="op">&gt;();</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> historicalTransfers<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> index<span class="op">++)</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> transfer <span class="op">=</span> historicalTransfers<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set a unique and strictly increasing timestamp.</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    historicalTimestamp <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span><span class="fu">Timestamp</span> <span class="op">=</span> historicalTimestamp<span class="op">;</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Set the account as `imported`.</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    transfer<span class="op">.</span><span class="fu">Flags</span> <span class="op">=</span> TransferFlags<span class="op">.</span><span class="fu">Imported</span><span class="op">;</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// To ensure atomicity, the entire batch (except the last event in the chain)</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// must be `linked`.</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>index <span class="op">&lt;</span> historicalTransfers<span class="op">.</span><span class="fu">Length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        transfer<span class="op">.</span><span class="fu">Flags</span> <span class="op">|=</span> TransferFlags<span class="op">.</span><span class="fu">Linked</span><span class="op">;</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    transfersBatch<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>transfer<span class="op">);</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> transferErrors <span class="op">=</span> client<span class="op">.</span><span class="fu">CreateTransfers</span><span class="op">(</span>transfersBatch<span class="op">.</span><span class="fu">ToArray</span><span class="op">());</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling omitted.</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Since it is a linked chain, in case of any error the entire batch is rolled back and can be retried</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a><span class="co">// with the same historical timestamps without regressing the cluster timestamp.</span></span></code></pre></div>
</div>
<a class="edit-link" href="https://github.com/tigerbeetle/tigerbeetle/edit/main/src/clients/dotnet/README.md">
  <svg width="16" height="16" fill="none">
    <path d="M10 4L12 6M8.667 13.333H14M3.333 10.667L2.667 13.333L5.333 12.667L13.0574 4.94263C13.3074 4.69259 13.4478 4.35351 13.4478 4C13.4478 3.64641 13.3074 3.30733 13.0574 3.05729L12.9427 2.94263C12.6927 2.69267 12.3536 2.55225 12 2.55225C11.6465 2.55225 11.3075 2.69267 11.0574 2.94263L3.333 10.667Z" stroke-width="1.333" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"/>
  </svg>
  Edit this page
</a>

        </div>
      </article>
    </main>
    <div id="svg-templates" style="width: 0; height: 0; overflow: hidden;" aria-hidden="true">
      <svg id="svg-tigerbeetle-logo" width="127" height="24" viewBox="0 0 127 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="m20.637 6.4656h-20.637c0-3.5378 3.1347-6.4656 6.7918-6.4656h20.637c0 3.5378-3.1347 6.4656-6.7919 6.4656z" fill="currentColor"/>
        <path d="m8.0098 22.84 1.4016-9.5939c0.59548-4.076 4.0996-7.1037 8.2215-7.1037l-1.8889 12.465c-0.6421 2.9286-4.0162 4.867-7.7342 4.2322z" fill="currentColor"/>
        <path d="m32.351 7.7116 0.3579-2.1298h10.035l-0.358 2.1298h-3.7406l-1.6705 10.088h-2.5534l1.6705-10.088h-3.7406zm9.969 10.088 1.5273-9.1636h2.5414l-1.5272 9.1636h-2.5415zm3.0605-10.357c-0.3778 0-0.69-0.12528-0.9366-0.37585-0.2427-0.25455-0.3421-0.55682-0.2983-0.90682 0.0437-0.35796 0.2147-0.66023 0.513-0.90682 0.2983-0.25057 0.6364-0.37585 1.0142-0.37585 0.3779 0 0.6861 0.12528 0.9248 0.37585 0.2386 0.24659 0.338 0.54886 0.2983 0.90682-0.0398 0.35-0.2089 0.65227-0.5072 0.90682-0.2943 0.25057-0.6303 0.37585-1.0082 0.37585zm5.0725 13.984c-0.8272 0-1.5173-0.1134-2.0701-0.3401-0.5489-0.2227-0.9665-0.527-1.2529-0.9128-0.2824-0.3858-0.4375-0.8193-0.4653-1.3005l2.4102-0.3162c0.0437 0.1869 0.1273 0.3599 0.2506 0.519 0.1272 0.1591 0.3082 0.2864 0.5429 0.3818 0.2386 0.0955 0.5468 0.1432 0.9247 0.1432 0.5528 0 1.0341-0.1352 1.4437-0.4057 0.4097-0.2665 0.6622-0.7139 0.7577-1.3423l0.2744-1.6764h-0.1074c-0.1511 0.2545-0.3579 0.4951-0.6204 0.7218-0.2585 0.2267-0.5747 0.4117-0.9486 0.5549-0.3699 0.1431-0.7974 0.2147-1.2827 0.2147-0.692 0-1.2926-0.1591-1.8017-0.4772-0.5051-0.3222-0.871-0.8134-1.0977-1.4736-0.2227-0.6642-0.2506-1.5034-0.0835-2.5176 0.175-1.0381 0.4892-1.9051 0.9426-2.6012 0.4534-0.69599 0.9903-1.217 1.6108-1.563s1.2668-0.51904 1.9389-0.51904c0.5131 0 0.9267 0.0875 1.2409 0.2625 0.3182 0.17103 0.5628 0.3858 0.7338 0.64432 0.1711 0.25455 0.2924 0.50512 0.364 0.75175h0.1014l0.2505-1.5392h2.5236l-1.5392 9.2532c-0.1233 0.7835-0.4196 1.4358-0.8889 1.9568-0.4653 0.525-1.056 0.9187-1.7719 1.1812-0.7159 0.2665-1.5094 0.3998-2.3804 0.3998zm0.9546-5.6677c0.4057 0 0.7696-0.1014 1.0917-0.3042 0.3262-0.2068 0.5986-0.5012 0.8174-0.883 0.2187-0.3858 0.3718-0.8471 0.4593-1.3841 0.0875-0.5369 0.0855-1.0022-0.0059-1.396-0.0875-0.3977-0.2586-0.7059-0.5131-0.9247-0.2506-0.2187-0.5807-0.3281-0.9903-0.3281-0.4216 0-0.7915 0.1133-1.1097 0.34-0.3182 0.2228-0.5827 0.533-0.7935 0.9307-0.2068 0.3977-0.352 0.8571-0.4355 1.3781-0.0875 0.529-0.0915 0.9864-0.0119 1.3722 0.0835 0.3818 0.2486 0.6781 0.4952 0.8889 0.2466 0.2068 0.5787 0.3102 0.9963 0.3102zm10.273 2.2194c-0.9387 0-1.7162-0.1909-2.3327-0.5728-0.6165-0.3858-1.05-0.9306-1.3006-1.6346-0.2466-0.708-0.2883-1.5452-0.1253-2.5117 0.1591-0.9426 0.4793-1.7699 0.9606-2.4818 0.4852-0.7119 1.0937-1.2668 1.8255-1.6645 0.7318-0.39772 1.5472-0.59659 2.446-0.59659 0.6046 0 1.1515 0.09745 1.6407 0.29233 0.4932 0.19091 0.9028 0.48125 1.2289 0.87103 0.3262 0.38581 0.5489 0.86901 0.6682 1.4497 0.1233 0.5807 0.1213 1.2608-0.0059 2.0403l-0.1134 0.6981h-7.7318l0.2446-1.575h5.3454c0.0597-0.366 0.0358-0.6901-0.0715-0.9725-0.1074-0.2824-0.2864-0.5031-0.537-0.6622-0.2505-0.1631-0.5588-0.2446-0.9247-0.2446-0.3739 0-0.7239 0.0915-1.05 0.2744-0.3261 0.183-0.6006 0.4236-0.8233 0.7219-0.2187 0.2943-0.3599 0.6145-0.4236 0.9605l-0.2804 1.5631c-0.0795 0.4812-0.0636 0.8809 0.0478 1.1991 0.1153 0.3182 0.3142 0.5568 0.5966 0.7159 0.2823 0.1551 0.6403 0.2327 1.0738 0.2327 0.2824 0 0.5469-0.0398 0.7935-0.1193 0.2506-0.0796 0.4733-0.1969 0.6682-0.352 0.1949-0.1591 0.3539-0.356 0.4772-0.5906l2.3208 0.1551c-0.2148 0.5648-0.5409 1.0579-0.9784 1.4795-0.4375 0.4176-0.9645 0.7438-1.581 0.9784-0.6125 0.2307-1.2986 0.3461-2.0582 0.3461zm5.9047-0.179 1.5273-9.1636h2.4639l-0.2684 1.5988h0.0954c0.2625-0.56873 0.6145-0.99828 1.056-1.2886 0.4454-0.29432 0.9247-0.44148 1.4378-0.44148 0.1272 0 0.2605 0.00796 0.3997 0.02386 0.1432 0.01194 0.2704 0.03182 0.3818 0.05966l-0.3818 2.2611c-0.1114-0.0398-0.2705-0.0716-0.4773-0.0955-0.2028-0.0278-0.3957-0.0417-0.5787-0.0417-0.3699 0-0.7139 0.0815-1.0321 0.2446-0.3182 0.1591-0.5866 0.3818-0.8054 0.6682-0.2148 0.2863-0.356 0.6164-0.4236 0.9903l-0.8531 5.1844h-2.5415zm6.922 0 2.0284-12.218h4.892c0.8989 0 1.6267 0.13323 2.1835 0.39971 0.5608 0.26648 0.9526 0.63637 1.1753 1.1097 0.2228 0.46932 0.2824 1.0102 0.179 1.6227-0.0835 0.47727-0.2525 0.89488-0.5071 1.2528-0.2506 0.35795-0.5608 0.65225-0.9307 0.88295s-0.7716 0.3938-1.2051 0.4892l-0.0239 0.1193c0.4614 0.0199 0.877 0.1512 1.2469 0.3938 0.3699 0.2386 0.6463 0.5767 0.8293 1.0142 0.1829 0.4375 0.2247 0.9565 0.1253 1.5571-0.1074 0.6483-0.364 1.227-0.7696 1.7361-0.4057 0.5051-0.9466 0.9048-1.6228 1.1991-0.6721 0.2943-1.4656 0.4415-2.3804 0.4415h-5.2201zm2.9412-2.1119h2.1059c0.7159 0 1.2628-0.1392 1.6407-0.4177 0.3778-0.2784 0.6045-0.6463 0.6801-1.1037 0.0517-0.338 0.0179-0.6363-0.1015-0.8948-0.1153-0.2586-0.3122-0.4614-0.5906-0.6086-0.2744-0.1471-0.6224-0.2207-1.044-0.2207h-2.1597l-0.5309 3.2455zm0.8292-4.9935h1.9151c0.35 0 0.6741-0.0617 0.9724-0.185 0.3023-0.1272 0.5509-0.3062 0.7458-0.53688 0.1988-0.23466 0.3241-0.51108 0.3758-0.82927 0.0716-0.44545-0.0278-0.80142-0.2983-1.0679-0.2665-0.27046-0.6841-0.40569-1.2528-0.40569h-1.9568l-0.5012 3.0247zm11.441 7.2844c-0.9386 0-1.7161-0.1909-2.3326-0.5728-0.6165-0.3858-1.05-0.9306-1.3006-1.6346-0.2466-0.708-0.2883-1.5452-0.1253-2.5117 0.1591-0.9426 0.4793-1.7699 0.9605-2.4818 0.4853-0.7119 1.0938-1.2668 1.8256-1.6645 0.7318-0.39772 1.5472-0.59659 2.446-0.59659 0.6046 0 1.1514 0.09745 1.6406 0.29233 0.4932 0.19091 0.9029 0.48125 1.229 0.87103 0.3262 0.38581 0.5489 0.86901 0.6682 1.4497 0.1233 0.5807 0.1213 1.2608-6e-3 2.0403l-0.1133 0.6981h-7.7318l0.2446-1.575h5.3454c0.0597-0.366 0.0358-0.6901-0.0716-0.9725-0.1073-0.2824-0.2863-0.5031-0.5369-0.6622-0.2506-0.1631-0.5588-0.2446-0.9247-0.2446-0.3739 0-0.7239 0.0915-1.05 0.2744-0.3261 0.183-0.6006 0.4236-0.8233 0.7219-0.2188 0.2943-0.3599 0.6145-0.4236 0.9605l-0.2804 1.5631c-0.0795 0.4812-0.0636 0.8809 0.0477 1.1991 0.1154 0.3182 0.3142 0.5568 0.5966 0.7159 0.2824 0.1551 0.6404 0.2327 1.0739 0.2327 0.2824 0 0.5469-0.0398 0.7935-0.1193 0.2505-0.0796 0.4733-0.1969 0.6681-0.352 0.1949-0.1591 0.354-0.356 0.4773-0.5906l2.3208 0.1551c-0.2148 0.5648-0.541 1.0579-0.9785 1.4795-0.4375 0.4176-0.9644 0.7438-1.5809 0.9784-0.6125 0.2307-1.2986 0.3461-2.0583 0.3461zm10.057 0c-0.9387 0-1.7162-0.1909-2.3327-0.5728-0.6165-0.3858-1.05-0.9306-1.3006-1.6346-0.2466-0.708-0.2883-1.5452-0.1252-2.5117 0.159-0.9426 0.4792-1.7699 0.9605-2.4818 0.4852-0.7119 1.0937-1.2668 1.8255-1.6645 0.7319-0.39772 1.5472-0.59659 2.4462-0.59659 0.604 0 1.151 0.09745 1.64 0.29233 0.494 0.19091 0.903 0.48125 1.229 0.87103 0.327 0.38581 0.549 0.86901 0.669 1.4497 0.123 0.5807 0.121 1.2608-6e-3 2.0403l-0.114 0.6981h-7.7315l0.2446-1.575h5.3459c0.059-0.366 0.035-0.6901-0.072-0.9725s-0.286-0.5031-0.537-0.6622c-0.251-0.1631-0.559-0.2446-0.925-0.2446-0.374 0-0.724 0.0915-1.0497 0.2744-0.3261 0.183-0.6005 0.4236-0.8233 0.7219-0.2187 0.2943-0.3599 0.6145-0.4236 0.9605l-0.2804 1.5631c-0.0795 0.4812-0.0636 0.8809 0.0478 1.1991 0.1153 0.3182 0.3142 0.5568 0.5966 0.7159 0.2824 0.1551 0.6403 0.2327 1.0736 0.2327 0.283 0 0.547-0.0398 0.794-0.1193 0.25-0.0796 0.473-0.1969 0.668-0.352 0.195-0.1591 0.354-0.356 0.477-0.5906l2.321 0.1551c-0.215 0.5648-0.541 1.0579-0.979 1.4795-0.437 0.4176-0.964 0.7438-1.58 0.9784-0.613 0.2307-1.299 0.3461-2.0587 0.3461zm12.306-9.3426-0.316 1.909h-5.524l0.322-1.909h5.518zm-3.907-2.1954h2.541l-1.42 8.5432c-0.039 0.2346-0.033 0.4176 0.018 0.5488 0.052 0.1273 0.137 0.2168 0.257 0.2685 0.123 0.0517 0.27 0.0776 0.441 0.0776 0.12 0 0.241-0.01 0.364-0.0299 0.123-0.0238 0.217-0.0417 0.281-0.0537l0.095 1.8912c-0.143 0.0438-0.336 0.0915-0.579 0.1432-0.238 0.0517-0.521 0.0835-0.847 0.0955-0.62 0.0238-1.145-0.0577-1.575-0.2446-0.429-0.1909-0.738-0.4833-0.925-0.877-0.186-0.3938-0.226-0.8889-0.119-1.4855l1.468-8.8773zm8.802-0.85909-2.028 12.218h-2.541l2.028-12.218h2.541zm4.16 12.397c-0.938 0-1.716-0.1909-2.332-0.5728-0.617-0.3858-1.05-0.9306-1.301-1.6346-0.247-0.708-0.288-1.5452-0.125-2.5117 0.159-0.9426 0.479-1.7699 0.96-2.4818 0.485-0.7119 1.094-1.2668 1.826-1.6645 0.732-0.39772 1.547-0.59659 2.446-0.59659 0.604 0 1.151 0.09745 1.64 0.29233 0.494 0.19091 0.903 0.48125 1.229 0.87103 0.327 0.38581 0.549 0.86901 0.669 1.4497 0.123 0.5807 0.121 1.2608-6e-3 2.0403l-0.114 0.6981h-7.732l0.245-1.575h5.345c0.06-0.366 0.036-0.6901-0.071-0.9725s-0.286-0.5031-0.537-0.6622c-0.251-0.1631-0.559-0.2446-0.925-0.2446-0.374 0-0.724 0.0915-1.05 0.2744-0.326 0.183-0.6 0.4236-0.823 0.7219-0.219 0.2943-0.36 0.6145-0.424 0.9605l-0.28 1.5631c-0.08 0.4812-0.064 0.8809 0.048 1.1991 0.115 0.3182 0.314 0.5568 0.596 0.7159 0.283 0.1551 0.641 0.2327 1.074 0.2327 0.283 0 0.547-0.0398 0.794-0.1193 0.25-0.0796 0.473-0.1969 0.668-0.352 0.195-0.1591 0.354-0.356 0.477-0.5906l2.321 0.1551c-0.215 0.5648-0.541 1.0579-0.979 1.4795-0.437 0.4176-0.964 0.7438-1.581 0.9784-0.612 0.2307-1.298 0.3461-2.058 0.3461z" fill="currentColor"/>
      </svg>
      <svg id="svg-copy" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <clipPath id="a"><path d="m4 0v6h6v6h6v-12" /></clipPath>
        <g stroke="currentColor" stroke-width="1.5">
          <rect x="1.75" y="5.75" width="8.5" height="8.5" rx="2.25" />
          <rect x="5.75" y="1.75" width="8.5" height="8.5" rx="2.25" clip-path="url(#a)" />
        </g>
      </svg>
    </div>
    <script>function assert(condition) {
  if (!condition) {
    alert("Assertion failed");
    throw "Assertion failed";
  }
}

window.urlPrefix = "";

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register(urlPrefix + "/service-worker.js");
}

document.querySelector("article").focus();
const content = document.querySelector("article>.content");
const leftPane = document.querySelector(".left-pane");
const resizer = document.querySelector(".resizer");
resizer.addEventListener("mousedown", () => {
  resizer.classList.add("resizing");
  document.body.style.cursor = "col-resize";
  document.body.style.userSelect = document.body.style.webkitUserSelect = "none";
  document.addEventListener("mousemove", onMouseMove);
  document.addEventListener("mouseup", onMouseUp);
  function onMouseMove(e) {
    leftPane.style.width = Math.max(176, e.clientX) + "px";
    if (e.clientX < 130) {
      document.body.classList.add("sidenav-collapsed");
    } else if (e.clientX > 140) {
      document.body.classList.remove("sidenav-collapsed");
    }
  }
  function onMouseUp() {
    resizer.classList.remove("resizing");
    document.body.style.cursor = "";
    document.body.style.userSelect = document.body.style.webkitUserSelect = "";
    document.removeEventListener("mousemove", onMouseMove);
  }
});
resizer.addEventListener("dblclick", () => leftPane.style.removeProperty("width"));

const collapseButton = document.querySelector(".collapse-button");
collapseButton.addEventListener("click", () => document.body.classList.add("sidenav-collapsed"));
const expandButton = document.querySelector(".expand-button");
expandButton.addEventListener("click", () => document.body.classList.remove("sidenav-collapsed"));
document.addEventListener("keydown", event => {
  if (event.ctrlKey || event.altKey || event.metaKey) return;
  if (document.activeElement.tagName === "INPUT") return;
  if (event.key === "m") document.body.classList.toggle("sidenav-collapsed");
});

const menuButton = document.querySelector(".menu-button");
menuButton.addEventListener("click", () => {
  document.body.classList.toggle("mobile-expanded");
  if (leftPane.classList.contains("search-active")) closeSearch();
});

// Restore and save the state of the side navigation.
const navState = JSON.parse(localStorage.getItem("navState"));
if (navState) {
  leftPane.style.width = navState.width;
  if (navState.collapsed) document.body.classList.add("sidenav-collapsed");
  leftPane.scrollTop = navState.scrollTop;
}
window.addEventListener("beforeunload", () => {
  const navState = {
    width: leftPane.style.width,
    collapsed: document.body.classList.contains("sidenav-collapsed"),
    scrollTop: leftPane.scrollTop,
  };
  localStorage.setItem("navState", JSON.stringify(navState));
});

function syncSideNavWithLocation() {
  const target = document.querySelector("nav.side .target");
  if (target) target.classList.remove("target");
  document.querySelectorAll("nav.side details").forEach(details => details.open = false);

  let path = location.pathname;
  if (path.includes("single-page")) path = location.hash;
  if (path.length > 1) {
    document.querySelectorAll("nav.side a").forEach(a => {
      if (a.href.endsWith(path)) {
        a.classList.add("target");
        for (let parent = a.parentElement; parent; parent = parent.parentElement) {
          if (parent.tagName === "DETAILS") parent.open = true;
        }
      }
    });
  }
}

syncSideNavWithLocation();
addEventListener("hashchange", syncSideNavWithLocation);

function addContentEventHandlers() {
  function copyCode(button) {
    let codeBlock = button.nextElementSibling;
    navigator.clipboard.writeText(codeBlock.innerText).then(() => {
      const before = button.innerHTML;
      button.innerText = "Copied!";
      setTimeout(() => button.innerHTML = before, 1000);
    });
  }

  content.querySelectorAll("button.copy").forEach(button =>
    button.addEventListener("click", () => copyCode(button))
  );
}

addContentEventHandlers();
</script>
    <script src="/js/search.js"></script>
  </body>
</html>
